/*-----LICENCE------
 * NextAdmin.Core.js Framework v1.0.0
 * Copyright (c) 2023, Maxime AVART
 * Licensed under the MIT License:
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 *
 * This project uses the following components:
 *
 * - Perfect-scrollbar
 *   License: MIT (https://github.com/mdbootstrap/perfect-scrollbar/blob/main/LICENSE)
 *
 * - Quill
 *   License: BSD 3-Clause (https://github.com/slab/quill/blob/main/LICENSE)
 *
 * - Animate.css
 *   License: Hippocratic License (https://github.com/animate-css/animate.css/blob/main/LICENSE)
 
------------------*/ 
var NextAdmin;
(function (NextAdmin) {
    class Style {
        static append(key, value) {
            if (NextAdmin.DependenciesController.registeredDependencies[key] == null) {
                NextAdmin.DependenciesController.registeredDependencies[key] = value;
                let style = document.createElement("style");
                style.textContent = value;
                document.head.appendChild(style);
            }
        }
        static load(url, key) {
            if (key == null) {
                key = url;
            }
            let style = NextAdmin.DependenciesController.registeredDependencies[key];
            return new Promise((resolve, reject) => {
                if (style == null) {
                    let style = document.createElement("link");
                    style.addEventListener('load', () => {
                        style['_loaded'] = true;
                        resolve(style);
                    });
                    NextAdmin.DependenciesController.registeredDependencies[key] = style;
                    style.href = url;
                    style.rel = 'stylesheet';
                    document.head.appendChild(style);
                }
                else {
                    if (style['_loaded']) {
                        resolve(style);
                    }
                    else {
                        style.addEventListener('load', () => {
                            resolve(style);
                        });
                    }
                }
            });
        }
        static exist(key) {
            return NextAdmin.DependenciesController.registeredDependencies[key] != null;
        }
    }
    NextAdmin.Style = Style;
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Style.ts"/>
var NextAdmin;
(function (NextAdmin) {
    class Animation {
        static registerStyle() {
            if (!NextAdmin.Style.exist('Animate')) { //check if style already exit before call to avoid pass big string on stack 
                NextAdmin.Style.append('Animate', NextAdmin.Animation.animateStyle);
            }
        }
        static animate(element, animation, options) {
            if (options == null) {
                options = {};
            }
            this.registerStyle();
            if (!element.classList.contains('animated')) {
                element.classList.add('animated');
            }
            if (element['previousAnim'] != undefined) {
                element.classList.remove(element['previousAnim']);
            }
            element['previousAnim'] = animation;
            element.classList.add(animation);
            if (options.animationSpeed != null) {
                element.classList.add(options.animationSpeed);
            }
            this.playingAnimationElements.push(element);
            let animationEnded = false;
            setTimeout(() => {
                if (!animationEnded) {
                    element.trigger('animationend');
                }
            }, 1000);
            element.addEventsListener('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', () => {
                if (animationEnded)
                    return;
                this.playingAnimationElements.splice(this.playingAnimationElements.indexOf(element), 1);
                animationEnded = true;
                if (!NextAdmin.String.isNullOrEmpty(element['previousAnim'])) {
                    element.classList.remove(element['previousAnim']);
                    delete element['previousAnim'];
                } //-webkit-animation-duration
                if (options.onEndAnimation != undefined && options.onEndAnimation != null) {
                    options.onEndAnimation();
                }
            });
        }
    }
    Animation.playingAnimationElements = new Array();
    Animation.animateStyle = `@-webkit-keyframes bounce{0%,20%,53%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1);-webkit-transform:translateZ(0);transform:translateZ(0)}40%,43%{-webkit-animation-timing-function:cubic-bezier(.755,.05,.855,.06);animation-timing-function:cubic-bezier(.755,.05,.855,.06);-webkit-transform:translate3d(0,-30px,0);transform:translate3d(0,-30px,0)}70%{-webkit-animation-timing-function:cubic-bezier(.755,.05,.855,.06);animation-timing-function:cubic-bezier(.755,.05,.855,.06);-webkit-transform:translate3d(0,-15px,0);transform:translate3d(0,-15px,0)}90%{-webkit-transform:translate3d(0,-4px,0);transform:translate3d(0,-4px,0)}}@keyframes bounce{0%,20%,53%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1);-webkit-transform:translateZ(0);transform:translateZ(0)}40%,43%{-webkit-animation-timing-function:cubic-bezier(.755,.05,.855,.06);animation-timing-function:cubic-bezier(.755,.05,.855,.06);-webkit-transform:translate3d(0,-30px,0);transform:translate3d(0,-30px,0)}70%{-webkit-animation-timing-function:cubic-bezier(.755,.05,.855,.06);animation-timing-function:cubic-bezier(.755,.05,.855,.06);-webkit-transform:translate3d(0,-15px,0);transform:translate3d(0,-15px,0)}90%{-webkit-transform:translate3d(0,-4px,0);transform:translate3d(0,-4px,0)}}.bounce{-webkit-animation-name:bounce;animation-name:bounce;-webkit-transform-origin:center bottom;transform-origin:center bottom}@-webkit-keyframes flash{0%,50%,to{opacity:1}25%,75%{opacity:0}}@keyframes flash{0%,50%,to{opacity:1}25%,75%{opacity:0}}.flash{-webkit-animation-name:flash;animation-name:flash}@-webkit-keyframes pulse{0%{-webkit-transform:scaleX(1);transform:scaleX(1)}50%{-webkit-transform:scale3d(1.05,1.05,1.05);transform:scale3d(1.05,1.05,1.05)}to{-webkit-transform:scaleX(1);transform:scaleX(1)}}@keyframes pulse{0%{-webkit-transform:scaleX(1);transform:scaleX(1)}50%{-webkit-transform:scale3d(1.05,1.05,1.05);transform:scale3d(1.05,1.05,1.05)}to{-webkit-transform:scaleX(1);transform:scaleX(1)}}.pulse{-webkit-animation-name:pulse;animation-name:pulse}@-webkit-keyframes rubberBand{0%{-webkit-transform:scaleX(1);transform:scaleX(1)}30%{-webkit-transform:scale3d(1.25,.75,1);transform:scale3d(1.25,.75,1)}40%{-webkit-transform:scale3d(.75,1.25,1);transform:scale3d(.75,1.25,1)}50%{-webkit-transform:scale3d(1.15,.85,1);transform:scale3d(1.15,.85,1)}65%{-webkit-transform:scale3d(.95,1.05,1);transform:scale3d(.95,1.05,1)}75%{-webkit-transform:scale3d(1.05,.95,1);transform:scale3d(1.05,.95,1)}to{-webkit-transform:scaleX(1);transform:scaleX(1)}}@keyframes rubberBand{0%{-webkit-transform:scaleX(1);transform:scaleX(1)}30%{-webkit-transform:scale3d(1.25,.75,1);transform:scale3d(1.25,.75,1)}40%{-webkit-transform:scale3d(.75,1.25,1);transform:scale3d(.75,1.25,1)}50%{-webkit-transform:scale3d(1.15,.85,1);transform:scale3d(1.15,.85,1)}65%{-webkit-transform:scale3d(.95,1.05,1);transform:scale3d(.95,1.05,1)}75%{-webkit-transform:scale3d(1.05,.95,1);transform:scale3d(1.05,.95,1)}to{-webkit-transform:scaleX(1);transform:scaleX(1)}}.rubberBand{-webkit-animation-name:rubberBand;animation-name:rubberBand}@-webkit-keyframes shake{0%,to{-webkit-transform:translateZ(0);transform:translateZ(0)}10%,30%,50%,70%,90%{-webkit-transform:translate3d(-10px,0,0);transform:translate3d(-10px,0,0)}20%,40%,60%,80%{-webkit-transform:translate3d(10px,0,0);transform:translate3d(10px,0,0)}}@keyframes shake{0%,to{-webkit-transform:translateZ(0);transform:translateZ(0)}10%,30%,50%,70%,90%{-webkit-transform:translate3d(-10px,0,0);transform:translate3d(-10px,0,0)}20%,40%,60%,80%{-webkit-transform:translate3d(10px,0,0);transform:translate3d(10px,0,0)}}.shake{-webkit-animation-name:shake;animation-name:shake}@-webkit-keyframes headShake{0%{-webkit-transform:translateX(0);transform:translateX(0)}6.5%{-webkit-transform:translateX(-6px) rotateY(-9deg);transform:translateX(-6px) rotateY(-9deg)}18.5%{-webkit-transform:translateX(5px) rotateY(7deg);transform:translateX(5px) rotateY(7deg)}31.5%{-webkit-transform:translateX(-3px) rotateY(-5deg);transform:translateX(-3px) rotateY(-5deg)}43.5%{-webkit-transform:translateX(2px) rotateY(3deg);transform:translateX(2px) rotateY(3deg)}50%{-webkit-transform:translateX(0);transform:translateX(0)}}@keyframes headShake{0%{-webkit-transform:translateX(0);transform:translateX(0)}6.5%{-webkit-transform:translateX(-6px) rotateY(-9deg);transform:translateX(-6px) rotateY(-9deg)}18.5%{-webkit-transform:translateX(5px) rotateY(7deg);transform:translateX(5px) rotateY(7deg)}31.5%{-webkit-transform:translateX(-3px) rotateY(-5deg);transform:translateX(-3px) rotateY(-5deg)}43.5%{-webkit-transform:translateX(2px) rotateY(3deg);transform:translateX(2px) rotateY(3deg)}50%{-webkit-transform:translateX(0);transform:translateX(0)}}.headShake{-webkit-animation-timing-function:ease-in-out;animation-timing-function:ease-in-out;-webkit-animation-name:headShake;animation-name:headShake}@-webkit-keyframes swing{20%{-webkit-transform:rotate(15deg);transform:rotate(15deg)}40%{-webkit-transform:rotate(-10deg);transform:rotate(-10deg)}60%{-webkit-transform:rotate(5deg);transform:rotate(5deg)}80%{-webkit-transform:rotate(-5deg);transform:rotate(-5deg)}to{-webkit-transform:rotate(0deg);transform:rotate(0deg)}}@keyframes swing{20%{-webkit-transform:rotate(15deg);transform:rotate(15deg)}40%{-webkit-transform:rotate(-10deg);transform:rotate(-10deg)}60%{-webkit-transform:rotate(5deg);transform:rotate(5deg)}80%{-webkit-transform:rotate(-5deg);transform:rotate(-5deg)}to{-webkit-transform:rotate(0deg);transform:rotate(0deg)}}.swing{-webkit-transform-origin:top center;transform-origin:top center;-webkit-animation-name:swing;animation-name:swing}@-webkit-keyframes tada{0%{-webkit-transform:scaleX(1);transform:scaleX(1)}10%,20%{-webkit-transform:scale3d(.9,.9,.9) rotate(-3deg);transform:scale3d(.9,.9,.9) rotate(-3deg)}30%,50%,70%,90%{-webkit-transform:scale3d(1.1,1.1,1.1) rotate(3deg);transform:scale3d(1.1,1.1,1.1) rotate(3deg)}40%,60%,80%{-webkit-transform:scale3d(1.1,1.1,1.1) rotate(-3deg);transform:scale3d(1.1,1.1,1.1) rotate(-3deg)}to{-webkit-transform:scaleX(1);transform:scaleX(1)}}@keyframes tada{0%{-webkit-transform:scaleX(1);transform:scaleX(1)}10%,20%{-webkit-transform:scale3d(.9,.9,.9) rotate(-3deg);transform:scale3d(.9,.9,.9) rotate(-3deg)}30%,50%,70%,90%{-webkit-transform:scale3d(1.1,1.1,1.1) rotate(3deg);transform:scale3d(1.1,1.1,1.1) rotate(3deg)}40%,60%,80%{-webkit-transform:scale3d(1.1,1.1,1.1) rotate(-3deg);transform:scale3d(1.1,1.1,1.1) rotate(-3deg)}to{-webkit-transform:scaleX(1);transform:scaleX(1)}}.tada{-webkit-animation-name:tada;animation-name:tada}@-webkit-keyframes wobble{0%{-webkit-transform:translateZ(0);transform:translateZ(0)}15%{-webkit-transform:translate3d(-25%,0,0) rotate(-5deg);transform:translate3d(-25%,0,0) rotate(-5deg)}30%{-webkit-transform:translate3d(20%,0,0) rotate(3deg);transform:translate3d(20%,0,0) rotate(3deg)}45%{-webkit-transform:translate3d(-15%,0,0) rotate(-3deg);transform:translate3d(-15%,0,0) rotate(-3deg)}60%{-webkit-transform:translate3d(10%,0,0) rotate(2deg);transform:translate3d(10%,0,0) rotate(2deg)}75%{-webkit-transform:translate3d(-5%,0,0) rotate(-1deg);transform:translate3d(-5%,0,0) rotate(-1deg)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes wobble{0%{-webkit-transform:translateZ(0);transform:translateZ(0)}15%{-webkit-transform:translate3d(-25%,0,0) rotate(-5deg);transform:translate3d(-25%,0,0) rotate(-5deg)}30%{-webkit-transform:translate3d(20%,0,0) rotate(3deg);transform:translate3d(20%,0,0) rotate(3deg)}45%{-webkit-transform:translate3d(-15%,0,0) rotate(-3deg);transform:translate3d(-15%,0,0) rotate(-3deg)}60%{-webkit-transform:translate3d(10%,0,0) rotate(2deg);transform:translate3d(10%,0,0) rotate(2deg)}75%{-webkit-transform:translate3d(-5%,0,0) rotate(-1deg);transform:translate3d(-5%,0,0) rotate(-1deg)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}.wobble{-webkit-animation-name:wobble;animation-name:wobble}@-webkit-keyframes jello{0%,11.1%,to{-webkit-transform:translateZ(0);transform:translateZ(0)}22.2%{-webkit-transform:skewX(-12.5deg) skewY(-12.5deg);transform:skewX(-12.5deg) skewY(-12.5deg)}33.3%{-webkit-transform:skewX(6.25deg) skewY(6.25deg);transform:skewX(6.25deg) skewY(6.25deg)}44.4%{-webkit-transform:skewX(-3.125deg) skewY(-3.125deg);transform:skewX(-3.125deg) skewY(-3.125deg)}55.5%{-webkit-transform:skewX(1.5625deg) skewY(1.5625deg);transform:skewX(1.5625deg) skewY(1.5625deg)}66.6%{-webkit-transform:skewX(-.78125deg) skewY(-.78125deg);transform:skewX(-.78125deg) skewY(-.78125deg)}77.7%{-webkit-transform:skewX(.390625deg) skewY(.390625deg);transform:skewX(.390625deg) skewY(.390625deg)}88.8%{-webkit-transform:skewX(-.1953125deg) skewY(-.1953125deg);transform:skewX(-.1953125deg) skewY(-.1953125deg)}}@keyframes jello{0%,11.1%,to{-webkit-transform:translateZ(0);transform:translateZ(0)}22.2%{-webkit-transform:skewX(-12.5deg) skewY(-12.5deg);transform:skewX(-12.5deg) skewY(-12.5deg)}33.3%{-webkit-transform:skewX(6.25deg) skewY(6.25deg);transform:skewX(6.25deg) skewY(6.25deg)}44.4%{-webkit-transform:skewX(-3.125deg) skewY(-3.125deg);transform:skewX(-3.125deg) skewY(-3.125deg)}55.5%{-webkit-transform:skewX(1.5625deg) skewY(1.5625deg);transform:skewX(1.5625deg) skewY(1.5625deg)}66.6%{-webkit-transform:skewX(-.78125deg) skewY(-.78125deg);transform:skewX(-.78125deg) skewY(-.78125deg)}77.7%{-webkit-transform:skewX(.390625deg) skewY(.390625deg);transform:skewX(.390625deg) skewY(.390625deg)}88.8%{-webkit-transform:skewX(-.1953125deg) skewY(-.1953125deg);transform:skewX(-.1953125deg) skewY(-.1953125deg)}}.jello{-webkit-animation-name:jello;animation-name:jello;-webkit-transform-origin:center;transform-origin:center}@-webkit-keyframes heartBeat{0%{-webkit-transform:scale(1);transform:scale(1)}14%{-webkit-transform:scale(1.3);transform:scale(1.3)}28%{-webkit-transform:scale(1);transform:scale(1)}42%{-webkit-transform:scale(1.3);transform:scale(1.3)}70%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes heartBeat{0%{-webkit-transform:scale(1);transform:scale(1)}14%{-webkit-transform:scale(1.3);transform:scale(1.3)}28%{-webkit-transform:scale(1);transform:scale(1)}42%{-webkit-transform:scale(1.3);transform:scale(1.3)}70%{-webkit-transform:scale(1);transform:scale(1)}}.heartBeat{-webkit-animation-name:heartBeat;animation-name:heartBeat;-webkit-animation-duration:1.3s;animation-duration:1.3s;-webkit-animation-timing-function:ease-in-out;animation-timing-function:ease-in-out}@-webkit-keyframes bounceIn{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}20%{-webkit-transform:scale3d(1.1,1.1,1.1);transform:scale3d(1.1,1.1,1.1)}40%{-webkit-transform:scale3d(.9,.9,.9);transform:scale3d(.9,.9,.9)}60%{opacity:1;-webkit-transform:scale3d(1.03,1.03,1.03);transform:scale3d(1.03,1.03,1.03)}80%{-webkit-transform:scale3d(.97,.97,.97);transform:scale3d(.97,.97,.97)}to{opacity:1;-webkit-transform:scaleX(1);transform:scaleX(1)}}@keyframes bounceIn{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}20%{-webkit-transform:scale3d(1.1,1.1,1.1);transform:scale3d(1.1,1.1,1.1)}40%{-webkit-transform:scale3d(.9,.9,.9);transform:scale3d(.9,.9,.9)}60%{opacity:1;-webkit-transform:scale3d(1.03,1.03,1.03);transform:scale3d(1.03,1.03,1.03)}80%{-webkit-transform:scale3d(.97,.97,.97);transform:scale3d(.97,.97,.97)}to{opacity:1;-webkit-transform:scaleX(1);transform:scaleX(1)}}.bounceIn{-webkit-animation-duration:.75s;animation-duration:.75s;-webkit-animation-name:bounceIn;animation-name:bounceIn}@-webkit-keyframes bounceInDown{0%,60%,75%,90%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;-webkit-transform:translate3d(0,-3000px,0);transform:translate3d(0,-3000px,0)}60%{opacity:1;-webkit-transform:translate3d(0,25px,0);transform:translate3d(0,25px,0)}75%{-webkit-transform:translate3d(0,-10px,0);transform:translate3d(0,-10px,0)}90%{-webkit-transform:translate3d(0,5px,0);transform:translate3d(0,5px,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes bounceInDown{0%,60%,75%,90%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;-webkit-transform:translate3d(0,-3000px,0);transform:translate3d(0,-3000px,0)}60%{opacity:1;-webkit-transform:translate3d(0,25px,0);transform:translate3d(0,25px,0)}75%{-webkit-transform:translate3d(0,-10px,0);transform:translate3d(0,-10px,0)}90%{-webkit-transform:translate3d(0,5px,0);transform:translate3d(0,5px,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}.bounceInDown{-webkit-animation-name:bounceInDown;animation-name:bounceInDown}@-webkit-keyframes bounceInLeft{0%,60%,75%,90%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;-webkit-transform:translate3d(-3000px,0,0);transform:translate3d(-3000px,0,0)}60%{opacity:1;-webkit-transform:translate3d(25px,0,0);transform:translate3d(25px,0,0)}75%{-webkit-transform:translate3d(-10px,0,0);transform:translate3d(-10px,0,0)}90%{-webkit-transform:translate3d(5px,0,0);transform:translate3d(5px,0,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes bounceInLeft{0%,60%,75%,90%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;-webkit-transform:translate3d(-3000px,0,0);transform:translate3d(-3000px,0,0)}60%{opacity:1;-webkit-transform:translate3d(25px,0,0);transform:translate3d(25px,0,0)}75%{-webkit-transform:translate3d(-10px,0,0);transform:translate3d(-10px,0,0)}90%{-webkit-transform:translate3d(5px,0,0);transform:translate3d(5px,0,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}.bounceInLeft{-webkit-animation-name:bounceInLeft;animation-name:bounceInLeft}@-webkit-keyframes bounceInRight{0%,60%,75%,90%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;-webkit-transform:translate3d(3000px,0,0);transform:translate3d(3000px,0,0)}60%{opacity:1;-webkit-transform:translate3d(-25px,0,0);transform:translate3d(-25px,0,0)}75%{-webkit-transform:translate3d(10px,0,0);transform:translate3d(10px,0,0)}90%{-webkit-transform:translate3d(-5px,0,0);transform:translate3d(-5px,0,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes bounceInRight{0%,60%,75%,90%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;-webkit-transform:translate3d(3000px,0,0);transform:translate3d(3000px,0,0)}60%{opacity:1;-webkit-transform:translate3d(-25px,0,0);transform:translate3d(-25px,0,0)}75%{-webkit-transform:translate3d(10px,0,0);transform:translate3d(10px,0,0)}90%{-webkit-transform:translate3d(-5px,0,0);transform:translate3d(-5px,0,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}.bounceInRight{-webkit-animation-name:bounceInRight;animation-name:bounceInRight}@-webkit-keyframes bounceInUp{0%,60%,75%,90%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;-webkit-transform:translate3d(0,3000px,0);transform:translate3d(0,3000px,0)}60%{opacity:1;-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0)}75%{-webkit-transform:translate3d(0,10px,0);transform:translate3d(0,10px,0)}90%{-webkit-transform:translate3d(0,-5px,0);transform:translate3d(0,-5px,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes bounceInUp{0%,60%,75%,90%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;-webkit-transform:translate3d(0,3000px,0);transform:translate3d(0,3000px,0)}60%{opacity:1;-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0)}75%{-webkit-transform:translate3d(0,10px,0);transform:translate3d(0,10px,0)}90%{-webkit-transform:translate3d(0,-5px,0);transform:translate3d(0,-5px,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}.bounceInUp{-webkit-animation-name:bounceInUp;animation-name:bounceInUp}@-webkit-keyframes bounceOut{20%{-webkit-transform:scale3d(.9,.9,.9);transform:scale3d(.9,.9,.9)}50%,55%{opacity:1;-webkit-transform:scale3d(1.1,1.1,1.1);transform:scale3d(1.1,1.1,1.1)}to{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}}@keyframes bounceOut{20%{-webkit-transform:scale3d(.9,.9,.9);transform:scale3d(.9,.9,.9)}50%,55%{opacity:1;-webkit-transform:scale3d(1.1,1.1,1.1);transform:scale3d(1.1,1.1,1.1)}to{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}}.bounceOut{-webkit-animation-duration:.75s;animation-duration:.75s;-webkit-animation-name:bounceOut;animation-name:bounceOut}@-webkit-keyframes bounceOutDown{20%{-webkit-transform:translate3d(0,10px,0);transform:translate3d(0,10px,0)}40%,45%{opacity:1;-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0)}to{opacity:0;-webkit-transform:translate3d(0,2000px,0);transform:translate3d(0,2000px,0)}}@keyframes bounceOutDown{20%{-webkit-transform:translate3d(0,10px,0);transform:translate3d(0,10px,0)}40%,45%{opacity:1;-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0)}to{opacity:0;-webkit-transform:translate3d(0,2000px,0);transform:translate3d(0,2000px,0)}}.bounceOutDown{-webkit-animation-name:bounceOutDown;animation-name:bounceOutDown}@-webkit-keyframes bounceOutLeft{20%{opacity:1;-webkit-transform:translate3d(20px,0,0);transform:translate3d(20px,0,0)}to{opacity:0;-webkit-transform:translate3d(-2000px,0,0);transform:translate3d(-2000px,0,0)}}@keyframes bounceOutLeft{20%{opacity:1;-webkit-transform:translate3d(20px,0,0);transform:translate3d(20px,0,0)}to{opacity:0;-webkit-transform:translate3d(-2000px,0,0);transform:translate3d(-2000px,0,0)}}.bounceOutLeft{-webkit-animation-name:bounceOutLeft;animation-name:bounceOutLeft}@-webkit-keyframes bounceOutRight{20%{opacity:1;-webkit-transform:translate3d(-20px,0,0);transform:translate3d(-20px,0,0)}to{opacity:0;-webkit-transform:translate3d(2000px,0,0);transform:translate3d(2000px,0,0)}}@keyframes bounceOutRight{20%{opacity:1;-webkit-transform:translate3d(-20px,0,0);transform:translate3d(-20px,0,0)}to{opacity:0;-webkit-transform:translate3d(2000px,0,0);transform:translate3d(2000px,0,0)}}.bounceOutRight{-webkit-animation-name:bounceOutRight;animation-name:bounceOutRight}@-webkit-keyframes bounceOutUp{20%{-webkit-transform:translate3d(0,-10px,0);transform:translate3d(0,-10px,0)}40%,45%{opacity:1;-webkit-transform:translate3d(0,20px,0);transform:translate3d(0,20px,0)}to{opacity:0;-webkit-transform:translate3d(0,-2000px,0);transform:translate3d(0,-2000px,0)}}@keyframes bounceOutUp{20%{-webkit-transform:translate3d(0,-10px,0);transform:translate3d(0,-10px,0)}40%,45%{opacity:1;-webkit-transform:translate3d(0,20px,0);transform:translate3d(0,20px,0)}to{opacity:0;-webkit-transform:translate3d(0,-2000px,0);transform:translate3d(0,-2000px,0)}}.bounceOutUp{-webkit-animation-name:bounceOutUp;animation-name:bounceOutUp}@-webkit-keyframes fadeIn{0%{opacity:0}to{opacity:1}}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.fadeIn{-webkit-animation-name:fadeIn;animation-name:fadeIn}@-webkit-keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}.fadeInDown{-webkit-animation-name:fadeInDown;animation-name:fadeInDown}@-webkit-keyframes fadeInDownBig{0%{opacity:0;-webkit-transform:translate3d(0,-2000px,0);transform:translate3d(0,-2000px,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes fadeInDownBig{0%{opacity:0;-webkit-transform:translate3d(0,-2000px,0);transform:translate3d(0,-2000px,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}.fadeInDownBig{-webkit-animation-name:fadeInDownBig;animation-name:fadeInDownBig}@-webkit-keyframes fadeInLeft{0%{opacity:0;-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes fadeInLeft{0%{opacity:0;-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}.fadeInLeft{-webkit-animation-name:fadeInLeft;animation-name:fadeInLeft}@-webkit-keyframes fadeInLeftBig{0%{opacity:0;-webkit-transform:translate3d(-2000px,0,0);transform:translate3d(-2000px,0,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes fadeInLeftBig{0%{opacity:0;-webkit-transform:translate3d(-2000px,0,0);transform:translate3d(-2000px,0,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}.fadeInLeftBig{-webkit-animation-name:fadeInLeftBig;animation-name:fadeInLeftBig}@-webkit-keyframes fadeInRight{0%{opacity:0;-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes fadeInRight{0%{opacity:0;-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}.fadeInRight{-webkit-animation-name:fadeInRight;animation-name:fadeInRight}@-webkit-keyframes fadeInRightBig{0%{opacity:0;-webkit-transform:translate3d(2000px,0,0);transform:translate3d(2000px,0,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes fadeInRightBig{0%{opacity:0;-webkit-transform:translate3d(2000px,0,0);transform:translate3d(2000px,0,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}.fadeInRightBig{-webkit-animation-name:fadeInRightBig;animation-name:fadeInRightBig}@-webkit-keyframes fadeInUp{0%{opacity:0;-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes fadeInUp{0%{opacity:0;-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}.fadeInUp{-webkit-animation-name:fadeInUp;animation-name:fadeInUp}@-webkit-keyframes fadeInUpBig{0%{opacity:0;-webkit-transform:translate3d(0,2000px,0);transform:translate3d(0,2000px,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes fadeInUpBig{0%{opacity:0;-webkit-transform:translate3d(0,2000px,0);transform:translate3d(0,2000px,0)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}.fadeInUpBig{-webkit-animation-name:fadeInUpBig;animation-name:fadeInUpBig}@-webkit-keyframes fadeOut{0%{opacity:1}to{opacity:0}}@keyframes fadeOut{0%{opacity:1}to{opacity:0}}.fadeOut{-webkit-animation-name:fadeOut;animation-name:fadeOut}@-webkit-keyframes fadeOutDown{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}}@keyframes fadeOutDown{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}}.fadeOutDown{-webkit-animation-name:fadeOutDown;animation-name:fadeOutDown}@-webkit-keyframes fadeOutDownBig{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(0,2000px,0);transform:translate3d(0,2000px,0)}}@keyframes fadeOutDownBig{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(0,2000px,0);transform:translate3d(0,2000px,0)}}.fadeOutDownBig{-webkit-animation-name:fadeOutDownBig;animation-name:fadeOutDownBig}@-webkit-keyframes fadeOutLeft{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}}@keyframes fadeOutLeft{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}}.fadeOutLeft{-webkit-animation-name:fadeOutLeft;animation-name:fadeOutLeft}@-webkit-keyframes fadeOutLeftBig{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(-2000px,0,0);transform:translate3d(-2000px,0,0)}}@keyframes fadeOutLeftBig{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(-2000px,0,0);transform:translate3d(-2000px,0,0)}}.fadeOutLeftBig{-webkit-animation-name:fadeOutLeftBig;animation-name:fadeOutLeftBig}@-webkit-keyframes fadeOutRight{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}}@keyframes fadeOutRight{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}}.fadeOutRight{-webkit-animation-name:fadeOutRight;animation-name:fadeOutRight}@-webkit-keyframes fadeOutRightBig{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(2000px,0,0);transform:translate3d(2000px,0,0)}}@keyframes fadeOutRightBig{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(2000px,0,0);transform:translate3d(2000px,0,0)}}.fadeOutRightBig{-webkit-animation-name:fadeOutRightBig;animation-name:fadeOutRightBig}@-webkit-keyframes fadeOutUp{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}}@keyframes fadeOutUp{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}}.fadeOutUp{-webkit-animation-name:fadeOutUp;animation-name:fadeOutUp}@-webkit-keyframes fadeOutUpBig{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(0,-2000px,0);transform:translate3d(0,-2000px,0)}}@keyframes fadeOutUpBig{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(0,-2000px,0);transform:translate3d(0,-2000px,0)}}.fadeOutUpBig{-webkit-animation-name:fadeOutUpBig;animation-name:fadeOutUpBig}@-webkit-keyframes flip{0%{-webkit-transform:perspective(400px) scaleX(1) translateZ(0) rotateY(-1turn);transform:perspective(400px) scaleX(1) translateZ(0) rotateY(-1turn);-webkit-animation-timing-function:ease-out;animation-timing-function:ease-out}40%{-webkit-transform:perspective(400px) scaleX(1) translateZ(150px) rotateY(-190deg);transform:perspective(400px) scaleX(1) translateZ(150px) rotateY(-190deg);-webkit-animation-timing-function:ease-out;animation-timing-function:ease-out}50%{-webkit-transform:perspective(400px) scaleX(1) translateZ(150px) rotateY(-170deg);transform:perspective(400px) scaleX(1) translateZ(150px) rotateY(-170deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in}80%{-webkit-transform:perspective(400px) scale3d(.95,.95,.95) translateZ(0) rotateY(0deg);transform:perspective(400px) scale3d(.95,.95,.95) translateZ(0) rotateY(0deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in}to{-webkit-transform:perspective(400px) scaleX(1) translateZ(0) rotateY(0deg);transform:perspective(400px) scaleX(1) translateZ(0) rotateY(0deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in}}@keyframes flip{0%{-webkit-transform:perspective(400px) scaleX(1) translateZ(0) rotateY(-1turn);transform:perspective(400px) scaleX(1) translateZ(0) rotateY(-1turn);-webkit-animation-timing-function:ease-out;animation-timing-function:ease-out}40%{-webkit-transform:perspective(400px) scaleX(1) translateZ(150px) rotateY(-190deg);transform:perspective(400px) scaleX(1) translateZ(150px) rotateY(-190deg);-webkit-animation-timing-function:ease-out;animation-timing-function:ease-out}50%{-webkit-transform:perspective(400px) scaleX(1) translateZ(150px) rotateY(-170deg);transform:perspective(400px) scaleX(1) translateZ(150px) rotateY(-170deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in}80%{-webkit-transform:perspective(400px) scale3d(.95,.95,.95) translateZ(0) rotateY(0deg);transform:perspective(400px) scale3d(.95,.95,.95) translateZ(0) rotateY(0deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in}to{-webkit-transform:perspective(400px) scaleX(1) translateZ(0) rotateY(0deg);transform:perspective(400px) scaleX(1) translateZ(0) rotateY(0deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in}}.animated.flip{-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-animation-name:flip;animation-name:flip}@-webkit-keyframes flipInX{0%{-webkit-transform:perspective(400px) rotateX(90deg);transform:perspective(400px) rotateX(90deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in;opacity:0}40%{-webkit-transform:perspective(400px) rotateX(-20deg);transform:perspective(400px) rotateX(-20deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in}60%{-webkit-transform:perspective(400px) rotateX(10deg);transform:perspective(400px) rotateX(10deg);opacity:1}80%{-webkit-transform:perspective(400px) rotateX(-5deg);transform:perspective(400px) rotateX(-5deg)}to{-webkit-transform:perspective(400px);transform:perspective(400px)}}@keyframes flipInX{0%{-webkit-transform:perspective(400px) rotateX(90deg);transform:perspective(400px) rotateX(90deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in;opacity:0}40%{-webkit-transform:perspective(400px) rotateX(-20deg);transform:perspective(400px) rotateX(-20deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in}60%{-webkit-transform:perspective(400px) rotateX(10deg);transform:perspective(400px) rotateX(10deg);opacity:1}80%{-webkit-transform:perspective(400px) rotateX(-5deg);transform:perspective(400px) rotateX(-5deg)}to{-webkit-transform:perspective(400px);transform:perspective(400px)}}.flipInX{-webkit-backface-visibility:visible!important;backface-visibility:visible!important;-webkit-animation-name:flipInX;animation-name:flipInX}@-webkit-keyframes flipInY{0%{-webkit-transform:perspective(400px) rotateY(90deg);transform:perspective(400px) rotateY(90deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in;opacity:0}40%{-webkit-transform:perspective(400px) rotateY(-20deg);transform:perspective(400px) rotateY(-20deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in}60%{-webkit-transform:perspective(400px) rotateY(10deg);transform:perspective(400px) rotateY(10deg);opacity:1}80%{-webkit-transform:perspective(400px) rotateY(-5deg);transform:perspective(400px) rotateY(-5deg)}to{-webkit-transform:perspective(400px);transform:perspective(400px)}}@keyframes flipInY{0%{-webkit-transform:perspective(400px) rotateY(90deg);transform:perspective(400px) rotateY(90deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in;opacity:0}40%{-webkit-transform:perspective(400px) rotateY(-20deg);transform:perspective(400px) rotateY(-20deg);-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in}60%{-webkit-transform:perspective(400px) rotateY(10deg);transform:perspective(400px) rotateY(10deg);opacity:1}80%{-webkit-transform:perspective(400px) rotateY(-5deg);transform:perspective(400px) rotateY(-5deg)}to{-webkit-transform:perspective(400px);transform:perspective(400px)}}.flipInY{-webkit-backface-visibility:visible!important;backface-visibility:visible!important;-webkit-animation-name:flipInY;animation-name:flipInY}@-webkit-keyframes flipOutX{0%{-webkit-transform:perspective(400px);transform:perspective(400px)}30%{-webkit-transform:perspective(400px) rotateX(-20deg);transform:perspective(400px) rotateX(-20deg);opacity:1}to{-webkit-transform:perspective(400px) rotateX(90deg);transform:perspective(400px) rotateX(90deg);opacity:0}}@keyframes flipOutX{0%{-webkit-transform:perspective(400px);transform:perspective(400px)}30%{-webkit-transform:perspective(400px) rotateX(-20deg);transform:perspective(400px) rotateX(-20deg);opacity:1}to{-webkit-transform:perspective(400px) rotateX(90deg);transform:perspective(400px) rotateX(90deg);opacity:0}}.flipOutX{-webkit-animation-duration:.75s;animation-duration:.75s;-webkit-animation-name:flipOutX;animation-name:flipOutX;-webkit-backface-visibility:visible!important;backface-visibility:visible!important}@-webkit-keyframes flipOutY{0%{-webkit-transform:perspective(400px);transform:perspective(400px)}30%{-webkit-transform:perspective(400px) rotateY(-15deg);transform:perspective(400px) rotateY(-15deg);opacity:1}to{-webkit-transform:perspective(400px) rotateY(90deg);transform:perspective(400px) rotateY(90deg);opacity:0}}@keyframes flipOutY{0%{-webkit-transform:perspective(400px);transform:perspective(400px)}30%{-webkit-transform:perspective(400px) rotateY(-15deg);transform:perspective(400px) rotateY(-15deg);opacity:1}to{-webkit-transform:perspective(400px) rotateY(90deg);transform:perspective(400px) rotateY(90deg);opacity:0}}.flipOutY{-webkit-animation-duration:.75s;animation-duration:.75s;-webkit-backface-visibility:visible!important;backface-visibility:visible!important;-webkit-animation-name:flipOutY;animation-name:flipOutY}@-webkit-keyframes lightSpeedIn{0%{-webkit-transform:translate3d(100%,0,0) skewX(-30deg);transform:translate3d(100%,0,0) skewX(-30deg);opacity:0}60%{-webkit-transform:skewX(20deg);transform:skewX(20deg);opacity:1}80%{-webkit-transform:skewX(-5deg);transform:skewX(-5deg)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes lightSpeedIn{0%{-webkit-transform:translate3d(100%,0,0) skewX(-30deg);transform:translate3d(100%,0,0) skewX(-30deg);opacity:0}60%{-webkit-transform:skewX(20deg);transform:skewX(20deg);opacity:1}80%{-webkit-transform:skewX(-5deg);transform:skewX(-5deg)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}.lightSpeedIn{-webkit-animation-name:lightSpeedIn;animation-name:lightSpeedIn;-webkit-animation-timing-function:ease-out;animation-timing-function:ease-out}@-webkit-keyframes lightSpeedOut{0%{opacity:1}to{-webkit-transform:translate3d(100%,0,0) skewX(30deg);transform:translate3d(100%,0,0) skewX(30deg);opacity:0}}@keyframes lightSpeedOut{0%{opacity:1}to{-webkit-transform:translate3d(100%,0,0) skewX(30deg);transform:translate3d(100%,0,0) skewX(30deg);opacity:0}}.lightSpeedOut{-webkit-animation-name:lightSpeedOut;animation-name:lightSpeedOut;-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in}@-webkit-keyframes rotateIn{0%{-webkit-transform-origin:center;transform-origin:center;-webkit-transform:rotate(-200deg);transform:rotate(-200deg);opacity:0}to{-webkit-transform-origin:center;transform-origin:center;-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@keyframes rotateIn{0%{-webkit-transform-origin:center;transform-origin:center;-webkit-transform:rotate(-200deg);transform:rotate(-200deg);opacity:0}to{-webkit-transform-origin:center;transform-origin:center;-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}.rotateIn{-webkit-animation-name:rotateIn;animation-name:rotateIn}@-webkit-keyframes rotateInDownLeft{0%{-webkit-transform-origin:left bottom;transform-origin:left bottom;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);opacity:0}to{-webkit-transform-origin:left bottom;transform-origin:left bottom;-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@keyframes rotateInDownLeft{0%{-webkit-transform-origin:left bottom;transform-origin:left bottom;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);opacity:0}to{-webkit-transform-origin:left bottom;transform-origin:left bottom;-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}.rotateInDownLeft{-webkit-animation-name:rotateInDownLeft;animation-name:rotateInDownLeft}@-webkit-keyframes rotateInDownRight{0%{-webkit-transform-origin:right bottom;transform-origin:right bottom;-webkit-transform:rotate(45deg);transform:rotate(45deg);opacity:0}to{-webkit-transform-origin:right bottom;transform-origin:right bottom;-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@keyframes rotateInDownRight{0%{-webkit-transform-origin:right bottom;transform-origin:right bottom;-webkit-transform:rotate(45deg);transform:rotate(45deg);opacity:0}to{-webkit-transform-origin:right bottom;transform-origin:right bottom;-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}.rotateInDownRight{-webkit-animation-name:rotateInDownRight;animation-name:rotateInDownRight}@-webkit-keyframes rotateInUpLeft{0%{-webkit-transform-origin:left bottom;transform-origin:left bottom;-webkit-transform:rotate(45deg);transform:rotate(45deg);opacity:0}to{-webkit-transform-origin:left bottom;transform-origin:left bottom;-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@keyframes rotateInUpLeft{0%{-webkit-transform-origin:left bottom;transform-origin:left bottom;-webkit-transform:rotate(45deg);transform:rotate(45deg);opacity:0}to{-webkit-transform-origin:left bottom;transform-origin:left bottom;-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}.rotateInUpLeft{-webkit-animation-name:rotateInUpLeft;animation-name:rotateInUpLeft}@-webkit-keyframes rotateInUpRight{0%{-webkit-transform-origin:right bottom;transform-origin:right bottom;-webkit-transform:rotate(-90deg);transform:rotate(-90deg);opacity:0}to{-webkit-transform-origin:right bottom;transform-origin:right bottom;-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@keyframes rotateInUpRight{0%{-webkit-transform-origin:right bottom;transform-origin:right bottom;-webkit-transform:rotate(-90deg);transform:rotate(-90deg);opacity:0}to{-webkit-transform-origin:right bottom;transform-origin:right bottom;-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}.rotateInUpRight{-webkit-animation-name:rotateInUpRight;animation-name:rotateInUpRight}@-webkit-keyframes rotateOut{0%{-webkit-transform-origin:center;transform-origin:center;opacity:1}to{-webkit-transform-origin:center;transform-origin:center;-webkit-transform:rotate(200deg);transform:rotate(200deg);opacity:0}}@keyframes rotateOut{0%{-webkit-transform-origin:center;transform-origin:center;opacity:1}to{-webkit-transform-origin:center;transform-origin:center;-webkit-transform:rotate(200deg);transform:rotate(200deg);opacity:0}}.rotateOut{-webkit-animation-name:rotateOut;animation-name:rotateOut}@-webkit-keyframes rotateOutDownLeft{0%{-webkit-transform-origin:left bottom;transform-origin:left bottom;opacity:1}to{-webkit-transform-origin:left bottom;transform-origin:left bottom;-webkit-transform:rotate(45deg);transform:rotate(45deg);opacity:0}}@keyframes rotateOutDownLeft{0%{-webkit-transform-origin:left bottom;transform-origin:left bottom;opacity:1}to{-webkit-transform-origin:left bottom;transform-origin:left bottom;-webkit-transform:rotate(45deg);transform:rotate(45deg);opacity:0}}.rotateOutDownLeft{-webkit-animation-name:rotateOutDownLeft;animation-name:rotateOutDownLeft}@-webkit-keyframes rotateOutDownRight{0%{-webkit-transform-origin:right bottom;transform-origin:right bottom;opacity:1}to{-webkit-transform-origin:right bottom;transform-origin:right bottom;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);opacity:0}}@keyframes rotateOutDownRight{0%{-webkit-transform-origin:right bottom;transform-origin:right bottom;opacity:1}to{-webkit-transform-origin:right bottom;transform-origin:right bottom;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);opacity:0}}.rotateOutDownRight{-webkit-animation-name:rotateOutDownRight;animation-name:rotateOutDownRight}@-webkit-keyframes rotateOutUpLeft{0%{-webkit-transform-origin:left bottom;transform-origin:left bottom;opacity:1}to{-webkit-transform-origin:left bottom;transform-origin:left bottom;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);opacity:0}}@keyframes rotateOutUpLeft{0%{-webkit-transform-origin:left bottom;transform-origin:left bottom;opacity:1}to{-webkit-transform-origin:left bottom;transform-origin:left bottom;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);opacity:0}}.rotateOutUpLeft{-webkit-animation-name:rotateOutUpLeft;animation-name:rotateOutUpLeft}@-webkit-keyframes rotateOutUpRight{0%{-webkit-transform-origin:right bottom;transform-origin:right bottom;opacity:1}to{-webkit-transform-origin:right bottom;transform-origin:right bottom;-webkit-transform:rotate(90deg);transform:rotate(90deg);opacity:0}}@keyframes rotateOutUpRight{0%{-webkit-transform-origin:right bottom;transform-origin:right bottom;opacity:1}to{-webkit-transform-origin:right bottom;transform-origin:right bottom;-webkit-transform:rotate(90deg);transform:rotate(90deg);opacity:0}}.rotateOutUpRight{-webkit-animation-name:rotateOutUpRight;animation-name:rotateOutUpRight}@-webkit-keyframes hinge{0%{-webkit-transform-origin:top left;transform-origin:top left;-webkit-animation-timing-function:ease-in-out;animation-timing-function:ease-in-out}20%,60%{-webkit-transform:rotate(80deg);transform:rotate(80deg);-webkit-transform-origin:top left;transform-origin:top left;-webkit-animation-timing-function:ease-in-out;animation-timing-function:ease-in-out}40%,80%{-webkit-transform:rotate(60deg);transform:rotate(60deg);-webkit-transform-origin:top left;transform-origin:top left;-webkit-animation-timing-function:ease-in-out;animation-timing-function:ease-in-out;opacity:1}to{-webkit-transform:translate3d(0,700px,0);transform:translate3d(0,700px,0);opacity:0}}@keyframes hinge{0%{-webkit-transform-origin:top left;transform-origin:top left;-webkit-animation-timing-function:ease-in-out;animation-timing-function:ease-in-out}20%,60%{-webkit-transform:rotate(80deg);transform:rotate(80deg);-webkit-transform-origin:top left;transform-origin:top left;-webkit-animation-timing-function:ease-in-out;animation-timing-function:ease-in-out}40%,80%{-webkit-transform:rotate(60deg);transform:rotate(60deg);-webkit-transform-origin:top left;transform-origin:top left;-webkit-animation-timing-function:ease-in-out;animation-timing-function:ease-in-out;opacity:1}to{-webkit-transform:translate3d(0,700px,0);transform:translate3d(0,700px,0);opacity:0}}.hinge{-webkit-animation-duration:2s;animation-duration:2s;-webkit-animation-name:hinge;animation-name:hinge}@-webkit-keyframes jackInTheBox{0%{opacity:0;-webkit-transform:scale(.1) rotate(30deg);transform:scale(.1) rotate(30deg);-webkit-transform-origin:center bottom;transform-origin:center bottom}50%{-webkit-transform:rotate(-10deg);transform:rotate(-10deg)}70%{-webkit-transform:rotate(3deg);transform:rotate(3deg)}to{opacity:1;-webkit-transform:scale(1);transform:scale(1)}}@keyframes jackInTheBox{0%{opacity:0;-webkit-transform:scale(.1) rotate(30deg);transform:scale(.1) rotate(30deg);-webkit-transform-origin:center bottom;transform-origin:center bottom}50%{-webkit-transform:rotate(-10deg);transform:rotate(-10deg)}70%{-webkit-transform:rotate(3deg);transform:rotate(3deg)}to{opacity:1;-webkit-transform:scale(1);transform:scale(1)}}.jackInTheBox{-webkit-animation-name:jackInTheBox;animation-name:jackInTheBox}@-webkit-keyframes rollIn{0%{opacity:0;-webkit-transform:translate3d(-100%,0,0) rotate(-120deg);transform:translate3d(-100%,0,0) rotate(-120deg)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes rollIn{0%{opacity:0;-webkit-transform:translate3d(-100%,0,0) rotate(-120deg);transform:translate3d(-100%,0,0) rotate(-120deg)}to{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}}.rollIn{-webkit-animation-name:rollIn;animation-name:rollIn}@-webkit-keyframes rollOut{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(100%,0,0) rotate(120deg);transform:translate3d(100%,0,0) rotate(120deg)}}@keyframes rollOut{0%{opacity:1}to{opacity:0;-webkit-transform:translate3d(100%,0,0) rotate(120deg);transform:translate3d(100%,0,0) rotate(120deg)}}.rollOut{-webkit-animation-name:rollOut;animation-name:rollOut}@-webkit-keyframes zoomIn{0%{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes zoomIn{0%{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}50%{opacity:1}}.zoomIn{-webkit-animation-name:zoomIn;animation-name:zoomIn}@-webkit-keyframes zoomInDown{0%{opacity:0;-webkit-transform:scale3d(.1,.1,.1) translate3d(0,-1000px,0);transform:scale3d(.1,.1,.1) translate3d(0,-1000px,0);-webkit-animation-timing-function:cubic-bezier(.55,.055,.675,.19);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}60%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(0,60px,0);transform:scale3d(.475,.475,.475) translate3d(0,60px,0);-webkit-animation-timing-function:cubic-bezier(.175,.885,.32,1);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}@keyframes zoomInDown{0%{opacity:0;-webkit-transform:scale3d(.1,.1,.1) translate3d(0,-1000px,0);transform:scale3d(.1,.1,.1) translate3d(0,-1000px,0);-webkit-animation-timing-function:cubic-bezier(.55,.055,.675,.19);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}60%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(0,60px,0);transform:scale3d(.475,.475,.475) translate3d(0,60px,0);-webkit-animation-timing-function:cubic-bezier(.175,.885,.32,1);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}.zoomInDown{-webkit-animation-name:zoomInDown;animation-name:zoomInDown}@-webkit-keyframes zoomInLeft{0%{opacity:0;-webkit-transform:scale3d(.1,.1,.1) translate3d(-1000px,0,0);transform:scale3d(.1,.1,.1) translate3d(-1000px,0,0);-webkit-animation-timing-function:cubic-bezier(.55,.055,.675,.19);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}60%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(10px,0,0);transform:scale3d(.475,.475,.475) translate3d(10px,0,0);-webkit-animation-timing-function:cubic-bezier(.175,.885,.32,1);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}@keyframes zoomInLeft{0%{opacity:0;-webkit-transform:scale3d(.1,.1,.1) translate3d(-1000px,0,0);transform:scale3d(.1,.1,.1) translate3d(-1000px,0,0);-webkit-animation-timing-function:cubic-bezier(.55,.055,.675,.19);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}60%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(10px,0,0);transform:scale3d(.475,.475,.475) translate3d(10px,0,0);-webkit-animation-timing-function:cubic-bezier(.175,.885,.32,1);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}.zoomInLeft{-webkit-animation-name:zoomInLeft;animation-name:zoomInLeft}@-webkit-keyframes zoomInRight{0%{opacity:0;-webkit-transform:scale3d(.1,.1,.1) translate3d(1000px,0,0);transform:scale3d(.1,.1,.1) translate3d(1000px,0,0);-webkit-animation-timing-function:cubic-bezier(.55,.055,.675,.19);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}60%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(-10px,0,0);transform:scale3d(.475,.475,.475) translate3d(-10px,0,0);-webkit-animation-timing-function:cubic-bezier(.175,.885,.32,1);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}@keyframes zoomInRight{0%{opacity:0;-webkit-transform:scale3d(.1,.1,.1) translate3d(1000px,0,0);transform:scale3d(.1,.1,.1) translate3d(1000px,0,0);-webkit-animation-timing-function:cubic-bezier(.55,.055,.675,.19);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}60%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(-10px,0,0);transform:scale3d(.475,.475,.475) translate3d(-10px,0,0);-webkit-animation-timing-function:cubic-bezier(.175,.885,.32,1);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}.zoomInRight{-webkit-animation-name:zoomInRight;animation-name:zoomInRight}@-webkit-keyframes zoomInUp{0%{opacity:0;-webkit-transform:scale3d(.1,.1,.1) translate3d(0,1000px,0);transform:scale3d(.1,.1,.1) translate3d(0,1000px,0);-webkit-animation-timing-function:cubic-bezier(.55,.055,.675,.19);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}60%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(0,-60px,0);transform:scale3d(.475,.475,.475) translate3d(0,-60px,0);-webkit-animation-timing-function:cubic-bezier(.175,.885,.32,1);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}@keyframes zoomInUp{0%{opacity:0;-webkit-transform:scale3d(.1,.1,.1) translate3d(0,1000px,0);transform:scale3d(.1,.1,.1) translate3d(0,1000px,0);-webkit-animation-timing-function:cubic-bezier(.55,.055,.675,.19);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}60%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(0,-60px,0);transform:scale3d(.475,.475,.475) translate3d(0,-60px,0);-webkit-animation-timing-function:cubic-bezier(.175,.885,.32,1);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}.zoomInUp{-webkit-animation-name:zoomInUp;animation-name:zoomInUp}@-webkit-keyframes zoomOut{0%{opacity:1}50%{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}to{opacity:0}}@keyframes zoomOut{0%{opacity:1}50%{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}to{opacity:0}}.zoomOut{-webkit-animation-name:zoomOut;animation-name:zoomOut}@-webkit-keyframes zoomOutDown{40%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(0,-60px,0);transform:scale3d(.475,.475,.475) translate3d(0,-60px,0);-webkit-animation-timing-function:cubic-bezier(.55,.055,.675,.19);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}to{opacity:0;-webkit-transform:scale3d(.1,.1,.1) translate3d(0,2000px,0);transform:scale3d(.1,.1,.1) translate3d(0,2000px,0);-webkit-transform-origin:center bottom;transform-origin:center bottom;-webkit-animation-timing-function:cubic-bezier(.175,.885,.32,1);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}@keyframes zoomOutDown{40%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(0,-60px,0);transform:scale3d(.475,.475,.475) translate3d(0,-60px,0);-webkit-animation-timing-function:cubic-bezier(.55,.055,.675,.19);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}to{opacity:0;-webkit-transform:scale3d(.1,.1,.1) translate3d(0,2000px,0);transform:scale3d(.1,.1,.1) translate3d(0,2000px,0);-webkit-transform-origin:center bottom;transform-origin:center bottom;-webkit-animation-timing-function:cubic-bezier(.175,.885,.32,1);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}.zoomOutDown{-webkit-animation-name:zoomOutDown;animation-name:zoomOutDown}@-webkit-keyframes zoomOutLeft{40%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(42px,0,0);transform:scale3d(.475,.475,.475) translate3d(42px,0,0)}to{opacity:0;-webkit-transform:scale(.1) translate3d(-2000px,0,0);transform:scale(.1) translate3d(-2000px,0,0);-webkit-transform-origin:left center;transform-origin:left center}}@keyframes zoomOutLeft{40%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(42px,0,0);transform:scale3d(.475,.475,.475) translate3d(42px,0,0)}to{opacity:0;-webkit-transform:scale(.1) translate3d(-2000px,0,0);transform:scale(.1) translate3d(-2000px,0,0);-webkit-transform-origin:left center;transform-origin:left center}}.zoomOutLeft{-webkit-animation-name:zoomOutLeft;animation-name:zoomOutLeft}@-webkit-keyframes zoomOutRight{40%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(-42px,0,0);transform:scale3d(.475,.475,.475) translate3d(-42px,0,0)}to{opacity:0;-webkit-transform:scale(.1) translate3d(2000px,0,0);transform:scale(.1) translate3d(2000px,0,0);-webkit-transform-origin:right center;transform-origin:right center}}@keyframes zoomOutRight{40%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(-42px,0,0);transform:scale3d(.475,.475,.475) translate3d(-42px,0,0)}to{opacity:0;-webkit-transform:scale(.1) translate3d(2000px,0,0);transform:scale(.1) translate3d(2000px,0,0);-webkit-transform-origin:right center;transform-origin:right center}}.zoomOutRight{-webkit-animation-name:zoomOutRight;animation-name:zoomOutRight}@-webkit-keyframes zoomOutUp{40%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(0,60px,0);transform:scale3d(.475,.475,.475) translate3d(0,60px,0);-webkit-animation-timing-function:cubic-bezier(.55,.055,.675,.19);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}to{opacity:0;-webkit-transform:scale3d(.1,.1,.1) translate3d(0,-2000px,0);transform:scale3d(.1,.1,.1) translate3d(0,-2000px,0);-webkit-transform-origin:center bottom;transform-origin:center bottom;-webkit-animation-timing-function:cubic-bezier(.175,.885,.32,1);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}@keyframes zoomOutUp{40%{opacity:1;-webkit-transform:scale3d(.475,.475,.475) translate3d(0,60px,0);transform:scale3d(.475,.475,.475) translate3d(0,60px,0);-webkit-animation-timing-function:cubic-bezier(.55,.055,.675,.19);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}to{opacity:0;-webkit-transform:scale3d(.1,.1,.1) translate3d(0,-2000px,0);transform:scale3d(.1,.1,.1) translate3d(0,-2000px,0);-webkit-transform-origin:center bottom;transform-origin:center bottom;-webkit-animation-timing-function:cubic-bezier(.175,.885,.32,1);animation-timing-function:cubic-bezier(.175,.885,.32,1)}}.zoomOutUp{-webkit-animation-name:zoomOutUp;animation-name:zoomOutUp}@-webkit-keyframes slideInDown{0%{-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0);visibility:visible}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes slideInDown{0%{-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0);visibility:visible}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}.slideInDown{-webkit-animation-name:slideInDown;animation-name:slideInDown}@-webkit-keyframes slideInLeft{0%{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0);visibility:visible}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes slideInLeft{0%{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0);visibility:visible}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}.slideInLeft{-webkit-animation-name:slideInLeft;animation-name:slideInLeft}@-webkit-keyframes slideInRight{0%{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0);visibility:visible}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes slideInRight{0%{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0);visibility:visible}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}.slideInRight{-webkit-animation-name:slideInRight;animation-name:slideInRight}@-webkit-keyframes slideInUp{0%{-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0);visibility:visible}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes slideInUp{0%{-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0);visibility:visible}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}.slideInUp{-webkit-animation-name:slideInUp;animation-name:slideInUp}@-webkit-keyframes slideOutDown{0%{-webkit-transform:translateZ(0);transform:translateZ(0)}to{visibility:hidden;-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}}@keyframes slideOutDown{0%{-webkit-transform:translateZ(0);transform:translateZ(0)}to{visibility:hidden;-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}}.slideOutDown{-webkit-animation-name:slideOutDown;animation-name:slideOutDown}@-webkit-keyframes slideOutLeft{0%{-webkit-transform:translateZ(0);transform:translateZ(0)}to{visibility:hidden;-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}}@keyframes slideOutLeft{0%{-webkit-transform:translateZ(0);transform:translateZ(0)}to{visibility:hidden;-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}}.slideOutLeft{-webkit-animation-name:slideOutLeft;animation-name:slideOutLeft}@-webkit-keyframes slideOutRight{0%{-webkit-transform:translateZ(0);transform:translateZ(0)}to{visibility:hidden;-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}}@keyframes slideOutRight{0%{-webkit-transform:translateZ(0);transform:translateZ(0)}to{visibility:hidden;-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}}.slideOutRight{-webkit-animation-name:slideOutRight;animation-name:slideOutRight}@-webkit-keyframes slideOutUp{0%{-webkit-transform:translateZ(0);transform:translateZ(0)}to{visibility:hidden;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}}@keyframes slideOutUp{0%{-webkit-transform:translateZ(0);transform:translateZ(0)}to{visibility:hidden;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}}.slideOutUp{-webkit-animation-name:slideOutUp;animation-name:slideOutUp}.animated{-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-fill-mode:both;animation-fill-mode:both}.animated.infinite{-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite}.animated.delay-1s{-webkit-animation-delay:1s;animation-delay:1s}.animated.delay-2s{-webkit-animation-delay:2s;animation-delay:2s}.animated.delay-3s{-webkit-animation-delay:3s;animation-delay:3s}.animated.delay-4s{-webkit-animation-delay:4s;animation-delay:4s}.animated.delay-5s{-webkit-animation-delay:5s;animation-delay:5s}.animated.fast{-webkit-animation-duration:.8s;animation-duration:.8s}.animated.faster{-webkit-animation-duration:.5s;animation-duration:.5s}.animated.slow{-webkit-animation-duration:2s;animation-duration:2s}.animated.slower{-webkit-animation-duration:3s;animation-duration:3s}@media (prefers-reduced-motion:reduce),(print){.animated{-webkit-animation-duration:1ms!important;animation-duration:1ms!important;-webkit-transition-duration:1ms!important;transition-duration:1ms!important;-webkit-animation-iteration-count:1!important;animation-iteration-count:1!important}}`;
    NextAdmin.Animation = Animation;
    let AnimationSpeed;
    (function (AnimationSpeed) {
        AnimationSpeed["slow"] = "slow";
        AnimationSpeed["slower"] = "slower";
        AnimationSpeed["fast"] = "fast";
        AnimationSpeed["faster"] = "faster";
    })(AnimationSpeed = NextAdmin.AnimationSpeed || (NextAdmin.AnimationSpeed = {}));
})(NextAdmin || (NextAdmin = {}));
try {
    HTMLElement.prototype.anim = function (animation, options) {
        NextAdmin.Animation.animate(this, animation, options);
    };
}
catch {
}
try {
    const ArrayCompareFunc = (a, b, _keySelector, descending) => {
        const sortKeyA = _keySelector(a);
        const sortKeyB = _keySelector(b);
        if (sortKeyA > sortKeyB) {
            return !descending ? 1 : -1;
        }
        else if (sortKeyA < sortKeyB) {
            return !descending ? -1 : 1;
        }
        else {
            return 0;
        }
    };
    const ArrayKeyComparer = (_keySelector, descending) => (a, b) => ArrayCompareFunc(a, b, _keySelector, descending);
    Array.prototype.orderBy = function (keySelector, comparer = ArrayKeyComparer(keySelector, false)) {
        return this.sort(comparer);
    };
    Array.prototype.orderByDescending = function (keySelector, comparer = ArrayKeyComparer(keySelector, true)) {
        return this.sort(comparer);
    };
    Array.prototype.clear = function () {
        while (this.length > 0) {
            this.pop();
        }
    };
    Array.prototype.replace = function (oldElement, newElement) {
        let _this = this;
        for (let i = 0; i < this.length; i++) {
            if (_this[i] == oldElement) {
                _this.insert(i, newElement);
                _this.removeAt(i + 1);
            }
        }
    };
    Array.prototype.clone = function () {
        return [...this];
    };
    Array.prototype.take = function (amount) {
        return this.slice(0, Math.max(0, amount));
    };
    Array.prototype.skip = function (amount) {
        return this.slice(Math.max(0, amount));
    };
    Array.prototype.where = function (predicate) {
        return this.filter(predicate);
    };
    Array.prototype.add = function (element) {
        this.push(element);
        return this;
    };
    Array.prototype.addRange = function (elements) {
        this.push(...elements);
        return this;
    };
    Array.prototype.remove = function (element) {
        return this.indexOf(element) !== -1
            ? (this.removeAt(this.indexOf(element)), true)
            : false;
    };
    Array.prototype.removeRange = function (elements) {
        if (elements) {
            for (let element of elements) {
                this.remove(element);
            }
        }
        return this;
    };
    Array.prototype.removeAt = function (index) {
        this.splice(index, 1);
    };
    Array.prototype.contains = function (element) {
        return this.some(x => x === element);
    };
    Array.prototype.distinct = function () {
        return this.where((value, index, iter) => iter.indexOf(value) === index);
    };
    Array.prototype.distinctBy = function (keySelector) {
        const groups = this.groupBy(keySelector);
        return Object.keys(groups).reduce((res, key) => {
            res.add(groups[key][0]);
            return res;
        }, new Array());
    };
    Array.prototype.groupBy = function (grouper, mapper) {
        const initialValue = {};
        if (!mapper) {
            mapper = val => val;
        }
        return this.aggregate((ac, v) => {
            const key = grouper(v);
            const existingGroup = ac[key];
            const mappedValue = mapper(v);
            if (existingGroup) {
                existingGroup.push(mappedValue);
            }
            else {
                ac[key] = [mappedValue];
            }
            return ac;
        }, initialValue);
    };
    Array.prototype.groupByArray = function (grouper, mapper) {
        let result = this.groupBy(grouper, mapper);
        let groupArray = new Array();
        for (let groupName in result) {
            groupArray.add({ name: groupName, items: result[groupName] });
        }
        return groupArray;
    };
    Array.prototype.insert = function (index, element) {
        if (index < 0 || index > this.length) {
            throw new Error('Index is out of range.');
        }
        this.splice(index, 0, element);
        return this;
    };
    Array.prototype.select = function (selector) {
        return this.map(selector);
    };
    Array.prototype.selectAsync = function (selector) {
        return Promise.all(this.map(selector));
    };
    Array.prototype.first = function (predicate) {
        if (this.length > 0) {
            return predicate ? this.where(predicate).first() : this[0];
        }
        else {
            throw new Error('InvalidOperationException: The source sequence is empty.');
        }
    };
    Array.prototype.firstOrDefault = function (predicate) {
        if (this.length == 0)
            return null;
        if (!predicate)
            return this[0];
        let elements = this.where(predicate);
        if (elements.length == 0)
            return null;
        return elements[0];
    };
    Array.prototype.last = function (predicate) {
        if (this.length > 0) {
            return predicate ? this.where(predicate).last() : this[this.length - 1];
        }
        else {
            throw new Error('InvalidOperationException: The source sequence is empty.');
        }
    };
    Array.prototype.lastOrDefault = function (predicate) {
        if (this.length == 0)
            return null;
        if (!predicate)
            return this[this.length - 1];
        let elements = this.where(predicate);
        if (elements.length == 0)
            return null;
        return elements[elements.length - 1];
    };
    Array.prototype.min = function (selector) {
        const id = x => x;
        return Math.min(...this.map(selector || id));
    };
    Array.prototype.max = function (selector) {
        const id = x => x;
        return Math.max(...this.map(selector || id));
    };
    Array.prototype.average = function (transform) {
        return this.sum(transform) / this.count(transform);
    };
    Array.prototype.count = function (predicate) {
        return predicate ? this.where(predicate).length : this.length;
    };
    Array.prototype.aggregate = function (accumulator, initialValue) {
        return this.reduce(accumulator, initialValue);
    };
    Array.prototype.sum = function (transform) {
        return transform ? this.select(transform).sum() : this.aggregate((ac, v) => (ac += +v), 0);
    };
    Array.prototype.cast = function () {
        return this;
    };
    Array.prototype.toFlatArray = function (action) {
        let cloneArray = this.clone();
        let finalArray = [];
        while (cloneArray.length > 0) {
            let firstElement = cloneArray[0];
            cloneArray.removeAt(0);
            finalArray.push(firstElement);
            let children = action(firstElement);
            if (children != null) {
                cloneArray.addRange(children);
            }
        }
        return finalArray;
    };
    Array.prototype.toDictionary = function (key) {
        let dictionary = new NextAdmin.Dictionary();
        if (typeof key === 'string') {
            for (let item of this) {
                dictionary.add(item[key] + '', item);
            }
        }
        else {
            for (let item of this) {
                dictionary.add(key(item), item);
            }
        }
        return dictionary;
    };
}
catch {
}
var NextAdmin;
(function (NextAdmin) {
    class CSV {
        static parse(csvStrData, delimiter = ',') {
            // Create a regular expression to parse the CSV values.
            var objPattern = new RegExp((
            // Delimiters.
            "(\\" + delimiter + "|\\r?\\n|\\r|^)" +
                // Quoted fields.
                "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +
                // Standard fields.
                "([^\"\\" + delimiter + "\\r\\n]*))"), "gi");
            // Create an array to hold our data. Give the array
            // a default empty first row.
            var arrData = [[]];
            // Create an array to hold our individual pattern
            // matching groups.
            var arrMatches = null;
            // Keep looping over the regular expression matches
            // until we can no longer find a match.
            while (arrMatches = objPattern.exec(csvStrData)) {
                // Get the delimiter that was found.
                var strMatchedDelimiter = arrMatches[1];
                // Check to see if the given delimiter has a length
                // (is not the start of string) and if it matches
                // field delimiter. If id does not, then we know
                // that this delimiter is a row delimiter.
                if (strMatchedDelimiter.length &&
                    strMatchedDelimiter !== delimiter) {
                    // Since we have reached a new row of data,
                    // add an empty row to our data array.
                    arrData.push([]);
                }
                var strMatchedValue;
                // Now that we have our delimiter out of the way,
                // let's check to see which kind of value we
                // captured (quoted or unquoted).
                if (arrMatches[2]) {
                    // We found a quoted value. When we capture
                    // this value, unescape any double quotes.
                    strMatchedValue = arrMatches[2].replace(new RegExp("\"\"", "g"), "\"");
                }
                else {
                    // We found a non-quoted value.
                    strMatchedValue = arrMatches[3];
                }
                // Now that we have our value string, let's add
                // it to the data array.
                arrData[arrData.length - 1].push(strMatchedValue);
            }
            // Return the parsed data.
            return (arrData);
        }
    }
    NextAdmin.CSV = CSV;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class Cookies {
        static get(cname) {
            let name = cname + "=";
            let decodedCookie = decodeURIComponent(document.cookie);
            let ca = decodedCookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return null;
        }
        static set(name, value, days = null) {
            let cookieString = name + "=" + value + ";path=/;";
            if (days != null && days > 0) {
                var d = new Date;
                d.setTime(d.getTime() + 24 * 60 * 60 * 1000 * days);
                cookieString += "expires=" + d.toUTCString();
            }
            document.cookie = cookieString;
        }
        static delete(name) { Cookies.set(name, '', -1); }
    }
    NextAdmin.Cookies = Cookies;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class Copy {
        static copyTo(source, target) {
            for (let key in source) {
                target[key] = source[key];
            }
        }
        static clone(objectToClone) {
            return JSON.parse(JSON.stringify(objectToClone));
        }
    }
    NextAdmin.Copy = Copy;
})(NextAdmin || (NextAdmin = {}));
try {
    Date.prototype.getWeek = function () {
        var date = new Date(this.getTime());
        date.setHours(0, 0, 0, 0);
        // Thursday in current week decides the year.
        date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
        // January 4 is always in week 1.
        var week1 = new Date(date.getFullYear(), 0, 4);
        // Adjust to Thursday in week 1 and count number of weeks from date to week1.
        return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000
            - 3 + (week1.getDay() + 6) % 7) / 7);
    };
    Date.prototype.addDays = function (days) {
        this.setDate(this.getDate() + days);
        return this;
    };
    Date.prototype.addMonths = function (months) {
        let d = this;
        d.setMonth(d.getMonth() + months);
        return this;
    };
    Date.prototype.addYears = function (years) {
        let d = this;
        d.setFullYear(d.getFullYear() + years);
        return d;
    };
    Date.prototype.clone = function () {
        return new Date(this);
    };
    Date.prototype.getTotalDays = function () {
        const millisecondsPerDay = 24 * 60 * 60 * 1000; // Nombre de millisecondes dans une journe
        const diffInMilliseconds = this.getTime() - new Date(0, 0, 1).getTime(); // Diffrence en millisecondes
        return Math.floor(diffInMilliseconds / millisecondsPerDay);
    };
}
catch {
}
var NextAdmin;
(function (NextAdmin) {
    class DateTime {
        static now() {
            return new Date();
        }
        static firstDayOfYear() {
            return new Date(this.now().getFullYear(), 0, 1);
        }
        static firstDayOfMonth() {
            return new Date(this.now().getFullYear(), this.now().getMonth(), 1);
        }
    }
    NextAdmin.DateTime = DateTime;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class DependenciesController {
        /**
         *
         * @param dependencies
         * @param ready
         * @param fastLoading indicate the way to load dependency.
         * if set to true, all dependencies will be loaded simultaniously, and appended as element in given order,
         * this method is more powerfull but have issus for style that should reload data like background or fonts.
         * if set to false, data will be loaded as normal resource, it avoid issue, but it's less faster because all query are done one by one
         */
        static load(dependencies, ready, fastLoading) {
            let depenciesToLoad = this.preparDependencies(dependencies);
            return new Promise((resolve, reject) => {
                if (depenciesToLoad.length == 0) {
                    if (ready) {
                        ready();
                    }
                    resolve(depenciesToLoad.toDictionary('key'));
                    return;
                }
                if (fastLoading) {
                    for (let dependency of depenciesToLoad) {
                        console.log('loading : ' + dependency.url);
                        fetch(dependency.url).then(response => {
                            response.text().then((content) => {
                                dependency.content = content;
                                if (depenciesToLoad.firstOrDefault(a => a.content == null) == null) {
                                    for (let dependency of depenciesToLoad) {
                                        if (dependency.type == DependencyType.script) {
                                            NextAdmin.Script.append(dependency.key, dependency.content);
                                        }
                                        else if (dependency.type == DependencyType.style) {
                                            NextAdmin.Style.append(dependency.key, dependency.content);
                                        }
                                        else if (dependency.type == DependencyType.typeScript) {
                                            NextAdmin.TypeScript.append(dependency.key, dependency.content);
                                        }
                                        if (ready) {
                                            ready();
                                        }
                                        resolve(depenciesToLoad.toDictionary('key'));
                                    }
                                }
                            });
                        });
                    }
                }
                else {
                    let loadedDependencyDictionary = new NextAdmin.Dictionary();
                    let loadDependency = (dependency) => {
                        let endLoad = () => {
                            loadedDependencyDictionary.add(depenciesToLoad[0].key, depenciesToLoad[0]);
                            depenciesToLoad.removeAt(0);
                            if (depenciesToLoad.length > 0) {
                                loadDependency(depenciesToLoad[0]);
                            }
                            else { //end
                                if (ready) {
                                    ready();
                                }
                                resolve(loadedDependencyDictionary);
                            }
                        };
                        if (dependency.type == DependencyType.script) {
                            NextAdmin.Script.load(dependency.url, dependency.key).then(() => endLoad());
                        }
                        else if (dependency.type == DependencyType.style) {
                            NextAdmin.Style.load(dependency.url, dependency.key).then(() => endLoad());
                        }
                        else if (dependency.type == DependencyType.typeScript) {
                            NextAdmin.TypeScript.load(dependency.url, dependency.key).then(() => endLoad());
                        }
                        else {
                            fetch(dependency.url).then(response => {
                                response.text().then((content) => {
                                    dependency.content = content;
                                    endLoad();
                                });
                            });
                        }
                    };
                    loadDependency(depenciesToLoad[0]);
                }
            });
        }
        static preparDependencies(dependencies, keepOnlyNotLoadedDependencyes = true) {
            let output = new Array();
            for (let dependencyInfo of dependencies) {
                if (typeof dependencyInfo === 'string') {
                    dependencyInfo = {
                        url: dependencyInfo
                    };
                }
                dependencyInfo.key = dependencyInfo.key == null ? dependencyInfo.url : dependencyInfo.key;
                if (dependencyInfo.type == null) {
                    if (dependencyInfo.url.endsWith('.js')) {
                        dependencyInfo.type = DependencyType.script;
                    }
                    else if (dependencyInfo.url.endsWith('.ts')) {
                        dependencyInfo.type = DependencyType.typeScript;
                    }
                    else if (dependencyInfo.url.endsWith('.css')) {
                        dependencyInfo.type = DependencyType.style;
                    }
                }
                if (keepOnlyNotLoadedDependencyes == null || !DependenciesController.exist(dependencyInfo.key)) {
                    output.add(dependencyInfo);
                }
            }
            return output;
        }
        static unloadRange(dependencies) {
            for (let dependency of dependencies) {
                let key = null;
                if (typeof dependency === 'string') {
                    key = dependency;
                }
                else {
                    key = dependency.key ?? dependency.url;
                }
                DependenciesController.unload(key);
            }
        }
        static unload(key) {
            let dependency = DependenciesController.registeredDependencies[key];
            if (dependency != null) {
                dependency.remove();
                delete DependenciesController.registeredDependencies[key];
            }
        }
        static exist(key) {
            return DependenciesController.registeredDependencies[key] != null;
        }
    }
    DependenciesController.registeredDependencies = {};
    NextAdmin.DependenciesController = DependenciesController;
    let DependencyType;
    (function (DependencyType) {
        DependencyType[DependencyType["style"] = 0] = "style";
        DependencyType[DependencyType["script"] = 1] = "script";
        DependencyType[DependencyType["typeScript"] = 2] = "typeScript";
    })(DependencyType = NextAdmin.DependencyType || (NextAdmin.DependencyType = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class Dictionary {
        constructor(obj) {
            if (obj) {
                Object.assign(this, obj);
            }
        }
        set(key, value) {
            this[key] = value;
        }
        get(key) {
            return this[key];
        }
        add(key, value) {
            if (this[key] !== undefined) {
                throw Error('Item already exist');
            }
            this[key] = value;
        }
        tryAdd(key, value) {
            if (this[key] !== undefined) {
                false;
            }
            this[key] = value;
            return true;
        }
        getKeys() {
            let keys = new Array();
            for (let key in this) {
                keys.push(key);
            }
            return keys;
        }
        getValues() {
            let values = new Array();
            for (let key in this) {
                values.push(this[key]);
            }
            return values;
        }
        getKeysValues() {
            let keysValues = new Array();
            for (let key in this) {
                keysValues.push({
                    key: key,
                    value: this[key]
                });
            }
            return keysValues;
        }
        remove(key) {
            delete this[key];
        }
        clear() {
            for (let key in this) {
                delete this[key];
            }
        }
        clone() {
            return new Dictionary(this);
        }
    }
    NextAdmin.Dictionary = Dictionary;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class EventHandlerBase {
        constructor() {
            this._subscriptions = new Array();
        }
        subscribe(fn) {
            if (fn) {
                this._subscriptions.push(fn);
            }
        }
        unsubscribe(fn) {
            let i = this._subscriptions.indexOf(fn);
            if (i > -1) {
                this._subscriptions.splice(i, 1);
            }
        }
        subscribeOnce(fn) {
            let proxyFunc = () => {
                this.unsubscribe(proxyFunc);
                fn();
            };
            this.subscribe(proxyFunc);
            return proxyFunc;
        }
        unsubscribeAll() {
            this._subscriptions = new Array();
            ;
        }
        dispatch() {
            for (let handler of this._subscriptions) {
                handler();
            }
        }
        isSubscribed(fn) {
            return this._subscriptions.contains(fn);
        }
    }
    NextAdmin.EventHandlerBase = EventHandlerBase;
    class EventHandler {
        constructor() {
            this._subscriptions = new Array();
        }
        subscribe(fn) {
            if (fn) {
                this._subscriptions.push(fn);
            }
            return fn;
        }
        unsubscribe(fn) {
            let i = this._subscriptions.indexOf(fn);
            if (i > -1) {
                this._subscriptions.splice(i, 1);
            }
        }
        subscribeOnce(fn) {
            let proxyFunc = (s2, args2) => {
                this.unsubscribe(proxyFunc);
                fn(s2, args2);
            };
            this.subscribe(proxyFunc);
            return proxyFunc;
        }
        unsubscribeAll() {
            this._subscriptions = new Array();
        }
        dispatch(sender, args) {
            for (let handler of this._subscriptions) {
                handler(sender, args);
            }
        }
        isSubscribed(fn) {
            return this._subscriptions.contains(fn);
        }
    }
    NextAdmin.EventHandler = EventHandler;
    class AsyncEventHandler {
        constructor() {
            this._subscriptions = new Array();
        }
        subscribe(fn) {
            if (fn) {
                this._subscriptions.push(fn);
            }
        }
        unsubscribe(fn) {
            let i = this._subscriptions.indexOf(fn);
            if (i > -1) {
                this._subscriptions.splice(i, 1);
            }
        }
        subscribeOnce(fn) {
            let proxyFunc = async (s2, args2) => {
                this.unsubscribe(proxyFunc);
                await fn(s2, args2);
            };
            this.subscribe(proxyFunc);
            return proxyFunc;
        }
        unsubscribeAll() {
            this._subscriptions = new Array();
        }
        async dispatch(sender, args) {
            for (let handler of this._subscriptions) {
                await handler(sender, args);
            }
        }
    }
    NextAdmin.AsyncEventHandler = AsyncEventHandler;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class FileExplorer {
        static openFileExplorer(onFilesSelectedAction, mulipleFiles = false, extensions) {
            let browseFileInput = document.createElement('input');
            browseFileInput.type = 'file';
            document.body.appendChild(browseFileInput);
            if (extensions != null && extensions.length > 0) {
                let extensionsAsString = '';
                let i = 0;
                for (let extension of extensions) {
                    if (i > 0) {
                        extensionsAsString += ',';
                    }
                    if (extension.indexOf('.') != 0) {
                        extensionsAsString += '.';
                    }
                    extensionsAsString += extension;
                    i++;
                }
                browseFileInput.setAttribute('accept', extensionsAsString);
            }
            if (mulipleFiles) {
                browseFileInput.setAttribute('multiple', 'multiple');
            }
            browseFileInput.addEventListener('change', () => {
                let files = new Array();
                for (let i = 0; i < browseFileInput.files.length; i++) {
                    let file = browseFileInput.files[i];
                    if (extensions != null && extensions.length > 0) {
                        let extension = NextAdmin.Path.getFileExtension(file.name);
                        if (extensions.firstOrDefault(e => e.replace('.', '') == extension) == null) {
                            continue;
                        }
                    }
                    files.push(file);
                }
                onFilesSelectedAction(files);
            });
            browseFileInput.click();
            setTimeout(() => {
                browseFileInput.remove();
            }, 10);
        }
    }
    NextAdmin.FileExplorer = FileExplorer;
})(NextAdmin || (NextAdmin = {}));
try {
    File.prototype.getDataAsBase64Url = function () {
        let file = this;
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
        });
    };
    File.prototype.getDataAsArrayBuffer = function () {
        let file = this;
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsArrayBuffer(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
        });
    };
}
catch {
}
var NextAdmin;
(function (NextAdmin) {
    class Guid {
        constructor(guid) {
            this._guid = guid.toLowerCase();
        }
        toString() {
            return this._guid;
        }
        // Static member
        static newGuid() {
            return new Guid(Guid.createStrGuid());
        }
        static createStrGuid() {
            var result;
            var i;
            var j;
            result = "";
            for (j = 0; j < 32; j++) {
                if (j == 8 || j == 12 || j == 16 || j == 20)
                    result = result + '-';
                i = Math.floor(Math.random() * 16).toString(16);
                result = result + i;
            }
            return result;
        }
    }
    NextAdmin.Guid = Guid;
})(NextAdmin || (NextAdmin = {}));
try {
    HTMLTableElement.prototype.fixHeader = function (onDrawHeaderAction) {
        let table = this;
        let thead = table.querySelector('thead');
        if (thead == null) {
            console.log('Table need thead to fix header');
            return;
        }
        let headerRow = thead.querySelector('tr');
        if (headerRow == null) {
            console.log('Table need tr in thead to fix header');
            return;
        }
        table.style.position = 'relative';
        setTimeout(function () {
            let clonedHeaderRow = headerRow.cloneNode(true);
            let headerCells = headerRow.querySelectorAll('th');
            let clonedHeaderCells = clonedHeaderRow.querySelectorAll('th');
            clonedHeaderRow.style.position = 'absolute';
            clonedHeaderRow.style.top = '0px';
            clonedHeaderRow.style.left = '0px';
            clonedHeaderRow.style.background = 'rgba(255,255,255,1)';
            clonedHeaderRow.style.boxShadow = '0px 1px 1px rgba(0,0,0,0.5)';
            thead.appendChild(clonedHeaderRow);
            for (let i = 0; i < headerCells.length; i++) {
                let headerCell = headerCells.item(i);
                let clonedHeaderCell = clonedHeaderCells.item(i);
                clonedHeaderCell.style.width = headerCell.offsetWidth + 'px';
                clonedHeaderCell.style.minWidth = headerCell.offsetWidth + 'px';
                clonedHeaderCell.style.maxWidth = headerCell.offsetWidth + 'px';
                clonedHeaderCell.style.border = '0px';
                clonedHeaderCell.style.padding = '0px';
                let cellDiv = document.createElement('div');
                cellDiv.innerHTML = clonedHeaderCell.innerHTML;
                cellDiv.style.width = '100%';
                cellDiv.style.height = '100%';
                cellDiv.style.position = 'relative';
                clonedHeaderCell.innerHTML = '';
                clonedHeaderCell.appendChild(cellDiv);
                if (onDrawHeaderAction != null) {
                    onDrawHeaderAction(cellDiv);
                }
            }
            clonedHeaderRow.style.display = 'none';
            let updateFixedHeaderFunc = () => {
                let headerClientRext = thead.getBoundingClientRect();
                if (headerClientRext.top < 0) { //fix header
                    clonedHeaderRow.style.display = '';
                    clonedHeaderRow.style.top = -headerClientRext.top + 'px';
                }
                else { //restor header at default state
                    clonedHeaderRow.style.display = 'none';
                }
            };
            document.addEventListener('scroll', () => {
                updateFixedHeaderFunc();
            });
            updateFixedHeaderFunc();
        }, 100);
    };
    HTMLElement.prototype.isInViewport = function () {
        let rect = this.getBoundingClientRect();
        return (rect.top >= 0 &&
            rect.left >= 0 &&
            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
            rect.right <= (window.innerWidth || document.documentElement.clientWidth));
    };
    HTMLElement.prototype.addStyle = function (style) {
        for (let property in style) {
            this.style[property] = style[property];
        }
    };
    HTMLElement.prototype.onSizeChanged = function (callback) {
        try { //not working on safari and old Edge before chrome view
            var observer = new ResizeObserver(() => {
                callback();
            });
            observer.observe(this);
            return observer;
        }
        catch {
        }
    };
    HTMLElement.prototype.onDoubleClick = function (callback) {
        let lastClickTimeStamp = -1;
        this.addEventListener('click', (ev) => {
            let actualTimeStamp = Date.now();
            if (actualTimeStamp - lastClickTimeStamp < 500) {
                callback(ev);
                lastClickTimeStamp = -1;
            }
            else {
                lastClickTimeStamp = actualTimeStamp;
            }
        });
    };
    HTMLElement.prototype.addChild = function (child, configAction) {
        if (child instanceof NextAdmin.UI.Control) {
            this.appendChild(child.element);
        }
        else {
            this.appendChild(child);
        }
        if (configAction != null) {
            configAction(child);
        }
        return child;
    };
    HTMLElement.prototype.addChildFirst = function (child, configAction) {
        if (child instanceof NextAdmin.UI.Control) {
            this.prepend(child.element);
        }
        else {
            this.prepend(child);
        }
        if (configAction != null) {
            configAction(child);
        }
        return child;
    };
    HTMLElement.prototype.appendControl = function (control, configAction) {
        this.appendChild(control.element);
        if (configAction != null) {
            configAction(control);
        }
        return control;
    };
    HTMLElement.prototype.prependControl = function (control, configAction) {
        this.prepend(control.element);
        if (configAction != null) {
            configAction(control);
        }
        return control;
    };
    HTMLElement.prototype.insertControlBefore = function (control, configAction) {
        this.before(control.element);
        if (configAction != null) {
            configAction(control);
        }
        return control;
    };
    HTMLElement.prototype.insertControlAfter = function (control, configAction) {
        this.after(control.element);
        if (configAction != null) {
            configAction(control);
        }
        return control;
    };
    HTMLElement.prototype.prependHTML = function (elementType, configActionOrContent) {
        let element = document.createElement(elementType);
        if (configActionOrContent) {
            if (typeof configActionOrContent == 'string') {
                element.innerHTML = configActionOrContent;
            }
            else {
                configActionOrContent(element);
            }
        }
        this.prepend(element);
        return element;
    };
    HTMLElement.prototype.appendHTML = function (elementType, configActionOrContent) {
        let element = document.createElement(elementType);
        if (configActionOrContent) {
            if (typeof configActionOrContent == 'string') {
                element.innerHTML = configActionOrContent;
            }
            else {
                configActionOrContent(element);
            }
        }
        this.appendChild(element);
        return element;
    };
    HTMLElement.prototype.insertHTMLBefore = function (elementType, configActionOrContent) {
        let element = document.createElement(elementType);
        if (configActionOrContent) {
            if (typeof configActionOrContent == 'string') {
                element.innerHTML = configActionOrContent;
            }
            else {
                configActionOrContent(element);
            }
        }
        let _this = this;
        _this.before(element);
        return element;
    };
    HTMLElement.prototype.insertHTMLAfter = function (elementType, configActionOrContent) {
        let element = document.createElement(elementType);
        if (configActionOrContent) {
            if (typeof configActionOrContent == 'string') {
                element.innerHTML = configActionOrContent;
            }
            else {
                configActionOrContent(element);
            }
        }
        let _this = this;
        _this.after(element);
        return element;
    };
    HTMLElement.prototype.centerVertically = function () {
        this.style.position = 'relative';
        this.style.top = '50%';
        this.style.transform = 'perspective(1px) translateY(-50%)';
    };
    HTMLElement.prototype.centerHorizontally = function () {
        this.style.position = 'relative';
        this.style.left = '50%';
        this.style.transform = 'perspective(1px) translateX(-50%)';
    };
    HTMLElement.prototype.center = function () {
        this.style.position = 'relative';
        this.style.top = '50%';
        this.style.left = '50%';
        this.style.transform = 'perspective(1px) translateY(-50%) translateX(-50%)';
    };
    HTMLElement.prototype.centerContentVertically = function () {
        this.style.display = 'flex';
        this.style.alignItems = 'center';
    };
    HTMLElement.prototype.centerContentHorizontally = function () {
        this.style.display = 'flex';
        this.style.justifyContent = 'center';
    };
    HTMLElement.prototype.centerContent = function () {
        this.style.display = 'flex';
        this.style.alignItems = 'center';
        this.style.justifyContent = 'center';
    };
    HTMLElement.prototype.disableUserSelection = function () {
        NextAdmin.Style.append('NextAdmin.NoSelect', NextAdmin.UI.UserInterfaceHelper.noSelectStyle);
        this.classList.add('no-select');
    };
    HTMLElement.prototype.hideScrollbar = function () {
        NextAdmin.Style.append('NextAdmin.HideScrollbar', NextAdmin.UI.UserInterfaceHelper.noScrollbarStyle);
        this.classList.add('no-scrollbar');
    };
    HTMLElement.prototype.setBackgroundImage = function (imageUrl, cover = true) {
        this.style.background = 'url("' + imageUrl + '")';
        if (cover) {
            this.style.backgroundSize = 'cover';
        }
        this.style.backgroundRepeat = 'no-repeat';
        this.style.backgroundPosition = 'center';
    };
    HTMLElement.prototype.getChildrenElements = function () {
        let children = [];
        for (let i = 0; i < this.children.length; i++) {
            let node = this.children[i];
            if (node instanceof HTMLElement) {
                children.add(this.children[i]);
            }
        }
        return children;
    };
    HTMLElement.prototype.getDescendantsChildrenElements = function () {
        let elementsToExplore = this.getChildrenElements();
        for (let element of elementsToExplore) {
            elementsToExplore.addRange(element.getChildrenElements());
        }
        return elementsToExplore;
    };
    HTMLElement.prototype.isEnable = function () {
        let element = this;
        return element['_disableContainer'] == null;
    };
    HTMLElement.prototype.enable = function () {
        let element = this;
        let disableContainer = element['_disableContainer'];
        if (disableContainer == null) {
            return;
        }
        disableContainer.remove();
        delete element['_disableContainer'];
        element['_disableContainer'] = null;
    };
    HTMLElement.prototype.disable = function () {
        let element = this;
        element.style.position = 'relative';
        let disableContainer = element['_disableContainer'];
        if (disableContainer != null) {
            return disableContainer;
        }
        disableContainer = document.createElement('div');
        disableContainer.style.position = 'absolute';
        disableContainer.style.width = '100%';
        disableContainer.style.height = '100%';
        disableContainer.style.left = '0px';
        disableContainer.style.top = '0px';
        disableContainer.style.background = 'rgba(255,255,255,0.4)';
        disableContainer.style.cursor = 'not-allowed';
        disableContainer.style.zIndex = '10';
        element.appendChild(disableContainer);
        element['_disableContainer'] = disableContainer;
        return disableContainer;
    };
    HTMLElement.prototype.trigger = function (eventName) {
        this.dispatchEvent(new Event(eventName));
    };
    HTMLElement.prototype.getControl = function () {
        return this['_control'];
    };
    Node.prototype.addEventsListener = function (eventsNames, listener, options) {
        for (let eventName of eventsNames.split(" ")) {
            this.addEventListener(eventName, listener, options);
        }
        return listener;
    };
    Node.prototype.removeEventsListener = function (eventsNames, listener) {
        for (let eventName of eventsNames.split(" ")) {
            this.removeEventListener(eventName, listener);
        }
    };
}
catch {
}
var NextAdmin;
(function (NextAdmin) {
    class Image {
        static createBase64EmptyImage(width, height, format = 'png') {
            let imageData = new ImageData(width, height);
            let canvas = document.createElement('canvas');
            let ctx = canvas.getContext('2d');
            canvas.width = width;
            canvas.height = height;
            ctx.putImageData(imageData, 0, 0);
            return canvas.toDataURL(format);
        }
        static resizeImage(base64Data, maxWidth, maxHeight, targetType, resultAction) {
            let image = document.createElement('img');
            image.onload = () => {
                let targetSize = Image.computeResizedImageSize(image.width, image.height, maxWidth, maxHeight);
                let canvas = document.createElement('canvas');
                canvas.width = targetSize.Width;
                canvas.height = targetSize.Height;
                image.width = targetSize.Width;
                image.height = targetSize.Height;
                let ctx = canvas.getContext("2d");
                ctx.drawImage(image, 0, 0, targetSize.Width, targetSize.Height);
                let result = canvas.toDataURL(targetType);
                resultAction(result);
            };
            image.src = base64Data;
        }
        static computeResizedImageSize(imageWidth, imageHeight, maxWidth, maxHeight) {
            if (imageWidth > imageHeight) {
                if (imageWidth > maxWidth) {
                    imageHeight *= maxWidth / imageWidth;
                    imageWidth = maxWidth;
                }
            }
            else {
                if (imageHeight > maxHeight) {
                    imageWidth *= maxHeight / imageHeight;
                    imageHeight = maxHeight;
                }
            }
            return { Width: imageWidth, Height: imageHeight };
        }
        static getSize(src) {
            return new Promise((response) => {
                document.body.appendHTML('img', (img) => {
                    img.style.position = 'fixed';
                    img.style.display = 'none';
                    img.addEventListener('load', () => {
                        let size = { width: img.width, height: img.height };
                        img.remove();
                        response(size);
                    });
                    img.src = src;
                });
            });
        }
    }
    NextAdmin.Image = Image;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class Logger {
        constructor() {
            this.events = new Array();
        }
        logError(message) {
            this.events.push({
                type: LogEventType.Error,
                message: message,
                date: new Date()
            });
            return this;
        }
        logWarning(message) {
            this.events.push({
                type: LogEventType.Warning,
                message: message,
                date: new Date()
            });
            return this;
        }
        logInfo(message) {
            this.events.push({
                type: LogEventType.Info,
                message: message,
                date: new Date()
            });
            return this;
        }
        throwError(message) {
            throw (message);
        }
        buildTrace() {
            return this.events.select(e => '<b style="color="' + Logger.getEventTypeColor(e.type) + '">' + e.date.toLocaleDateString() + ' ' + e.date.toLocaleTimeString() + '</b>:' + e.message).join('<br />');
        }
        static getEventTypeColor(eventType) {
            switch (eventType) {
                case LogEventType.Info:
                    return "#00aeff";
                case LogEventType.Warning:
                    return "#ffa200";
                case LogEventType.Error:
                    return "#ff0000";
                default:
                    return "#000000";
            }
        }
    }
    NextAdmin.Logger = Logger;
    let LogEventType;
    (function (LogEventType) {
        LogEventType[LogEventType["Info"] = 0] = "Info";
        LogEventType[LogEventType["Warning"] = 1] = "Warning";
        LogEventType[LogEventType["Error"] = 2] = "Error";
    })(LogEventType = NextAdmin.LogEventType || (NextAdmin.LogEventType = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class NavigationController {
        constructor(options) {
            this._pages = new NextAdmin.Dictionary();
            this.onNavigate = new NextAdmin.EventHandler();
            this.onAddPage = new NextAdmin.EventHandler();
            this.onPageChanged = new NextAdmin.EventHandler();
            this.options = {
                pageContainer: document.body,
                enableSpaLinkNavigation: true,
                ...options
            };
            this.pageContainer = this.options.pageContainer;
            if (NextAdmin.Navigation == null) {
                NextAdmin.Navigation = this;
            }
            window.addEventListener('popstate', () => {
                this.navigateToUrl();
            });
            if (this.options.enableSpaLinkNavigation) {
                document.addEventListener('click', (e) => {
                    let element = e.srcElement;
                    while (true) {
                        if (element?.tagName === 'A') {
                            break;
                        }
                        element = element.parentElement;
                        if (element == null) {
                            return;
                        }
                    }
                    let linkElement = element;
                    if (!NextAdmin.String.isNullOrEmpty(linkElement.href)) {
                        if (new URL(linkElement.href).hostname == document.location.hostname && !linkElement.href.contains('#')) { //internalLink
                            let pageName = linkElement.href.split('/').lastOrDefault();
                            let args = null;
                            if (pageName.contains('?')) {
                                let queryString = pageName.split('?');
                                pageName = queryString[0];
                                let queryStringArgs = queryString[1];
                                args = {};
                                for (let queryArgs of queryStringArgs.split('&')) {
                                    args[queryArgs.split('=')[0]] = queryArgs.split('=')[1];
                                }
                            }
                            let page = this._pages.get(pageName);
                            console.log('Try handle spa internal link for page:' + pageName);
                            if (this._pages.get(pageName) != null || this.options.pages.firstOrDefault(a => a.name == pageName) != null) {
                                e.preventDefault();
                                this.navigateTo(pageName, args);
                            }
                            else {
                                console.log('Unable to find page:' + pageName);
                            }
                        }
                    }
                });
            }
        }
        addPage(page, key) {
            this.onAddPage.dispatch(this, page);
            this._pages.add(key ?? page.options.name, page);
        }
        getInstantiatedPages() {
            return this._pages.getValues();
        }
        async getPage(pageName) {
            if (NextAdmin.String.isNullOrEmpty(pageName))
                return null;
            let page = this._pages.get(pageName);
            if (page == null) {
                let pageInfo = this.options.pages.firstOrDefault(a => a.name == pageName);
                if (pageInfo) {
                    let pageContainer = this.pageContainer ?? document.body;
                    if (pageInfo.scriptUrl) {
                        await NextAdmin.DependenciesController.load([pageInfo.scriptUrl]);
                    }
                    let pageOptions = { name: pageName, id: pageName, container: pageContainer, pageInfo: pageInfo };
                    if (pageInfo.factory) {
                        page = pageInfo.factory(pageOptions);
                    }
                    else if (pageInfo.className) {
                        try {
                            eval("page=new " + pageInfo.className + "(pageOptions)");
                        }
                        catch {
                            console.log('NavigationController.getPage:Unable to instanciate page : ' + pageInfo.name);
                        }
                    }
                    else {
                        page = new NextAdmin.UI.Page(pageOptions);
                    }
                }
                if (page != null) {
                    this.addPage(page, pageName);
                }
            }
            return page;
        }
        getCurrentPage() {
            return this._currentPage;
        }
        getCurrentPageName() {
            return this._currentPage?.options.name;
        }
        getPreviousPage() {
            return this._previousPage;
        }
        getPreviousPageName() {
            return this._previousPage?.options.name;
        }
        async navigateToUrl(url = document.location.href, updateNavigatorState = UpdateNavigatorState.none) {
            let pageInfo = this.getPageInfoFromUrl(url);
            let page = await this.getPage(pageInfo.pageName);
            if (page == null) { //unable to find view, so navigate to default view
                console.log('NavigationController.navigateToUrl:unable to find page:' + pageInfo.pageName + ', so navigate to default page:' + this.options.defaultPage);
                this.navigateTo(this.options.defaultPage, null, updateNavigatorState);
            }
            else {
                console.log('NavigationController.navigateToUrl:navigate to:{' + pageInfo.pageName + '}');
                this.navigateTo(pageInfo.pageName, pageInfo.pageData, updateNavigatorState);
            }
        }
        getPageInfoFromUrl(url = document.location.href) {
            let urlParts = url.split('/');
            let pageName = null;
            if (urlParts != null && urlParts.length > 0) {
                pageName = urlParts.last();
            }
            else {
                pageName = url;
            }
            let data;
            if (pageName.indexOf('?') != -1) {
                let viewNameAndParams = pageName.split('?');
                pageName = viewNameAndParams[0];
                let params = viewNameAndParams[1];
                if (!NextAdmin.String.isNullOrEmpty(params)) {
                    data = NextAdmin.QueryString.parseQuery(params);
                }
            }
            return {
                pageName: pageName,
                pageData: data
            };
        }
        async refresh(reload) {
            if (reload) {
                location.reload();
            }
            if (this._currentPage?.options?.name == null) {
                return;
            }
            await this.navigateTo(this._currentPage.options.name, this._currentPage.getData(), UpdateNavigatorState.none, true);
        }
        async navigateBack() {
            return new Promise((result) => {
                this.onNavigate.subscribeOnce(() => {
                    result(this.getCurrentPage());
                });
                history.back();
            });
        }
        async navigateBackOrDefault(defaultPageName) {
            if (this.getPreviousPage()) {
                return this.navigateBack();
            }
            else {
                if (defaultPageName == null) {
                    defaultPageName = this.options.defaultPage;
                }
                this.navigateTo(defaultPageName, null, UpdateNavigatorState.replaceState);
            }
        }
        async navigateTo(pageName, parameters = null, updateNavigatorState = UpdateNavigatorState.pushState, force = false) {
            if (!force && this._currentPage != null && this._currentPage.options != null && pageName == this._currentPage.options.name && JSON.stringify(parameters) == JSON.stringify(this._currentPage.parameters)) {
                return;
            }
            if (parameters == null) {
                parameters = {};
            }
            let nextPage = await this.getPage(pageName);
            if (nextPage == null) {
                console.log(pageName + ' not found');
                return null;
            }
            let previousPage = this._currentPage;
            if (previousPage != null) {
                let args = {
                    nextPage: nextPage,
                    nextPageParameters: parameters
                };
                await previousPage.navigateFrom(args);
                if (args.cancelNavigation) {
                    return null;
                }
            }
            if (this._currentPage != nextPage) {
                this._previousPage = previousPage;
                this._currentPage = nextPage;
            }
            let navigateArgs = { previousPage: this._previousPage, nextPage: nextPage };
            this.onNavigate.dispatch(this, navigateArgs);
            if (navigateArgs.cancelNavigation) {
                return null;
            }
            let nextPageNavigationArgs = {
                previousPage: previousPage,
                parameters: parameters,
                dependencies: nextPage?.options?.pageInfo?.dependencies,
                contentUrl: nextPage?.options?.pageInfo?.contentUrl
            };
            if (nextPageNavigationArgs.contentUrl) { //preload view html content
                await nextPage.loadContent(nextPageNavigationArgs.contentUrl);
            }
            if (previousPage != null) {
                previousPage.endNavigateFrom();
            }
            await nextPage.navigateTo(nextPageNavigationArgs);
            if (updateNavigatorState && window.history && window.history.pushState) {
                let url = this._currentPage.options.name;
                if (!NextAdmin.String.isNullOrEmpty(document.location.pathname)) {
                    let currentLocationArrayPath = document.location.pathname.split('/');
                    currentLocationArrayPath.pop();
                    currentLocationArrayPath.push(url);
                    url = currentLocationArrayPath.join('/').replaceAll('//', '/');
                }
                if (!url.startsWith('/')) {
                    url = '/' + url;
                }
                if (parameters != null) {
                    let params = NextAdmin.QueryString.encodeQuery(parameters);
                    if (!NextAdmin.String.isNullOrEmpty(params)) {
                        url += '?' + params;
                    }
                }
                if (updateNavigatorState == UpdateNavigatorState.pushState) {
                    window.history.pushState('', this._currentPage.options.name, url);
                }
                else if (updateNavigatorState == UpdateNavigatorState.replaceState) {
                    window.history.replaceState('', this._currentPage.options.name, url);
                }
            }
            this.onPageChanged.dispatch(this, nextPage);
            return nextPage;
        }
        getDisplayMode() {
            if (this.displayMode) {
                return this.displayMode;
            }
            return NextAdmin.UserAgent.isMobile() ? DisplayMode.mobile : DisplayMode.desktop;
        }
        async setDisplayMode(displayMode) {
            this.displayMode = displayMode;
        }
        static getDisplayMode() {
            if (NextAdmin.Navigation) {
                return NextAdmin.Navigation.getDisplayMode();
            }
            return NextAdmin.UserAgent.isMobile() ? DisplayMode.mobile : DisplayMode.desktop;
        }
    }
    NextAdmin.NavigationController = NavigationController;
    let DisplayMode;
    (function (DisplayMode) {
        DisplayMode[DisplayMode["desktop"] = 1] = "desktop";
        DisplayMode[DisplayMode["mobile"] = 2] = "mobile";
    })(DisplayMode = NextAdmin.DisplayMode || (NextAdmin.DisplayMode = {}));
    let UpdateNavigatorState;
    (function (UpdateNavigatorState) {
        UpdateNavigatorState[UpdateNavigatorState["none"] = 0] = "none";
        UpdateNavigatorState[UpdateNavigatorState["pushState"] = 1] = "pushState";
        UpdateNavigatorState[UpdateNavigatorState["replaceState"] = 2] = "replaceState";
    })(UpdateNavigatorState = NextAdmin.UpdateNavigatorState || (NextAdmin.UpdateNavigatorState = {}));
    NextAdmin.CacheKey = NextAdmin.Guid.createStrGuid();
})(NextAdmin || (NextAdmin = {}));
try {
    Number.prototype.toStringDigit = function (digitCount) {
        return this.toString().ToDigit(digitCount);
    };
}
catch {
}
var NextAdmin;
(function (NextAdmin) {
    class Path {
        static getFileExtension(fileNameOrExtension) {
            if (fileNameOrExtension == null) {
                return '';
            }
            return (fileNameOrExtension.contains(".") ? fileNameOrExtension.split(".")[1] : fileNameOrExtension).toLocaleLowerCase();
        }
        static getFileName(fullPath) {
            if (fullPath == null) {
                return '';
            }
            if (!fullPath.contains('/')) {
                return fullPath;
            }
            return fullPath.substring(fullPath.lastIndexOf("/") + 1);
        }
        static getFileNameWithoutExtension(fileNameWithExtension) {
            fileNameWithExtension = this.getFileName(fileNameWithExtension);
            let extensionIndox = fileNameWithExtension.lastIndexOf('.');
            if (extensionIndox < 0) {
                return fileNameWithExtension;
            }
            return fileNameWithExtension.substr(0, extensionIndox);
        }
        static isImage(fileNameOrExtension) {
            var fileExtension = Path.getFileExtension(fileNameOrExtension);
            return (fileExtension == "png" || fileExtension == "jpg" || fileExtension == "jpeg" || fileExtension == "gif" || fileExtension == "bmp");
        }
        static isAudio(fileNameOrExtension) {
            var fileExtension = Path.getFileExtension(fileNameOrExtension);
            return (fileExtension == "mp3" || fileExtension == "flac" || fileExtension == "wma");
        }
        static isVideo(fileNameOrExtension) {
            var fileExtension = Path.getFileExtension(fileNameOrExtension);
            return (fileExtension == "mp4" || fileExtension == "mkv" || fileExtension == "webm");
        }
        /**
         * Return parent directory path with name (full path)
         * @param fullPath
         */
        static getDirectoryName(fullPath) {
            if (NextAdmin.String.isNullOrEmpty(fullPath) || !fullPath.contains('/'))
                return '';
            return fullPath.substring(0, fullPath.lastIndexOf("/"));
        }
        static combine(str1, str2) {
            str1 = (str1 ?? '').replaceAll('\\', '/');
            str2 = (str2 ?? '').replaceAll('\\', '/');
            if (NextAdmin.String.isNullOrEmpty(str2)) {
                return str1;
            }
            if (NextAdmin.String.isNullOrEmpty(str1)) {
                return str2;
            }
            if (str1.endsWith('/')) {
                str1 = str1.substr(0, str1.length - 1);
            }
            if (str2.startsWith('/')) {
                str2 = str2.substr(1, str2.length);
            }
            return str1 + '/' + str2;
        }
    }
    NextAdmin.Path = Path;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class PerfectScrollbarHandler {
        static ensurePerfectScrollbarLoaded() {
            if (!PerfectScrollbarHandler._perfectScrollBarLoaded) {
                let style = document.createElement("style");
                style.textContent = '.ps { overflow: hidden !important;overflow-anchor: none;-ms-overflow-style: none;touch-action: auto; -ms-touch-action: auto;}.ps__rail-x {display: none; opacity: 0; transition: background-color .2s linear, opacity .2s linear; -webkit-transition: background-color .2s linear, opacity .2s linear; height: 15px;bottom: 0px; position: absolute;} .ps__rail-y { display: none; opacity: 0; transition: background-color .2s linear, opacity .2s linear; -webkit-transition: background-color .2s linear, opacity .2s linear; width: 15px; right: 0;position: absolute;} .ps--active-x > .ps__rail-x, .ps--active-y > .ps__rail-y { display: block; background-color: transparent;} .ps:hover > .ps__rail-x, .ps:hover > .ps__rail-y, .ps--focus > .ps__rail-x, .ps--focus > .ps__rail-y, .ps--scrolling-x > .ps__rail-x, .ps--scrolling-y > .ps__rail-y { opacity: 0.6;} .ps__rail-x:hover, .ps__rail-y:hover, .ps__rail-x:focus, .ps__rail-y:focus { background-color: #eee; opacity: 0.9; } .ps__thumb-x { background-color: #aaa; border-radius: 6px; transition: background-color .2s linear, height .2s ease-in-out; -webkit-transition: background-color .2s linear, height .2s ease-in-out; height: 6px; bottom: 2px; position: absolute; } .ps__thumb-y { background-color: #aaa; border-radius: 6px; transition: background-color .2s linear, width .2s ease-in-out; -webkit-transition: background-color .2s linear, width .2s ease-in-out; width: 6px; right: 2px; position: absolute; } .ps__rail-x:hover > .ps__thumb-x, .ps__rail-x:focus > .ps__thumb-x { background-color: #999; height: 11px; } .ps__rail-y:hover > .ps__thumb-y, .ps__rail-y:focus > .ps__thumb-y { background-color: #999; width: 11px; } @supports (-ms-overflow-style: none) { .ps { overflow: auto !important; } } @media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) { .ps { overflow: auto !important; } }';
                document.head.appendChild(style);
                let script = document.createElement('script');
                script.textContent = "(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define(b):(a=a||self,a.PerfectScrollbar=b())})(this,function(){'use strict';var u=Math.abs,v=Math.floor;function a(a){return getComputedStyle(a)}function b(a,b){for(var c in b){var d=b[c];'number'==typeof d&&(d+='px'),a.style[c]=d}return a}function c(a){var b=document.createElement('div');return b.className=a,b}function d(a,b){if(!w)throw new Error('No element matching method supported');return w.call(a,b)}function e(a){a.remove?a.remove():a.parentNode&&a.parentNode.removeChild(a)}function f(a,b){return Array.prototype.filter.call(a.children,function(a){return d(a,b)})}function g(a,b){var c=a.element.classList,d=z.state.scrolling(b);c.contains(d)?clearTimeout(A[b]):c.add(d)}function h(a,b){A[b]=setTimeout(function(){return a.isAlive&&a.element.classList.remove(z.state.scrolling(b))},a.settings.scrollingThreshold)}function j(a,b){g(a,b),h(a,b)}function k(a){if('function'==typeof window.CustomEvent)return new CustomEvent(a);var b=document.createEvent('CustomEvent');return b.initCustomEvent(a,!1,!1,void 0),b}function l(a,b,c,d,e){void 0===d&&(d=!0),void 0===e&&(e=!1);var f;if('top'===b)f=['contentHeight','containerHeight','scrollTop','y','up','down'];else if('left'===b)f=['contentWidth','containerWidth','scrollLeft','x','left','right'];else throw new Error('A proper axis should be provided');m(a,c,f,d,e)}function m(a,b,c,d,e){var f=c[0],g=c[1],h=c[2],i=c[3],l=c[4],m=c[5];void 0===d&&(d=!0),void 0===e&&(e=!1);var n=a.element; a.reach[i]=null,1>n[h]&&(a.reach[i]='start'),n[h]>a[f]-a[g]-1&&(a.reach[i]='end'),b&&(n.dispatchEvent(k('ps-scroll-'+i)),0>b?n.dispatchEvent(k('ps-scroll-'+l)):0<b&&n.dispatchEvent(k('ps-scroll-'+m)),d&&j(a,i)),a.reach[i]&&(b||e)&&n.dispatchEvent(k('ps-'+i+'-reach-'+a.reach[i]))}function n(a){return parseInt(a,10)||0}function o(a){return d(a,'input,[contenteditable]')||d(a,'select,[contenteditable]')||d(a,'textarea,[contenteditable]')||d(a,'button,[contenteditable]')}function p(b){var c=a(b);return n(c.width)+n(c.paddingLeft)+n(c.paddingRight)+n(c.borderLeftWidth)+n(c.borderRightWidth)}function q(a){var b=Math.ceil,c=a.element,d=v(c.scrollTop),g=c.getBoundingClientRect();a.containerWidth=b(g.width),a.containerHeight=b(g.height),a.contentWidth=c.scrollWidth,a.contentHeight=c.scrollHeight,c.contains(a.scrollbarXRail)||(f(c,z.element.rail('x')).forEach(function(a){return e(a)}),c.appendChild(a.scrollbarXRail)),c.contains(a.scrollbarYRail)||(f(c,z.element.rail('y')).forEach(function(a){return e(a)}),c.appendChild(a.scrollbarYRail)),!a.settings.suppressScrollX&&a.containerWidth+a.settings.scrollXMarginOffset<a.contentWidth?(a.scrollbarXActive=!0,a.railXWidth=a.containerWidth-a.railXMarginWidth,a.railXRatio=a.containerWidth/a.railXWidth,a.scrollbarXWidth=r(a,n(a.railXWidth*a.containerWidth/a.contentWidth)),a.scrollbarXLeft=n((a.negativeScrollAdjustment+c.scrollLeft)*(a.railXWidth-a.scrollbarXWidth)/(a.contentWidth-a.containerWidth))):a.scrollbarXActive=!1,!a.settings.suppressScrollY&&a.containerHeight+a.settings.scrollYMarginOffset<a.contentHeight?(a.scrollbarYActive=!0,a.railYHeight=a.containerHeight-a.railYMarginHeight,a.railYRatio=a.containerHeight/a.railYHeight,a.scrollbarYHeight=r(a,n(a.railYHeight*a.containerHeight/a.contentHeight)),a.scrollbarYTop=n(d*(a.railYHeight-a.scrollbarYHeight)/(a.contentHeight-a.containerHeight))):a.scrollbarYActive=!1,a.scrollbarXLeft>=a.railXWidth-a.scrollbarXWidth&&(a.scrollbarXLeft=a.railXWidth-a.scrollbarXWidth),a.scrollbarYTop>=a.railYHeight-a.scrollbarYHeight&&(a.scrollbarYTop=a.railYHeight-a.scrollbarYHeight),s(c,a),a.scrollbarXActive?c.classList.add(z.state.active('x')):(c.classList.remove(z.state.active('x')),a.scrollbarXWidth=0,a.scrollbarXLeft=0,c.scrollLeft=!0===a.isRtl?a.contentWidth:0),a.scrollbarYActive?c.classList.add(z.state.active('y')):(c.classList.remove(z.state.active('y')),a.scrollbarYHeight=0,a.scrollbarYTop=0,c.scrollTop=0)}function r(a,b){var c=Math.min,d=Math.max;return a.settings.minScrollbarLength&&(b=d(b,a.settings.minScrollbarLength)),a.settings.maxScrollbarLength&&(b=c(b,a.settings.maxScrollbarLength)),b}function s(a,c){var d={width:c.railXWidth},e=v(a.scrollTop);d.left=c.isRtl?c.negativeScrollAdjustment+a.scrollLeft+c.containerWidth-c.contentWidth:a.scrollLeft,c.isScrollbarXUsingBottom?d.bottom=c.scrollbarXBottom-e:d.top=c.scrollbarXTop+e,b(c.scrollbarXRail,d);var f={top:e,height:c.railYHeight};c.isScrollbarYUsingRight?c.isRtl?f.right=c.contentWidth-(c.negativeScrollAdjustment+a.scrollLeft)-c.scrollbarYRight-c.scrollbarYOuterWidth-9:f.right=c.scrollbarYRight-a.scrollLeft:c.isRtl?f.left=c.negativeScrollAdjustment+a.scrollLeft+2*c.containerWidth-c.contentWidth-c.scrollbarYLeft-c.scrollbarYOuterWidth:f.left=c.scrollbarYLeft+a.scrollLeft,b(c.scrollbarYRail,f),b(c.scrollbarX,{left:c.scrollbarXLeft,width:c.scrollbarXWidth-c.railBorderXWidth}),b(c.scrollbarY,{top:c.scrollbarYTop,height:c.scrollbarYHeight-c.railBorderYWidth})}function t(a,b){function c(b){b.touches&&b.touches[0]&&(b[k]=b.touches[0].pageY),s[o]=t+v*(b[k]-u),g(a,p),q(a),b.stopPropagation(),b.preventDefault()}function d(){h(a,p),a[r].classList.remove(z.state.clicking),a.event.unbind(a.ownerDocument,'mousemove',c)}function f(b,e){t=s[o],e&&b.touches&&(b[k]=b.touches[0].pageY),u=b[k],v=(a[j]-a[i])/(a[l]-a[n]),e?a.event.bind(a.ownerDocument,'touchmove',c):(a.event.bind(a.ownerDocument,'mousemove',c),a.event.once(a.ownerDocument,'mouseup',d),b.preventDefault()),a[r].classList.add(z.state.clicking),b.stopPropagation()}var i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],r=b[8],s=a.element,t=null,u=null,v=null;a.event.bind(a[m],'mousedown',function(a){f(a)}),a.event.bind(a[m],'touchstart',function(a){f(a,!0)})}var w='undefined'!=typeof Element&&(Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector),z={main:'ps',rtl:'ps__rtl',element:{thumb:function(a){return'ps__thumb-'+a},rail:function(a){return'ps__rail-'+a},consuming:'ps__child--consume'},state:{focus:'ps--focus',clicking:'ps--clicking',active:function(a){return'ps--active-'+a},scrolling:function(a){return'ps--scrolling-'+a}}},A={x:null,y:null},B=function(a){this.element=a,this.handlers={}},C={isEmpty:{configurable:!0}};B.prototype.bind=function(a,b){'undefined'==typeof this.handlers[a]&&(this.handlers[a]=[]),this.handlers[a].push(b),this.element.addEventListener(a,b,!1)},B.prototype.unbind=function(a,b){var c=this;this.handlers[a]=this.handlers[a].filter(function(d){return!!(b&&d!==b)||(c.element.removeEventListener(a,d,!1),!1)})},B.prototype.unbindAll=function(){for(var a in this.handlers)this.unbind(a)},C.isEmpty.get=function(){var a=this;return Object.keys(this.handlers).every(function(b){return 0===a.handlers[b].length})},Object.defineProperties(B.prototype,C);var D=function(){this.eventElements=[]};D.prototype.eventElement=function(a){var b=this.eventElements.filter(function(b){return b.element===a})[0];return b||(b=new B(a),this.eventElements.push(b)),b},D.prototype.bind=function(a,b,c){this.eventElement(a).bind(b,c)},D.prototype.unbind=function(a,b,c){var d=this.eventElement(a);d.unbind(b,c),d.isEmpty&&this.eventElements.splice(this.eventElements.indexOf(d),1)},D.prototype.unbindAll=function(){this.eventElements.forEach(function(a){return a.unbindAll()}),this.eventElements=[]},D.prototype.once=function(a,b,c){var d=this.eventElement(a),e=function(a){d.unbind(b,e),c(a)};d.bind(b,e)};var E={isWebKit:'undefined'!=typeof document&&'WebkitAppearance'in document.documentElement.style,supportsTouch:'undefined'!=typeof window&&('ontouchstart'in window||'maxTouchPoints'in window.navigator&&0<window.navigator.maxTouchPoints||window.DocumentTouch&&document instanceof window.DocumentTouch),supportsIePointer:'undefined'!=typeof navigator&&navigator.msMaxTouchPoints,isChrome:'undefined'!=typeof navigator&&/Chrome/i.test(navigator&&navigator.userAgent)},F=function(){return{handlers:['click-rail','drag-thumb','keyboard','wheel','touch'],maxScrollbarLength:null,minScrollbarLength:null,scrollingThreshold:1e3,scrollXMarginOffset:0,scrollYMarginOffset:0,suppressScrollX:!1,suppressScrollY:!1,swipeEasing:!0,useBothWheelAxes:!1,wheelPropagation:!0,wheelSpeed:1}},G={'click-rail':function(a){a.element;a.event.bind(a.scrollbarY,'mousedown',function(a){return a.stopPropagation()}),a.event.bind(a.scrollbarYRail,'mousedown',function(b){var c=b.pageY-window.pageYOffset-a.scrollbarYRail.getBoundingClientRect().top,d=c>a.scrollbarYTop?1:-1;a.element.scrollTop+=d*a.containerHeight,q(a),b.stopPropagation()}),a.event.bind(a.scrollbarX,'mousedown',function(a){return a.stopPropagation()}),a.event.bind(a.scrollbarXRail,'mousedown',function(b){var c=b.pageX-window.pageXOffset-a.scrollbarXRail.getBoundingClientRect().left,d=c>a.scrollbarXLeft?1:-1;a.element.scrollLeft+=d*a.containerWidth,q(a),b.stopPropagation()})},'drag-thumb':function(a){t(a,['containerWidth','contentWidth','pageX','railXWidth','scrollbarX','scrollbarXWidth','scrollLeft','x','scrollbarXRail']),t(a,['containerHeight','contentHeight','pageY','railYHeight','scrollbarY','scrollbarYHeight','scrollTop','y','scrollbarYRail'])},keyboard:function(a){function b(b,d){var e=v(c.scrollTop);if(0===b){if(!a.scrollbarYActive)return!1;if(0===e&&0<d||e>=a.contentHeight-a.containerHeight&&0>d)return!a.settings.wheelPropagation}var f=c.scrollLeft;if(0===d){if(!a.scrollbarXActive)return!1;if(0===f&&0>b||f>=a.contentWidth-a.containerWidth&&0<b)return!a.settings.wheelPropagation}return!0}var c=a.element,f=function(){return d(c,':hover')},g=function(){return d(a.scrollbarX,':focus')||d(a.scrollbarY,':focus')};a.event.bind(a.ownerDocument,'keydown',function(d){if(!(d.isDefaultPrevented&&d.isDefaultPrevented()||d.defaultPrevented)&&(f()||g())){var e=document.activeElement?document.activeElement:a.ownerDocument.activeElement;if(e){if('IFRAME'===e.tagName)e=e.contentDocument.activeElement;else for(;e.shadowRoot;)e=e.shadowRoot.activeElement;if(o(e))return}var h=0,i=0;switch(d.which){case 37:h=d.metaKey?-a.contentWidth:d.altKey?-a.containerWidth:-30;break;case 38:i=d.metaKey?a.contentHeight:d.altKey?a.containerHeight:30;break;case 39:h=d.metaKey?a.contentWidth:d.altKey?a.containerWidth:30;break;case 40:i=d.metaKey?-a.contentHeight:d.altKey?-a.containerHeight:-30;break;case 32:i=d.shiftKey?a.containerHeight:-a.containerHeight;break;case 33:i=a.containerHeight;break;case 34:i=-a.containerHeight;break;case 36:i=a.contentHeight;break;case 35:i=-a.contentHeight;break;default:return;}a.settings.suppressScrollX&&0!==h||a.settings.suppressScrollY&&0!==i||(c.scrollTop-=i,c.scrollLeft+=h,q(a),b(h,i)&&d.preventDefault())}})},wheel:function(b){function c(a,c){var d,e=v(h.scrollTop),f=0===h.scrollTop,g=e+h.offsetHeight===h.scrollHeight,i=0===h.scrollLeft,j=h.scrollLeft+h.offsetWidth===h.scrollWidth;return d=u(c)>u(a)?f||g:i||j,!d||!b.settings.wheelPropagation}function d(a){var b=a.deltaX,c=-1*a.deltaY;return('undefined'==typeof b||'undefined'==typeof c)&&(b=-1*a.wheelDeltaX/6,c=a.wheelDeltaY/6),a.deltaMode&&1===a.deltaMode&&(b*=10,c*=10),b!==b&&c!==c/* NaN checks */&&(b=0,c=a.wheelDelta),a.shiftKey?[-c,-b]:[b,c]}function f(b,c,d){ if(!E.isWebKit&&h.querySelector('select:focus'))return!0;if(!h.contains(b))return!1;for(var e=b;e&&e!==h;){if(e.classList.contains(z.element.consuming))return!0;var f=a(e); if(d&&f.overflowY.match(/(scroll|auto)/)){var g=e.scrollHeight-e.clientHeight;if(0<g&&(0<e.scrollTop&&0>d||e.scrollTop<g&&0<d))return!0} if(c&&f.overflowX.match(/(scroll|auto)/)){var i=e.scrollWidth-e.clientWidth;if(0<i&&(0<e.scrollLeft&&0>c||e.scrollLeft<i&&0<c))return!0}e=e.parentNode}return!1}function g(a){var e=d(a),g=e[0],i=e[1];if(!f(a.target,g,i)){var j=!1;b.settings.useBothWheelAxes?b.scrollbarYActive&&!b.scrollbarXActive?(i?h.scrollTop-=i*b.settings.wheelSpeed:h.scrollTop+=g*b.settings.wheelSpeed,j=!0):b.scrollbarXActive&&!b.scrollbarYActive&&(g?h.scrollLeft+=g*b.settings.wheelSpeed:h.scrollLeft-=i*b.settings.wheelSpeed,j=!0):(h.scrollTop-=i*b.settings.wheelSpeed,h.scrollLeft+=g*b.settings.wheelSpeed),q(b),j=j||c(g,i),j&&!a.ctrlKey&&(a.stopPropagation(),a.preventDefault())}}var h=b.element;'undefined'==typeof window.onwheel?'undefined'!=typeof window.onmousewheel&&b.event.bind(h,'mousewheel',g):b.event.bind(h,'wheel',g)},touch:function(b){function c(a,c){var d=v(l.scrollTop),e=l.scrollLeft,f=u(a),g=u(c);if(g>f){ if(0>c&&d===b.contentHeight-b.containerHeight||0<c&&0===d) return 0===window.scrollY&&0<c&&E.isChrome;}else if(f>g&&(0>a&&e===b.contentWidth-b.containerWidth||0<a&&0===e))return!0;return!0}function d(a,c){l.scrollTop-=c,l.scrollLeft-=a,q(b)}function f(a){return a.targetTouches?a.targetTouches[0]:a}function g(a){return!(a.pointerType&&'pen'===a.pointerType&&0===a.buttons)&&(!!(a.targetTouches&&1===a.targetTouches.length)||!!(a.pointerType&&'mouse'!==a.pointerType&&a.pointerType!==a.MSPOINTER_TYPE_MOUSE))}function h(a){if(g(a)){var b=f(a);m.pageX=b.pageX,m.pageY=b.pageY,n=new Date().getTime(),null!==p&&clearInterval(p)}}function i(b,c,d){if(!l.contains(b))return!1;for(var e=b;e&&e!==l;){if(e.classList.contains(z.element.consuming))return!0;var f=a(e); if(d&&f.overflowY.match(/(scroll|auto)/)){var g=e.scrollHeight-e.clientHeight;if(0<g&&(0<e.scrollTop&&0>d||e.scrollTop<g&&0<d))return!0} if(c&&f.overflowX.match(/(scroll|auto)/)){var h=e.scrollWidth-e.clientWidth;if(0<h&&(0<e.scrollLeft&&0>c||e.scrollLeft<h&&0<c))return!0}e=e.parentNode}return!1}function j(a){if(g(a)){var b=f(a),e={pageX:b.pageX,pageY:b.pageY},h=e.pageX-m.pageX,j=e.pageY-m.pageY;if(i(a.target,h,j))return;d(h,j),m=e;var k=new Date().getTime(),l=k-n;0<l&&(o.x=h/l,o.y=j/l,n=k),c(h,j)&&a.preventDefault()}}function k(){b.settings.swipeEasing&&(clearInterval(p),p=setInterval(function(){return b.isInitialized?void clearInterval(p):o.x||o.y?.01>u(o.x)&&.01>u(o.y)?void clearInterval(p):void(d(30*o.x,30*o.y),o.x*=.8,o.y*=.8):void clearInterval(p)},10))}if(E.supportsTouch||E.supportsIePointer){var l=b.element,m={},n=0,o={},p=null;E.supportsTouch?(b.event.bind(l,'touchstart',h),b.event.bind(l,'touchmove',j),b.event.bind(l,'touchend',k)):E.supportsIePointer&&(window.PointerEvent?(b.event.bind(l,'pointerdown',h),b.event.bind(l,'pointermove',j),b.event.bind(l,'pointerup',k)):window.MSPointerEvent&&(b.event.bind(l,'MSPointerDown',h),b.event.bind(l,'MSPointerMove',j),b.event.bind(l,'MSPointerUp',k)))}}},H=function(d,e){var f=this;if(void 0===e&&(e={}),'string'==typeof d&&(d=document.querySelector(d)),!d||!d.nodeName)throw new Error('no element is specified to initialize PerfectScrollbar');for(var g in this.element=d,d.classList.add(z.main),this.settings=F(),e)this.settings[g]=e[g];this.containerWidth=null,this.containerHeight=null,this.contentWidth=null,this.contentHeight=null;var h=function(){return d.classList.add(z.state.focus)},i=function(){return d.classList.remove(z.state.focus)};this.isRtl='rtl'===a(d).direction,!0===this.isRtl&&d.classList.add(z.rtl),this.isNegativeScroll=function(){var a=d.scrollLeft,b=null;return d.scrollLeft=-1,b=0>d.scrollLeft,d.scrollLeft=a,b}(),this.negativeScrollAdjustment=this.isNegativeScroll?d.scrollWidth-d.clientWidth:0,this.event=new D,this.ownerDocument=d.ownerDocument||document,this.scrollbarXRail=c(z.element.rail('x')),d.appendChild(this.scrollbarXRail),this.scrollbarX=c(z.element.thumb('x')),this.scrollbarXRail.appendChild(this.scrollbarX),this.scrollbarX.setAttribute('tabindex',0),this.event.bind(this.scrollbarX,'focus',h),this.event.bind(this.scrollbarX,'blur',i),this.scrollbarXActive=null,this.scrollbarXWidth=null,this.scrollbarXLeft=null;var j=a(this.scrollbarXRail);this.scrollbarXBottom=parseInt(j.bottom,10),isNaN(this.scrollbarXBottom)?(this.isScrollbarXUsingBottom=!1,this.scrollbarXTop=n(j.top)):this.isScrollbarXUsingBottom=!0,this.railBorderXWidth=n(j.borderLeftWidth)+n(j.borderRightWidth),b(this.scrollbarXRail,{display:'block'}),this.railXMarginWidth=n(j.marginLeft)+n(j.marginRight),b(this.scrollbarXRail,{display:''}),this.railXWidth=null,this.railXRatio=null,this.scrollbarYRail=c(z.element.rail('y')),d.appendChild(this.scrollbarYRail),this.scrollbarY=c(z.element.thumb('y')),this.scrollbarYRail.appendChild(this.scrollbarY),this.scrollbarY.setAttribute('tabindex',0),this.event.bind(this.scrollbarY,'focus',h),this.event.bind(this.scrollbarY,'blur',i),this.scrollbarYActive=null,this.scrollbarYHeight=null,this.scrollbarYTop=null;var k=a(this.scrollbarYRail);this.scrollbarYRight=parseInt(k.right,10),isNaN(this.scrollbarYRight)?(this.isScrollbarYUsingRight=!1,this.scrollbarYLeft=n(k.left)):this.isScrollbarYUsingRight=!0,this.scrollbarYOuterWidth=this.isRtl?p(this.scrollbarY):null,this.railBorderYWidth=n(k.borderTopWidth)+n(k.borderBottomWidth),b(this.scrollbarYRail,{display:'block'}),this.railYMarginHeight=n(k.marginTop)+n(k.marginBottom),b(this.scrollbarYRail,{display:''}),this.railYHeight=null,this.railYRatio=null,this.reach={x:0>=d.scrollLeft?'start':d.scrollLeft>=this.contentWidth-this.containerWidth?'end':null,y:0>=d.scrollTop?'start':d.scrollTop>=this.contentHeight-this.containerHeight?'end':null},this.isAlive=!0,this.settings.handlers.forEach(function(a){return G[a](f)}),this.lastScrollTop=v(d.scrollTop),this.lastScrollLeft=d.scrollLeft,this.event.bind(this.element,'scroll',function(a){return f.onScroll(a)}),q(this)};return H.prototype.update=function(){this.isAlive&&( this.negativeScrollAdjustment=this.isNegativeScroll?this.element.scrollWidth-this.element.clientWidth:0,b(this.scrollbarXRail,{display:'block'}),b(this.scrollbarYRail,{display:'block'}),this.railXMarginWidth=n(a(this.scrollbarXRail).marginLeft)+n(a(this.scrollbarXRail).marginRight),this.railYMarginHeight=n(a(this.scrollbarYRail).marginTop)+n(a(this.scrollbarYRail).marginBottom),b(this.scrollbarXRail,{display:'none'}),b(this.scrollbarYRail,{display:'none'}),q(this),l(this,'top',0,!1,!0),l(this,'left',0,!1,!0),b(this.scrollbarXRail,{display:''}),b(this.scrollbarYRail,{display:''}))},H.prototype.onScroll=function(){this.isAlive&&(q(this),l(this,'top',this.element.scrollTop-this.lastScrollTop),l(this,'left',this.element.scrollLeft-this.lastScrollLeft),this.lastScrollTop=v(this.element.scrollTop),this.lastScrollLeft=this.element.scrollLeft)},H.prototype.destroy=function(){this.isAlive&&( this.event.unbindAll(),e(this.scrollbarX),e(this.scrollbarY),e(this.scrollbarXRail),e(this.scrollbarYRail),this.removePsClasses(),this.element=null,this.scrollbarX=null,this.scrollbarY=null,this.scrollbarXRail=null,this.scrollbarYRail=null,this.isAlive=!1)},H.prototype.removePsClasses=function(){this.element.className=this.element.className.split(' ').filter(function(a){return!a.match(/^ps([-_].+|)$/)}).join(' ')},H});";
                document.head.appendChild(script);
                PerfectScrollbarHandler._perfectScrollBarLoaded = true;
            }
        }
        static async append(element) {
            PerfectScrollbarHandler.ensurePerfectScrollbarLoaded();
            await NextAdmin.Timer.sleep(10);
            return new PerfectScrollbar(element);
        }
    }
    PerfectScrollbarHandler._perfectScrollBarLoaded = false;
    NextAdmin.PerfectScrollbarHandler = PerfectScrollbarHandler;
})(NextAdmin || (NextAdmin = {}));
try {
    HTMLElement.prototype.appendPerfectScrollbar = function () {
        return NextAdmin.PerfectScrollbarHandler.append(this);
    };
}
catch {
}
var NextAdmin;
(function (NextAdmin) {
    class QueryString {
        static fromURL() {
            return QueryString.parseURL(document.location.href);
        }
        static parseURL(url) {
            let urlParts = url.split('?');
            if (urlParts.length < 2) {
                return null;
            }
            return QueryString.parseQuery(urlParts[1]);
        }
        static parseQuery(queryString) {
            var query = {};
            var pairs = (queryString[0] === '?' ? queryString.substr(1) : queryString).split('&');
            for (var i = 0; i < pairs.length; i++) {
                var pair = pairs[i].split('=');
                query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');
            }
            return query;
        }
        static encodeQuery(obj) {
            var str = [];
            for (var p in obj)
                if (obj.hasOwnProperty(p)) {
                    str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
                }
            return str.join("&");
        }
    }
    NextAdmin.QueryString = QueryString;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class ResourcesManager {
        get(key) {
            return this[key] ?? key;
        }
        addResources(...resources) {
            for (let resource of resources) {
                for (let key in resource) {
                    let value = resource[key];
                    if (NextAdmin.String.isString(value)) {
                        this[key] = value;
                    }
                }
            }
            return this;
        }
    }
    NextAdmin.ResourcesManager = ResourcesManager;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class Script {
        static append(key, value) {
            let script = NextAdmin.DependenciesController.registeredDependencies[key];
            if (script == null) {
                script = document.createElement("script");
                script.type = 'text/javascript';
                script.text = value;
                NextAdmin.DependenciesController.registeredDependencies[key] = script;
                document.head.appendChild(script);
            }
            return script;
        }
        static load(url, key, loadAsModule) {
            if (key == null) {
                key = url;
            }
            let script = NextAdmin.DependenciesController.registeredDependencies[key];
            return new Promise((resolve, reject) => {
                if (script == null) {
                    let script = document.createElement("script");
                    if (loadAsModule) {
                        script.type = 'module';
                    }
                    script.addEventListener('load', () => {
                        script['_loaded'] = true;
                        resolve(script);
                    });
                    script.src = url;
                    NextAdmin.DependenciesController.registeredDependencies[key] = script;
                    document.head.appendChild(script);
                }
                else {
                    if (script['_loaded']) {
                        resolve(script);
                    }
                    else {
                        script.addEventListener('load', () => {
                            resolve(script);
                        });
                    }
                }
            });
        }
        static remove(key) {
            let script = NextAdmin.DependenciesController.registeredDependencies[key];
            if (script != null) {
                script.remove();
                delete NextAdmin.DependenciesController.registeredDependencies[key];
            }
        }
        static exist(key) {
            return NextAdmin.DependenciesController.registeredDependencies[key] != null;
        }
    }
    NextAdmin.Script = Script;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class Serialization {
        static parseJsonAsync(data, result) {
            (new Response(data)).json().then(value => {
                result(value);
            });
        }
        static fromJsonBase64(data) {
            return JSON.parse(atob(data));
        }
    }
    NextAdmin.Serialization = Serialization;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class Spinner {
        static createDefault(size) {
            if (size == null) {
                size = 64;
            }
            let spinner = document.createElement('img');
            spinner.src = 'data:image/gif;base64,R0lGODlhkAGQAdU0AP7+/s3Nzf39/c7OztbW1uvr6+Dg4PX19dDQ0OTk5O3t7dPT0/v7++fn597e3tHR0fr6+urq6vj4+OHh4fPz89jY2NTU1Nvb2+/v7/Dw8Pf39/z8/M/Pz9fX1+7u7uXl5dLS0vn5+ePj4/T09Obm5ujo6Nzc3Nra2vLy8vHx8dnZ2fb29t/f39XV1enp6d3d3eLi4uzs7H+LhczMzP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkU1MzYwRTg1NzFDNzExRTFBODZFODc5NThDRUU2REI3IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkU1MzYwRTg2NzFDNzExRTFBODZFODc5NThDRUU2REI3Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RTUzNjBFODM3MUM3MTFFMUE4NkU4Nzk1OENFRTZEQjciIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RTUzNjBFODQ3MUM3MTFFMUE4NkU4Nzk1OENFRTZEQjciLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4B//79/Pv6+fj39vX08/Lx8O/u7ezr6uno5+bl5OPi4eDf3t3c29rZ2NfW1dTT0tHQz87NzMvKycjHxsXEw8LBwL++vby7urm4t7a1tLOysbCvrq2sq6qpqKempaSjoqGgn56dnJuamZiXlpWUk5KRkI+OjYyLiomIh4aFhIOCgYB/fn18e3p5eHd2dXRzcnFwb25tbGtqaWhnZmVkY2JhYF9eXVxbWllYV1ZVVFNSUVBPTk1MS0pJSEdGRURDQkFAPz49PDs6OTg3NjU0MzIxMC8uLSwrKikoJyYlJCMiISAfHh0cGxoZGBcWFRQTEhEQDw4NDAsKCQgHBgUEAwIBAAAh+QQFCgA0ACwAAAAAkAGQAQAG/0CacEgsGo/IpHLJbDqf0Kh0Sq1ar9isdsvter/gsHhMLpvP6LR6zW673/C4fE6v2+/4vH7P7/v/gIFsMoSFhjKCiYqLjG+Hj4aNkpOUlVOQmISWm5ydkpmgnqKjpHagp6Wpqqtkp66ssLGyUq61s7e4uTS1r7q+v6O8tsDExZ/CqMbKy3/IyczQ0XXOodLW123Umdjc3WXamN7i41zgkOTo6Zfmj+ru70ns7fD09PKH9fnu95H6/uP8Cv0b2C2gJoIIpRlElLDhsoUOIxaDKLHiEwgHCpAooeDAhkkUGW2zqCiFiRkoU84YwGJEo5CCeJEERGGBypspCaxYBBOQs/+ZfEoEwEl0RgAXinr60QYUDwAHRaPO+JBIKR9zTe1MkCq1QEyDgeRlnYOBq9QBEsKCbSZ2LBwAD8xKraA2oM97bt9EkMtVwV27S/nldUOAr9QFANgCvrp2cJoQhrk2UCy4j1XHYzxEPgsh8GI9CxliPkNis1QHnivvCT0aDQzTUilYbpwntOjWZETAjkpg9mc8tnGbKb27qN/VtO/Yvi08TNniRB8IQP572vLmZCBAL5qAumrl17GP6bAdZ4C0tZPTWX5QfJgY5XFeAK1+Dnv3YwDYjK8SRfrqcrDHHH5eKMCfSgQkBh6AcAhIIBnkHYhSBMDV1+B9D4pBgYQoIcD/wILfBYhhhmJAxeEEIOJlXXAkjiHBUBIGsNOKIV4YXotiJMDhDPPRqKKIN+IYxgYI7JiBj20ByaKQYuzFIWLrWbiGg0zmZ8GOk9knpRpUVilGBjsO0JmSPzoyopdinLCjAVoymEaXaIpxAIwHBnAAmUm6AWecYRiwI11xXIbGnnyCAcEAOx5npptnEFroF8RJKJ2NNb555qNhCBAXh1QtWmmjjmJaYJhjZrNlK5eKCgYAhXGImp6nihGqql5suKNspjI6xqy0dnEShwnm+imqQfYqxos7UjhIrF8IOKCxYLzGIQLTTcmsF7xCywUDRXLYnbW6NpuqtmG4sON54A4b/0a25G6h3449WhpuF+y2u8VzHB4pr7riFmuvGBXsCOWg12pR779aHLDjDMqCOq/BByOchYkSekjww1lELDEWh+6IosP8bqHxxljoyKGdIJcp67gkg6HpnynnuS7LLYNRwMIYmCGoyCPXbAWrAiu4a8FV9OyzFSksnOXQGFPh7NFoXEAqsSFfYTTUVWhA54Gvrtw0LTRjDcZWtzJdtdNXi00FAxzA7PXZ6/ir9hgNLKxov3BH8fTcZ7zL4aRg7GxF2nxTYeCO3+KtMsRhF/5FwCejhy3RTuzt+Bm2cvhC4JQ3QfjlVFAsIa70dr6E5QQKcAAKBwhNCbLAus543p43jv8ZCi8gqhICBrhEickcNszz16d/jmQ/jXhwpVQd5CyJAN1W/GE5piOBukgyKQKAtHKpcGcjTp5YOvHx2J5a9oAw0GpkE0yv/fIxSp5x9UZcXxU4gAgQoWkclCA7IGCCVzDMRx92/IFsxbFAChahJiN5wn6UMWAfMredE2ggEXMKGicg6BvyqUEFdRLBRwLhJyxt0Hjpop8ZVrAjBHgFEB3j0ADcBxIU7os1evjAwmZAAP/8oW4es4QNY4bDPIBwhzN4QQj88DLN/Q97S2KMs9pzh+jtcAAfqNYeDscfC/hwE1Es4BSpWAcAIPEmD7hbHtYHHQRE4ImVEByeppgHAZz/EScd8F0eKAibAExghKWgXQrHSMY6bO2OKDFAqe7wK9hYMBYyOx4hnzWHFiASJwNoABzhALvILMB5ssBKhSZ5jjyw4JJE+SQedGOYAfhPF9T4DynngQd8ofImKrhgHbjFF0USAxkpmiXy8NDEW97EjzSMg7m40oHvGWMYURJmOPZQAmMWhQNvnIPfiAICNT7zGYGSZjX0AAD4WfMmCiQLUbCoxWiMJJzifOceDqC7c+LEBPJzA+RS4oAlFgQfc4ynQP6AgUPaEyUBEEE72ZBBHurRGwD1lEBL+YcU1POgKnnAC93gAI3ug5IXm+g0AyGBBmL0JgR4qBoYsFAciXSc/4pQwKZOqpJ+gq54L6UoIwQgAoNidAAkaOlNczpSSmjApDRFSTdvOgSiFtUSGABBUlXiPdA5VaedEMAHLppUAyQTalelZSkk0Mip9m+TEgvrMFeRgv1MdQYL0FfN1LpWVgCABFyl6SM3RteB5iIEL3grQmEASHL1tZC5QIE5k+pGtPLpsCDNBQBKkNeTtuCLqoJsNCBwSsHOAJ+i0uw1KMDGpLLzsYf1BgAi0DbBPiAGXoJsZKPBgBIKNo9CEm06DlDapDpgke7R7TsKYEXTBhU/qdXHBmDg04OKCbl0JcgB9knTpQX3qg6JwUwPOjACEbUiPG3uJT1AopcCRQNHtP8moMor0LF4QKq3RFmL4jkYrYpXfLmdZWtKikiL5ZeQ2MGAWxeGlCoBWDwCwOvCusskDgonBGXlj1wNLDf8pGCx0IkXmsJIoslWdjPoQq0HWwMB0cEmcSKW4KMUuxv/PkrFogKAC1obGeEVSpTGYkBn+RKszP7EXiPobVFIF1phkCwCxcVJ12gFTZLVNioBAG6RYVqzA+xPJSjulTyxFgMrAk5bYp3bcmHkTS3XlW8rUMF624XYy32VqXCOs5znTOc62/nOeM6znvfM5z77+c+ADrSgB03oQhv60IhOtKIXzehGO/rRkI60pCdN6Upb+tKRFgAGHEAA+Hr2QFmGGhD/P80fEBDAARgQahQ2IIIPk3o7oT7aqF99oAGIsAoeSDKt4xNrn8161/zhAHmlEClgS6jXNfu1sePTqScUe9n8QXbLlA3t7ZDgCbasNq/5Rm1tF2fYS+Clt6PN7XHzx8VJAJ65YV3udZdH2jQQgKvdbRh4b6zb9G6lqoWgmXxDx94Sw7e/5VLmIZh44JEBOMIEjvDTKAHDDZeLwv/F8IgTxQJKoLHF+TJxe1V84yrhgBJAnvB2k1wuGT+5xE2u8qgM4OEt50rH2/Xxk2M8CQePOZZZrvObLNkIXOz5TWZOrpqTvOBCkLfQcUJ0bRl94wPYtxBYufSUNB1aT7e4CJgg/+6qz+Dqxsp6w9GdhH57Hey9EjvCwc0EHZ6d5z1vthPU3XO000rt+W66BzQec7urCu/rHgDbowABA8w74n4XFeC9HQBfXkHTnN7uxhOPqcUb+wEEeEGqz7CCA3j+86APvQcKQPrSm/70HzCA6lfP+ta/gACwj73sZ29JolD+Ud1uwex3L/sXtP73rP/A6Ydveg+E/vignxGml8/85jv/+dCPvvSnT/3qW//62M++9rfP/e57//vgD7/4x0/+8pv//OhPv/rXz/5SOLb9y+DsmslFgfcfzcMoQbqoXqTKy7E4JQxmLFKDEnulNoBFFNbVKwGUEgFAWFhzVx/2XMayTf+7k00101Zc8XOiUk1R4UUkQ1Z8QWSY0nVRAVr2olWHhyC9gkBcEQBZRC5RZRr6xyQNxRce1StHtRtfVijUZRi4hSkCkAD3ZRa3NxhBZxq/VSgeIHl9lE9VQoGwAVRShx/odSAa5iWWlxIgAEokMmYcIoJCEkP8UVUZol0L02NVknPl0T74YWVnZGMtwkcSclbNwQAsuENkRyJCJiHp1BrEhUofgyNHiEQF6BZBZkwBoEskUkyIlFCFNRNPdk5XSCB0d0kuBBQyxnfGNGH40UnW1EMWgQK1h1EBKB4DiFFK5BAl9lYJiB1yaE+nNRD491YSKB5A81Zp9A8X9mlehR//ZndbzvQOEPZpZEggCuBpguV46ZBgKWhMIDB4qaNgnpVJ9scMAjaNx8UkdjiE59R/3SABp/hWSRgnOUiMiigN9uVZP/gou+hZyCQN7+VZN6gqq8WENIVN1RgL5fhWAZAAUxgnKPhpfQgM4eVZJtguIaCGJ3WQuSBTnuWBGzMCVzZVCfWPo7ACPUhTjeUz1yiPG8UKXsiPf/SAJaCJNJVSrPCHglWIWLONn2ZTpOCGguWNhaMBEWZcFpkIkUiLr8RUKLCHGLVUlrBaJolRyhhnBWCPJ1WMjXCIwHhnAelZvbgI2+NZQskGG5CPzVF4n8YBM5gHITCRJxWLbcACNEkO/wIAjWpwAOn1ViyglXEwArp2UDDpBg3Fkt1wjDMQjG2AARCHUSYACBIwl+cEinFAXX70iNYgkzMwf22wWoR5TnJHThlpT5coBwtYgXB5C1x5E195BqzGjZcUAGB4B/BBU46oTQOGTgsEDbOIRjlpBiCYVL2xB+VEUxfghHphFgxJDB3JHXYgkUmFWXeQNBg1kHNAglCmUMSwj1DmT3WglxjFAnvAPdbEAS6wmWVAdXIxj7iwARMgmjOggXLAjAeFAHtQmXf0jnfgiTymUnaFZJtRmnJQeOLJIbo5B5G5MCqgfHcQWLtRl6vwf5uBhnfgnKjUmnhwn+VxlnbwipEhhf+qMJu7AYd20I6opJZzwKDFIaF7AJSRcZWeEIQcihN5aAeQiUqcWAf7GR8sIGV3MIjQwZSWkJT8sXV9EJVnxJd10JY7so57wIj8YQDamQdOyR8h1gcJeUYBEJtrUIn8kYs/tDCBOAnhIyGTuAfCuTCOWQcKI0Mv+AdiWGswuggQ0KKwsaJ84AGrGR8FpgdiCR292Qd3yB+tKAlXeiClyAeTVZSwwQGKeaH8YZiBUIN6WqTkBKLFUQKK4JLlwah9oJB8sZGJEI4HoqaTAKHbcaJ+YJMV9AcMMIogdmuKkJlWOAqSWhxVmgg/uRsL8GZ5AAHIyBd4CQgAIKpIeo5YQHz/vNqrpqcFY4qkPCoINupJutoHEBCnRbEACroIecofq4oFErIFWUgUXSoIOsoVJhCofSBj+4kAPblTaLoZnFoF06oFUMgfn4msBnBf3qkIAuACcUoALuCkegCl5WGhV3AgIrcFpsofe6oIEFACKnBRD2ACCoCodyAAFEB6KeCfkxACJWoWBqoF/NoFlmqnnSABnsetzZGqu0Gf+xpsXSABzbgZtShpI7AwWZoFF9sF1apklaae0JGkXXAg6NkF6RofIqtoMvpuYXAgIPAF/xoftQlpO7sdO3izpQYGGRsf6zpoMeuZYiC0YOCe8bG0iqacRjsGVgsG+MpujlanPOu1/wCbKUpZs/lZaFhbHuTJtPHRAmLws9vRsoX2tNuRsmBwIHILMAtDnIaGAkpTBnw7BlqzIxVLaLcoIQELt+XRtzmyMPoaaDeTKGZwIB1ABkIaH+XqZ5tbHtf6BQcSulxAt9ARrYHmdjEyrHvLH6TLBTRbHDJSaMEaH6gbtK5rBobKH3bLZyBrGp3rBaN7BmRbHpi6Z7sbH5B6BqdqBlzboAp7ObHrqtErBc1rBs8aH3eqZ0VrvGpwvWWwuGT6Z0mbYWsAvmWQvOXBJn62TPFzvvwRmGlQvDXLunX2vGL7vfzxtmKAv9DxunLGnecGq2TANWuQveURtZfTttsxuQW8v/9rIL5Raq98c5PlkbjMC8FroKnQMZl0xsHF0bMP7KJt8LsoW6Zwpqiwwb+XC61tULtue2emuxtR9gYHcrtmMLUqIcKF87n52wY37Aa3GTt0psMoobX6a7tvAMIVOmcwvB0KjLvxgaMctSNI7Dj0WxwA3MLb9gZP/G9xpr71KwegFgdGbBRrqzZIpcFxUMZv0abl0btY073Qobdu4MZwQMfQcbxQM8QSsr1scCCArAZ4Cx2NezQIbMjVywWCPAcMDB0OXDPQ40B00MhzELbFEbwkg8m7cQJ2YMnlCcfbgcMt88g0bL9AzB/Li5nngsobY8LscwcHEslrUMharDZMDLz/BHzH/EHLamDKu8GFPjO9sOHL8BsfxpwGnAwbh2wvMwwbGNzGvbywaVscg9wu5VscfGzD/PGRdPDMpmHHCHOaWKoHBxLFaEDMpkHFJKOsspvGcHDOeSDGHUrBhQIZ3rIH8pwHWbwbGkouv5i19owG+0xM1QwbpAwtqssfsKXP/CHMdgDOkZG5JNPPBbrIZhsf23yYjNsytlW2fHCpfEDPpjG0m2zAfSDSfGDRhnFzG1O55SHOsixhfeC/m+HJJMNC2vsHBwK4eJDIm+HB/yLKkXHFMw3SfKrCcgGf//JssIHOvIzUfJDLXLEAPkMk/xsIB8LDdLBju+HNLy27x+rQ//HB1Hlg01wRzQhjwXIB1iHNHxDLB9nWSnFNMvpjGkWYwfFR13sgdgEA0ZJsyzhxzXlwIHy9BzFwsiux0S/tpylhAWad0nCtCBrwlzfRAWONNRvQALOaEhUA1ZXMH5mdoy6QthYA2hKjARgQAaqXAB6AwoBwINC5CBRAAiYAexdgABEw2u0n2/AHC77926sQ3MKdCgeyy8VtCQfiscmt3PzB3M1NCcsd3aQw3dQtCgeC0dd91OWx3djNH97tCY7dSuHdCZYdGS5d3pUAyw6n3pYg0X3h3pagdHU80PK9StvBzvctCWgtFZq834AQ0JHxzwCuCAttGEJd4I2wzEOn4CmdsHdyIXgO7gmF52qNB9sT/jybRgBxgXmaZ98ZHuIiPuIkXuImDgVBAAAh+QQFCgA0ACy1AAUA1gDRAAAG/0CacCgUYBwE0AxEcGAExKh0Sq1ar9isdsvter/djWgwK5vNA9EGzG673/C43OpBnO9njmfO7/v/gFkkeIRnH4GIiYqLWoOFjzMkjJOUlX0YkJl7lpydnlcMdpmPCAyfp6idCaOZCamvsIgCZKyPA1CxubpvHrWZCrvBwlwOvpAOw8nKUxbGjxbL0csczoUc0tjC1Y/Z3bnbhd7iqeCEAOPoneV4a+nuk+t37e/0iPFn8/X6ffdm+fsA4fQrYyqgwTcDZ4Q4yJBNwoUNI3J5KLFiFooWM1JJqEGjxygJV3wcSSMkyY8mT2pMqdJiwhEtMyakENPlQJo1Jc7MqfMmz/+ICTP8bBh0KMOiRg0iTQowIQamARMCg7pPKtWqA6depWd1K9eBBbx+7RdB7LuEZc2mQ6t27cC0bcUlLBF3XMIGdeUOxJu3292+fvcCzpbQ1WBphQ8jHmhYsbLEjh8PFBFZcr8JlZMlxJxZ20DOnXdtDh0sIQvSogciQ/1NNevW/Va/fpVQ9mxUCU3cpj3wwm5yvX/jDi78U0LfxT0lrJBc+UDmzTktjy79OXVLCTtcr5SwxXZK3b/DG+hd/KLw5hUlXJBe/UAQ7RMlhB8/0Pz69t/jB5QQwf4/CV3zHz8DCTjgHAEeyEeCCsqR0AwNOphQhHEYYOGFGGao4YYUduj/4YcghijiiCSWaOKJKKao4oostujiizDGKOOMNNZo44045qjjjjz26OOPQAYp5JBEFmnkkUgmqeSSTDbp5JNQRinllFRWaeWVWGap5ZZcdunll2CGKeaYZJZp5plopqnmmmy26eabcMYp55x01hmlDHjmqeeefPbp55+ABiron5kNauihiCZqaGSKNuroo4I6BumklEKqWKWYZrroYJp26imfnH4qqqeAjWpqpqWequqkfa3qqqOtvirrobHOaiugtd6q65657uprr77qCmywtg5LrKzGHutqssqqymyzo6YKLbLPTttpqNY6i2220R7GramSfvspo+JqWmi5m34RAQQAIfkEBQoANAAs6AAdAIYAFAEABv9AmnBILBqPyCRR4zJcCA5YjKGsWq/YrHaLBcRas7BYfKJwz+i0+jyyjN9jh2BNr9u5sQB8H7Zo7oCBghF8hTMDI4KKi2cpeoZ8CBKMlJVIDA+QhiqWnZ0TmpAenqSKB4+hfB2lrHYAFamQK620aYSxhiW1u1oMCLiGL7zDVqDAhQTEykenx4ULy9FDsM58FtLRCtWFFdjKApnbexPexAnifKPluxKo6GIDc+u1Ku9wIvO12vZjAxD5rcDxG9MAYKtzA8M8AGCwVLuEYRQ0LHUB4oxuEz1lsBjgQMZOABZYJPfRUgOLCKiUpARhgMWCKymZsLiAYcxFGy1muLkopMX/CzwXnYQYYFLQQC0twjgqyAFKlUztULA4I0LUOwAIWCRg8yqdWxDNeKXjy6KDsXWcEjWKNs1Uiwnaqslq8YE8uWfAJpSI90xZiBj7cjEGMZHgLc0gnj28hVpCf4y17IMIM/IVTDS7Wq5COOHOzVYSJwwMWonjgR1LV5mckKRqJAIhpnydBCFEq7SPPIRoQXPuIRV1/jaSEyLQ4UQEiFyLnIjthHGbC9md0K50IcFvX6dRPCHX6z4tipU+VPH2pBAhX1cLkcT2txCtSwfgxiJf8lRJI0efMPV6qq41B99j/8yn1Uvb6TVQTdf9BdFn0pVA1XHbYbAcPwH8sZ0QAJDg/5I9AW5IAwQGvDObiEWM0IE4uKFohALhAPOdi0cI8MGHsYxH4xEhvBALhTsmgcKBhhQV5BUF/FJIdEdasYEI7oghX5NXaHACHPdRiUUK9c2wipZbAFACBzPoCGYWDBRw5ppstunmm3DGKeecdNZp55145qnnnnz26eefgAYq6KCEFmrooYgmquiijDbq6KOQRirppJRWaumlmGaq6aacdurpp6CGKuqopJZq6qmopqrqqqy26uqrsMYq66y01mrrrbjmquuuvPbq66/ABivssMQWa+yxyCar7LKPyiADn846u2e00eJJ7bV1Xqvts3Juq22c3nr7ZrjhskkuuWuee8Ouluq2e2S78HLrYrzwzktvvCLee+91+vbbXL/+/gbwwLQNbLC8mx1sMGgKK2xZww0fBvHEeE1ssVwWZ9xWxhqPxXHHXn1MMVoiQ7xxyQ57jHLKIa+8MMkuEwxzzAGrTPO+M99M78k675xzz+7+DDS6PA+9rtBGi4t00tgWzfS2GD8NddRSN0111dL2hXXWgm0dWdUPP80w06Ul/drQBfcs8M3I0SzdyhuWnO/H9o5Mo8lNspw3wOnq6ya+4B6dbbVVBAEAIfkEBQoANAAs6ABgAIYAEwEABv9AmnBILBqPyKRyyWw6lSkWATGbLToJzXPL7Xq/W0FpUS2bZyoMeM1uu4eFx3leNgDe+LyeiCLQ/1UEIXuEhV0aJ4CKVgyGjo9GDBMBi4sqkJiGACUclZ4RmaF4CmSeng8CoqpfIx2mrzMFq7NOIQ6wsJe0u0cbCQO4sAGpvMUAEVTBuAfFvCkWyspqzasridHKCtSiEAbY2CnbmAIkwN/RK+KPCiDn2AN36oR97t8X8nsSJvXnHvh4G0RQ4odtQbx/awC4SEYQ2zSEYDCUaoiNBUQwB1RQPNeB2MUt3TaeY+HxYxMBH8yJVDZAlskncVZiO6HlZRN6MpUteGhTiYb/CzmVcShxsCcSSQODwjIAwaiSTZ2UwurAzGkSDxOlegKhzSqSVlpfDfhQ0usQW2FfORhktsiGlGk9EaDQtsgxhnEBPXBZd8izvIsCiNjQdwgiwItMSCgspFtSxHMshGNMTiXkMxxcFK3L7jKdABMaMabgyvMcFTUZezA9ZydjIgCyeh5AYvPrDKxnsGj6+gjQyx1G9E4i4XHaB12HJxGRd2xZ5ZHwKjXBFvqSCFoJoLDuBICfnAhAcX9CQaZgwuO33NpIM32X4g0lu/+SgN9Q2/OdCJBzzoDo/F8o8I0KVQG4RgXKgOCPgW0cgAttzzH4xXqerCUhHhBY9gcBwl2Y/0cDiuzl4R6xfZZAhCO2gdsZiqVoCIJVWLCdi4YcEEB4+NGYhwLo6ejjj0AGKeSQRBZp5JFIJqnkkkw26eSTUEYp5ZRUVmnllVhmqeWWXHbp5ZdghinmmGSWaeaZaKap5ppstunmm3DGKeecdNZp55145qnnnnz26eefgAYq6KCEFmrooYgmquiijDbq6KOQRirppJRWaumlmGaq6aacdurpp6CGKuqopJZqaqEyyABmqql2ySqrW74qK5ay1qpqlbbWSmWuuUbJK69P/ipsk8IWq2SxyCKJ7LK3Esnsss4+y6yQ0j5LbbXTBolttj9uC6223hoLbrjAjktur+aeO7pruuq+em27urIL77vwuitvu/TW2+q96g6pr71A/gtwtwI3S3DB+dbrL8L89tswuQkr/HC4CwscMb4XOxxwwQb7yHHGGh/8b8UjT+wtyfqCfK7KFLN8ssnboizxxgzTXDLM2Locs84541ytzPPy/LPP0gKNsc0pC1200twiPbPTQUN9tNQhi/y01Vd7bDHT33ItrtEtg/1ytFGL3XORWRM97JFTG1k12isfG7bcZzNZN7HWStk1rui+FgQAIfkEBQoANAAstQC6ANYA0QAABv9AmnBILBqPyKRyyWw6nY2ZdEqtWq/YrHbLnYIIDozgSS6bz+g0Ldptu9/w7EC0Udvv+HyRHe/7/1ccHnqEhYZKfICKi3Afh4+QeomMlJVYJJGZmmWTlp6eg5uio0adn6eLCAykrKOmqLB+Ca20ma+xuG4DY7W9hbe5wVsKvsV5wMLJVg7GzWrIytEzFs7VZtDSyRzW3FDZ31fd4ojg5VID4+ml5uXU6u9r7ODM8OrY8qfE9en3+Ja7+/j5iyYioMCBwlQZHNcPoaJQC7s1dOjHUURxEynCmXURo8ZTAyB25Jbxo5YABiCMZGhS0QMCL8SsPGilBYGbOHPqfGGgp8//n0A/FBhKtKhRDweSKl3KdMXMp1CjSp1KtarVq1izat3KtavXr2DDih1LtqzZs2jTql3Ltq3bt3Djyp1Lt67du3jz6t3Lt6/fv4ADCx5MuLDhw4gTK17MuLHjx5AjS55MubLly5gza97MubPnz6BDix5NurTp06hTq17NurXr17Bjy55Nu7bt27hz697Nu7fv38CDCx9OvLjx48iTK1/OvLnz59CjS58uo7r169izaw+uvbv369y/i88efrx5GeXPi0+v3jv79tuBw18vf777+vbj/87f/T1/9Pj9Z51//BGYn4H2ITifgvAx2J6D6kF4noTmUTiehfTtJyB4AW6IsOF3H96n4YbVhdhfhwKaqJ9vJA6I4n8qkvdigTMeWGOCNy6YY4M7PthjhD9OGGSFQ15YZIYstgjgiCTGiJ2THDLp4ZEgUiliki1C6aKUKVp5Ipcwerlib0ouiWWTYsoIJo1r2tgmjm/qGCePc/pYJ5B3CpknkXsa2SeSZCqpZYlpPllolGdO+WeVi14ZKJqHEhqpmYmGOalwgg46HKRQFtelp24aBydydCqHZ3OAFhcEACH5BAUKADQALFoA7gAUAYUAAAb/QJpwSCwaj8ikcslsOp/QqHSKpACo2Kx2y+16v+CvJLDAhM/otHrNbhMvs/hJ467b7/h8NxPvB2AbeoKDhIVsAAt9iggRV4aPkJGSSCWKljMWKJObnJ12DAiXlyYSnqanqFkToqIBHwKpsbKzQwcBrKwPBbS8vZsVuMEdI77FxnkKwcozDhDHz9BniMvKAySw0dnaUw3U1CBm2+LjSBAD3t4qB+Ts5A7o8BMM7fTQFPD4HCWO9f20BPgCWkjhr2CqZAETzjHIcJOABwkjBhARqKHFQgkiapyBYNfFj3jGbNxIQBPIk2zgjBz5IgTKl2HurVw54BXMm1oAAJw584EC/5xApXjgSXRGh3VBkzJRAKIoTwPOlEo9IoDEOacjBzTgN7UrDQYTbmHdWMarWRoaTowdqYLO2a4pLKzVGEDe26kAIkCcm5BDo7tSBXy4yhffQMBSQ7wrHJAUYqUjOjDGNxHbY6AYEk1Gp+tyUAAlOGxGR4CYZ5xgxY5e5sDl6ZsaTKymZs3ya5Qods4OBuLnbZgF9u7Gpe73S8GEh4syMI+QDBnGCUEwoBwXB9+CnkOPPuiAiuqsWHC1o10790EY5IK3ZEJP+fLn9eQNtb7PBzzv88fPs0GEavABUEBefvrtF5Js9REwIIEFGmhHZPWZxAaDFG7nYB1MgceCGxVSeP+hHVUltxoCbXTY4Yd1TPffaKWsYaKJKLqR1m4EqfHijTG2EddqHrh444s5HhIBfYxlYOOPPwa5BnKMIXUGklBaqOQZivEVgG1gRJnklGtAOFYFaWi5JZdreKBZUS6EKSaMZLYBmmg8cVBRGGsC2aYbqc1Ugpp1eninHbGNdAKffRL4Zx65RbRAc3QW6ueheASHzwJuPemooZDqwSQ1JszZ6KUNZpqHisF0diSo8IkqXQkqJPeACQqM9ymq5qn6iAQHHOCpj7Q+Z+tFvdb6a0PB+josQ8VKeWw/ySq7LD3JPltQtNL6Q2210BaLLbPabtvOtd6O02y47IBLrjbmnpvFTbrqPsNuu8e8C68v8s7bS732zoJvvrHsy28q/v5rSsACe0JwwZscjPAkCi8MScMOP9JtxPpOTDHAFl+MCsQau5dxxwYHCzLGIo98yscmM4xyyg+vzLLELr/sXMwyD0JzzR6XjHMkN+98B8c+o9Fz0BwOTTSvvR5tiNFKn0pr0zMnDbXNOk+dR9VW4yd11lc/zXXOl36dHapig11o2WM7irbZa67NtpZup9123G+PSbfWcN8tt916181g30uzCXjLoQ5uRxAAIfkEBQoANAAsGADtABMBhgAABv9AmnBILBqPyKRyqZQxn9CodEqtWq/YrHb7lHm54LB4TC6bz96088xuu9/wOFKtltvv+LyeSKfv/4CBglR9hYOHiIl7hYaKjo+QYYyTkZWWl02TlJicnZCaoJ6io3+gpmukqapop6arr7Bcra2xtbZQs7O3u7xDub+9wbG/xMLGo8TJx8uXyc6ozNGIz87S1oLU1NfbeNnZ3OBv3uPh5WXj6ObqW+jt6+9V7fLQ8PVJ8/L2+kf47vv/QvqlAwhQIDmC+wx6Q5hQoTaG+hw+gxhRYjWK8CxexPhOYzGOHT0CA6lO5EiS5kzqQplS5SmWLV26gglO5kuaNW1qwplTJyP/nj199gG6R4CHPEIbEc2jAMSMA3eS+lma50CHGVgr2JGahmoeCAawip2hQA5Xel7fACgxYKzYBwLgcE17B8MCt24TyBVK146GE3jxBgghzmffOBsmBAgc2EFhmYfhAIiAgLFlCm4gR36DwoLlzwQAtFG5+Y0EE59Tz4gwWmTpNgISLFb9GQEDNh5ftynwgDZtEbgl6mYzgoBv3wEksDI4nE2E49AvLO/XnA2EytB9Z5jur7rz7L4XiD6Xz7sbAMbBqy7B/aF5NxTUq7Zt5uB7OA7kp57QPtd9OxC0pR9jAUBV30f/2dHAgJZp1d9OCd4BwF0MBlZWcKFEmEcGFQYm/95jXWkIyAUd4tWAiNtIIGCJWA0AAYrXLMiiWI7BKM2EM4qFmY3RcJjjDATwKA2JP14o5DESzDYjXEcuk8CPM+jVpDEC9JZjclMaowCU0mUpTAVQouBlMBooyWJoY/by5I+spblLlT/S5+YtW/7I35y3gHnlCnjacoCZJXbZZywTQLndoLAwgN2MHyL6ynM/nujoKuj96OKkq/z5owGYrlLolQZ2OoqiPzoo6iiQ5mjkqZ1UmiOTrHoS348fxCpKfjleaisnAf5Y466YyJjjjsBaAoBnOaJZrCWz5tjmspXgumRc0EbSa45SVguJsCxiqe0jOOYo6LeK+JjjoeQqQsgko+Oli0iSbLqryJozyinvIAJQOOOd9w5ibreh9hvIuiyaKjAg8OaIwcGC0MtiowwXZeWMkka8R50z6mqxHnrOCNzGemiaMbUg4/HpjEeVjAec+6rMVI4duJxHxx0uIDMeIncIws0ms2gBz3eQ2uEJQN+RKoO1Fi2HqwyOoLQdzepn89N2sMBgAVTbIbR6ymYdBwbyDcCn1wqCF8DCZN8Rw4qqDYBu2n4hm1oHGsCthwAuTIyXBavarQcFJJhAAAEXGBBB3UgEAQAh+QQFCgA0ACwFALoAzADRAAAG/0CacCiUGY/IpHLJbDqf0CZxSq1ar9isdsvt0qLgsHgM9prP6LR6SG6739C1fE5Hw+94eH3P7xfzgIFRfoSFZ4KIiUqGjI1WipCKjpOTkZaBlJmFl5x4mp98naJuoKVzo6hipqtpqa5xrLFdr7RMsrdatbpIuL2Pu7u+wkTAwcPDxbrHyMm0y8LNzs++0a7T1NWo19jZndvc3Zbf4OGS473lkefk6YDr0O2Y7+vxZfP3+Pn6+/z9/v8AAwocSLCgwYMIEypcyLChw4cQI0qcSLGixYsYM2rcyLGjx48gQ4ocSbKkyZMoU6pcybKly5cwY8qcSbOmzZs4c+rcybOnz/+fQIMKHUq0qNGjSJMqXcq0qdOnUKNKnUq1qtWrWLNq3cq1q9evYMOKHUu2rNmzaNOqXcu2rdu3cOPKnUu3rt27ePPq3duvgN+/gAMLHkx2huHDiBMrXlx4sePHhxtDnoyYg2TKlC2PxcxZs1jOmD2HBU0ZwWXSi0GcRp1Y9WbWjl1/hp16Ne0ZC2zTbqEbNu/XtxH/nh388PDRxQ936M26AnPUzoEnj058+nPSF66Dzi69OPfq3rVzNiEes4PylM93D64ePHv0k1nAhzxh/uP662/jd6/fvmMR/i2WQICKDZgfbQbyhyCBiTXAIGIOHghbhApO+OBhJVxoWAQazsCwoYSsfVhhiB0W0KECJ6YIImoorkgaBh1mEOOMLoImY42codAhBTv2iCNmI3S4gpBE/kjZkEZOpkGHITDpZJKQNQnlYwx0uIGVWE7p2JVaLgZAh2UlFxlZHIg5QFkWiGlBWQ6I2Z5YCojZ4lgCDFDcAAKYJUJxAJrFAAK3IVDlWR7c5oFaH8D2AVsJoJbgWh6USdkAh74FgQF2OhaAARDMJQAGDhDwwAwPEPACBnlaEQQAIfkEBQoANAAsFwBfAIYAFAEABv9AmnBIFMqOx6JyyWw6n9CodEpFWq3UrHbL7TqvYKx3TC57w2ixec1uG9PwpHtOz8bv8rp+X8Tj+YB6foOBhWyDiIaKXYiNi49VjY6QlE2Sl5WZRJecmpWcoJ6QoKSii6SlpoGoqKp8rK2udbCssnO0sLZtuLm6Zby9vmPAwcJcxMXGdsixylrMtc7P0KnSU9TN1lHYodrX3Jje2+Dh4k/k5eaW6InqX+zt7kzw8fJK9IT29/h/+vv8cfz9A5hG4CaCcAweRIhG4RCGBR3SgNjQIUUwEt9czLiQIceOAD8OpCdyHr6SJtmhfEdu5TluLqHAjCmTGc1vvG5GwqVzWbT/nj67AQ0qaSijdEan5Ut6ph/TYXeemkkodU3FqlOvYHWDZCsdGV7Dih1LtqzZs2jTql3Ltq3bt3Djyp1Lt67du3jz6t3Lt6/fv4ADCx5MuLDhw4gTK17MuLHjx5AjS55MubLly5gza97MubPnz6BDix5NurTp06hTq17NurXr17Bjy55Nu7bt27hz697Nu7fv38CDCx9OvPjkDQD8sliAge+BADNmnNCgt0L06AEmbLib4bp3BBGSzwWwwLt5CynmRjDPfoYJCXAZIGjPPoAIAW5F0Kf/oABbCdDtRx8BI6j1goAIOhDCWRQg6OAAJOBHFgEOVgiCAmMpUOGGM6hw/4BXAjzAIYcGiCdVAyNyOAFWEAyQYoUDQIDVBC9W2ABWz9WI4AImPnWBjghmgFV3QO53AVYAtFAkfQFQV9V6S7a3YlUCzBeleQgwgFUCV7IXAVYhBNhldAT0yJQDY3pHAVYjpHndkVhZ52YA8FWloZszJIBkeW4+IOGJeM6AYVXy4UnAVjTiuWZVAOLpwFY/uhkjVigEemNVAFDoJo9YFRDooFKFiGcFW32AZwAfVtUinlNWhaabWeIo5pglbCVnmpxWRaSbQmLKZ5pwVuXCqXVKVaibemKlH6xaMjprl19iZYKhZibVoKJbaZrmo1jdmWYAMlIpIrJbodjnn0+t6rQmqFIlmiapss6ZalUnOLrVrmNOiqkFeF76JJ65hmplmr1WxaWbJ2zV6LfzSvVqmq1KdW2ascaJZ7R2UrsnngVLFQOewVbVwZzFShUCnsli5cG5XpmaZgxhuXtlmWEZkOaiXh18JbdheXqlvmGt0KW/Yv0KpJ9lkRAlu2JtMHCN8Jrlc41NpjVtjf6lJcDIKaasdaQbEr1WARw4aEGBcG3QAAj0VcB0XBpgEIEBBiTgQbiZBAEAIfkEBQoANAAsGAAdAIUAFAEABv9AmnBILBqPyKRyqZQ5n06mdEqtWq9XqPaJ7Xq/4Ol2zA2bz2gpeS1Lu99nthxOr1flc7t+T8Tj+YB1fn+BhWmDhIaKX4iJi49UjY6QlE2SeZWZR5eYmp5CnJ2fmaFso5+lpqekqWurla2ur5SxZLOQtWO3j7m6u4q9W7/AwWXDgcVQx4XJUcuAzc7Pe9HTfNFt1nrY2nbc3YLV4HTi42/f5m7l6Wjo7HHr72Du8vPx9V30+Pn3+1n9/iIBDChmIMEl+g4WbKbwH8OGVhJCtPRwohqDFotIzKgRI0dQHjlu/DhkJEls2UgiMXkyZEaWH2G+dDmzokojKG+upGlRZk//nhN9BhUKkWjDnDpxAj1qVGFTp0uhRj34lCDSpH2mWq0a0CbWrL2+7qwllmKpsgjPomUSau3FRm4F+ol7ZxLdt7buOtSil5+yvl6MAeY3uLDhw4gTK17MuLHjx5AjS55MubLly5gza97MubPnz6BDix5NurTp06hTq17NurXr17Bjy55Nu7bt27hz697Nu7fv38CDCx9OvLjx48iTK1/OvLnz59CjS59Ovbr169iza9/Ovbv37+DDix9Pvvx1AJohsKiAGUCJATNmKLCMwkL8+AvQSw7x4r7/BpEBQAJ8/t03AASPpbBAgQw60JgEJjAo4QwUKCbABwROWCABiWEA/4KGGs5XmAYngAjiAwIAJkACAZhoYgJ9efCAiy4GIAFdGqhA444XuLUBDC3uuGOFZcUwo5BCEqBfUgd0gOSTM0SQFAMTQAklAgzcVAACVlo5AUkjENBllwFokBEDBoypZo8QAeACB2rGmUFDKLQQ5535EQSBA3f2OQOA+7iXoZ9qHohPCvYR2qcBWb4TQoSK3qnCAfIIMGCkcYLgQT0YLIjpmAOQkOI7ElzwqZoOIPjOhUGeCmUHI9TjwYeuQvlAAfWQWCuUASQwKjsCiNDqrjuacKM8ChxJ7I4WoFDPChUsKyQCESyZzo/DSqthABNsUM+W2tJ4gpnyNBmuiwtgUNEPmueaOEAJ1poDQARwtquhAaq+E6a9GnZAqTwAwMDvhCCIKE8ITg5c4AAf/Kovlwr750AI+0gAccQzEOBsoNFijACuAcWAcQAieBsQAIkOfMGxBKWgsAUpQCSwvRy4EC9BHYfLbaMTXSytCit8lG2t6ao09KehOsyRz6eykK9KOroK61cJnPqAwVgdgCnDSmOVsJ/GxuVynxrrxaea1N68FgN2WkmyyYBBQCuS4yIGwdfoxqyYm0wziAC8jgngAt73EeBC140JQEEBBaQQNGNBAAAh+QQFCgA0ACwFAAUAzADRAAAG/0CacEgsGo/IpHLJbDqf0Ki0Katar7Kpdsvter/gJXZ8DZvP6LRaTG5n1/C4fK502+n4vB5s7+//gIFIfYSChod4hIqIjI1nioWOkpNSkIuUmJmDln6anp6cnZ+jk6F3pKiNpm6prYerba6ygLBks7d5tba4vHC6Y73Bab9YwsZhxGXHy1zJVszQU85V0dVP02/W2knY295H3d/iQuHj3+Xm2+jp1uvs0e7vzPHyx/T1wvf4vfr7uP3+ZgEM6GogwVQGD5JKqPATw4aaHkLEJHFiqWkWeVXMqAojR4EePxYMKRIhyZILT6J0qHJlxJYuKcKMedEZzVEbb+aaqZNRzv+ec34CjSN06JqiRofxTEprKdM9SJ8icyo1EdWqQa9iJap169GuXpXaDBsoKllpYM9OHatWj9m219LC7fJ2LpO6duvIzYuWLV9fe/9CwSu4COHCQw4jpqEYcePCjwVH/juZb+W8l+1mnrsZbue2n9WGPjuabOmwpxerXs26tevXsGPLnk27tu3buHPr3s27t+/fwIMLH068uPHjyJMrX868ufPn0KNLn069uvXr2LNr3869u/fv4MOLH0++vPnz6NOrX8++vfv38OPLn0+/vv37+PPr38+/v///AAYo4IAE8iIABg4QAMIMDDbo4IMQRijhhBRWaGGDCdC0gQgDXOje4Ycghkhhhi55gICIKKao4oQkokTCijDGmGKLIr0o4404VkgjRxjk6OOPDu5oEQMnAmkkjkJOlMCRTMqYZEMCdNjklDOK5AGVWIr4pEIOZOmlh1seZMGXZI4oEgdlpglhmASp6SaGZ77pJpsBjSlnmnT60+WdZea5jwJ89ilSlIF+6ec+IhTq5aH4EKkolozic+WjU0aKzweUNmkpPktmauSmkqLpqY+g4gOBAVKO6qROByb4gKorlirSCgfUauutuHpQwK689urrBwYEK+ywxL5AwLHIJqtsCxLKKk4QACH5BAUKADQALBcAHQAUAYYAAAb/QJpwSCwaj8ikcslsOp/QqHRKrVqLsqxWe+16v+CweEyubs/nsnrNbrvfULR8C6/b7/h8cs7P6v+AgYJmfX2Dh4iJgYWMio6PkGOMjZGVlpdNk5SYnJ2VmpueoqOLoKGkqKlupqeqrq9frK2wtLVxsoa2urtLuIW8wMFDvrnCxrXExcfLqcnKzNCeznzR1Z3T1Nban9ho29+P3XLg5Ifi3uXpgOdp6u537HTv83DxfvT4bPb3+f1i+zL8CQwDcKDBKwUPKpyScKHDTPseSuwVcaLFIw0vasyo8SLHjhI/gnQIMOBIiyJPHkyp0iDLlv5ewsxXcibJijZX4szpcifP/5g+f/aTKTQd0aLkaiIdGnSpu6NOt0GNWm0qVWhKrz5tqvVb1q7lrIIVJnYssK9mpXJNi7UsW1tu39JCK5cZ3brL4uJVdbeMgAMoDgDY+0cvFBQvBsxYvBiBgRGE7fQF48EC48uXO2CIvMowEwAwMIu+rOIA5zWelzAgMLo14wkMTktKnURAB9e4Z3AoMVh2rLVeJuQebiGF7y6Tu1AYznzGCQ3HqSTvoqI58wAiNkSPMt3KCuvWERTY7qS7lQ/gwRNAQZ6iPTbV04N/EaL9nvdrEMhPP+CDAPsYscMGAPvt94ACAAbYDRsCFFhgB5AliMU0bgTgYIEGQCDhhMS40f/ChQUO0EBvG9LQoRssgOjgApuVKIQscGCg4oUqQOeiiaDAIcADMzoYAGw34vhLHSX0eCEHEZC44SxrAGCZkQ4WF2Q2dhygGJQOmiDBlO3ggYGFWBaI3X8udolHCleGaeB4N/KjhwQnqOkgAREGGYgCPMq5nwP12QmIACKAqSd4A5BApp96aBDnoOmBgCCif2AAAqPplQapHgJ8kCalzBkQ26V4SGACp9btpiSocKSwAKnNLZABqncAQMKmrLr2HKx2hPBCrcMFAIN2uMKBwpO8uoZAksG+AUAJtBaLWQvsJesGBCk665qW0rpBAWvWjtbfodmWAUAEHHQ72gMxhMvcBgMGmDsahOqucQC37l7mgIbxllGAfvUyVii4+YKxAQyC1jsAvgGPcUAF/c7QQMJrxJBntwucCrEYgBbMqwcXt6FBfLxW0PEbHkzKagCmjexGphrrOYHKdcBJKQKfwhzjqnq6YPMdAsyqZsU74xHCqFi+GnQeKRCr4gVH/7Fss/IFsGXTf0DgAIgJUC3IsAXSrLUgALhQbnoRfH0IA9U2R4DFZv8xAr25UdC2IhHw65oDczvCrmsBIJx3IgfcJlrWf0MSg90zPABw4YkMDOajjEeyggoiR35JzSMHAQA7';
            spinner.width = size;
            return spinner;
        }
    }
    NextAdmin.Spinner = Spinner;
})(NextAdmin || (NextAdmin = {}));
try {
    HTMLElement.prototype.startSpin = function (background = 'rgba(255,255,255,0.2)', size = 50, animation = null) {
        let element = this;
        element.style.position = 'relative';
        let spinnerContainer = element['_spinnerContainer'];
        if (spinnerContainer != null) {
            return;
        }
        spinnerContainer = document.createElement('div');
        spinnerContainer.style.position = 'absolute';
        spinnerContainer.style.width = '100%';
        spinnerContainer.style.height = '100%';
        spinnerContainer.style.left = '0px';
        spinnerContainer.style.top = '0px';
        if (background != null) {
            spinnerContainer.style.background = background;
            if (animation != null) {
                spinnerContainer.playAnimation(animation);
            }
        }
        spinnerContainer.style.cursor = 'not-allowed';
        spinnerContainer.style.zIndex = '10';
        let centeredDiv = document.createElement('div');
        centeredDiv.style.width = '1px';
        centeredDiv.style.height = '1px';
        centeredDiv.centerHorizontally();
        centeredDiv.centerVertically();
        //centeredDiv.style.position = 'absolute';
        let spinner = NextAdmin.Spinner.createDefault(size);
        spinner.style.position = 'absolute';
        spinner.style.left = '-' + (size / 2) + 'px';
        spinner.style.top = '-' + (size / 2) + 'px';
        centeredDiv.appendChild(spinner);
        spinnerContainer.appendChild(centeredDiv);
        element.appendChild(spinnerContainer);
        element['_spinnerContainer'] = spinnerContainer;
        return { spinnerContainer: spinnerContainer, spinner: spinner };
    };
    HTMLElement.prototype.stopSpin = function () {
        let element = this;
        let spinnerContainer = element['_spinnerContainer'];
        if (spinnerContainer == null) {
            return;
        }
        spinnerContainer.remove();
        delete element['_spinnerContainer'];
    };
}
catch {
}
var NextAdmin;
(function (NextAdmin) {
    class String {
        static isNullOrEmptyString(str) {
            return str === undefined || str === null || (typeof str === 'string' && str == '');
        }
        static isNullOrEmpty(str) {
            return str == null || str == '';
        }
        static isNullOrWhiteSpace(str) {
            if (String.isNullOrEmpty(str))
                return true;
            if (str.toString().trim() == '')
                return true;
            return false;
        }
        static isString(value) {
            return typeof value === 'string' || value instanceof String;
        }
        static nl2br(str) {
            if (String.isNullOrEmpty(str)) {
                return '';
            }
            return str.replace(/(?:\r\n|\r|\n)/g, '<br>');
        }
    }
    NextAdmin.String = String;
})(NextAdmin || (NextAdmin = {}));
try {
    String.prototype.isNumeric = function () {
        return !isNaN(this + 0);
    };
    String.prototype.extractTags = function (startDelimiter, endDelimiter) {
        let str = this;
        let extractedSubStrings = [];
        for (let subStr of str.split(startDelimiter)) {
            let stopIndex = subStr.indexOf(endDelimiter);
            if (stopIndex !== -1) {
                extractedSubStrings.push(subStr.substring(0, stopIndex));
            }
        }
        return extractedSubStrings;
    };
    String.prototype.replaceTags = function (startDelimiter, endDelimiter, replaceAction) {
        let str = this;
        let outputStr = '';
        let i = 0;
        for (let subStr of str.split(startDelimiter)) {
            let stopIndex = subStr.indexOf(endDelimiter);
            if (stopIndex !== -1 && (outputStr != '' || str.startsWith(startDelimiter))) {
                let endPart = subStr.substring(stopIndex + endDelimiter.length);
                let tageContent = subStr.substring(0, stopIndex);
                outputStr += replaceAction(tageContent) + endPart;
            }
            else {
                outputStr += (i > 0 ? startDelimiter : '') + subStr;
            }
            i++;
        }
        return outputStr;
    };
    String.prototype.removeTags = function (startDelimiter, endDelimiter) {
        let str = this;
        let outputStr = '';
        if (startDelimiter == endDelimiter) {
            let b = true;
            for (let subStr of str.split(startDelimiter)) {
                if (b) {
                    outputStr += subStr;
                }
                b = !b;
            }
        }
        else {
            for (let subStr of str.split(startDelimiter)) {
                let stopIndex = subStr.indexOf(endDelimiter);
                if (stopIndex !== -1) {
                    subStr = subStr.substring(stopIndex + endDelimiter.length);
                }
                outputStr += subStr;
            }
        }
        return outputStr;
    };
    String.prototype.firstCharToLower = function () {
        let str = this;
        return str.charAt(0).toLocaleLowerCase() + str.slice(1);
    };
    String.prototype.firstCharToUpper = function () {
        let str = this;
        return str.charAt(0).toLocaleUpperCase() + str.slice(1);
    };
    String.prototype.hexColorToRGBA = function (alpha) {
        let hexaColor = this;
        var r = parseInt(hexaColor.slice(1, 3), 16), g = parseInt(hexaColor.slice(3, 5), 16), b = parseInt(hexaColor.slice(5, 7), 16);
        if (alpha) {
            return "rgba(" + r + ", " + g + ", " + b + ", " + alpha + ")";
        }
        else {
            return "rgb(" + r + ", " + g + ", " + b + ")";
        }
    };
    String.prototype.toDigit = function (digitCount) {
        var loop = digitCount;
        var zeros = "";
        while (loop) {
            zeros += "0";
            loop--;
        }
        return (this.length > digitCount) ? this : (zeros + this).slice(-digitCount);
    };
    //Not tested sinced removed jquery implementation
    String.prototype.decodeHTML = function () {
        let element = document.createElement("div");
        element.innerHTML = this;
        return element.innerText;
    };
    String.prototype.decodeBase64Utf8 = function (str) {
        return decodeURIComponent(Array.prototype.map.call(atob(str), function (c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
    };
    String.prototype.isoDateToFRDate = function () {
        var date = this.substr(0, 10);
        var fullTime = this.substr(11);
        var time = fullTime.substr(0, 8);
        var dateArray = date.split('-');
        return dateArray[2] + '/' + dateArray[1] + '/' + dateArray[0] + ' ' + time;
    };
    String.prototype.replaceAll = function (search, replace) {
        return this.replace(new RegExp(search.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'), replace);
    };
    String.prototype.replaceAllRegExp = function (regExp, replace) {
        let output = this;
        while (true) {
            let org = output + '';
            output = output.replace(regExp, replace);
            if (org == output) {
                break;
            }
        }
        return output;
    };
    String.prototype.removeDiacritics = function () {
        var defaultDiacriticsRemovalMap = [
            { 'base': 'A', 'letters': /[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g },
            { 'base': 'AA', 'letters': /[\uA732]/g },
            { 'base': 'AE', 'letters': /[\u00C6\u01FC\u01E2]/g },
            { 'base': 'AO', 'letters': /[\uA734]/g },
            { 'base': 'AU', 'letters': /[\uA736]/g },
            { 'base': 'AV', 'letters': /[\uA738\uA73A]/g },
            { 'base': 'AY', 'letters': /[\uA73C]/g },
            { 'base': 'B', 'letters': /[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g },
            { 'base': 'C', 'letters': /[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g },
            { 'base': 'D', 'letters': /[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g },
            { 'base': 'DZ', 'letters': /[\u01F1\u01C4]/g },
            { 'base': 'Dz', 'letters': /[\u01F2\u01C5]/g },
            { 'base': 'E', 'letters': /[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g },
            { 'base': 'F', 'letters': /[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g },
            { 'base': 'G', 'letters': /[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g },
            { 'base': 'H', 'letters': /[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g },
            { 'base': 'I', 'letters': /[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g },
            { 'base': 'J', 'letters': /[\u004A\u24BF\uFF2A\u0134\u0248]/g },
            { 'base': 'K', 'letters': /[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g },
            { 'base': 'L', 'letters': /[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g },
            { 'base': 'LJ', 'letters': /[\u01C7]/g },
            { 'base': 'Lj', 'letters': /[\u01C8]/g },
            { 'base': 'M', 'letters': /[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g },
            { 'base': 'N', 'letters': /[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g },
            { 'base': 'NJ', 'letters': /[\u01CA]/g },
            { 'base': 'Nj', 'letters': /[\u01CB]/g },
            { 'base': 'O', 'letters': /[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g },
            { 'base': 'OI', 'letters': /[\u01A2]/g },
            { 'base': 'OO', 'letters': /[\uA74E]/g },
            { 'base': 'OU', 'letters': /[\u0222]/g },
            { 'base': 'P', 'letters': /[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g },
            { 'base': 'Q', 'letters': /[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g },
            { 'base': 'R', 'letters': /[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g },
            { 'base': 'S', 'letters': /[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g },
            { 'base': 'T', 'letters': /[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g },
            { 'base': 'TZ', 'letters': /[\uA728]/g },
            { 'base': 'U', 'letters': /[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g },
            { 'base': 'V', 'letters': /[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g },
            { 'base': 'VY', 'letters': /[\uA760]/g },
            { 'base': 'W', 'letters': /[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g },
            { 'base': 'X', 'letters': /[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g },
            { 'base': 'Y', 'letters': /[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g },
            { 'base': 'Z', 'letters': /[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g },
            { 'base': 'a', 'letters': /[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g },
            { 'base': 'aa', 'letters': /[\uA733]/g },
            { 'base': 'ae', 'letters': /[\u00E6\u01FD\u01E3]/g },
            { 'base': 'ao', 'letters': /[\uA735]/g },
            { 'base': 'au', 'letters': /[\uA737]/g },
            { 'base': 'av', 'letters': /[\uA739\uA73B]/g },
            { 'base': 'ay', 'letters': /[\uA73D]/g },
            { 'base': 'b', 'letters': /[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g },
            { 'base': 'c', 'letters': /[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g },
            { 'base': 'd', 'letters': /[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g },
            { 'base': 'dz', 'letters': /[\u01F3\u01C6]/g },
            { 'base': 'e', 'letters': /[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g },
            { 'base': 'f', 'letters': /[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g },
            { 'base': 'g', 'letters': /[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g },
            { 'base': 'h', 'letters': /[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g },
            { 'base': 'hv', 'letters': /[\u0195]/g },
            { 'base': 'i', 'letters': /[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g },
            { 'base': 'j', 'letters': /[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g },
            { 'base': 'k', 'letters': /[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g },
            { 'base': 'l', 'letters': /[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g },
            { 'base': 'lj', 'letters': /[\u01C9]/g },
            { 'base': 'm', 'letters': /[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g },
            { 'base': 'n', 'letters': /[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g },
            { 'base': 'nj', 'letters': /[\u01CC]/g },
            { 'base': 'o', 'letters': /[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g },
            { 'base': 'oi', 'letters': /[\u01A3]/g },
            { 'base': 'ou', 'letters': /[\u0223]/g },
            { 'base': 'oo', 'letters': /[\uA74F]/g },
            { 'base': 'p', 'letters': /[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g },
            { 'base': 'q', 'letters': /[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g },
            { 'base': 'r', 'letters': /[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g },
            { 'base': 's', 'letters': /[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g },
            { 'base': 't', 'letters': /[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g },
            { 'base': 'tz', 'letters': /[\uA729]/g },
            { 'base': 'u', 'letters': /[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g },
            { 'base': 'v', 'letters': /[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g },
            { 'base': 'vy', 'letters': /[\uA761]/g },
            { 'base': 'w', 'letters': /[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g },
            { 'base': 'x', 'letters': /[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g },
            { 'base': 'y', 'letters': /[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g },
            { 'base': 'z', 'letters': /[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g }
        ];
        let str = this;
        for (var i = 0; i < defaultDiacriticsRemovalMap.length; i++) {
            str = str.replace(defaultDiacriticsRemovalMap[i].letters, defaultDiacriticsRemovalMap[i].base);
        }
        return str;
    };
    String.prototype.contains = function (search) {
        return this.includes(search);
    };
    String.prototype.nl2br = function () {
        return NextAdmin.String.nl2br(this);
    };
    String.prototype.getHashCode = function () {
        var hash = 0, i, chr;
        if (this.length === 0)
            return hash;
        for (i = 0; i < this.length; i++) {
            chr = this.charCodeAt(i);
            hash = ((hash << 5) - hash) + chr;
            hash |= 0; // Convert to 32bit integer
        }
        return hash;
    };
}
catch {
}
var NextAdmin;
(function (NextAdmin) {
    class Timer {
        constructor(callBack) {
            this._timerHandler = -1;
            this.onExecute = new NextAdmin.EventHandler();
            this._executeAtNextTickCallBacks = new Array();
            this.callBack = callBack;
        }
        _onExecute() {
            if (this.callBack != null) {
                this.callBack();
            }
            for (let cb of this._executeAtNextTickCallBacks) {
                cb();
            }
            this._executeAtNextTickCallBacks.clear();
            this.onExecute.dispatch(this, null);
        }
        executeAtNextTick(callBack, replaceOtherCallBack = true) {
            if (replaceOtherCallBack) {
                this._executeAtNextTickCallBacks.clear();
            }
            this._executeAtNextTickCallBacks.push(callBack);
        }
        throttle(callBack, delay, restartTimer) {
            if (restartTimer || !this.isRuning()) {
                this.start(delay);
            }
            this.executeAtNextTick(() => {
                callBack();
                this.stop();
            }, true);
        }
        start(delay) {
            this.stop();
            this._timerHandler = setInterval(() => {
                this._onExecute();
            }, delay);
        }
        stop() {
            if (this._timerHandler != -1) {
                clearInterval(this._timerHandler);
                this._timerHandler = -1;
            }
        }
        isRuning() {
            return this._timerHandler != -1;
        }
        static async sleep(delay) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve(delay);
                }, delay);
            });
        }
    }
    NextAdmin.Timer = Timer;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class TypeScript {
        static append(key, content) {
            let script = NextAdmin.DependenciesController.registeredDependencies[key];
            if (script == null) {
                script = document.createElement("script");
                script.type = 'text/javascript';
                content = content.removeTags('/***/', '/***/');
                script.text = content;
                NextAdmin.DependenciesController.registeredDependencies[key] = script;
                document.head.appendChild(script);
            }
            return script;
        }
        static load(url, key) {
            if (key == null) {
                key = url;
            }
            let script = NextAdmin.DependenciesController.registeredDependencies[key];
            return new Promise((resolve, reject) => {
                if (script == null) {
                    let script = document.createElement("script");
                    fetch(url + '?nocahche=' + NextAdmin.Guid.newGuid().toString()).then((response) => {
                        if (response.ok) {
                            response.text().then((content) => {
                                script['_loaded'] = true;
                                script.type = 'text/javascript';
                                content = content.removeTags('/***/', '/***/');
                                script.innerHTML = content;
                                document.head.appendChild(script);
                                script.dispatchEvent(new Event('load'));
                                resolve(script);
                            });
                        }
                    });
                    NextAdmin.DependenciesController.registeredDependencies[key] = script;
                }
                else {
                    if (script['_loaded']) {
                        resolve(script);
                    }
                    else {
                        script.addEventListener('load', () => {
                            resolve(script);
                        });
                    }
                }
            });
        }
        static remove(key) {
            let script = NextAdmin.DependenciesController.registeredDependencies[key];
            if (script != null) {
                script.remove();
                delete NextAdmin.DependenciesController.registeredDependencies[key];
            }
        }
        static exist(key) {
            return NextAdmin.DependenciesController.registeredDependencies[key] != null;
        }
    }
    NextAdmin.TypeScript = TypeScript;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class Url {
        constructor(src) {
            this.raw = src;
            this.isHttps = src.startsWith('https');
            this.strPath = this.isHttps ? src.replace('https://', '') : src.replace('http://', '');
            this.path = this.strPath.split('/');
            this.domain = this.path.firstOrDefault();
            let lastPathPart = this.path.lastOrDefault();
            this.parameters = new NextAdmin.Dictionary();
            if (lastPathPart.contains('?')) {
                this.path[this.path.length - 1] = lastPathPart.split('?')[0];
                this.queryString = lastPathPart.split('?')[1];
                for (let parameter of this.queryString.split('&')) {
                    let paramKeyValueArray = parameter.split('=');
                    let key = paramKeyValueArray[0];
                    let value = paramKeyValueArray.length > 0 ? paramKeyValueArray[1] : null;
                    let values = this.parameters.get(key) ?? [];
                    values.add(value);
                    this.parameters.set(key, values);
                }
            }
        }
        getParameter(key) {
            return this.getParameters(key).firstOrDefault();
        }
        getParameters(key) {
            if (this.parameters == null) {
                return [];
            }
            return this.parameters.get(key) ?? [];
        }
        static parse(url) {
            return new Url(url ?? window.location.href);
        }
    }
    NextAdmin.Url = Url;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    class UserAgent {
        static isSafari() {
            return navigator.userAgent.search("Safari") >= 0 && navigator.userAgent.search("Chrome") < 0;
        }
        static isChrome() {
            return window['chrome'] != null;
        }
        static isFireFox() {
            return navigator.userAgent.indexOf("Firefox") > -1;
        }
        static isEdge() {
            return navigator.userAgent.indexOf("Edge") > -1;
        }
        static isIE11() {
            return navigator.userAgent.indexOf("Trident/") > -1;
        }
        static isIE10OrOlder() {
            return navigator.userAgent.indexOf("MSIE ") > -1;
        }
        static isAndroid() {
            return navigator.userAgent.match(/Android/i) != null;
        }
        static isIOS() {
            return UserAgent.isIPad() || UserAgent.isIPhone();
        }
        static isIPad() {
            return navigator.userAgent.match(/iPad/i) != null;
        }
        static isIPhone() {
            return navigator.userAgent.match(/iPhone/i) != null;
        }
        static isMobile() {
            return UserAgent.isAndroid() || UserAgent.isIOS();
        }
        static isDesktop() {
            return !UserAgent.isMobile();
        }
    }
    NextAdmin.UserAgent = UserAgent;
})(NextAdmin || (NextAdmin = {}));
/// <reference path="../EventHandler .ts"/>
var NextAdmin;
(function (NextAdmin) {
    var Business;
    (function (Business) {
        class DataControllerBase {
            constructor(options) {
                if (options.updateDataFromServerAfterSave === undefined) {
                    options.updateDataFromServerAfterSave = true;
                }
                if (options.dataPrimaryKeyName == null) {
                    if (options.dataInfos != null) {
                        let dataInfo = options.dataInfos.get(options.dataName);
                        if (dataInfo) {
                            let propertyInfos = dataInfo.propertyInfos;
                            for (let propertyName in propertyInfos) {
                                if (propertyInfos[propertyName].isPrimaryKey) {
                                    options.dataPrimaryKeyName = propertyName;
                                    break;
                                }
                            }
                        }
                    }
                    if (options.dataPrimaryKeyName == null) {
                        options.dataPrimaryKeyName = 'id';
                    }
                }
                this.options = options;
            }
            getDataPropertyInfoFromPath(dataName, path) {
                if (this.options.dataInfos == null)
                    return null;
                let dataInfo = this.getDataInfo(dataName);
                let pathArray = path.split('.');
                let lastPropertyName = pathArray.lastOrDefault();
                pathArray.removeAt(pathArray.length - 1);
                while (pathArray.length > 0) {
                    let pathItem = pathArray[0];
                    let found = false;
                    for (let propertyName in dataInfo.propertyInfos) {
                        let property = dataInfo.propertyInfos[propertyName];
                        if (property.foreignDataRelationName == pathItem) {
                            dataInfo = this.getDataInfo(property.foreignDataName);
                            pathArray.removeAt(0);
                            found = true;
                            break;
                        }
                    }
                    if (!found) {
                        return null;
                    }
                }
                let propertyInfo = dataInfo.propertyInfos[lastPropertyName];
                return propertyInfo;
            }
            getDataName() {
                return this.options.dataName;
            }
            getDataPrimaryKeyName() {
                return this.options.dataPrimaryKeyName;
            }
            getDataPropertyInfo_(dataName, propertyName) {
                let defaultPropertyInfo = { dataName: dataName, name: propertyName };
                if (this.options.dataInfos == null)
                    return defaultPropertyInfo;
                let dataInfo = this.getDataInfo(dataName);
                let propertyInfo = dataInfo.propertyInfos[propertyName];
                if (propertyInfo == null) {
                    return defaultPropertyInfo;
                }
                return propertyInfo;
            }
            getDataPropertyInfo(property) {
                if (NextAdmin.String.isString(property)) {
                    return this.getDataPropertyInfo_(this.options.dataName, property);
                }
                else {
                    return this.getDataPropertyInfo_(this.options.dataName, this.getPropertyName(property));
                }
            }
            getDataInfo(dataName = this.options.dataName) {
                let defaultEntityInfo = { name: dataName, propertiesInfos: {} };
                if (this.options.dataInfos == null)
                    return defaultEntityInfo;
                let dataInfo = this.options.dataInfos[dataName];
                if (dataInfo == null) {
                    return defaultEntityInfo;
                }
                return dataInfo;
            }
            getDataPropertyInfos(dataName = this.options.dataName) {
                let dataInfo = this.getDataInfo(dataName);
                let propertiesInfos = [];
                for (let propertyName in dataInfo.propertyInfos) {
                    propertiesInfos.push(dataInfo.propertyInfos[propertyName]);
                }
                return propertiesInfos;
            }
            getDataDisplayName(dataName = this.options.dataName) {
                let dataDisplayName = this.getDataInfo(dataName).displayName;
                return dataDisplayName != null ? dataDisplayName : dataName;
            }
            getDataDisplayValue(data) {
                let displayValue = '';
                let dataInfo = this.getDataInfo();
                if (dataInfo?.displayPropertiesNames) {
                    let displayValues = [];
                    for (let displayPropertyName of dataInfo.displayPropertiesNames) {
                        let dataValue = data[displayPropertyName];
                        if (!NextAdmin.String.isNullOrWhiteSpace(dataValue)) {
                            displayValues.add(dataValue);
                        }
                    }
                    if (displayValues.length > 0) {
                        displayValue = displayValues.join(' ');
                    }
                }
                else {
                    displayValue = this.getDataPrimaryKeyValue(data);
                }
                if (NextAdmin.String.isNullOrWhiteSpace(displayValue)) {
                    displayValue = NextAdmin.Resources.unamed;
                }
                return displayValue;
            }
            getDataPropertyPaths(dataName = this.options.dataName, exploreJoinedData = true, includeForeignKey = false) {
                let dataVars = new Array();
                let schemaDatasInfos = this.options.dataInfos;
                let dataToExplores;
                dataToExplores = [];
                dataToExplores.add({ dataName: dataName });
                while (dataToExplores.length > 0) {
                    let currentData = dataToExplores[0];
                    dataToExplores.removeAt(0);
                    let currentDataInfo = schemaDatasInfos[currentData.dataName];
                    if (currentDataInfo == null) {
                        continue;
                    }
                    for (let propertyName in currentDataInfo.propertyInfos) {
                        let propertyInfo = currentDataInfo.propertyInfos[propertyName];
                        if (propertyInfo.isQueryable == true && (propertyInfo.displayName != null || (propertyInfo.isPrimaryKey && propertyInfo.dataName == currentData.dataName))) {
                            let selectQuery = currentData.path == null ? propertyName : currentData.path + '.' + propertyName;
                            let displayName = propertyInfo.displayName != null ? propertyInfo.displayName : propertyInfo.name;
                            if (exploreJoinedData && propertyInfo.foreignDataName) {
                                let foreignData = schemaDatasInfos[propertyInfo.foreignDataName];
                                if (foreignData != null && foreignData.name != currentDataInfo.name && (NextAdmin.String.isNullOrEmpty(currentData?.path) || currentData.path.split('.').length < 5)) {
                                    dataToExplores.add({
                                        dataName: propertyInfo.foreignDataName,
                                        path: currentData.path == null ? propertyInfo.foreignDataRelationName : currentData.path + '.' + propertyInfo.foreignDataRelationName,
                                        dataDisplayName: currentData.dataDisplayName == null ? propertyInfo.displayName : currentData.dataDisplayName + '->' + foreignData.displayName + ' (' + propertyInfo.displayName + ')'
                                    });
                                }
                            }
                            if (!includeForeignKey && propertyInfo.foreignDataName != null && !propertyInfo.isPrimaryKey) {
                                continue;
                            }
                            if (propertyInfo.isPrimaryKey) {
                                displayName += ' (' + NextAdmin.Resources.primaryKey + ')';
                            }
                            if (propertyInfo.foreignDataName != null) {
                                displayName += ' (' + NextAdmin.Resources.linkTo + ' : ' + propertyInfo.foreignDataRelationName + ')';
                            }
                            dataVars.add({ path: selectQuery, label: currentData.dataDisplayName == null ? displayName : currentData.dataDisplayName + '->' + displayName });
                        }
                    }
                }
                dataVars = dataVars.orderBy(e => e.label.contains('>') ? e.label.replace('>', Array.from(e.label).where(e => e == '>').length.toString()) : '0000' + e.label);
                return dataVars;
            }
            getDataPrimaryKeyValue(data) {
                return data[this.options.dataPrimaryKeyName];
            }
            isDataUpToDate() {
                throw new Error('Not implemented');
            }
            save(args) {
                throw new Error('Not implemented');
            }
            displayDefaultError(result) {
                NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.error, 'Code : ' + result.code + '<br />' + (result.message != null ? result.message : ''));
            }
            askUserToSaveDataIfNeededAndExecuteAction(continueAction, cancelAction) {
                if (!this.isDataUpToDate()) {
                    let messageBox = new NextAdmin.UI.MessageBox({
                        title: NextAdmin.Resources.warning,
                        text: NextAdmin.Resources.lostDataNotSavedMessage,
                        buttons: [new NextAdmin.UI.Button({
                                text: NextAdmin.Resources.saveIcon + ' ' + NextAdmin.Resources.saveAndContinue,
                                style: NextAdmin.UI.ButtonStyle.green,
                                action: async () => {
                                    let result = await this.save();
                                    if (result.code == NextAdmin.Models.ApiResponseCode.Success) {
                                        continueAction(true);
                                    }
                                    else if (cancelAction) {
                                        cancelAction();
                                    }
                                    messageBox.close();
                                }
                            }), new NextAdmin.UI.Button({
                                text: NextAdmin.Resources.discardAndContinue,
                                action: () => {
                                    messageBox.close();
                                    continueAction(false);
                                }
                            }), new NextAdmin.UI.Button({
                                text: NextAdmin.Resources.cancel,
                                action: () => {
                                    messageBox.close();
                                    if (cancelAction) {
                                        cancelAction();
                                    }
                                }
                            })]
                    });
                    messageBox.open();
                }
                else {
                    continueAction(true);
                }
            }
            getDataDef() {
                if (this._dataDef == null) {
                    this._dataDef = {};
                    for (let propertyName in this.getDataInfo().propertyInfos) {
                        this._dataDef[propertyName] = propertyName;
                    }
                }
                return this._dataDef;
            }
            getPropertyName(dataDefPropertyAction) {
                return dataDefPropertyAction(this.getDataDef());
            }
        }
        Business.DataControllerBase = DataControllerBase;
        class DataControllerBase_ extends DataControllerBase {
        }
        Business.DataControllerBase_ = DataControllerBase_;
        let DataErrorType;
        (function (DataErrorType) {
            DataErrorType[DataErrorType["unknow"] = 0] = "unknow";
            DataErrorType[DataErrorType["emptyValue"] = 1] = "emptyValue";
            DataErrorType[DataErrorType["invalidValue"] = 2] = "invalidValue";
        })(DataErrorType = Business.DataErrorType || (Business.DataErrorType = {}));
        let DataState;
        (function (DataState) {
            DataState[DataState["append"] = 0] = "append";
            DataState[DataState["edited"] = 1] = "edited";
            DataState[DataState["serialized"] = 2] = "serialized";
            DataState[DataState["deleted"] = 3] = "deleted";
        })(DataState = Business.DataState || (Business.DataState = {}));
        let DataControllerActionType;
        (function (DataControllerActionType) {
            DataControllerActionType[DataControllerActionType["append"] = 0] = "append";
            DataControllerActionType[DataControllerActionType["load"] = 1] = "load";
            DataControllerActionType[DataControllerActionType["save"] = 2] = "save";
            DataControllerActionType[DataControllerActionType["delete"] = 3] = "delete";
        })(DataControllerActionType = Business.DataControllerActionType || (Business.DataControllerActionType = {}));
        class DataStateHelper {
            static getDataState(data) {
                let state = data['_state'];
                if (state == null) {
                    return DataState.append;
                }
                return state;
            }
            static setDataState(data, state) {
                data['_state'] = state;
            }
        }
        Business.DataStateHelper = DataStateHelper;
    })(Business = NextAdmin.Business || (NextAdmin.Business = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="DataControllerBase.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var Business;
    (function (Business) {
        class DataController extends Business.DataControllerBase {
            constructor(options) {
                super(options);
                this.bindedControls = new NextAdmin.Dictionary();
                this.appendAction = null;
                this.loadAction = null;
                this.saveAction = null;
                this.deleteAction = null;
                this.cancelAction = null;
                this.onDataChanged = new NextAdmin.EventHandler();
                this.onDataLoaded = new NextAdmin.EventHandler();
                this.onDataAppended = new NextAdmin.EventHandler();
                this.onDataDeleted = new NextAdmin.EventHandler();
                this.onDataSaved = new NextAdmin.EventHandler();
                this.onControlChanged = new NextAdmin.EventHandler();
                this.onDataStateChanged = new NextAdmin.EventHandler();
                this.onStartChangeData = new NextAdmin.AsyncEventHandler();
                this.onStartSaveData = new NextAdmin.AsyncEventHandler();
                this.onControlBinded = new NextAdmin.EventHandler();
                this.onReadOnlyChanged = new NextAdmin.EventHandler();
                this.data = {};
                this._originalData = {};
                Business.DataStateHelper.setDataState(this.data, Business.DataState.append);
                Business.DataStateHelper.setDataState(this._originalData, Business.DataState.append);
            }
            displayDataErrors(action, resultError, defaultErrorMessage, okAction) {
                if (resultError.code == 'VERSION_CONFLICT') {
                    return;
                }
                let errorsAndWarning = new Array();
                if (resultError.errors != null) {
                    errorsAndWarning.addRange(resultError.errors);
                }
                if (resultError.warnings != null) {
                    errorsAndWarning.addRange(resultError.warnings);
                }
                let textError = '';
                let errorsGroupedByDataName = errorsAndWarning.groupByArray((e) => {
                    let dataInfos = this.getDataInfo(e.dataName);
                    if (dataInfos == null || dataInfos.displayName == null) {
                        return e.dataName;
                    }
                    let displayValue = dataInfos.displayName;
                    if (displayValue == null) {
                        displayValue = e.dataName;
                    }
                    if (e.dataId != null) {
                        displayValue += ' ' + e.dataId;
                    }
                    return displayValue;
                });
                for (let group of errorsGroupedByDataName) {
                    if (errorsGroupedByDataName.count() > 0) { //display data name
                        textError += '<br /><b>' + group.name + ' : </b><br /><br />';
                    }
                    for (let error of group.items) {
                        let propertyDisplayName = error.propertyDisplayName;
                        if (NextAdmin.String.isNullOrEmpty(propertyDisplayName)) { //try find display name from data info
                            propertyDisplayName = this.getDataPropertyInfo_(error.dataName, error.propertyName).displayName;
                        }
                        if (NextAdmin.String.isNullOrEmpty(propertyDisplayName) && error.dataName == this.options.dataName) { //try find display name from form
                            let formControl = this.bindedControls[error.propertyName];
                            if (formControl != null) {
                                let controlLabel = formControl.getLabel();
                                if (!NextAdmin.String.isNullOrEmpty(controlLabel)) {
                                    propertyDisplayName = controlLabel;
                                }
                            }
                        }
                        if (error.dataName == this.options.dataName) {
                            let control = this.bindedControls[error.propertyName];
                            if (control != null) {
                                control.setError(error.message);
                                if (NextAdmin.String.isNullOrEmpty(propertyDisplayName)) {
                                    propertyDisplayName = control.getLabel();
                                }
                            }
                        }
                        else {
                            for (let controlPropertyName in this.bindedControls) {
                                if (this.bindedControls[controlPropertyName] instanceof NextAdmin.UI.DataGrid) {
                                    let grid = this.bindedControls[controlPropertyName];
                                    if (grid.datasetController != null && grid.datasetController.options.dataName == error.dataName) {
                                        let gridErrors = errorsAndWarning.where(e => e.dataName == grid.datasetController.options.dataName);
                                        grid.setError(gridErrors);
                                    }
                                }
                            }
                        }
                        if (NextAdmin.String.isNullOrEmpty(propertyDisplayName)) {
                            propertyDisplayName = error.propertyName;
                        }
                        let errorMessage = '';
                        if (NextAdmin.String.isNullOrEmpty(errorMessage)) {
                            errorMessage = error.message;
                        }
                        if (!NextAdmin.String.isNullOrWhiteSpace(propertyDisplayName)) {
                            textError += '<span style="margin-left:10px">' + propertyDisplayName + '</span> : ';
                        }
                        textError += errorMessage + '<br />';
                    }
                }
                if (NextAdmin.String.isNullOrEmpty(textError)) {
                    textError = defaultErrorMessage;
                }
                if (NextAdmin.String.isNullOrEmpty(textError)) {
                    textError = resultError.message;
                }
                if (NextAdmin.String.isNullOrEmpty(textError)) {
                    textError = NextAdmin.Resources.unknownError;
                }
                return NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.error, textError, okAction);
            }
            enableReadOnly(message) {
                if (this._isReadOnlyEnabled) {
                    return;
                }
                this._isReadOnlyEnabled = true;
                this._readOnlyMessage = message;
                if (this.form) {
                    this.form.saveButton.disable();
                    this.form.deleteButton.disable();
                    this.form.enableReadOnly();
                }
                this.onReadOnlyChanged.dispatch(this, true);
            }
            disableReadOnly() {
                if (!this._isReadOnlyEnabled) {
                    return;
                }
                this._isReadOnlyEnabled = false;
                this._readOnlyMessage = null;
                if (this.form) {
                    this.form.disableReadOnly();
                }
                this.onReadOnlyChanged.dispatch(this, false);
            }
            clearErrors() {
                for (let propertyName in this.bindedControls) {
                    let formControl = this.bindedControls[propertyName];
                    formControl.setError(null);
                }
            }
            bindToForm(form, autoExecuteAction = false) {
                this.form = form;
                if (autoExecuteAction) {
                    this.form.cancelButton.action = () => {
                        this.setData(this._originalData);
                    };
                    this.form.deleteButton.action = () => {
                        NextAdmin.UI.MessageBox.createYesCancel(NextAdmin.Resources.formDeleteMessageTitle, NextAdmin.Resources.formDeleteMessage, () => {
                            this.delete();
                        });
                    };
                    this.form.saveButton.action = () => {
                        this.save();
                    };
                }
            }
            save(args) {
                args = {
                    displayErrors: true,
                    ...args
                };
                return new Promise(async (resolve) => {
                    let dataToSave = NextAdmin.Copy.clone(this.data);
                    let saveDataEventArgs = {
                        data: dataToSave,
                        dataState: this.getDataState(),
                        errors: [],
                        warnings: [],
                    };
                    if (this.getDataPrimaryKeyValue() == null && this.getControl(this.options.dataPrimaryKeyName) != null) {
                        saveDataEventArgs.errors.add({
                            dataName: this.getDataInfo().name,
                            propertyName: this.options.dataPrimaryKeyName,
                            propertyDisplayName: this.getDataPropertyInfo_(this.options.dataName, this.options.dataPrimaryKeyName).displayName,
                            errorCode: 'PRIMARY_KEY_REQUIRED',
                            message: NextAdmin.Resources.requiredField
                        });
                    }
                    await this.onStartSaveData.dispatch(this, saveDataEventArgs);
                    if (saveDataEventArgs.errors?.length || saveDataEventArgs.warnings?.length || saveDataEventArgs.message) {
                        this.displayDataErrors(Business.DataControllerActionType.save, {
                            errors: saveDataEventArgs.errors,
                            warnings: saveDataEventArgs.warnings,
                            message: saveDataEventArgs.message,
                            success: false,
                        });
                    }
                    if (saveDataEventArgs.cancel || saveDataEventArgs.errors?.length) {
                        return;
                    }
                    if (this.form != null) {
                        this.form.startSpin();
                    }
                    if (this.saveAction != null) {
                        this.saveAction(dataToSave, (result) => {
                            if (args.onGetResponse != null) {
                                args.onGetResponse(result);
                            }
                            if (this.form != null) {
                                this.form.stopSpin();
                            }
                            if (result.success) {
                                if (result.newData != null && this.options.updateDataFromServerAfterSave) {
                                    NextAdmin.Copy.copyTo(result.newData, this.data); //copy new data into actual data to not change reference of data object
                                    this.setData(this.data, Business.DataState.serialized);
                                }
                                else {
                                    this.setDataState(Business.DataState.serialized);
                                    this._originalData = NextAdmin.Copy.clone(this.data);
                                }
                                this.clearErrors();
                                for (let controlName in this.bindedControls) {
                                    let control = this.bindedControls[controlName];
                                    control.setError(null);
                                }
                            }
                            else {
                                if (args.displayErrors) {
                                    this.displayDataErrors(Business.DataControllerActionType.save, result);
                                }
                            }
                            this.onDataSaved.dispatch(this, result);
                            resolve(result);
                        });
                    }
                    else {
                        resolve(null);
                    }
                });
            }
            delete(args) {
                args = {
                    displayErrors: true,
                    ...args
                };
                return new Promise((resolve) => {
                    if (this.deleteAction != null) {
                        this.deleteAction(this.data, (result) => {
                            if (args.onGetResponse != null) {
                                args.onGetResponse(result);
                            }
                            if (result.success) {
                                this.onDataDeleted.dispatch(this, this.data);
                                this.setDataState(Business.DataState.deleted);
                                this.clear();
                            }
                            else {
                                if (args.displayErrors) {
                                    if (result.errors.length > 0) {
                                        this.displayDataErrors(Business.DataControllerActionType.delete, result);
                                    }
                                    else {
                                        this.displayDataErrors(Business.DataControllerActionType.delete, result, NextAdmin.Resources.defaultDeleteError);
                                    }
                                }
                            }
                            resolve(result);
                        });
                    }
                    else {
                        resolve(null);
                    }
                });
            }
            cancel() {
                if (this.cancelAction != null) {
                    this.cancelAction(this.data);
                }
                else {
                    this.setData(this._originalData);
                }
            }
            _bindControl(formControl, propertyName) {
                let alreadyBindedControl = this.bindedControls.get(propertyName);
                if (alreadyBindedControl) {
                    this.unbindControl(alreadyBindedControl);
                }
                this.bindedControls[propertyName] = formControl;
                formControl.setDataController(this, propertyName);
                formControl['_propertyName'] = propertyName;
                formControl.onValueChanged.subscribe(formControl['_onValueChangedBindedAction'] = (control, args) => {
                    this.controlChanged(control, args);
                });
                this.onControlBinded.dispatch(this, formControl);
            }
            bindControl(formControl, property) {
                if (NextAdmin.String.isString(property)) {
                    this._bindControl(formControl, property);
                }
                else {
                    this._bindControl(formControl, this.getPropertyName(property));
                }
            }
            unbindControl(formControl) {
                delete this.bindedControls[formControl.getBindedPropertyName()];
                formControl.onValueChanged.unsubscribe(formControl['_onValueChangedBindedAction']);
            }
            getControl(property) {
                if (NextAdmin.String.isString(property)) {
                    return this.bindedControls[property];
                }
                else {
                    return this.bindedControls[this.getPropertyName(property)];
                }
            }
            async load(dataId, args) {
                args = {
                    displayErrors: true,
                    ...args
                };
                return new Promise((resolve, reject) => {
                    if (this.loadAction == null) {
                        throw new Error('No load action');
                    }
                    if (this.form != null) {
                        this.form.startSpin();
                    }
                    this.loadAction(dataId, async (result) => {
                        if (args.onGetResponse != null) {
                            args.onGetResponse(result);
                        }
                        if (result.success) {
                            await this.setData(result.data, Business.DataState.serialized);
                        }
                        else {
                            if (args.displayErrors) {
                                this.displayDefaultError(result);
                            }
                        }
                        if (this.form != null) {
                            this.form.stopSpin();
                        }
                        this.onDataLoaded.dispatch(this, result);
                        resolve(result);
                    });
                });
            }
            async append(args) {
                args = {
                    displayErrors: true,
                    ...args
                };
                return new Promise((resolve, reject) => {
                    if (this.form != null) {
                        this.form.startSpin();
                    }
                    this.appendAction(async (result) => {
                        if (args.onGetResponse != null) {
                            args.onGetResponse(result);
                        }
                        if (result.success) {
                            await this.setData(result.data, Business.DataState.append);
                        }
                        if (this.form != null) {
                            this.form.stopSpin();
                        }
                        this.onDataAppended.dispatch(this, result);
                        resolve(result);
                    });
                });
            }
            async setData(data, state = null) {
                for (let memberName in this.bindedControls) {
                    let formControl = this.bindedControls[memberName];
                    formControl.setError(null);
                }
                if (state == null) {
                    if (data['_state'] == null) {
                        state = Business.DataState.append;
                    }
                    else {
                        state = data['_state'];
                    }
                }
                this.data = data;
                await this.onStartChangeData.dispatch(this, { previousData: this._originalData, newData: data, newDataState: state });
                for (let propertyName in this.bindedControls) {
                    this.updateControlValueFromData(propertyName);
                }
                this.setDataState(state);
                this.onDataChanged.dispatch(this, { previousData: this._originalData, newData: data, newDataState: state });
                this._originalData = NextAdmin.Copy.clone(data);
            }
            setDataPropertyValue(dataDefPropertyAction, value, fireChange) {
                let propertyName = this.getPropertyName(dataDefPropertyAction);
                this.data[propertyName] = value;
                let control = this.getControl(propertyName);
                if (control) {
                    control.setValue(value, fireChange);
                }
            }
            updateControlValueFromData(propertyName) {
                let formControl = this.bindedControls[propertyName];
                let propertyPathArray = propertyName.split('.');
                let currentData = this.data;
                while (propertyPathArray.length > 0) {
                    currentData = currentData[propertyPathArray[0]];
                    if (currentData == null) {
                        currentData = null;
                        break;
                    }
                    propertyPathArray.removeAt(0);
                }
                let value = currentData;
                if (formControl != null) {
                    formControl.setValue(value);
                }
            }
            updateDataValueFromControl(control) {
                let propertyName = control['_propertyName'];
                let propertyPathArray = propertyName.split('.');
                let currentData = this.data;
                while (propertyPathArray.length > 1) {
                    let previousData = currentData;
                    currentData = previousData[propertyPathArray[0]];
                    if (currentData == null) {
                        previousData[propertyPathArray[0]] = currentData = {};
                    }
                    propertyPathArray.removeAt(0);
                }
                currentData[propertyPathArray[0]] = control.getValue();
            }
            getDataDisplayValue(data = this.data) {
                return super.getDataDisplayValue(data);
            }
            getDataPrimaryKeyValue(data = this.data) {
                return super.getDataPrimaryKeyValue(data);
            }
            getPrimaryKeyValue() {
                return super.getDataPrimaryKeyValue(this.data);
            }
            getData() {
                return this.data;
            }
            getOriginalData() {
                return this._originalData;
            }
            controlChanged(control, args) {
                if (this._isReadOnlyEnabled) {
                    NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.readOnlyMode, this._readOnlyMessage ?? NextAdmin.Resources.readOnlyDefaultMessage);
                    setTimeout(() => {
                        let propertyName = control['_propertyName'];
                        if (propertyName) {
                            control.setValue(this.data[propertyName], false);
                        }
                    }, 10);
                    return;
                }
                this.fireChange();
                this.updateDataValueFromControl(control);
                this.onControlChanged.dispatch(control, args);
            }
            fireChange() {
                if (this.getDataState() == Business.DataState.serialized) {
                    this.setDataState(Business.DataState.edited);
                }
            }
            getDataState() {
                if (this.data == null) {
                    throw Error('Unable to get data state without data');
                }
                return Business.DataStateHelper.getDataState(this.data);
            }
            setDataState(state) {
                if (this.data == null) {
                    throw Error('Unable to set data state without data');
                }
                let previousState = this.getDataState();
                this.data['_state'] = state;
                if (this.form != null) {
                    switch (state) {
                        case Business.DataState.append:
                            if (this.form.deleteButton != null) {
                                this.form.deleteButton.disable();
                            }
                            if (this.form.saveButton != null) {
                                this.form.saveButton.enable();
                            }
                            break;
                        case Business.DataState.edited:
                            if (this.form.deleteButton != null && !this._isReadOnlyEnabled) {
                                this.form.deleteButton.enable();
                            }
                            if (this.form.saveButton != null && !this._isReadOnlyEnabled) {
                                this.form.saveButton.enable();
                            }
                            if (this.form.cancelButton != null) {
                                this.form.cancelButton.enable();
                            }
                            break;
                        case Business.DataState.serialized:
                            if (this.form.deleteButton != null && !this._isReadOnlyEnabled) {
                                this.form.deleteButton.enable();
                            }
                            if (this.form.saveButton != null) {
                                this.form.saveButton.disable();
                            }
                            if (this.form.cancelButton != null) {
                                this.form.cancelButton.disable();
                            }
                            break;
                        default:
                    }
                    if (state != Business.DataState.append) {
                        let primaryKeyControl = this.getControl(this.options.dataPrimaryKeyName);
                        if (primaryKeyControl) {
                            primaryKeyControl.disable();
                        }
                    }
                }
                this.onDataStateChanged.dispatch(this, { previousState: previousState, newState: state });
            }
            clear() {
                this.data = {};
                for (let memberName in this.bindedControls) {
                    let formControl = this.bindedControls[memberName];
                    if (formControl != null) {
                        formControl.setValue(null);
                        formControl.setError(null);
                    }
                }
                this.setDataState(Business.DataState.append);
            }
            isDataUpToDate() {
                return this.getDataState() == Business.DataState.serialized;
            }
            ensureSerilized(action) {
                if (this._isReadOnlyEnabled) {
                    NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.readOnlyMode, this._readOnlyMessage ?? NextAdmin.Resources.readOnlyDefaultMessage);
                    return;
                }
                if (Business.DataStateHelper.getDataState(this.data) == Business.DataState.append) {
                    NextAdmin.UI.MessageBox.createYesCancel(NextAdmin.Resources.formSaveRequiredTitle, NextAdmin.Resources.formSaveRequiredMessage, async () => {
                        let result = await this.save();
                        if (result.success) {
                            action(this.data);
                        }
                    });
                }
                else {
                    action(this.data);
                }
            }
            ensureUpToDate(action) {
                if (this._isReadOnlyEnabled) {
                    NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.readOnlyMode, this._readOnlyMessage ?? NextAdmin.Resources.readOnlyDefaultMessage);
                    return;
                }
                if (Business.DataStateHelper.getDataState(this.data) != Business.DataState.serialized) {
                    NextAdmin.UI.MessageBox.createYesCancel(NextAdmin.Resources.formSaveRequiredTitle, NextAdmin.Resources.formSaveRequiredMessage, async () => {
                        let result = await this.save();
                        if (result.success) {
                            action(this.data);
                        }
                    });
                }
                else {
                    action(this.data);
                }
            }
        }
        Business.DataController = DataController;
        class DataController_ extends DataController {
        }
        Business.DataController_ = DataController_;
        class LocalDataController extends NextAdmin.Business.DataController {
            constructor(options) {
                super(options);
                this.appendAction = (actionResult) => {
                    actionResult({
                        success: true,
                        data: {},
                    });
                };
            }
        }
        Business.LocalDataController = LocalDataController;
    })(Business = NextAdmin.Business || (NextAdmin.Business = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="DataControllerBase.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var Business;
    (function (Business) {
        class DatasetController extends Business.DataControllerBase {
            constructor(options) {
                super(options);
                this.dataset = [];
                this.onStartRequest = new NextAdmin.EventHandler();
                this.onEndRequest = new NextAdmin.EventHandler();
                this.onStartLoadData = new NextAdmin.EventHandler();
                this.onDataLoaded = new NextAdmin.EventHandler();
                this.onDataAdded = new NextAdmin.EventHandler();
                this.onStartSaveData = new NextAdmin.EventHandler();
                this.onDataSaved = new NextAdmin.EventHandler();
                this.onDataDeleted = new NextAdmin.EventHandler();
                this.onStartAppeningData = new NextAdmin.EventHandler();
                this.onDataAppened = new NextAdmin.EventHandler();
                this.onDataCleared = new NextAdmin.EventHandler();
                this.onDataChanged = new NextAdmin.EventHandler();
                if (this.options.columnsToSelect != null) {
                    this.select(...this.options.columnsToSelect);
                }
            }
            displayDataErrors(dataset, action, resultError, defaultErrorMessage, okAction) {
                let errorsAndWarning = new Array();
                if (resultError.errors != null) {
                    errorsAndWarning.addRange(resultError.errors);
                }
                if (resultError.warnings != null) {
                    errorsAndWarning.addRange(resultError.warnings);
                }
                let textError = '';
                let errorsGroupedByDataName = errorsAndWarning.groupByArray((e) => {
                    let displayName = this.getDataInfo(e.dataName).displayName;
                    if (displayName == null) {
                        displayName = e.dataName;
                    }
                    return displayName + ' ' + e.dataId;
                });
                for (let group of errorsGroupedByDataName) {
                    if (errorsGroupedByDataName.count() > 0) { //display data name
                        textError += '<br /><b>' + group.name + ' : </b><br /><br />';
                    }
                    for (let error of group.items) {
                        let propertyDisplayName = error.propertyDisplayName;
                        if (NextAdmin.String.isNullOrEmpty(propertyDisplayName)) {
                            propertyDisplayName = this.getDataPropertyInfo_(error.dataName, error.propertyName).displayName;
                        }
                        if (NextAdmin.String.isNullOrEmpty(propertyDisplayName)) {
                            propertyDisplayName = error.propertyName;
                        }
                        let errorMessage = '';
                        if (NextAdmin.String.isNullOrEmpty(errorMessage)) {
                            errorMessage = error.message;
                        }
                        textError += '<span style="margin-left:10px">' + propertyDisplayName + '</span> : ' + errorMessage + '<br />';
                    }
                }
                if (NextAdmin.String.isNullOrEmpty(textError)) {
                    textError = defaultErrorMessage;
                }
                if (NextAdmin.String.isNullOrEmpty(textError)) {
                    textError = resultError.message;
                }
                if (NextAdmin.String.isNullOrEmpty(textError)) {
                    textError = NextAdmin.Resources.unknownError;
                }
                return NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.error, textError, okAction);
            }
            async load(args) {
                args = {
                    displayErrors: true,
                    dataState: Business.DataState.serialized,
                    ...args
                };
                return new Promise((resolve) => {
                    this.onStartLoadData.dispatch(this, this.dataset);
                    this.onStartRequest.dispatch(this, this.dataset);
                    this.loadAction((result) => {
                        if (args.onGetResponse) {
                            args.onGetResponse(result);
                        }
                        if (result.success) {
                            let previousDataset = this.dataset;
                            this.dataset = result.dataset;
                            for (let data of this.dataset) {
                                if (data['_state'] === undefined) {
                                    data['_state'] = args.dataState;
                                }
                            }
                            this.onDataLoaded.dispatch(this, result);
                            this.onDataChanged.dispatch(this, { previousDataset: previousDataset, newDataset: this.dataset });
                        }
                        else {
                            if (args.displayErrors) {
                                this.displayDataErrors(null, Business.DataControllerActionType.load, result);
                            }
                        }
                        this.onEndRequest.dispatch(this, this.dataset);
                        resolve(result);
                    });
                });
            }
            async loadAdd(args) {
                args = {
                    displayErrors: true,
                    dataState: Business.DataState.serialized,
                    ...args
                };
                return new Promise((resolve) => {
                    this.onStartLoadData.dispatch(this, this.dataset);
                    this.onStartRequest.dispatch(this, this.dataset);
                    this.loadAction((result) => {
                        if (args.onGetResponse) {
                            args.onGetResponse(result);
                        }
                        if (result.success) {
                            let previousDataset = this.dataset.clone();
                            for (let data of result.dataset) {
                                if (data['_state'] === undefined) {
                                    data['_state'] = args.dataState;
                                }
                                this.dataset.add(data);
                            }
                            this.onDataAdded.dispatch(this, result);
                            this.onDataChanged.dispatch(this, { previousDataset: previousDataset, newDataset: this.dataset });
                        }
                        else {
                            if (args.displayErrors) {
                                this.displayDataErrors(null, Business.DataControllerActionType.load, result);
                            }
                        }
                        this.onEndRequest.dispatch(this, this.dataset);
                        resolve(result);
                    });
                });
            }
            async save(args) {
                args = {
                    displayErrors: true,
                    ...args
                };
                return new Promise((resolve) => {
                    this.onStartSaveData.dispatch(this, this.dataset);
                    this.onStartRequest.dispatch(this, this.dataset);
                    this.saveAction(this.dataset, (result) => {
                        if (args.onGetResponse != null) {
                            args.onGetResponse(result);
                        }
                        if (result.success) {
                            let previousDataset = this.dataset.clone();
                            this.dataset = result.newDataset;
                            this.onDataChanged.dispatch(this, { previousDataset: previousDataset, newDataset: this.dataset });
                        }
                        else {
                            if (args.displayErrors) {
                                this.displayDataErrors(this.dataset, Business.DataControllerActionType.save, result);
                            }
                        }
                        this.onDataSaved.dispatch(this, result);
                        this.onEndRequest.dispatch(this, this.dataset);
                        resolve(result);
                    });
                });
            }
            async deleteItems(items, args) {
                args = {
                    displayErrors: true,
                    ...args
                };
                return new Promise((resolve) => {
                    this.onStartRequest.dispatch(this, this.dataset);
                    for (let item of items) {
                        item['_state'] = Business.DataState.deleted;
                    }
                    this.saveAction(items, async (result) => {
                        if (args.onGetResponse != null) {
                            args.onGetResponse(result);
                        }
                        if (result.success) {
                            let previousDataset = this.dataset.clone();
                            for (let deletedItem of items) {
                                this.dataset.remove(deletedItem);
                            }
                            this.onDataDeleted.dispatch(this, result);
                            this.onDataChanged.dispatch(this, { previousDataset: previousDataset, newDataset: this.dataset });
                        }
                        else {
                            if (args.displayErrors) {
                                this.displayDataErrors(items, Business.DataControllerActionType.delete, result, NextAdmin.Resources.defaultDeleteError);
                            }
                        }
                        this.onEndRequest.dispatch(this, this.dataset);
                        resolve(result);
                    });
                });
            }
            append(args) {
                args = {
                    displayErrors: true,
                    dataState: Business.DataState.append,
                    ...args
                };
                return new Promise((promise) => {
                    this.onStartAppeningData.dispatch(this, this.dataset);
                    this.onStartRequest.dispatch(this, this.dataset);
                    this.appendAction((result) => {
                        if (args.onGetResponse != null) {
                            args.onGetResponse(result);
                        }
                        if (result.success) {
                            let previousDataset = this.dataset.clone();
                            if (result.data['_state'] === undefined) {
                                result.data['_state'] = args.dataState;
                            }
                            this.dataset.add(result.data);
                            this.onDataAppened.dispatch(this, result);
                            this.onDataChanged.dispatch(this, { previousDataset: previousDataset, newDataset: this.dataset });
                        }
                        else {
                            if (args.displayErrors) {
                                this.displayDataErrors(null, Business.DataControllerActionType.append, result);
                            }
                        }
                        this.onEndRequest.dispatch(this, this.dataset);
                        promise(result);
                    });
                });
            }
            clear() {
                let previousDataset = this.dataset.clone();
                this.dataset = [];
                this.onDataCleared.dispatch(this, this.dataset);
                this.onDataChanged.dispatch(this, { previousDataset: previousDataset, newDataset: this.dataset });
            }
            getDataItemById(id) {
                return this.dataset.firstOrDefault(e => e[this.options.dataPrimaryKeyName] == id);
            }
            displayLostDataMessageIfNeededAndExecuteAction(actionToExecute) {
                if (this.dataset.firstOrDefault(e => Business.DataStateHelper.getDataState(e) != Business.DataState.serialized) != null) {
                    NextAdmin.UI.MessageBox.createYesCancel(NextAdmin.Resources.warning, NextAdmin.Resources.lostDataNotSavedMessage, actionToExecute);
                }
                else {
                    actionToExecute();
                }
            }
            isDataUpToDate() {
                return this.dataset.firstOrDefault(e => Business.DataStateHelper.getDataState(e) != Business.DataState.serialized) == null;
            }
            ensureUpToDate(action) {
                if (!this.isDataUpToDate()) {
                    NextAdmin.UI.MessageBox.createYesCancel(NextAdmin.Resources.formSaveRequiredTitle, NextAdmin.Resources.formSaveRequiredMessage, async () => {
                        let result = await this.save();
                        if (result.success) {
                            action(this.dataset);
                        }
                    });
                }
                else {
                    action(this.dataset);
                }
            }
            take(count) {
                throw new Error('Not implemented');
            }
            skip(count) {
                throw new Error('Not implemented');
            }
            orderBy(...columns) {
                throw new Error('Not implemented');
            }
            select(...columns) {
                throw new Error('Not implemented');
            }
            distinct(value = true) {
                throw new Error('Not implemented');
            }
            where(query, ...values) {
                throw new Error('Not implemented');
            }
            search(searchPropertyNames, seacrhValue) {
                throw new Error('Not implemented');
            }
            setQuery(queryData) {
                throw new Error('Not implemented');
            }
            getQuery() {
                throw new Error('Not implemented');
            }
            clone() {
                return new DatasetController_(this.options);
            }
        }
        Business.DatasetController = DatasetController;
        class DatasetController_ extends DatasetController {
        }
        Business.DatasetController_ = DatasetController_;
    })(Business = NextAdmin.Business || (NextAdmin.Business = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="DataController.ts"/>
/// <reference path="../EventHandler .ts"/>
var NextAdmin;
(function (NextAdmin) {
    var Business;
    (function (Business) {
        class EntityDataController extends Business.DataController {
            constructor(options) {
                super({
                    ...options
                });
                this.onLoadingEntity = new NextAdmin.EventHandler();
                this.entityLockKey = this.options.entityLockKey;
                this.loadAction = (dataId, actionResult) => {
                    let detailsToLoad = [];
                    for (let controlPropertyName in this.bindedControls) {
                        if (this.bindedControls.get(controlPropertyName) instanceof NextAdmin.UI.DataGrid) {
                            detailsToLoad.add(controlPropertyName);
                        }
                    }
                    let args = {
                        entityId: dataId,
                        entityName: this.options.dataName,
                        lockKey: this.entityLockKey,
                        detailToLoadNames: detailsToLoad
                    };
                    this.onLoadingEntity.dispatch(this, args);
                    this.options.entityClient.getEntity(args, (response) => {
                        let loadResult = {
                            success: response.code == NextAdmin.Models.ApiResponseCode.Success,
                            message: response.message,
                            data: response.entity,
                            code: response.code
                        };
                        let isPreviouslyLocked = this.isEntityLocked();
                        if (response.lockInfo) {
                            this._entityLockInfo = response.lockInfo;
                        }
                        if (this.entityLockKey && !this._entityLockInfo?.isOwner) {
                            this.enableReadOnly();
                        }
                        else if (isPreviouslyLocked) {
                            this.disableReadOnly();
                        }
                        actionResult(loadResult);
                    }, (response) => {
                        this.displayHTTPError(response, () => {
                            actionResult({ success: false });
                        });
                    });
                };
                let conflictAction = NextAdmin.Models.ConflictAction.cancel;
                this.saveAction = (data, actionResult) => {
                    let saveEntityArgs = {
                        entityName: this.options.dataName,
                        entity: data,
                        conflictAction: conflictAction,
                        lockKey: this.entityLockKey,
                    };
                    this.options.entityClient.saveEntity(saveEntityArgs, (response) => {
                        let saveResult = {
                            success: response.code == NextAdmin.Models.ApiResponseCode.Success,
                            errors: response.errors != null ? response.errors.select(e => ({ dataName: e.entityName, dataDisplayName: this.getDataInfo(e.entityName).displayName, dataId: e.entityId, propertyName: e.memberName, propertyDisplayName: this.getDataPropertyInfo_(e.entityName, e.memberName).displayName, message: e.message, errorCode: e.errorCode })) : [],
                            warnings: response.warings != null ? response.warings.select(e => ({ dataName: e.entityName, dataDisplayName: this.getDataInfo(e.entityName).displayName, dataId: e.entityId, propertyName: e.memberName, propertyDisplayName: this.getDataPropertyInfo_(e.entityName, e.memberName).displayName, message: e.message, errorCode: e.errorCode })) : [],
                            message: response.message,
                            newData: response.entity,
                            code: response.code
                        };
                        if (response.code == 'VERSION_CONFLICT') {
                            let msgBox = new NextAdmin.UI.MessageBox({
                                title: NextAdmin.Resources.overwriteDataTitle,
                                text: NextAdmin.Resources.overwriteDataMessage,
                                buttons: [
                                    new NextAdmin.UI.Button({
                                        text: NextAdmin.Resources.overwriteData,
                                        action: () => {
                                            conflictAction = NextAdmin.Models.ConflictAction.overwrite;
                                            this.saveAction(data, actionResult);
                                            conflictAction = NextAdmin.Models.ConflictAction.cancel;
                                            msgBox.close();
                                        }
                                    }),
                                    new NextAdmin.UI.Button({
                                        text: NextAdmin.Resources.cancel,
                                        action: () => {
                                            actionResult(saveResult);
                                            msgBox.close();
                                        }
                                    }),
                                ]
                            });
                            msgBox.open();
                            return;
                        }
                        actionResult(saveResult);
                        if (saveResult.success) {
                            this.dispatchEntityChanged({ entityName: this.options.dataName, previousEntity: data, newEntity: saveResult.newData, previousEntityState: data['_state'], newEntityState: Business.DataState.serialized });
                        }
                    }, (error) => {
                        this.displayHTTPError(error, () => {
                            actionResult({ success: false });
                        });
                    });
                };
                this.deleteAction = (data, actionResult) => {
                    this.options.entityClient.deleteEntity({ entityName: this.options.dataName, entityId: data[this.options.dataPrimaryKeyName] }, (response) => {
                        let deleteResult = {
                            success: response.code == NextAdmin.Models.ApiResponseCode.Success,
                            errors: response.errors != null ? response.errors.select(e => ({ dataName: e.entityName, dataDisplayName: this.getDataInfo(e.entityName).displayName, dataId: e.entityId, propertyName: e.memberName, propertyDisplayName: this.getDataPropertyInfo_(e.entityName, e.memberName).displayName, message: e.message, errorCode: e.errorCode })) : [],
                            warnings: response.warings != null ? response.warings.select(e => ({ dataName: e.entityName, dataDisplayName: this.getDataInfo(e.entityName).displayName, dataId: e.entityId, propertyName: e.memberName, propertyDisplayName: this.getDataPropertyInfo_(e.entityName, e.memberName).displayName, message: e.message, errorCode: e.errorCode })) : [],
                            message: response.message,
                            code: response.code
                        };
                        actionResult(deleteResult);
                        if (deleteResult.success) {
                            this.dispatchEntityChanged({ entityName: this.options.dataName, previousEntity: data, newEntity: null, previousEntityState: data['_state'], newEntityState: Business.DataState.deleted });
                        }
                    }, (error) => {
                        this.displayHTTPError(error, () => {
                            actionResult({ success: false });
                        });
                    });
                };
                this.appendAction = (actionResult) => {
                    this.options.entityClient.createEntity({ entityName: this.options.dataName }, (response) => {
                        actionResult({
                            success: response.code == NextAdmin.Models.ApiResponseCode.Success,
                            message: response.message,
                            data: response.entity,
                            code: response.code
                        });
                    });
                };
            }
            displayDataErrors(action, resultError, defaultErrorMessage, okAction) {
                let messageBox = super.displayDataErrors(action, resultError, defaultErrorMessage, okAction);
                if (action == Business.DataControllerActionType.delete && messageBox && this.data[this.options.dataPrimaryKeyName]) {
                    Business.EntityHelper.getLinkedEntities(this.options.entityClient, this.options.dataInfos, this.options.dataName, this.data[this.options.dataPrimaryKeyName]).then((linkedEntitiesInfos) => {
                        if (linkedEntitiesInfos?.length) {
                            messageBox.body.appendHTML('div', (container) => {
                                console.log('Coucou 3');
                                container.appendHTML('h3', 'Donnes lies :');
                                for (let linkedEntitiesInfo of linkedEntitiesInfos) {
                                    container.appendHTML('div', (title) => {
                                        title.style.fontWeight = 'bold';
                                        title.innerHTML = linkedEntitiesInfo.entityInfo.displayName ?? linkedEntitiesInfo.entityInfo.name;
                                    });
                                    for (let entity of linkedEntitiesInfo.entities) {
                                        container.appendHTML('div', (row) => {
                                            row.style.padding = '5px';
                                            let linkedEntityPrimaryKey = entity[linkedEntitiesInfo.entityInfo.getPrimaryKey()];
                                            if (linkedEntitiesInfo.entityInfo.displayPropertiesNames?.length) {
                                                row.appendControl(new NextAdmin.UI.Link({
                                                    text: linkedEntitiesInfo.entityInfo.displayPropertiesNames.select(a => entity[a]).join(' '),
                                                    action: () => {
                                                        messageBox.close();
                                                        NextAdmin.UI.DataFormModal_.formModalByDataNameFactory(linkedEntitiesInfo.entityInfo.name).open({ dataPrimaryKey: linkedEntityPrimaryKey });
                                                    }
                                                }));
                                            }
                                            else {
                                                row.innerHTML = linkedEntityPrimaryKey;
                                            }
                                        });
                                    }
                                }
                            });
                        }
                    });
                }
                return messageBox;
            }
            getEntityInfo() {
                return this.options.dataInfos.get(this.options.dataName);
            }
            getEntityLockInfo() {
                return this._entityLockInfo;
            }
            async tryLockEntity() {
                let entityPrimaryKey = this.getPrimaryKeyValue();
                if (entityPrimaryKey == null || this.entityLockKey == null) {
                    return null;
                }
                let response = await this.options.entityClient.tryLockEntity(this.options.dataName, entityPrimaryKey, this.entityLockKey);
                let lockEntityInfo = response?.data;
                if (lockEntityInfo && !lockEntityInfo.isOwner) {
                    this._entityLockInfo = lockEntityInfo;
                    this.enableReadOnly();
                }
                else if (this.isEntityLocked()) {
                    await this.load(this.getPrimaryKeyValue());
                }
                else {
                    this._entityLockInfo = lockEntityInfo;
                }
                return this._entityLockInfo;
            }
            async tryUnlockEntity() {
                let entityPrimaryKey = this.getPrimaryKeyValue();
                if (entityPrimaryKey == null || this.entityLockKey == null) {
                    return false;
                }
                let response = await this.options.entityClient.tryUnlockEntity(this.options.dataName, entityPrimaryKey, this.entityLockKey);
                if (response?.isSuccess) {
                    this._entityLockInfo = null;
                    return true;
                }
                return false;
            }
            isEntityLocked() {
                return this._entityLockInfo && !this._entityLockInfo.isOwner;
            }
            displayHTTPError(response, endDisplayFunc) {
                alert('HTTP Error : code : ' + response.status + ', message : ' + response.text);
                endDisplayFunc();
            }
            dispatchEntityChanged(args) {
                EntityDataController_.onEntityChanged.dispatch(this, args);
            }
        }
        EntityDataController.onEntityChanged = new NextAdmin.EventHandler();
        Business.EntityDataController = EntityDataController;
        class EntityDataController_ extends EntityDataController {
        }
        Business.EntityDataController_ = EntityDataController_;
    })(Business = NextAdmin.Business || (NextAdmin.Business = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="DatasetController.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var Business;
    (function (Business) {
        class EntityDatasetController extends Business.DatasetController_ {
            constructor(options) {
                super(options);
                this._where = null;
                this._whereValues = [];
                this._searchWhere = null;
                this._searchValues = [];
                this.loadAction = (actionResult) => {
                    let args = this.buildQuery();
                    this.options.entityClient.getEntities(args, (response) => {
                        let loadResult = {
                            success: response.code == NextAdmin.Models.ApiResponseCode.Success,
                            message: response.message,
                            dataset: response.entities,
                            code: response.code,
                        };
                        actionResult(loadResult);
                    }, (response) => {
                        this.displayHTTPError(response, () => {
                            actionResult({ success: false });
                        });
                    });
                };
                this.saveAction = (dataset, actionResult) => {
                    let saveEntitiesArgs = {
                        entityName: this.options.dataName,
                        entitiesToAddOrUpdate: dataset.where((e) => e['_state'] != Business.DataState.deleted),
                        entitiesToDeleteIds: dataset.where((e) => e['_state'] == Business.DataState.deleted).select(e => e[this.options.dataPrimaryKeyName])
                    };
                    this.options.entityClient.saveEntities(saveEntitiesArgs, (response) => {
                        let saveResult = {
                            success: response.code == NextAdmin.Models.ApiResponseCode.Success,
                            errors: response.errors != null ? response.errors.select(e => ({ dataName: e.entityName, dataDisplayName: this.getDataInfo(e.entityName).displayName, dataId: e.entityId, propertyName: e.memberName, propertyDisplayName: this.getDataPropertyInfo_(e.entityName, e.memberName).displayName, message: e.message, errorCode: e.errorCode })) : [],
                            warnings: response.warings != null ? response.warings.select(e => ({ dataName: e.entityName, dataDisplayName: this.getDataInfo(e.entityName).displayName, dataId: e.entityId, propertyName: e.memberName, propertyDisplayName: this.getDataPropertyInfo_(e.entityName, e.memberName).displayName, message: e.message, errorCode: e.errorCode })) : [],
                            message: response.message,
                            newDataset: response.entities,
                            code: response.code
                        };
                        actionResult(saveResult);
                    }, (response) => {
                        this.displayHTTPError(response, () => {
                            actionResult({ success: false });
                        });
                    });
                };
                this.appendAction = (actionResult) => {
                    this.options.entityClient.createEntity({ entityName: this.options.dataName }, (response) => {
                        let loadResult = {
                            success: response.code == NextAdmin.Models.ApiResponseCode.Success,
                            message: response.message,
                            data: response.entity,
                            code: response.code
                        };
                        actionResult(loadResult);
                    }, (response) => {
                        this.displayHTTPError(response, () => {
                            actionResult({ success: false });
                        });
                    });
                };
            }
            displayDataErrors(dataset, action, resultError, defaultErrorMessage, okAction) {
                let messageBox = super.displayDataErrors(dataset, action, resultError, defaultErrorMessage, okAction);
                if (action == Business.DataControllerActionType.delete && messageBox && dataset?.length == 1) {
                    Business.EntityHelper.getLinkedEntities(this.options.entityClient, this.options.dataInfos, this.options.dataName, dataset[0][this.options.dataPrimaryKeyName]).then((linkedEntitiesInfos) => {
                        if (linkedEntitiesInfos?.length) {
                            messageBox.body.appendHTML('div', (container) => {
                                container.appendHTML('h3', 'Donnes lies :');
                                for (let linkedEntitiesInfo of linkedEntitiesInfos) {
                                    container.appendHTML('div', (title) => {
                                        title.style.fontWeight = 'bold';
                                        title.innerHTML = linkedEntitiesInfo.entityInfo.displayName ?? linkedEntitiesInfo.entityInfo.name;
                                    });
                                    for (let entity of linkedEntitiesInfo.entities) {
                                        container.appendHTML('div', (row) => {
                                            row.style.padding = '5px';
                                            let linkedEntityPrimaryKey = entity[linkedEntitiesInfo.entityInfo.getPrimaryKey()];
                                            if (linkedEntitiesInfo.entityInfo.displayPropertiesNames?.length) {
                                                row.appendControl(new NextAdmin.UI.Link({
                                                    text: linkedEntitiesInfo.entityInfo.displayPropertiesNames.select(a => entity[a]).join(' '),
                                                    action: () => {
                                                        messageBox.close();
                                                        NextAdmin.UI.DataFormModal_.formModalByDataNameFactory(linkedEntitiesInfo.entityInfo.name).open({ dataPrimaryKey: linkedEntityPrimaryKey });
                                                    }
                                                }));
                                            }
                                            else {
                                                row.innerHTML = linkedEntityPrimaryKey;
                                            }
                                        });
                                    }
                                }
                            });
                        }
                    });
                }
                return messageBox;
            }
            displayHTTPError(response, endDisplayFunc) {
                alert('HTTP Error : code : ' + response.status + ', message : ' + response.text);
                endDisplayFunc();
            }
            buildQuery() {
                let where = '';
                if (!NextAdmin.String.isNullOrEmpty(this._where)) {
                    where = this._where;
                }
                if (!NextAdmin.String.isNullOrEmpty(this._searchWhere)) {
                    if (!NextAdmin.String.isNullOrEmpty(where)) {
                        where = '(' + where + ') AND (' + this._searchWhere + ')';
                    }
                    else {
                        where = this._searchWhere;
                    }
                }
                let whereValues = this._whereValues.clone();
                whereValues.addRange(this._searchValues);
                return {
                    entityName: this.options.dataName,
                    whereQuery: where,
                    whereQueryArgs: whereValues,
                    orderColumnNames: this._orderBy,
                    columnToSelectNames: this._columnsToSelect?.length == 0 ? null : this._columnsToSelect,
                    skipRecordCount: this._skip,
                    takeRecordCount: this._take,
                    isSelectDistinctQuery: this._distinct
                };
            }
            take(count) {
                this._take = count;
            }
            skip(count) {
                this._skip = count;
            }
            orderBy(...columns) {
                let orderBy = [];
                for (let column of columns) {
                    orderBy.add(column.name + (column.desc ? ' DESC' : ''));
                }
                this._orderBy = orderBy;
            }
            select(...columns) {
                this._columnsToSelect = columns;
            }
            distinct(value = true) {
                this._distinct = value;
            }
            where(query, ...values) {
                this._whereValues = [];
                for (let value of values) {
                    this._whereValues.add(value);
                }
                this._where = query;
                return this;
            }
            search(searchPropertyNames, seacrhValue) {
                this._searchWhere = '';
                this._searchValues = [];
                if (searchPropertyNames == null || searchPropertyNames.length == 0) {
                    return;
                }
                if (NextAdmin.String.isNullOrEmpty(seacrhValue)) {
                    return;
                }
                let seacrhParts = seacrhValue.split(' ');
                let i = 0;
                for (let seacrhPart of seacrhParts) {
                    if (seacrhPart == '' || seacrhPart == '')
                        continue;
                    if (i > 0) {
                        this._searchWhere += ' AND ';
                    }
                    this._searchWhere += '(';
                    let j = 0;
                    for (let searchmember of searchPropertyNames) {
                        if (j > 0) {
                            this._searchWhere += ' OR ';
                        }
                        this._searchWhere += 'LOWER(' + searchmember + ')' + ' LIKE LOWER(?)';
                        this._searchValues.add('%' + seacrhPart + '%');
                        j++;
                    }
                    this._searchWhere += ')';
                    i++;
                }
            }
            setQuery(queryData) {
                this._columnsToSelect = queryData.columnToSelectNames;
                this._orderBy = queryData.orderColumnNames;
                this._where = queryData.whereQuery;
                this._whereValues = queryData.whereQueryArgs;
                this._skip = queryData.skipRecordCount;
                this._take = queryData.takeRecordCount;
                this._distinct = queryData.isSelectDistinctQuery;
            }
            getQuery() {
                return {
                    columnToSelectNames: this._columnsToSelect,
                    orderColumnNames: this._orderBy,
                    whereQuery: this._where,
                    whereQueryArgs: this._whereValues,
                    skipRecordCount: this._skip,
                    takeRecordCount: this._take,
                    isSelectDistinctQuery: this._distinct
                };
            }
            clone() {
                let clone = new EntityDatasetController(this.options);
                clone._take = this._take;
                clone._skip = this._skip;
                clone._orderBy = this._orderBy;
                clone._columnsToSelect = this._columnsToSelect;
                clone._where = this._where;
                clone._whereValues = this._whereValues;
                clone._searchWhere = this._searchWhere;
                clone._searchValues = this._searchValues;
                return clone;
            }
        }
        Business.EntityDatasetController = EntityDatasetController;
    })(Business = NextAdmin.Business || (NextAdmin.Business = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var Business;
    (function (Business) {
        class QueryBuilder {
            constructor(query, writeQueryMode) {
                this.query = query ?? {};
                this.writeQueryMode = writeQueryMode;
            }
            clone() {
                return new QueryBuilder(NextAdmin.Copy.clone(this.query), this.writeQueryMode);
            }
            orderBy(...fields) {
                let _this = this.writeQueryMode == WriteQueryMode.keepOriginalQuery ? this : this.clone();
                if (_this.query.orderColumnNames?.length) {
                    _this.query.orderColumnNames.addRange(fields);
                }
                else {
                    _this.query.orderColumnNames = fields;
                }
                return _this;
            }
            skip(n) {
                let _this = this.writeQueryMode == WriteQueryMode.keepOriginalQuery ? this : this.clone();
                _this.query.skipRecordCount = n;
                return _this;
            }
            take(n) {
                let _this = this.writeQueryMode == WriteQueryMode.keepOriginalQuery ? this : this.clone();
                _this.query.takeRecordCount = n;
                return _this;
            }
            select(...fields) {
                let _this = this.writeQueryMode == WriteQueryMode.keepOriginalQuery ? this : this.clone();
                if (_this.query.columnToSelectNames?.length) {
                    _this.query.columnToSelectNames.addRange(fields);
                }
                else {
                    _this.query.columnToSelectNames = fields;
                }
                return _this;
            }
            distinct(value = true) {
                let _this = this.writeQueryMode == WriteQueryMode.keepOriginalQuery ? this : this.clone();
                _this.query.isSelectDistinctQuery = value;
                return _this;
            }
            where(query, ...args) {
                let _this = this.writeQueryMode == WriteQueryMode.keepOriginalQuery ? this : this.clone();
                if (NextAdmin.String.isNullOrWhiteSpace(_this.query.whereQuery)) {
                    _this.query.whereQuery = query;
                }
                else {
                    _this.query.whereQuery = '(' + _this.query.whereQuery + ')' + ' AND ' + query;
                }
                if (_this.query.whereQueryArgs == null) {
                    _this.query.whereQueryArgs = [];
                }
                for (let arg of args) {
                    _this.query.whereQueryArgs.add(arg);
                }
                return _this;
            }
            whereIn(clumn, ...args) {
                return this.where(clumn + ' IN(' + args.select(a => '?').join(',') + ')', ...args);
            }
            whereNotIn(clumn, ...args) {
                return this.where(clumn + ' NOT IN(' + args.select(a => '?').join(',') + ')', ...args);
            }
            search(search, ...clumns) {
                if (NextAdmin.String.isNullOrEmpty(search) || !clumns?.length) {
                    return this;
                }
                let values = [];
                let queryPart = [];
                for (let columns of clumns) {
                    queryPart.add('LOWER(' + columns + ')' + ' LIKE LOWER(?)');
                    values.add('%' + search + '%');
                }
                return this.where('(' + queryPart.join(' OR ') + ')', ...values);
            }
            searchMany(searches, clumns, mode = SearchManyMode.and) {
                if (!searches?.length || !clumns?.length) {
                    return this;
                }
                let query = '';
                let args = [];
                for (let search of searches) {
                    if (search == '' || search == '')
                        continue;
                    let queryPart = [];
                    for (let columns of clumns) {
                        queryPart.add('LOWER(' + columns + ')' + ' LIKE LOWER(?)');
                        args.add('%' + search + '%');
                    }
                    query += (!NextAdmin.String.isNullOrEmpty(query) ? (mode == SearchManyMode.and ? ' AND ' : ' OR ') : '') + '(' + queryPart.join(' OR ') + ')';
                }
                return this.where('(' + query + ')', args);
            }
            whereContains(clumn, search, invariantCase) {
                if (invariantCase) {
                    return this.where('LOWER(' + clumn + ')' + ' LIKE LOWER(?)', '%' + search + '%');
                }
                else {
                    return this.where(clumn + ' LIKE ?', '%' + search + '%');
                }
            }
            whereNotContains(clumn, search, invariantCase) {
                if (invariantCase) {
                    return this.where('LOWER(' + clumn + ')' + ' NOT LIKE LOWER(?)', '%' + search + '%');
                }
                else {
                    return this.where(clumn + ' NOT LIKE ?', '%' + search + '%');
                }
            }
            whereStartsWith(clumn, search, invariantCase) {
                if (invariantCase) {
                    return this.where('LOWER(' + clumn + ')' + ' LIKE LOWER(?)', search + '%');
                }
                else {
                    return this.where(clumn + ' LIKE ?', search + '%');
                }
            }
            whereEndsWith(clumn, search, invariantCase) {
                if (invariantCase) {
                    return this.where('LOWER(' + clumn + ')' + ' LIKE LOWER(?)', '%' + search);
                }
                else {
                    return this.where(clumn + ' LIKE ?', '%' + search);
                }
            }
            whereIsNullOrEmpty(clumn) {
                return this.where(clumn + ' IS NULL OR ' + clumn + ' = ?', '');
            }
            whereIsNotNullOrEmpty(clumn) {
                return this.where(clumn + ' IS NOT NULL AND ' + clumn + ' != ?', '');
            }
        }
        Business.QueryBuilder = QueryBuilder;
        let SearchManyMode;
        (function (SearchManyMode) {
            SearchManyMode[SearchManyMode["and"] = 0] = "and";
            SearchManyMode[SearchManyMode["or"] = 1] = "or";
        })(SearchManyMode = Business.SearchManyMode || (Business.SearchManyMode = {}));
        let WriteQueryMode;
        (function (WriteQueryMode) {
            WriteQueryMode[WriteQueryMode["instanciateNewQueryPerCommand"] = 0] = "instanciateNewQueryPerCommand";
            WriteQueryMode[WriteQueryMode["keepOriginalQuery"] = 1] = "keepOriginalQuery";
        })(WriteQueryMode = Business.WriteQueryMode || (Business.WriteQueryMode = {}));
    })(Business = NextAdmin.Business || (NextAdmin.Business = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="QueryBuilder.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var Business;
    (function (Business) {
        class DbSetHandler extends Business.QueryBuilder {
            constructor(entityName, entityClient, query, writeQueryMode) {
                super(query, writeQueryMode);
                this.entityName = entityName;
                this.entityClient = entityClient;
            }
            select(...fields) {
                return super.select(...fields);
            }
            distinct(value = true) {
                return super.distinct(value);
            }
            where(query, ...args) {
                return super.where(query, ...args);
            }
            whereIn(clumn, ...args) {
                return super.whereIn(clumn, ...args);
            }
            whereNotIn(clumn, ...args) {
                return super.whereNotIn(clumn, ...args);
            }
            search(search, ...clumns) {
                return super.search(search, ...clumns);
            }
            searchMany(searches, clumns, mode = Business.SearchManyMode.and) {
                return super.searchMany(searches, clumns, mode);
            }
            orderBy(...fields) {
                return super.orderBy(...fields);
            }
            skip(n) {
                return super.skip(n);
            }
            take(n) {
                return super.take(n);
            }
            clone() {
                return new DbSetHandler(this.entityName, this.entityClient, NextAdmin.Copy.clone(this.query), this.writeQueryMode);
            }
            async toArray(parameters) {
                let result = await this.entityClient.getEntities({
                    entityName: this.entityName,
                    skipRecordCount: this.query.skipRecordCount,
                    takeRecordCount: this.query.takeRecordCount,
                    whereQuery: this.query.whereQuery,
                    whereQueryArgs: this.query.whereQueryArgs,
                    columnToSelectNames: this.query.columnToSelectNames,
                    orderColumnNames: this.query.orderColumnNames,
                    isSelectDistinctQuery: this.query.isSelectDistinctQuery,
                    parameters: parameters
                });
                return result.entities;
            }
            async first(parameters) {
                let result = await this.entityClient.getEntities({
                    entityName: this.entityName,
                    skipRecordCount: this.query.skipRecordCount,
                    takeRecordCount: 1,
                    whereQuery: this.query.whereQuery,
                    whereQueryArgs: this.query.whereQueryArgs,
                    columnToSelectNames: this.query.columnToSelectNames,
                    orderColumnNames: this.query.orderColumnNames,
                    parameters: parameters
                });
                if (result.entities != null && result.entities.length > 0) {
                    return result.entities[0];
                }
                return null;
            }
            async addOrUpdate(entity, parameters) {
                return await this.entityClient.saveEntity({ entityName: this.entityName, entity: entity, parameters: parameters });
            }
            async addOrUpdateRange(entities, parameters) {
                return await this.entityClient.saveEntities({ entityName: this.entityName, entitiesToAddOrUpdate: entities, parameters: parameters });
            }
            async create(parameters) {
                return (await this.entityClient.createEntity({ entityName: this.entityName, parameters: parameters })).entity;
            }
            async delete(id, parameters) {
                return await this.entityClient.deleteEntity({ entityName: this.entityName, entityId: id, parameters: parameters });
            }
            async deleteRange(ids, parameters) {
                return await this.entityClient.saveEntities({ entityName: this.entityName, entitiesToDeleteIds: ids, parameters: parameters });
            }
            async get(id, parameters, detailToLoadNames) {
                if (id == null)
                    return null;
                return (await this.entityClient.getEntity({ entityName: this.entityName, entityId: id, parameters: parameters, detailToLoadNames: detailToLoadNames })).entity;
            }
            async count() {
                return (await this.entityClient.countEntities({ entityName: this.entityName, skipRecordCount: this.query.skipRecordCount, takeRecordCount: this.query.takeRecordCount, whereQuery: this.query.whereQuery, whereQueryArgs: this.query.whereQueryArgs, columnToSelectNames: this.query.columnToSelectNames, orderColumnNames: this.query.orderColumnNames })).data;
            }
            async sum(member) {
                return (await this.entityClient.sumEntities({ entityName: this.entityName, skipRecordCount: this.query.skipRecordCount, takeRecordCount: this.query.takeRecordCount, whereQuery: this.query.whereQuery, whereQueryArgs: this.query.whereQueryArgs, columnToSelectNames: this.query.columnToSelectNames, orderColumnNames: this.query.orderColumnNames })).data;
            }
            async min(propertyName) {
                return (await this.entityClient.minEntities({ entityName: this.entityName, skipRecordCount: this.query.skipRecordCount, takeRecordCount: this.query.takeRecordCount, whereQuery: this.query.whereQuery, whereQueryArgs: this.query.whereQueryArgs, columnToSelectNames: propertyName ? [propertyName] : this.query.columnToSelectNames, orderColumnNames: this.query.orderColumnNames })).data;
            }
            async max(propertyName) {
                return (await this.entityClient.maxEntities({ entityName: this.entityName, skipRecordCount: this.query.skipRecordCount, takeRecordCount: this.query.takeRecordCount, whereQuery: this.query.whereQuery, whereQueryArgs: this.query.whereQueryArgs, columnToSelectNames: propertyName ? [propertyName] : this.query.columnToSelectNames, orderColumnNames: this.query.orderColumnNames })).data;
            }
        }
        Business.DbSetHandler = DbSetHandler;
        class EntityDbSetHandler extends DbSetHandler {
            constructor(entityInfo, entityClient, query, writeQueryMode) {
                super(entityInfo.name, entityClient, query, writeQueryMode);
                this.entityInfo = entityInfo;
            }
            clone() {
                return new EntityDbSetHandler(this.entityInfo, this.entityClient, NextAdmin.Copy.clone(this.query), this.writeQueryMode);
            }
            getPropertyName(dataDefPropertyAction) {
                return this.entityInfo.getPropertyName(dataDefPropertyAction);
            }
            async toArray_(property, parameters) {
                let entities = await this.toArray(parameters);
                if (!entities?.length) {
                    return null;
                }
                let propertyName = this.entityInfo.getPropertyName(property);
                return entities.select(a => a[propertyName]);
            }
            async first_(property, parameters) {
                let entity = await this.first(parameters);
                if (entity == null) {
                    return null;
                }
                return entity[this.entityInfo.getPropertyName(property)];
            }
            select(...fields) {
                return super.select(...fields);
            }
            distinct(value = true) {
                return super.distinct(value);
            }
            where(query, ...args) {
                return super.where(query, ...args);
            }
            orderBy(...fields) {
                return super.orderBy(...fields);
            }
            skip(n) {
                return super.skip(n);
            }
            take(n) {
                return super.take(n);
            }
            where_(property, operator, value) {
                return super.where(this.entityInfo.getPropertyName(property) + ' ' + operator + ' ?', value);
            }
            whereIn_(property, ...args) {
                return super.whereIn(this.entityInfo.getPropertyName(property), ...args);
            }
            whereNotIn_(property, ...args) {
                return super.whereNotIn(this.entityInfo.getPropertyName(property), ...args);
            }
            whereContains_(property, search, invariantCase) {
                return super.whereContains(this.entityInfo.getPropertyName(property), search, invariantCase);
            }
            whereNotContains_(property, search, invariantCase) {
                return super.whereNotContains(this.entityInfo.getPropertyName(property), search, invariantCase);
            }
            whereStartsWith_(property, search, invariantCase) {
                return super.whereStartsWith(this.entityInfo.getPropertyName(property), search, invariantCase);
            }
            whereEndsWith_(property, search, invariantCase) {
                return super.whereEndsWith(this.entityInfo.getPropertyName(property), search, invariantCase);
            }
            whereIsNullOrEmpty_(property) {
                return this.whereIsNullOrEmpty(this.entityInfo.getPropertyName(property));
            }
            whereIsNotNullOrEmpty_(property) {
                return this.whereIsNotNullOrEmpty(this.entityInfo.getPropertyName(property));
            }
            search_(search, ...properties) {
                let fieldNames = [];
                for (let field of properties) {
                    fieldNames.add(this.entityInfo.getPropertyName(field));
                }
                return super.search(search, ...fieldNames);
            }
            searchMany_(searches, properties, mode = Business.SearchManyMode.and) {
                let fieldNames = [];
                for (let field of properties) {
                    fieldNames.add(this.entityInfo.getPropertyName(field));
                }
                return super.searchMany(searches, fieldNames, mode);
            }
            orderBy_(...properties) {
                let fieldNames = [];
                for (let field of properties) {
                    fieldNames.add(this.entityInfo.getPropertyName(field));
                }
                return super.orderBy(...fieldNames);
            }
            orderByDesc_(...properties) {
                let fieldNames = [];
                for (let field of properties) {
                    fieldNames.add(this.entityInfo.getPropertyName(field) + ' DESC');
                }
                return super.orderBy(...fieldNames);
            }
            select_(...properties) {
                let fieldNames = [];
                for (let field of properties) {
                    fieldNames.add(this.entityInfo.getPropertyName(field));
                }
                return super.select(...fieldNames);
            }
            selectMany_(properties) {
                return super.select(...this.entityInfo.getPropertyNames(properties));
            }
            async getRange(ids, dataDefPropertyAction, parameters) {
                if (ids == null)
                    return null;
                return await this.where((dataDefPropertyAction ? this.entityInfo.getPropertyName(dataDefPropertyAction) : this.entityInfo.getPrimaryKey()) + ' IN(' + ids.select(a => '?').join(',') + ')', ...ids.select(a => a)).toArray(parameters);
            }
            async min_(property) {
                return this.min(this.entityInfo.getPropertyName(property));
            }
            async max_(property) {
                return this.max(this.entityInfo.getPropertyName(property));
            }
        }
        Business.EntityDbSetHandler = EntityDbSetHandler;
    })(Business = NextAdmin.Business || (NextAdmin.Business = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var Business;
    (function (Business) {
        class EntityHelper {
            static async getLinkedEntities(entityClient, entittyInfos, entityName, entityPrimaryKey) {
                let linkedEntittiesInfos = new Array();
                for (let entityInfo of entittyInfos.getValues()) {
                    let foreignEntityLinkedMember = entityInfo.propertyInfos.getValues().where(a => a.foreignDataRelationName == entityName);
                    if (foreignEntityLinkedMember.length > 0) {
                        let foreignEntityDbset = new Business.DbSetHandler(entityInfo.name, entityClient);
                        let linkedEntities = await foreignEntityDbset.where(foreignEntityLinkedMember.select(a => a.name + ' = ' + "'" + entityPrimaryKey + "'").join(' OR ')).toArray();
                        if (linkedEntities.length > 0) {
                            linkedEntittiesInfos.add({
                                entityInfo: entityInfo,
                                entities: linkedEntities
                            });
                        }
                    }
                }
                return linkedEntittiesInfos;
            }
        }
        Business.EntityHelper = EntityHelper;
    })(Business = NextAdmin.Business || (NextAdmin.Business = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="../Dictionary.ts" />
var NextAdmin;
(function (NextAdmin) {
    var Business;
    (function (Business) {
        class EntityInfos extends NextAdmin.Dictionary {
            constructor(entitiesInfo) {
                super(null);
                for (let entityInfo of entitiesInfo) {
                    this.add(entityInfo.entityName, new EntityInfo_(entityInfo));
                }
            }
            getEntityPrimaryKey(entityName) {
                let entityInfo = this.get(entityName);
                if (entityInfo == null)
                    return null;
                return entityInfo.getPrimaryKey();
            }
            getMemberInfo(entityName, memberName) {
                let entityInfo = this.get(entityName);
                if (entityInfo == null) {
                    return null;
                }
                let memberInfo = entityInfo.propertyInfos.get(memberName);
                return memberInfo;
            }
        }
        Business.EntityInfos = EntityInfos;
        class EntityInfo {
            constructor(data) {
                this._primaryKey = null;
                this.name = data.entityName;
                this.tableName = data.entityTableName;
                this.displayName = data.entityDisplayName;
                this.entityParentNames = data.entityParentNames;
                this.displayPropertiesNames = data.displayMembersNames;
                this.propertyInfos = new NextAdmin.Dictionary();
                for (let key in data.membersInfos) {
                    let entityMemberInfo = data.membersInfos[key];
                    this.propertyInfos.add(key, {
                        dataName: this.name,
                        name: entityMemberInfo.memberName,
                        displayName: entityMemberInfo.memberDisplayName,
                        type: entityMemberInfo.memberType,
                        isPrimaryKey: entityMemberInfo.isPrimaryKey,
                        isRequired: entityMemberInfo.isRequired,
                        values: entityMemberInfo.memberValues,
                        foreignDataName: entityMemberInfo.foreignEntityName,
                        foreignDataRelationName: entityMemberInfo.foreignEntityRelationName,
                        isQueryable: entityMemberInfo.isQueryable
                    });
                }
            }
            getEntityDef() {
                if (this._dataDef == null) {
                    this._dataDef = {};
                    for (let propertyName in this.propertyInfos) {
                        this._dataDef[propertyName] = propertyName;
                    }
                }
                return this._dataDef;
            }
            getPropertyName(dataDefPropertyAction) {
                return dataDefPropertyAction(this.getEntityDef());
            }
            getPropertyNames(dataDefPropertyAction) {
                return dataDefPropertyAction(this.getEntityDef());
            }
            getPropertyInfo(dataDefPropertyAction) {
                return this.propertyInfos[this.getPropertyName(dataDefPropertyAction)];
            }
            getPrimaryKey() {
                if (this._primaryKey == null) {
                    for (let memberInfo of this.propertyInfos.getValues()) {
                        if (memberInfo.isPrimaryKey) {
                            this._primaryKey = memberInfo.name;
                            break;
                        }
                    }
                }
                return this._primaryKey;
            }
        }
        Business.EntityInfo = EntityInfo;
        class EntityInfo_ extends EntityInfo {
        }
        Business.EntityInfo_ = EntityInfo_;
    })(Business = NextAdmin.Business || (NextAdmin.Business = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var Models;
    (function (Models) {
        let ApiResponseCode;
        (function (ApiResponseCode) {
            ApiResponseCode["Success"] = "Success";
            ApiResponseCode["AuthError"] = "AuthError";
            ApiResponseCode["PermissionLevelError"] = "PermissionLevelError";
            ApiResponseCode["SQLError"] = "SQLError";
            ApiResponseCode["ValidationError"] = "ValidationError";
        })(ApiResponseCode = Models.ApiResponseCode || (Models.ApiResponseCode = {}));
    })(Models = NextAdmin.Models || (NextAdmin.Models = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var Models;
    (function (Models) {
        let ConflictAction;
        (function (ConflictAction) {
            ConflictAction[ConflictAction["overwrite"] = 0] = "overwrite";
            ConflictAction[ConflictAction["cancel"] = 1] = "cancel";
        })(ConflictAction = Models.ConflictAction || (Models.ConflictAction = {}));
    })(Models = NextAdmin.Models || (NextAdmin.Models = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var Models;
    (function (Models) {
        let UpdateEntityActionType;
        (function (UpdateEntityActionType) {
            UpdateEntityActionType[UpdateEntityActionType["create"] = 1] = "create";
            UpdateEntityActionType[UpdateEntityActionType["update"] = 2] = "update";
            UpdateEntityActionType[UpdateEntityActionType["delete"] = 3] = "delete";
        })(UpdateEntityActionType = Models.UpdateEntityActionType || (Models.UpdateEntityActionType = {}));
    })(Models = NextAdmin.Models || (NextAdmin.Models = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="../ResourcesManager.ts"/>
var NextAdmin;
(function (NextAdmin) {
    class ResourcesBase extends NextAdmin.ResourcesManager {
        constructor() {
            super(...arguments);
            this.refreshIcon = "";
            this.backIcon = "";
            this.addIcon = "+";
            this.downloadIcon = '';
            this.printIcon = '';
            this.saveIcon = "";
            this.deleteIcon = "";
            this.removeIcon = "";
            this.clearIcon = '';
            this.openIcon = "";
            this.checkIcon = "";
            this.cogIcon = '';
            this.searchIcon = "";
            this.iconCaretDown = "";
            this.iconCaretLeft = "";
            this.iconCaretRight = "";
            this.menuIcon = '';
            this.keyIcon = '';
            this.emailIcon = '';
            this.lockIcon = '';
            this.noDataIcon = '';
            this.copyIcon = '';
            this.dragIcon = '';
            this.closeIcon = '';
            this.linkIcon = '';
            this.warningIcon = '!';
        }
    }
    NextAdmin.ResourcesBase = ResourcesBase;
})(NextAdmin || (NextAdmin = {}));
/// <reference path="ResourcesBase.ts"/>
var NextAdmin;
(function (NextAdmin) {
    class NextAdminIcons extends NextAdmin.ResourcesBase {
        constructor() {
            super(...arguments);
            this.addIcon = '<i class="fas fa-plus"></i>';
            this.downloadIcon = '<i class="fas fa-download"></i>';
            this.printIcon = '<i class="fas fa-print"></i>';
            this.saveIcon = '<i class="fas fa-save"></i>';
            this.deleteIcon = '<i class="fas fa-trash-alt"></i>';
            this.removeIcon = '<i class="fas fa-times"></i>';
            this.closeIcon = '<i class="fas fa-times"></i>';
            this.clearIcon = '<i class="fas fa-eraser"></i>';
            this.checkIcon = '<i class="fas fa-check"></i>';
            this.cogIcon = '<i class="fas fa-cog"></i>';
            this.openIcon = '<i class="far fa-edit"></i>';
            this.refreshIcon = '<i class="fas fa-sync"></i>';
            this.searchIcon = '<i class="fas fa-search"></i>';
            this.menuIcon = '<i class="fas fa-bars"></i>';
            this.iconCaretDown = '<i class="fas fa-angle-down"></i>';
            this.iconCaretLeft = '<i class="fas fa-angle-left"></i>';
            this.iconCaretRight = '<i class="fas fa-angle-right"></i>';
            this.keyIcon = '<i class="fas fa-key"></i>';
            this.emailIcon = '<i class="fas fa-envelope"></i>';
            this.lockIcon = '<i class="fas fa-lock"></i>';
            this.noDataIcon = '<i class="fas fa-database"></i>';
            this.copyIcon = '<i class="fa-solid fa-copy"></i>';
            this.dragIcon = '<i class="fas fa-grip-vertical"></i>';
            this.backIcon = '<i class="fas fa-arrow-alt-left"></i>';
            this.linkIcon = '<i class="fas fa-link"></i>';
            this.warningIcon = '<i class="fas fa-exclamation-triangle"></i>';
        }
    }
    NextAdmin.NextAdminIcons = NextAdminIcons;
})(NextAdmin || (NextAdmin = {}));
/// <reference path="ResourcesBase.ts"/>
var NextAdmin;
(function (NextAdmin) {
    class ResourcesEn extends NextAdmin.ResourcesBase {
        constructor() {
            super(...arguments);
            this.save = "Save";
            this.delete = "Delete";
            this.deleteEntry = "Delete entry";
            this.stopUseEntry = "Do not use this entry anymore";
            this.remove = "Remove";
            this.deleteMulti = "Delete selected rows";
            this.yes = "Yes";
            this.no = "No";
            this.cancel = "Cancel";
            this.refresh = "Refresh";
            this.add = "Add";
            this.overwriteDataTitle = "Data overwrite";
            this.overwriteDataMessage = "The data currently being recorded has been updated. By proceeding, you run the risk of erasing some of the previous modifications.What would you like to do? ";
            this.overwriteData = "Overwrite data";
            this.a = "a";
            this.back = "Back";
            this.warning = "Warning";
            this.error = "Error";
            this.unknownError = "An unknown error has occurred.";
            this.success = "Success";
            this.search = "Search";
            this.lostDataNotSavedMessage = 'If you validate, not saved data will be lost, what do you want to do ?';
            this.formDeleteMessageTitle = 'Delete data';
            this.formDeleteMessage = 'If you validate, data will be permanently deleted, do you want to tontinue ?';
            this.formSaveRequiredTitle = "Save required";
            this.formSaveRequiredMessage = "You need to save date to execute this action, do you want to save it now ?";
            this.requiredField = "This field is required";
            this.saveAndContinue = "Save and continue";
            this.discardAndContinue = "Discard changed and continue";
            this.actions = 'Actions';
            this.menu = 'Menu';
            this.systemViewName = 'System view';
            this.createNewView = 'Create new view';
            this.editView = 'Edit view';
            this.deleteView = 'Delete view';
            this.setAsDefaultView = 'Set as default view';
            this.addColumn = 'Add column';
            this.addOperator = 'Add operator';
            this.addFunction = 'Add function';
            this.addFilterValue = 'Add filter value';
            this.isNotNull = "Is not null";
            this.isNull = "Is null";
            this.contains = "Contains";
            this.addValue = 'Add value';
            this.viewEditor = 'View editor';
            this.viewName = 'View name';
            this.defaultView = 'Default view';
            this.defaultUserViewName = 'User view';
            this.columnName = 'Column';
            this.control = 'Control';
            this.editable = 'Editable';
            this.columnLabel = 'Custom label';
            this.columnOrdering = 'Ordering';
            this.manualOrderingColumn = 'Manual ordering column';
            this.columnSize = 'Width';
            this.auto = 'Auto.';
            this.filterQuery = 'Query';
            this.unableToDeleteDataMessage = "Unable to delete this element, it's probably kinked to another element.";
            this.defaultDeleteError = "An error occured, it's probably due to the impossibiliy to delete element(s).";
            this.validate = "Validate";
            this.validateNew = "Validate & new";
            this.export = "Export";
            this.dataExportConfig = "Config data export";
            this.format = "Format";
            this.fieldName = "Fields names";
            this.label = 'Label';
            this.filterName = 'Filter name';
            this.filters = 'Filters';
            this.userFilters = 'User filters';
            this.realName = 'Real name';
            this.print = 'Print';
            this.generateDocument = 'Generate document';
            this.printAll = 'All items';
            this.printSelection = 'Select items';
            this.valueFormat = "Values format";
            this.rawValue = 'Raw value';
            this.displayValue = 'Display value';
            this.columns = 'Columns';
            this.all = 'All';
            this.visible = 'Visible';
            this.selection = 'Selection';
            this.data = 'Data';
            this.list = 'List';
            this.primaryKey = 'Primary key';
            this.linkTo = 'Link to';
            this.rowCount = "Row count";
            this.columnCount = "Column count";
            this.appendControl = "Append control";
            this.fillAllFieldsMessage = "Please fill all fields.";
            this.addNewItems = "+ Add items";
            this.addNewItemsText = "You can add multiple values by separating themes by ";
            this.open = 'Open';
            this.openEntry = 'Open entry';
            this.newEntry = 'New fiche';
            this.start = 'Start';
            this.end = 'End';
            this.min = 'Min';
            this.max = 'Max';
            this.standardListExport = 'Default list export';
            this.clearFilter = "Clear filter";
            this.loading = 'Loading';
            this.close = 'Close';
            this.pleaseWait = "Please wait while the operation is running...";
            this.unauthorizedAction = "This action is not allowed";
            this.filterConfiguration = 'Filter configuration';
            this.configure = "Configure";
            this.dataSelector = 'Data selector';
            this.valueSelector = 'Single value selector';
            this.multiValuesSelector = 'Multi values selector';
            this.signIn = "Sign-in";
            this.signUp = "Sign-up";
            this.confirmEmail = "Confirm e-mail";
            this.login = 'E-mail';
            this.password = 'Password';
            this.rememberMe = 'Remember me';
            this.noAccount = "Don't have an account?";
            this.haveAnAccount = "Have an account?";
            this.createAccount = 'Create an account';
            this.forgottenPassword = 'Forgotten password';
            this.recoverPassword = "Recover password";
            this.recoverMyPassword = "Recover my password";
            this.invalidPassword = "Invalid password";
            this.invalidEmail = "Invalid email address";
            this.unableToSendEmail = "Unable to send email, please check your email adresse";
            this.userAlreadyExist = "User already exist";
            this.confirmationCode = "Confirmation code";
            this.confirmationCodeMessage = "A confirmation code has been sent to you at the address indicated";
            this.invalidCredentials = "Invalid credentials";
            this.readOnlyMode = "Read only";
            this.readOnlyDefaultMessage = "This action is not allowed because this record is read-only.";
            this.error_passwordAreNotSame = 'Passwords are not the sames.';
            this.error_invalidPassword = 'Password must be composed by 8 to 64 alphanumeric characters';
            this.passwordChanged = 'Password updated';
            this.newPassword = 'New password';
            this.newPasswordRepeat = 'Repeat password';
            this.currentPassword = 'Current password';
            this.changePasswordModalTitle = 'Change password';
            this.changeEmailModalTitle = 'Change email';
            this.newEmail = 'New e-mail';
            this.noDataAvailable = 'No data available';
            this.copy = 'Copy';
            this.errprMaximumPublishedProject = "You have reached the maximum number of publications allowed, please upgrade your offer to publish more projects.";
            this.unamed = 'Unnamed';
            this.emailSent = 'Email sent';
            this.recoverPasswordSuccess = "Un e-mail vous a t envoy avec un nouveau mot de passe.";
            this.recoverPasswordInvalidEmail = 'An email has been sent to you with a new password.';
            this.recoverPasswordDefaultError = "An error occurred while sending the recovery email, this error has been forwarded to our technical services.";
            this.newData = "New data";
        }
    }
    NextAdmin.ResourcesEn = ResourcesEn;
    NextAdmin.Resources = new ResourcesEn();
})(NextAdmin || (NextAdmin = {}));
/// <reference path="ResourcesEn.ts"/>
var NextAdmin;
(function (NextAdmin) {
    class ResourcesFr extends NextAdmin.ResourcesEn {
        constructor() {
            super(...arguments);
            this.save = "Enregistrer";
            this.delete = "Supprimer";
            this.deleteEntry = "Supprimer la fiche";
            this.stopUseEntry = "Ne plus utiliser cette fiche";
            this.remove = "Retirer";
            this.deleteMulti = "Sup. la slection";
            this.yes = "Oui";
            this.refresh = "Actualiser";
            this.no = "Non";
            this.cancel = "Annuler";
            this.add = "Ajouter";
            this.overwriteDataTitle = "crasement de donnes";
            this.overwriteDataMessage = "Les donnes actuellement en cours d'enregistrement ont t mises  jour. En poursuivant, vous courez le risque d'effacer une partie des modifications prcdentes. Que souhaitez-vous faire ?";
            this.overwriteData = "craser les donnes";
            this.a = "un";
            this.back = "Retour";
            this.warning = "Attention";
            this.error = "Erreur";
            this.unknownError = "Une erreur inconnue s'est produite.";
            this.success = "Succs";
            this.search = "Recherche";
            this.lostDataNotSavedMessage = 'Si vous continuez, les donnes non sauvegardes pourraient tre perdues, que voulez-vous faire?';
            this.formDeleteMessageTitle = 'Suppression dfinitive';
            this.formDeleteMessage = 'Si vous validez, cet lment sera supprim de manire permanente, voulez-vous continuer ?';
            this.formSaveRequiredTitle = "Enregistrement requis";
            this.formSaveRequiredMessage = "Vous devez enregistrer l'lment courant pour pouvoir effectuer cette action, voulez-vous enregistrer maintenant ?";
            this.requiredField = "Le champ est requis";
            this.saveAndContinue = "Enregistrer et continuer";
            this.discardAndContinue = "Continuer sans enregistrer";
            this.actions = 'Actions';
            this.menu = 'Menu';
            this.systemViewName = 'Vue systme';
            this.createNewView = 'Crer une nouvelle vue';
            this.editView = 'diter la vue actuelle';
            this.deleteView = 'Supprimer la vue actuelle';
            this.setAsDefaultView = 'Dfinir comme vue par dfaut';
            this.addColumn = 'Ajouter une colonne';
            this.addOperator = 'Ajouter un oprateur';
            this.addValue = 'Ajouter une valeur';
            this.addFunction = '+ Ajouter une fonction';
            this.addFilterValue = 'Ajouter une valeur de filtre';
            this.isNotNull = "N'est pas null";
            this.isNull = "Est null";
            this.contains = "Contient";
            this.viewEditor = 'Editeur de vue';
            this.viewName = 'Nom de la vue';
            this.defaultView = 'Vue par dfaut';
            this.defaultUserViewName = 'Vue utilisateur';
            this.columnName = 'Colonne';
            this.control = 'Contrle';
            this.editable = 'ditable';
            this.columnOrdering = 'Tri';
            this.manualOrderingColumn = 'Colonne de tri manuel';
            this.columnLabel = 'Libell perso.';
            this.columnSize = 'Largeur';
            this.auto = 'Auto.';
            this.filterQuery = 'Requte';
            this.unableToDeleteDataMessage = "Impossible de supprimer cet lment, il est probablement li  un autre lment.";
            this.defaultDeleteError = "Une erreur s'est produite, cela est probablement d  l'impossibilit de supprimer un ou plusieurs lments.";
            this.validate = "Valider";
            this.validateNew = "Valider & nouveau";
            this.export = "Exporter";
            this.dataExportConfig = "Configuration de l'export";
            this.format = "Format";
            this.fieldName = "Intiul des champs";
            this.label = 'Libell';
            this.filterName = 'Nom du filtre';
            this.filters = 'Filtres';
            this.userFilters = 'Filtres utilisateur';
            this.realName = 'Nom rel';
            this.print = 'Imprimer';
            this.generateDocument = 'Gnrer un document';
            this.printAll = 'Tous les lments';
            this.printSelection = 'lments slectionns';
            this.valueFormat = "Format des donnes";
            this.rawValue = 'Valeur brute';
            this.displayValue = 'Valeur formate';
            this.columns = 'Colonnes';
            this.all = 'Tout';
            this.visible = 'Visibles';
            this.selection = 'Slection';
            this.data = 'Donnes';
            this.list = 'Liste';
            this.primaryKey = 'Cl primaire';
            this.linkTo = 'Lien vers';
            this.rowCount = "Nombre de lignes";
            this.columnCount = "Nombre de colonnes";
            this.appendControl = "Ajouter un contrle";
            this.fillAllFieldsMessage = "Veuillez remplir tous les champs.";
            this.addNewItems = "+ Ajout de nouveaux lments";
            this.addNewItemsText = "Vous pouvez ajouter plusieurs lments en les sparant par des ";
            this.open = 'Ouvrir';
            this.openEntry = 'Ouvrir la fiche';
            this.newEntry = 'Nouvelle fiche';
            this.start = 'Dbut';
            this.end = 'Fin';
            this.min = 'Min';
            this.max = 'Max';
            this.standardListExport = 'Export de liste standard';
            this.loading = 'Chargement';
            this.pleaseWait = "Veuillez patienter durant l'excution de l'opration...";
            this.unauthorizedAction = "Cette action n'est pas autorise";
            this.close = 'Fermer';
            this.filterConfiguration = 'Configuration des filtres';
            this.configure = "Configurer";
            this.dataSelector = 'Slecteur de donnes';
            this.valueSelector = 'Slecteur de valeur';
            this.multiValuesSelector = 'Slecteur de valeurs multiple';
            this.clearFilter = "Vider le filtre";
            this.iconCaretDown = "";
            this.iconCaretLeft = "";
            this.menuIcon = '';
            this.signIn = "Connexion";
            this.signUp = "Cration de compte";
            this.confirmEmail = "Vrifier mon adresse e-mail";
            this.login = 'E-mail';
            this.password = 'Mot de passe';
            this.rememberMe = 'Rester connect';
            this.noAccount = "Pas encore de compte ?";
            this.haveAnAccount = "Dj un compte?";
            this.forgottenPassword = 'Mot de passe oubli';
            this.createAccount = 'Crer un compte';
            this.keyIcon = '';
            this.invalidPassword = "Mot de passe invalide";
            this.invalidEmail = "Adresse email invalide";
            this.unableToSendEmail = "Impossible de vous envoyer le code confirmation, veuillez vrifier votre adresse.";
            this.userAlreadyExist = "Cette adresse email est dj utilise";
            this.confirmationCode = "Code de confirmation";
            this.confirmationCodeMessage = "Un code de confirmation vous a t envoy  l'adresse indique";
            this.invalidCredentials = "Identifiants invalides";
            this.readOnlyMode = "Lecture seule";
            this.readOnlyDefaultMessage = " Cette action n'est pas autorise car cette fiche est en lecture seule.";
            this.error_passwordAreNotSame = 'Les mots de passe ne sont pas identiques';
            this.error_invalidPassword = 'Le mot de passe doit comprendre entre 8 et 64 carractres alphanumriques.';
            this.passwordChanged = 'Le mot de passe a t modifi';
            this.newPassword = 'Nouveau mot de passe';
            this.newPasswordRepeat = 'Rpeter le mot de passe';
            this.currentPassword = 'Mot de passe actuel';
            this.changePasswordModalTitle = 'Modification du mot passe';
            this.changeEmailModalTitle = 'Modification de votre adresse e-mail';
            this.newEmail = 'Nouvelle adresse e-mail';
            this.noDataAvailable = 'Aucune donne disponible';
            this.noDataIcon = '';
            this.copyIcon = '';
            this.copy = 'Copier';
            this.errprMaximumPublishedProject = "Vous avez atteint le nombre maximum de publication autoris, veuillez mettre niveau votre offre pour publier davantage de projets.";
            this.unamed = 'Sans nom';
            this.recoverPassword = "Rcupration de mot de passe";
            this.recoverMyPassword = "Rcuprer mon mot de passe";
            this.emailSent = 'E-mail envoy';
            this.recoverPasswordSuccess = "Un e-mail vous a t envoy avec un nouveau mot de passe.";
            this.recoverPasswordInvalidEmail = 'Aucun compte ne semble associ  cette adresse e-mail.';
            this.recoverPasswordDefaultError = "Une erreur est survenue lors de l'envoi de l'email de rcupration, cette erreur a t transmise  nos services techniques.";
            this.newData = "Nouvelle donne";
        }
    }
    NextAdmin.ResourcesFr = ResourcesFr;
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var Services;
    (function (Services) {
        class HttpClient {
            constructor(rootURL = "") {
                this.headerParams = {};
                this.rootURL = rootURL;
            }
            postJson(url, params = {}, responseAction, progressAction, beforeSend) {
                return this.send({
                    async: true,
                    url: url,
                    method: HttpMethod.POST,
                    bodyFormat: BodyFormat.JSON,
                    body: params
                }, responseAction, progressAction, beforeSend);
            }
            postForm(url, params = {}, responseAction, progressAction, beforeSend) {
                return this.send({
                    async: true,
                    url: url,
                    method: HttpMethod.POST,
                    bodyFormat: BodyFormat.FORM,
                    body: params
                }, responseAction, progressAction, beforeSend);
            }
            get(url, params = {}, responseAction, progressAction, beforeSend) {
                return this.send({
                    async: true,
                    url: url,
                    method: HttpMethod.GET,
                    urlParams: params
                }, responseAction, progressAction, beforeSend);
            }
            async fetch(url, options) {
                options = {
                    method: options?.jsonData || options?.headerData || Object.keys(this.headerParams) ? HttpMethod.POST : HttpMethod.GET,
                    cors: true,
                    ...options
                };
                let finalUrl = NextAdmin.Path.combine(this.rootURL, url);
                if (options.queryArgs) {
                    let arrayArgs = new Array();
                    for (let args in options.queryArgs) {
                        arrayArgs.push(encodeURI(args + '=' + options.queryArgs[args]));
                    }
                    if (arrayArgs.length > 0) {
                        finalUrl += '?' + arrayArgs.join('&');
                    }
                }
                let header = {};
                if (this.headerParams) {
                    NextAdmin.Copy.copyTo(this.headerParams, header);
                }
                if (options.headerData) {
                    NextAdmin.Copy.copyTo(options.headerData, header);
                }
                return await fetch(finalUrl, {
                    method: options.method,
                    mode: options.cors ? "cors" : null,
                    headers: header,
                    body: options.jsonData != null ? JSON.stringify(options.jsonData) : null
                });
            }
            async fetchJson(url, options) {
                let response = await this.fetch(url, options);
                if (!response.ok) {
                    throw new Error('Unable to fetch ' + url + ', server return :' + response.status);
                }
                return await response.json();
            }
            async fetchText(url, options) {
                let response = await this.fetch(url, options);
                if (!response.ok) {
                    throw new Error();
                }
                return await response.text();
            }
            send(request, responseAction, progressAction, beforeSend) {
                let xhr = new XMLHttpRequest();
                let url = NextAdmin.Path.combine(this.rootURL, request.url);
                if (request.urlParams != null) {
                    let params = {};
                    for (let pk in request.urlParams) {
                        let value = request.urlParams[pk];
                        if (value !== undefined && value !== null) {
                            params[pk] = value;
                        }
                    }
                    let queryString = new URLSearchParams(params);
                    url += request.url.indexOf("?") > 0 ? "&" : "?";
                    url += queryString;
                }
                xhr.open(request.method, url, request.async === null ? true : request.async);
                for (let key in this.headerParams) {
                    xhr.setRequestHeader(key, this.headerParams[key]);
                }
                if (request.headerParams != null) {
                    for (let key in request.headerParams) {
                        xhr.setRequestHeader(key, request.headerParams[key]);
                    }
                }
                let bodyData = null;
                if (request.body != null) {
                    switch (request.bodyFormat) {
                        default:
                        case BodyFormat.TEXT:
                            bodyData = request.body;
                            break;
                        case BodyFormat.JSON:
                            bodyData = JSON.stringify(request.body);
                            xhr.setRequestHeader('Content-Type', 'application/json; charset=utf-8');
                            break;
                        case BodyFormat.FORM:
                            bodyData = new FormData();
                            for (let key in request.body) {
                                let value = request.body[key];
                                if (value !== undefined) {
                                    bodyData.append(key, request.body[key]);
                                }
                            }
                            break;
                    }
                }
                if (beforeSend) {
                    beforeSend(xhr);
                }
                if (progressAction) {
                    xhr.upload.onprogress = (args) => {
                        progressAction(args);
                    };
                }
                return new Promise((resolve, reject) => {
                    xhr.onload = () => {
                        let response = new HttpResponse(xhr);
                        if (responseAction != null) {
                            responseAction(response);
                        }
                        resolve(response);
                    };
                    xhr.onerror = () => {
                        let response = new HttpResponse(xhr);
                        if (responseAction != null) {
                            responseAction(response);
                        }
                        reject(xhr);
                    };
                    xhr.send(bodyData);
                });
            }
        }
        Services.HttpClient = HttpClient;
        let HttpMethod;
        (function (HttpMethod) {
            HttpMethod["GET"] = "GET";
            HttpMethod["POST"] = "POST";
        })(HttpMethod = Services.HttpMethod || (Services.HttpMethod = {}));
        let BodyFormat;
        (function (BodyFormat) {
            BodyFormat["TEXT"] = "TEXT";
            BodyFormat["JSON"] = "JSON";
            BodyFormat["FORM"] = "FORM";
        })(BodyFormat = Services.BodyFormat || (Services.BodyFormat = {}));
        class HttpResponse {
            constructor(xhr) {
                this.xhr = xhr;
                if (xhr.responseType == '' || xhr.responseType == "text" || xhr.responseType == "json") {
                    this.text = xhr.responseText;
                }
                this.content = xhr.response;
                this.status = xhr.status;
                this.success = xhr.status == 200;
            }
            parseJson() {
                return JSON.parse(this.text);
            }
        }
        Services.HttpResponse = HttpResponse;
    })(Services = NextAdmin.Services || (NextAdmin.Services = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="HTTPClient.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var Services;
    (function (Services) {
        class EntityClient extends Services.HttpClient {
            static dispatchEntitiesUpdated(sender, mainEntities, updateInfos) {
                let entitiesUpdatedInfos = new NextAdmin.Dictionary();
                if (mainEntities) {
                    for (let mainEntity of mainEntities) {
                        entitiesUpdatedInfos.set(mainEntity.name, {
                            entityName: mainEntity.name,
                            entities: mainEntity.entities?.where(a => a != null)
                        });
                    }
                }
                if (updateInfos) {
                    for (let group of updateInfos.groupByArray(a => a.entityName)) {
                        let info = entitiesUpdatedInfos.get(group.name);
                        if (info) {
                            info.entityUpdatedInfos = group.items;
                        }
                        else {
                            entitiesUpdatedInfos.set(group.name, {
                                entityName: group.name,
                                entityUpdatedInfos: group.items,
                            });
                        }
                    }
                }
                EntityClient.onEntiesUpdated.dispatch(sender, entitiesUpdatedInfos);
            }
            constructor(rootServiceURL = '/entity', authTokenName = 'NextAdminAuthToken', authToken) {
                super(rootServiceURL);
                this.authTokenName = authTokenName;
                if (authToken) {
                    this.setAuthToken(authToken);
                }
            }
            setAuthToken(authToken) {
                this.headerParams[this.authTokenName] = authToken;
            }
            async tryLockEntity(entityName, entityId, lockKey) {
                let httpResponse = await this.get('tryLockEntity', { entityName: entityName, entityId: entityId, lockKey: lockKey });
                if (!httpResponse?.success) {
                    return null;
                }
                return httpResponse.parseJson();
            }
            async tryUnlockEntity(entityName, entityId, lockKey) {
                let httpResponse = await this.get('tryUnlockEntity', { entityName: entityName, entityId: entityId, lockKey: lockKey });
                if (!httpResponse?.success) {
                    return null;
                }
                return httpResponse.parseJson();
            }
            getEntity(args, responseAction, errorAction, progressAction) {
                return new Promise((resolve, reject) => {
                    this.postJson('getEntity', args, (response) => {
                        if (response.success) {
                            let responseData = response.parseJson();
                            if (responseAction != null) {
                                responseAction(responseData);
                            }
                            resolve(responseData);
                        }
                        else {
                            if (errorAction != null) {
                                errorAction(response);
                            }
                            reject(response);
                        }
                    }, progressAction);
                });
            }
            createEntity(args, responseAction, errorAction, progressAction) {
                return new Promise((resolve, reject) => {
                    this.postJson('createEntity', args, (response) => {
                        if (response.success) {
                            let responseData = response.parseJson();
                            if (responseAction != null) {
                                responseAction(responseData);
                            }
                            resolve(responseData);
                        }
                        else {
                            if (errorAction != null) {
                                errorAction(response);
                            }
                            reject(response);
                        }
                    }, progressAction);
                });
            }
            saveEntity(saveEntityArgs, responseAction, errorAction, progressAction) {
                return new Promise((resolve, reject) => {
                    this.postJson('saveEntity', saveEntityArgs, (response) => {
                        if (response.success) {
                            let saveEntityResponse = response.parseJson();
                            if (responseAction) {
                                responseAction(saveEntityResponse);
                            }
                            EntityClient.dispatchEntitiesUpdated(this, [{ name: saveEntityArgs.entityName, entities: [saveEntityResponse.entity] }], saveEntityResponse?.updateInfos);
                            resolve(saveEntityResponse);
                        }
                        else {
                            if (errorAction != null) {
                                errorAction(response);
                            }
                            reject(response);
                        }
                    }, progressAction);
                });
            }
            deleteEntity(args, responseAction, errorAction, progressAction) {
                return new Promise((resolve, reject) => {
                    this.postJson('deleteEntity', args, (response) => {
                        if (response.success) {
                            let apiResponse = response.parseJson();
                            if (responseAction) {
                                responseAction(apiResponse);
                            }
                            if (apiResponse?.isSuccess) {
                                EntityClient.dispatchEntitiesUpdated(this, null, apiResponse?.updateInfos);
                            }
                            resolve(apiResponse);
                        }
                        else {
                            if (errorAction != null) {
                                errorAction(response);
                            }
                            reject(response);
                        }
                    }, progressAction);
                });
            }
            getEntities(args, responseAction, errorAction, progressAction) {
                return new Promise((resolve, reject) => {
                    this.postJson('getEntities', args, (response) => {
                        if (response.success) {
                            let responseData = response.parseJson();
                            if (responseAction != null) {
                                responseAction(responseData);
                            }
                            resolve(responseData);
                        }
                        else {
                            if (errorAction != null) {
                                errorAction(response);
                            }
                            reject(response);
                        }
                    }, progressAction);
                });
            }
            countEntities(args, responseAction, errorAction, progressAction) {
                return new Promise((resolve, reject) => {
                    this.postJson('countEntities', args, (response) => {
                        if (response.success) {
                            let responseData = response.parseJson();
                            if (responseAction != null) {
                                responseAction(responseData);
                            }
                            resolve(responseData);
                        }
                        else {
                            if (errorAction != null) {
                                errorAction(response);
                            }
                            reject(response);
                        }
                    }, progressAction);
                });
            }
            sumEntities(args, responseAction, errorAction, progressAction) {
                return new Promise((resolve, reject) => {
                    this.postJson('sumEntities', args, (response) => {
                        if (response.success) {
                            let responseData = response.parseJson();
                            if (responseAction != null) {
                                responseAction(responseData);
                            }
                            resolve(responseData);
                        }
                        else {
                            if (errorAction != null) {
                                errorAction(response);
                            }
                            reject(response);
                        }
                    }, progressAction);
                });
            }
            async minEntities(args) {
                let response = await this.postJson('minEntities', args);
                if (!response.success) {
                    return null;
                }
                return response.parseJson();
            }
            async maxEntities(args) {
                let response = await this.postJson('maxEntities', args);
                if (!response.success) {
                    return null;
                }
                return response.parseJson();
            }
            saveEntities(args, responseAction, errorAction, progressAction) {
                return new Promise((resolve, reject) => {
                    this.postJson('saveEntities', args, (response) => {
                        if (response.success) {
                            let saveEntitiesResponse = response.parseJson();
                            if (responseAction) {
                                responseAction(saveEntitiesResponse);
                            }
                            if (saveEntitiesResponse?.isSuccess) {
                                EntityClient.dispatchEntitiesUpdated(this, [{ name: args.entityName, entities: saveEntitiesResponse?.entities }], saveEntitiesResponse?.updateInfos);
                            }
                            resolve(saveEntitiesResponse);
                        }
                        else {
                            if (errorAction != null) {
                                errorAction(response);
                            }
                            reject(response);
                        }
                    }, progressAction);
                });
            }
            async getEntityUserRight(entityName, entityId) {
                let response = await this.get('getUserEntityRight', { entityName: entityName, entityId: entityId });
                if (!response.success) {
                    return null;
                }
                return response.parseJson();
            }
        }
        EntityClient.onEntiesUpdated = new NextAdmin.EventHandler();
        Services.EntityClient = EntityClient;
    })(Services = NextAdmin.Services || (NextAdmin.Services = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var Services;
    (function (Services) {
        class UserClient extends Services.HttpClient {
            constructor(rootServiceURL, authTokenName = 'NextAdminAuthToken') {
                super(rootServiceURL ?? '/user');
                this.authTokenName = authTokenName;
            }
            async recoverPassword(userName) {
                let httpResponse = await this.get('recoverPassword', { userName: userName });
                if (httpResponse == null || !httpResponse.success) {
                    return null;
                }
                return httpResponse.parseJson();
            }
            async changePassword(newPassword, authToken) {
                if (authToken == null) {
                    authToken = this.getCurrentAuthToken();
                }
                if (NextAdmin.String.isNullOrEmpty(authToken)) {
                    return null;
                }
                this.headerParams[this.authTokenName] = authToken;
                let httpResponse = await this.get('changePassword', { newPassword: newPassword });
                delete this.headerParams[this.authTokenName];
                if (httpResponse == null || !httpResponse.success)
                    return null;
                return httpResponse.parseJson();
            }
            async authUser(userName, password, rememberTokeninCookies) {
                let httpResponse = await this.get('getAuthToken', { userName: userName, password: password });
                if (httpResponse == null || !httpResponse.success) {
                    return null;
                }
                let authTokenResponse = httpResponse.parseJson();
                if (authTokenResponse?.isSuccess) {
                    if (rememberTokeninCookies) {
                        NextAdmin.Cookies.set(this.authTokenName, authTokenResponse.token, authTokenResponse.dayValidity ?? 1);
                    }
                    else {
                        NextAdmin.Cookies.set(this.authTokenName, authTokenResponse.token, 0); //do not set duration, so token is stored in sesssion only
                    }
                }
                return authTokenResponse;
            }
            async getUserByToken(authToken) {
                if (authToken == null) {
                    authToken = this.getCurrentAuthToken();
                }
                if (NextAdmin.String.isNullOrEmpty(authToken)) {
                    return null;
                }
                this.headerParams[this.authTokenName] = authToken;
                let httpResponse = await this.get('getAuthentifiedUser');
                delete this.headerParams[this.authTokenName];
                if (httpResponse == null || !httpResponse.success)
                    return null;
                let userResponse = httpResponse.parseJson();
                return userResponse?.user;
            }
            async getUserByLogin(userName, password) {
                let httpResponse = await this.get('getUser', { userName: userName, password: password });
                if (httpResponse == null || !httpResponse.success) {
                    return null;
                }
                return httpResponse.parseJson();
            }
            async setUserCulture(culture, authToken) {
                if (authToken == null) {
                    authToken = this.getCurrentAuthToken();
                }
                if (NextAdmin.String.isNullOrEmpty(authToken)) {
                    return false;
                }
                this.headerParams[this.authTokenName] = authToken;
                let httpResponse = await this.get('setUserCulture', { culture: culture });
                delete this.headerParams[this.authTokenName];
                if (httpResponse == null || !httpResponse?.success) {
                    return false;
                }
                return httpResponse.parseJson()?.isSuccess ?? false;
            }
            getCurrentAuthToken() {
                return NextAdmin.Cookies.get(this.authTokenName);
            }
            deleteCurrentAuthToken() {
                return NextAdmin.Cookies.delete(this.authTokenName);
            }
        }
        Services.UserClient = UserClient;
    })(Services = NextAdmin.Services || (NextAdmin.Services = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="../EventHandler .ts" />
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Control {
            constructor(htmlElement, options) {
                this._tooltipValue = null;
                if (options == null) {
                    options = {};
                }
                if (typeof htmlElement == 'string') {
                    this.element = document.createElement(htmlElement);
                }
                else {
                    this.element = htmlElement;
                }
                this.element['_control'] = this;
                this.element.setAttribute('control-type', this.constructor.name);
                this.options = options;
                if (this.options.id) {
                    this.element.id = this.options.id;
                }
                if (this.options.disabled) {
                    setTimeout(() => {
                        this.disable();
                    }, 1);
                }
                if (this.options.toolTip) {
                    setTimeout(() => {
                        this.setTooltip(this.options.toolTip);
                    }, 1);
                }
                if (this.options.hidden) {
                    this.hide();
                }
                if (this.options.classes) {
                    this.element.classList.add(...this.options.classes);
                }
                if (this.options.css) {
                    NextAdmin.Copy.copyTo(this.options.css, this.element.style);
                }
                Control.onCreated.dispatch(this, this.options);
            }
            isEnable() {
                return this.element.isEnable();
            }
            enable() {
                this.element.enable();
            }
            disable() {
                this.element.disable();
            }
            setTooltip(value) {
                if (value != null) {
                    this.element.setPopover(value, this.element);
                }
                else {
                    this.element.removePopover();
                }
                this._tooltipValue = value;
            }
            getToolTip() {
                return this._tooltipValue;
            }
            changeEnableStateOnControlsRequiredValueChanged(condition, ...controls) {
                this.disable();
                setTimeout(() => {
                    if (condition()) {
                        this.enable();
                    }
                    else {
                        this.disable();
                    }
                }, 20); //use timeout in the case of value is setted by option.value
                for (let control of controls) {
                    control.onValueChanged.subscribe((sender, args) => {
                        if (condition()) {
                            this.enable();
                        }
                        else {
                            this.disable();
                        }
                    });
                }
            }
            startSpin() {
                this.element.startSpin('rgba(255,255,255,0.5)', 20);
            }
            stopSpin() {
                this.element.stopSpin();
            }
            hide() {
                this.element.style.display = 'none';
            }
            display() {
                this.element.style.display = '';
            }
            dispose() {
                this.element.remove();
            }
        }
        Control.onCreated = new NextAdmin.EventHandler();
        UI.Control = Control;
        let ControlStyle;
        (function (ControlStyle) {
            ControlStyle[ControlStyle["default"] = 0] = "default";
            ControlStyle[ControlStyle["modern"] = 1] = "modern";
        })(ControlStyle = UI.ControlStyle || (UI.ControlStyle = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class AspectRatioContainer extends NextAdmin.UI.Control {
            constructor(options) {
                super('div', options);
                this.element.style.position = 'relative';
                this.imageRatio = this.element.appendHTML('img', (img) => {
                    img.src = NextAdmin.Image.createBase64EmptyImage(this.options.width, this.options.height);
                    img.style.width = '100%';
                });
                this.element.appendHTML('div', (absoluteContainer) => {
                    absoluteContainer.style.position = 'absolute';
                    absoluteContainer.style.left = '0px';
                    absoluteContainer.style.top = '0px';
                    absoluteContainer.style.width = '100%';
                    absoluteContainer.style.height = '100%';
                    this.body = absoluteContainer.appendHTML('div', (body) => {
                        body.style.width = '100%';
                        body.style.height = '100%';
                    });
                });
            }
        }
        UI.AspectRatioContainer = AspectRatioContainer;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class DefaultStyle {
        }
        DefaultStyle.RequiredFieldBackground = 'rgba(237,243,255,0.30)';
        DefaultStyle.SelectedRowBackground = '#eff4ff';
        DefaultStyle.HoveredRowBackground = '#f2f2f2';
        DefaultStyle.RedOne = '#c81c4d';
        DefaultStyle.BlueOne = '#105ABE';
        DefaultStyle.BlueTwo = '#12101d';
        DefaultStyle.GreenOne = '#586e53';
        DefaultStyle.GreenTwo = '#629965';
        DefaultStyle.DarkModalBackdrop = 'rgba(0,0,0,0.5)';
        UI.DefaultStyle = DefaultStyle;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts"/>
/// <reference path="DefaultStyle.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Button extends UI.Control {
            //next-admin-btn-no-bg-red
            constructor(options) {
                super(options?.htmlTag ?? 'button', {
                    stopClickEventPropagation: true,
                    style: ButtonStyle.default, ...options
                });
                this.onActionExecuting = new NextAdmin.EventHandler();
                this.onActionExecuted = new NextAdmin.EventHandler();
                this._currentStyle = null;
                this._isPressed = false;
                NextAdmin.Style.append("Button", Button.style);
                this.action = this.options.action;
                this.element.classList.add('next-admin-btn');
                if (this.options.text != null) {
                    this.element.innerHTML = this.options.text;
                }
                if (this.options.popover) {
                    this.element.setPopover(this.options.popover);
                }
                this.setColorStyle(this.options.style);
                switch (this.options.size) {
                    case ButtonSize.extraSmall:
                        this.element.classList.add('next-admin-btn-extra-small');
                        break;
                    case ButtonSize.small:
                        this.element.classList.add('next-admin-btn-small');
                        break;
                    default:
                    case ButtonSize.medium:
                        this.element.classList.add('next-admin-btn-medium');
                        break;
                    case ButtonSize.large:
                        this.element.classList.add('next-admin-btn-large');
                        break;
                    case ButtonSize.largeResponsive:
                        this.element.classList.add('next-admin-btn-large-responsive');
                        break;
                }
                this.element.addEventListener('click', (event) => {
                    if (this.options.stopClickEventPropagation) {
                        event.stopPropagation();
                    }
                    if (!this._isPressed && this.isEnable()) {
                        this.executeAction();
                    }
                });
                Button.onCreated.dispatch(this, this.options);
            }
            setColorStyle(style) {
                if (this._currentStyle == style) {
                    return;
                }
                if (this._currentStyle != null) {
                    this.element.classList.remove(Button.getColorStyleClass(this._currentStyle));
                }
                this._currentStyle = style;
                this.element.classList.add(Button.getColorStyleClass(style));
            }
            getColorStyle() {
                return this._currentStyle;
            }
            static getColorStyleClass(style) {
                switch (style) {
                    case ButtonStyle.default:
                        return 'next-admin-btn-default';
                    case ButtonStyle.blue:
                        return 'next-admin-btn-blue';
                    case ButtonStyle.lightBlue:
                        return 'next-admin-btn-light-blue';
                    case ButtonStyle.green:
                        return 'next-admin-btn-green';
                    case ButtonStyle.lightgreen:
                        return 'next-admin-btn-light-green';
                    case ButtonStyle.red:
                        return 'next-admin-btn-red';
                    case ButtonStyle.bgWhite:
                        return 'next-admin-btn-bg-white';
                    case ButtonStyle.bgLightGrey:
                        return 'next-admin-btn-bg-light-grey';
                    case ButtonStyle.bgGrey:
                        return 'next-admin-btn-bg-grey';
                    case ButtonStyle.bgBlack:
                        return 'next-admin-btn-bg-black';
                    case ButtonStyle.bgBlue:
                        return 'next-admin-btn-bg-blue';
                    case ButtonStyle.bgGreen:
                        return 'next-admin-btn-bg-green';
                    case ButtonStyle.bgRed:
                        return 'next-admin-btn-bg-red';
                    case ButtonStyle.noBg:
                        return 'next-admin-btn-no-bg';
                    case ButtonStyle.noBgWhite:
                        return 'next-admin-btn-no-bg-white';
                    case ButtonStyle.noBgLightGrey:
                        return 'next-admin-btn-no-bg-light-grey';
                    case ButtonStyle.noBgDarkBlue:
                        return 'next-admin-btn-no-bg-dark-blue';
                    case ButtonStyle.noBgBlue:
                        return 'next-admin-btn-no-bg-blue';
                    case ButtonStyle.noBgRed:
                        return 'next-admin-btn-no-bg-red';
                }
            }
            press(disbaleClick = true) {
                this._isPressed = disbaleClick;
                this.element.classList.add('next-admin-btn-pressed');
            }
            release() {
                this._isPressed = false;
                this.element.classList.remove('next-admin-btn-pressed');
            }
            executeAction(event) {
                this.onActionExecuting.dispatch(this, this.action);
                if (this.action != null) {
                    this.action(this, event);
                }
                this.onActionExecuted.dispatch(this, this.action);
            }
            setText(text) {
                this.element.innerHTML = text;
                return this;
            }
            getText() {
                return this.element.innerHTML;
            }
            setBadge(options) {
                if (NextAdmin.String.isNullOrEmpty(options?.text)) {
                    if (this._badge) {
                        this._badge.remove();
                        this._badge = null;
                    }
                    return;
                }
                options = {
                    backgroundColor: UI.DefaultStyle.BlueOne,
                    ...options
                };
                this.element.style.position = 'relative';
                if (this._badge == null) {
                    this._badge = this.element.appendHTML('div', (badge) => {
                        badge.style.position = 'absolute';
                        badge.style.left = '-5px';
                        badge.style.bottom = '5px';
                        badge.style.width = '15px';
                        badge.style.height = '15px';
                        badge.style.lineHeight = '15px';
                        badge.style.textAlign = 'center';
                        badge.style.fontSize = '12px';
                        badge.style.color = '#fff';
                        badge.style.borderRadius = '100%';
                        badge.style.boxShadow = '0px 0px 4px rgba(0,0,0,0.25)';
                    });
                }
                this._badge.style.backgroundColor = options.backgroundColor;
                this._badge.innerHTML = options.text;
            }
            startSpin() {
                return this.element.startSpin('rgba(255,255,255,0.5)', 20);
            }
            stopSpin() {
                this.element.stopSpin();
            }
        }
        Button.onCreated = new NextAdmin.EventHandler();
        Button.style = ".next-admin-btn {border:1px solid #ccc;font-weight:bold;cursor:pointer;box-sizing:border-box;white-space:nowrap;text-overflow: ellipsis;border-radius:5px;transition:0.2s}"
            + '.next-admin-btn-extra-small{height:12.5px;font-size:10px;padding:0px;}'
            + ".next-admin-btn-small{height:24px;font-size:10px;padding-left:2px;padding-right:2px}"
            + ".next-admin-btn-medium{height:34px;font-size:14px;font-weight:500;padding-left:5px;padding-right:5px}"
            + ".next-admin-btn-large{height:40px;font-size:18px;font-weight:500;padding-left:7px;padding-right:7px}"
            + ".next-admin-btn-large-responsive{height:40px;font-size:18px;font-weight:500;padding-left:7px;padding-right:7px; @media (max-width: 768px) { height:34px;font-size:14px; }}"
            + ".next-admin-btn-default{background:#FFF;color:#444;}.next-admin-btn-default:hover,.next-admin-btn-white.next-admin-btn-pressed{background:#f0f0f0;box-shadow:inset 0px 0px 2px #444}"
            + ".next-admin-btn-red{background:#FFF;color:" + UI.DefaultStyle.RedOne + ";}.next-admin-btn-red:hover,.next-admin-btn-red.next-admin-btn-pressed{background:#f0f0f0;box-shadow:inset 0px 0px 2px #444}"
            + ".next-admin-btn-green{background:#FFF;color:" + UI.DefaultStyle.GreenOne + ";}.next-admin-btn-green:hover,.next-admin-btn-green.next-admin-btn-pressed{background:#f0f0f0;box-shadow:inset 0px 0px 2px #444}"
            + ".next-admin-btn-light-green{background:#FFF;color:" + UI.DefaultStyle.GreenTwo + ";}.next-admin-btn-light-green:hover,.next-admin-btn-light-green.next-admin-btn-pressed{background:#f0f0f0;box-shadow:inset 0px 0px 2px #444}"
            + ".next-admin-btn-blue{background:#FFF;color:" + UI.DefaultStyle.BlueOne + ";}.next-admin-btn-blue:hover,.next-admin-btn-blue.next-admin-btn-pressed{background:#f0f0f0;box-shadow:inset 0px 0px 2px #444}"
            + ".next-admin-btn-light-blue{background:#FFF;color:#0d6efd;}.next-admin-btn-blue:hover,.next-admin-btn-blue.next-admin-btn-pressed{background:#f0f0f0;box-shadow:inset 0px 0px 2px #444}"
            + ".next-admin-btn-bg-blue{background:#0d6efd;color:#f0f0f0;}.next-admin-btn-bg-blue:hover,.next-admin-btn-bg-blue.next-admin-btn-pressed{background:#0b5ed7;box-shadow:inset 0px 0px 2px #444}"
            + ".next-admin-btn-bg-white{background:#FFF;color:#444;}.next-admin-btn-bg-white:hover,.next-admin-btn-bg-white.next-admin-btn-pressed{background:#f0f0f0;box-shadow:inset 0px 0px 2px #444}"
            + ".next-admin-btn-bg-light-grey{background:#f0f0f0;color:#444;}.next-admin-btn-bg-light-grey:hover,.next-admin-btn-bg-light-grey.next-admin-btn-pressed{background:#fff;box-shadow:inset 0px 0px 2px #444}"
            + ".next-admin-btn-bg-grey{background:#87939f;color:#fff;}.next-admin-btn-bg-grey:hover,.next-admin-btn-bg-grey.next-admin-btn-pressed{background:#929da8;box-shadow:inset 0px 0px 2px #444}"
            + ".next-admin-btn-bg-green{background:#8EDA2F;color:#fff;}.next-admin-btn-bg-green:hover,.next-admin-btn-bg-green.next-admin-btn-pressed{background:#446D11;box-shadow:inset 0px 0px 2px #444}"
            + ".next-admin-btn-bg-red{background:#E32D2D;color:#fff;}.next-admin-btn-bg-red:hover,.next-admin-btn-bg-red.next-admin-btn-pressed{background:#FF1414;box-shadow:inset 0px 0px 4px #444}"
            + ".next-admin-btn-bg-black{background:#3A3A3A;color:#fff;}.next-admin-btn-bg-black:hover,.next-admin-btn-bg-black.next-admin-btn-pressed{background:#151515;box-shadow:inset 0px 0px 4px #444}"
            + ".next-admin-btn-no-bg{background:rgba(255,255,255,0);color:#000; border:0px}.next-admin-btn-no-bg:hover,.next-admin-btn-no-bg.next-admin-btn-pressed{color:#105ABE;text-decoration: underline;border:0px!important;}"
            + ".next-admin-btn-no-bg-white{background:rgba(255,255,255,0);color:#fff; border:0px}.next-admin-btn-no-bg-white:hover,.next-admin-btn-no-bg-white.next-admin-btn-pressed{color:#f0f0f0;text-decoration: underline;border:0px!important;}"
            + ".next-admin-btn-no-bg-light-grey{background:rgba(255,255,255,0);color:#777; border:0px}.next-admin-btn-no-bg-light-grey:hover,.next-admin-btn-no-bg-light-grey.next-admin-btn-pressed{color:#444;text-decoration: underline;border:0px!important;}"
            + ".next-admin-btn-no-bg-blue{background:rgba(255,255,255,0);color:#0d6efd; border:0px}.next-admin-btn-no-bg-blue:hover,.next-admin-btn-no-blue-bg.next-admin-btn-pressed{color:#053b8a;text-decoration: underline;border:0px!important;}"
            + ".next-admin-btn-no-bg-dark-blue{background:rgba(255,255,255,0);color:" + UI.DefaultStyle.BlueTwo + "; border:0px}.next-admin-btn-no-bg-dark-blue:hover,.next-admin-btn-no-bg.next-admin-btn-pressed{color:#053b8a;text-decoration: underline;border:0px!important;}"
            + ".next-admin-btn-no-bg-red{background:rgba(255,255,255,0);color:" + UI.DefaultStyle.RedOne + "; border:0px}.next-admin-btn-no-bg-red:hover,.next-admin-btn-no-bg.next-admin-btn-pressed{color:#053b8a;text-decoration: underline;border:0px!important;}";
        UI.Button = Button;
        let ButtonStyle;
        (function (ButtonStyle) {
            ButtonStyle[ButtonStyle["default"] = 0] = "default";
            ButtonStyle[ButtonStyle["lightBlue"] = 1] = "lightBlue";
            ButtonStyle[ButtonStyle["blue"] = 2] = "blue";
            ButtonStyle[ButtonStyle["green"] = 3] = "green";
            ButtonStyle[ButtonStyle["lightgreen"] = 4] = "lightgreen";
            ButtonStyle[ButtonStyle["red"] = 5] = "red";
            ButtonStyle[ButtonStyle["bgWhite"] = 6] = "bgWhite";
            ButtonStyle[ButtonStyle["bgLightGrey"] = 7] = "bgLightGrey";
            ButtonStyle[ButtonStyle["bgGrey"] = 8] = "bgGrey";
            ButtonStyle[ButtonStyle["bgBlack"] = 9] = "bgBlack";
            ButtonStyle[ButtonStyle["bgBlue"] = 10] = "bgBlue";
            ButtonStyle[ButtonStyle["bgGreen"] = 11] = "bgGreen";
            ButtonStyle[ButtonStyle["bgRed"] = 12] = "bgRed";
            ButtonStyle[ButtonStyle["noBg"] = 13] = "noBg";
            ButtonStyle[ButtonStyle["noBgLightGrey"] = 14] = "noBgLightGrey";
            ButtonStyle[ButtonStyle["noBgWhite"] = 15] = "noBgWhite";
            ButtonStyle[ButtonStyle["noBgBlue"] = 16] = "noBgBlue";
            ButtonStyle[ButtonStyle["noBgDarkBlue"] = 17] = "noBgDarkBlue";
            ButtonStyle[ButtonStyle["noBgRed"] = 18] = "noBgRed";
        })(ButtonStyle = UI.ButtonStyle || (UI.ButtonStyle = {}));
        let ButtonSize;
        (function (ButtonSize) {
            ButtonSize[ButtonSize["extraSmall"] = 0] = "extraSmall";
            ButtonSize[ButtonSize["small"] = 1] = "small";
            ButtonSize[ButtonSize["medium"] = 2] = "medium";
            ButtonSize[ButtonSize["large"] = 3] = "large";
            ButtonSize[ButtonSize["largeResponsive"] = 4] = "largeResponsive";
        })(ButtonSize = UI.ButtonSize || (UI.ButtonSize = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts" />
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Toolbar extends UI.Control {
            constructor(options) {
                super('table', options);
                this.onItemsChanged = new NextAdmin.EventHandler();
                this.items = new Array();
                NextAdmin.Style.append("Toolbar", Toolbar.style);
                this.element.classList.add('next-admin-toolbar');
                if (this.options.alignItemsTop) {
                    this.element.classList.add('next-admin-toolbar-align-top');
                }
                this.element.style.borderSpacing = '0px';
                this.row = this.element.appendHTML('tr');
                if (this.options.items != null) {
                    for (let item of this.options.items) {
                        this.appendControl(item);
                    }
                }
                Toolbar.onCreated.dispatch(this, this.options);
            }
            addItem(item) {
                this.items.push(item);
                this.onItemsChanged.dispatch(this, this.items);
            }
            appendHTML(html, setControlPropertiesAction) {
                return this.appendControl(document.createElement(html), setControlPropertiesAction);
            }
            prependHTML(html, setControlPropertiesAction) {
                return this.prependControl(document.createElement(html), setControlPropertiesAction);
            }
            appendControl(elementOrControl, setControlPropertiesAction) {
                this.row.appendHTML('td', (td) => {
                    td.classList.add('toolbar-cell');
                    if (elementOrControl instanceof UI.Control) {
                        td.appendControl(elementOrControl);
                    }
                    else {
                        td.appendChild(elementOrControl);
                    }
                });
                if (setControlPropertiesAction != null) {
                    setControlPropertiesAction(elementOrControl);
                }
                this.addItem(elementOrControl);
                return elementOrControl;
            }
            prependControl(elementOrControl, setControlPropertiesAction) {
                this.row.prependHTML('td', (td) => {
                    td.classList.add('toolbar-cell');
                    if (elementOrControl instanceof UI.Control) {
                        td.appendControl(elementOrControl);
                    }
                    else {
                        td.appendChild(elementOrControl);
                    }
                });
                if (setControlPropertiesAction != null) {
                    setControlPropertiesAction(elementOrControl);
                }
                this.addItem(elementOrControl);
                return elementOrControl;
            }
            insertControl(elementOrControl, index, setControlPropertiesAction) {
                let td = this.row.childNodes.length < index ? this.row.addCell() : this.row.insertCell(index);
                td.classList.add('toolbar-cell');
                if (elementOrControl instanceof UI.Control) {
                    td.appendControl(elementOrControl);
                }
                else {
                    td.appendChild(elementOrControl);
                }
                if (setControlPropertiesAction != null) {
                    setControlPropertiesAction(elementOrControl);
                }
                this.addItem(elementOrControl);
                return elementOrControl;
            }
            removeControl(elementOrControl) {
                if (elementOrControl instanceof UI.Control) {
                    elementOrControl.element.parentElement.remove();
                }
                else {
                    elementOrControl.parentElement.remove();
                }
                this.items.remove(elementOrControl);
                this.onItemsChanged.dispatch(this, this.items);
            }
            clear() {
                for (let item of this.items) {
                    this.removeControl(item);
                }
            }
        }
        Toolbar.style = `
        .next-admin-toolbar {
            border-spacing:0px 
        } 
        .next-admin-toolbar .toolbar-cell {
            padding:0px; 
            padding-left:1px;
            padding-right:1px;
        }
        .next-admin-toolbar-align-top .toolbar-cell{
            vertical-align:top;
        }
        `;
        Toolbar.onCreated = new NextAdmin.EventHandler();
        UI.Toolbar = Toolbar;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts"/>
/// <reference path="Toolbar.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Modal extends UI.Control {
            constructor(options) {
                super('div', {
                    style: Modal.defaultStyle,
                    canChangeScreenMode: (options == null || (options.size != ModalSize.smallFitContent && options.size != ModalSize.mediumFitContent)) && NextAdmin.UserAgent.isDesktop(),
                    parentElement: document.body,
                    size: ModalSize.large,
                    hasBodyOverflow: true,
                    removeOnClose: true,
                    canClose: true,
                    hasHeader: true,
                    hasFooter: true,
                    openAnimation: 'zoomIn',
                    closeAnimation: 'zoomOut',
                    minimizeAnimation: 'fadeOutDown',
                    maximizeAnimation: 'fadeInUp',
                    canMoveAndResize: NextAdmin.UserAgent.isDesktop() && (options == null || (options.size != ModalSize.smallFitContent && options.size != ModalSize.mediumFitContent)),
                    minModalManualSizingWidth: options == null || options.size != ModalSize.smallFitContent ? 400 : 50,
                    minModalManualSizingHeight: options == null || options.size != ModalSize.smallFitContent ? 400 : 50,
                    canModalManualSizingOverlapBrowserWindow: document.body.style.overflow == 'hidden',
                    ...options
                });
                this.onClose = new NextAdmin.EventHandler();
                this.onClosed = new NextAdmin.EventHandler();
                this.onOpen = new NextAdmin.EventHandler();
                this.onOpened = new NextAdmin.EventHandler();
                this.onTitleChanged = new NextAdmin.EventHandler();
                this._currentModalSizeClass = null;
                this._isFullScreen = false;
                this._previousBodyOverflow = null;
                this._isOpen = false;
                if (this.options.canMinimize && Modal.getMinimizedModalToolbar().element.parentElement == null) {
                    this.options.canMinimize = false;
                }
                if (this.options.blockBackgroundEvents === undefined && !this.options.canMinimize) {
                    this.options.blockBackgroundEvents = true;
                }
                NextAdmin.Style.append('Modal', Modal.style);
                this.element.classList.add('next-admin-modal-backdrop');
                if (this.options.backdropColor) {
                    this.element.style.background = this.options.backdropColor;
                    this.element.anim('fadeIn', { animationSpeed: NextAdmin.AnimationSpeed.faster });
                }
                this.modal = this.element.appendHTML('div', (modal) => {
                    modal.classList.add('next-admin-modal');
                    modal.classList.add('next-admin-modal-autosizing');
                    modal.addEventListener('pointerdown', () => {
                        this.passToTop();
                    });
                    this.header = modal.appendHTML('div', (header) => {
                        header.classList.add('next-admin-modal-header');
                        if (!this.options.hasHeader) {
                            header.style.display = 'none';
                        }
                        header.appendHTML('table', (table) => {
                            table.style.width = '100%';
                            table.style.borderSpacing = '0px';
                            table.appendHTML('tr', (tr) => {
                                this.leftHeader = tr.appendHTML('td', (leftheader) => {
                                    leftheader.classList.add('next-admin-modal-left-header');
                                    this.title = leftheader.appendHTML('span', (title) => {
                                        title.style.marginLeft = '10px';
                                        //title.style.fontWeight = 'bold';
                                    });
                                });
                                this.rightHeader = tr.appendHTML('td', (rightHeader) => {
                                    rightHeader.classList.add('next-admin-modal-right-header');
                                    this.buttonClose = rightHeader.appendHTML('div', (buttonClose) => {
                                        buttonClose.innerHTML = '';
                                        buttonClose.classList.add('next-admin-modal-toolbar-button');
                                        buttonClose.classList.add('next-admin-modal-btn-close');
                                        buttonClose.addEventListener('pointerenter', () => {
                                            buttonClose.classList.add('modal-btn-hover');
                                        });
                                        buttonClose.addEventListener('pointerleave', () => {
                                            buttonClose.classList.remove('modal-btn-hover');
                                        });
                                        buttonClose.addEventListener('pointerdown', (e) => {
                                            e.stopPropagation();
                                        });
                                        buttonClose.addEventListener('click', () => {
                                            this.close();
                                        });
                                        if (!this.options.canClose) {
                                            buttonClose.style.display = 'none';
                                        }
                                    });
                                    this.buttonFullScreen = rightHeader.appendHTML('div', (buttonFullScreen) => {
                                        buttonFullScreen.innerHTML = '';
                                        buttonFullScreen.classList.add('next-admin-modal-toolbar-button');
                                        buttonFullScreen.classList.add('next-admin-modal-button-full-screen');
                                        buttonFullScreen.addEventListener('pointerenter', () => {
                                            buttonFullScreen.classList.add('modal-btn-hover');
                                        });
                                        buttonFullScreen.addEventListener('pointerleave', () => {
                                            buttonFullScreen.classList.remove('modal-btn-hover');
                                        });
                                        buttonFullScreen.addEventListener('pointerdown', (e) => {
                                            e.stopPropagation();
                                        });
                                        buttonFullScreen.addEventListener('click', () => {
                                            this.toggleFullScreen();
                                        });
                                        if (this.options.canChangeScreenMode != true) {
                                            buttonFullScreen.style.display = 'none';
                                        }
                                    });
                                    this.buttonMinimize = rightHeader.appendHTML('div', (buttonMinimize) => {
                                        buttonMinimize.innerHTML = '-';
                                        buttonMinimize.classList.add('next-admin-modal-toolbar-button');
                                        buttonMinimize.addEventListener('pointerenter', () => {
                                            buttonMinimize.classList.add('modal-btn-hover');
                                        });
                                        buttonMinimize.addEventListener('pointerleave', () => {
                                            buttonMinimize.classList.remove('modal-btn-hover');
                                        });
                                        buttonMinimize.addEventListener('pointerdown', (e) => {
                                            e.stopPropagation();
                                        });
                                        buttonMinimize.addEventListener('click', () => {
                                            this.minimize();
                                        });
                                        if (!this.options.canMinimize) {
                                            buttonMinimize.style.display = 'none';
                                        }
                                    });
                                });
                            });
                        });
                    });
                    this.body = modal.appendHTML('div', (body) => {
                        body.classList.add('next-admin-modal-body');
                        body.style.width = '100%';
                        body.style.flexGrow = '1';
                        if (this.options.hasBodyOverflow) {
                            //body.appendPerfectScrollbar();
                            body.style.overflow = 'auto';
                        }
                    });
                    this.footer = modal.appendHTML('div', (footer) => {
                        footer.classList.add('next-admin-modal-footer');
                        if (!this.options.hasFooter) {
                            footer.style.display = 'none';
                        }
                        footer.appendHTML('table', (table) => {
                            table.style.width = '100%';
                            table.appendHTML('tr', (tr) => {
                                this.leftFooter = tr.appendHTML('td', (leftFooter) => {
                                    leftFooter.classList.add('next-admin-modal-left-footer');
                                });
                                this.rightFooter = tr.appendHTML('td', (rightFooter) => {
                                    rightFooter.classList.add('next-admin-modal-right-footer');
                                });
                            });
                        });
                    });
                });
                this.setSize(this.options.size);
                this.setStyle(this.options.style);
                if (this.options.startFullScreen) {
                    this.enableFullScreen();
                }
                if (this.options.canMoveAndResize) {
                    this.enableMoveAndResize();
                }
                if (!this.options.blockBackgroundEvents) {
                    this.element.style.pointerEvents = 'none';
                    this.modal.style.pointerEvents = 'all';
                }
                if (this.options.title) {
                    this.setTitle(this.options.title);
                }
                Modal.onCreated.dispatch(this, this.options);
            }
            getKey() {
                return this._key;
            }
            setSize(size) {
                if (this._currentModalSizeClass) {
                    this.modal.classList.remove(this._currentModalSizeClass);
                }
                switch (size) {
                    case ModalSize.small:
                        this._currentModalSizeClass = 'next-admin-modal-small';
                        break;
                    case ModalSize.smallFitContent:
                        this._currentModalSizeClass = 'next-admin-modal-small-fit-content';
                        break;
                    case ModalSize.medium:
                        this._currentModalSizeClass = 'next-admin-modal-medium';
                        break;
                    default:
                    case ModalSize.mediumFitContent:
                        this._currentModalSizeClass = 'next-admin-modal-medium-fit-content';
                        break;
                    case ModalSize.mediumLarge:
                        this._currentModalSizeClass = 'next-admin-modal-medium-large';
                        break;
                    case ModalSize.large:
                        this._currentModalSizeClass = 'next-admin-modal-large';
                        break;
                }
                this.modal.classList.add(this._currentModalSizeClass);
            }
            setStyle(style) {
                switch (style) {
                    default:
                    case ModalStyle.default:
                        this.modal.classList.add('next-admin-modal-default');
                        break;
                    case ModalStyle.modern:
                        this.modal.classList.add('next-admin-modal-modern');
                        break;
                }
            }
            static getMinimizedModalToolbar() {
                if (Modal._minimizedModalToolbar == null) {
                    Modal._minimizedModalToolbar = new UI.Toolbar();
                }
                return Modal._minimizedModalToolbar;
            }
            static registerModal(modal) {
                if (modal.isRegistered()) {
                    return;
                }
                let modalToolbar = Modal.getMinimizedModalToolbar();
                modalToolbar.appendControl(new UI.Button({
                    text: modal.getTitle(),
                    action: (btn) => {
                        modalToolbar.element.querySelectorAll('.btn-modal-active').forEach(otherBtn => otherBtn.classList.remove('btn-modal-active'));
                        if (!modal.isOpen()) {
                            modal.maximize();
                        }
                        else {
                            if (Modal.activModals.max(e => e.getZIndex()) == modal.getZIndex()) {
                                modal.minimize();
                            }
                            else {
                                modal.passToTop();
                            }
                        }
                    }
                }), (btn) => {
                    modal._minimizedButton = btn;
                    modalToolbar.element.querySelectorAll('.btn-modal-active').forEach(otherBtn => otherBtn.classList.remove('btn-modal-active'));
                    btn.element.classList.add('btn-modal-active');
                });
                Modal.activModals.add(modal);
            }
            static unRegisterModal(modal) {
                Modal.activModals.remove(modal);
                Modal.getMinimizedModalToolbar().removeControl(modal._minimizedButton);
            }
            static getRegisteredModal(key) {
                return Modal.activModals.firstOrDefault(e => e.getKey() == key);
                ;
            }
            enableMoveAndResize() {
                this.modal.disableUserSelection();
                let initModalManualSizing = () => {
                    let boundingRect = this.modal.getBoundingClientRect();
                    this.modal.classList.remove('next-admin-modal-autosizing');
                    this.modal.style.marginLeft = (boundingRect.left / window.innerWidth) * 100 + 'vw';
                    this.modal.style.width = (boundingRect.width / window.innerWidth) * 100 + 'vw';
                    this.modal.style.minWidth = this.options.minModalManualSizingWidth + 'px';
                    this.modal.style.marginRight = '';
                    this.modal.style.marginTop = (boundingRect.top / window.innerHeight) * 100 + 'vh';
                    this.modal.style.height = (boundingRect.height / window.innerHeight) * 100 + 'vh';
                    this.modal.style.minHeight = this.options.minModalManualSizingHeight + 'px';
                    this.modal.style.marginBottom = '';
                };
                let startPointerPosition;
                let startModalClientRect;
                let disabler;
                let startMoveOrResize = (args) => {
                    startPointerPosition = { x: args.clientX, y: args.clientY };
                    startModalClientRect = this.modal.getBoundingClientRect();
                    disabler = this.body.appendHTML('div', (disabler) => {
                        disabler.style.position = 'absolute';
                        disabler.style.left = '0px';
                        disabler.style.top = '0px';
                        disabler.style.width = '100%';
                        disabler.style.height = '100%';
                    });
                };
                let isDragging = false;
                let isResizeRight = false;
                let isResizeLeft = false;
                let isResizeTop = false;
                let isResizeBottom = false;
                this.header.addEventListener('pointerdown', (args) => {
                    if (args.button == 0 && !this._isFullScreen) {
                        startMoveOrResize(args);
                        isDragging = true;
                    }
                });
                this.modal.appendHTML('div', (resizeHandLeft) => {
                    resizeHandLeft.style.position = 'absolute';
                    resizeHandLeft.style.left = this.options.canModalManualSizingOverlapBrowserWindow ? '-2px' : '0px';
                    resizeHandLeft.style.top = '0px';
                    resizeHandLeft.style.height = '100%';
                    resizeHandLeft.style.width = '4px';
                    resizeHandLeft.style.cursor = 'ew-resize';
                    resizeHandLeft.addEventListener('pointerdown', (args) => {
                        if (args.button == 0 && !this._isFullScreen) {
                            startMoveOrResize(args);
                            isResizeLeft = true;
                        }
                    });
                });
                this.modal.appendHTML('div', (resizeHandRight) => {
                    resizeHandRight.style.position = 'absolute';
                    resizeHandRight.style.right = this.options.canModalManualSizingOverlapBrowserWindow ? '-2px' : '0px';
                    resizeHandRight.style.top = '0px';
                    resizeHandRight.style.height = '100%';
                    resizeHandRight.style.width = '4px';
                    resizeHandRight.style.cursor = 'ew-resize';
                    resizeHandRight.addEventListener('pointerdown', (args) => {
                        if (args.button == 0 && !this._isFullScreen) {
                            startMoveOrResize(args);
                            isResizeRight = true;
                        }
                    });
                });
                this.modal.appendHTML('div', (resizeHandleTop) => {
                    resizeHandleTop.style.position = 'absolute';
                    resizeHandleTop.style.left = '0px';
                    resizeHandleTop.style.top = this.options.canModalManualSizingOverlapBrowserWindow ? '-2px' : '0px';
                    resizeHandleTop.style.height = '4px';
                    resizeHandleTop.style.width = '100%';
                    resizeHandleTop.style.cursor = 'ns-resize';
                    resizeHandleTop.addEventListener('pointerdown', (args) => {
                        if (args.button == 0 && !this._isFullScreen) {
                            startMoveOrResize(args);
                            isResizeTop = true;
                        }
                    });
                });
                this.modal.appendHTML('div', (resizeHandleBottom) => {
                    resizeHandleBottom.style.position = 'absolute';
                    resizeHandleBottom.style.left = '0px';
                    resizeHandleBottom.style.bottom = this.options.canModalManualSizingOverlapBrowserWindow ? '-2px' : '0px';
                    resizeHandleBottom.style.height = '4px';
                    resizeHandleBottom.style.width = '100%';
                    resizeHandleBottom.style.cursor = 'ns-resize';
                    resizeHandleBottom.addEventListener('pointerdown', (args) => {
                        if (args.button == 0 && !this._isFullScreen) {
                            startMoveOrResize(args);
                            isResizeBottom = true;
                        }
                    });
                });
                this.modal.appendHTML('div', (resizeHandCornerTopLeft) => {
                    resizeHandCornerTopLeft.style.position = 'absolute';
                    resizeHandCornerTopLeft.style.left = this.options.canModalManualSizingOverlapBrowserWindow ? '-3px' : '0px';
                    resizeHandCornerTopLeft.style.top = this.options.canModalManualSizingOverlapBrowserWindow ? '-3x' : '0px';
                    resizeHandCornerTopLeft.style.height = '6px';
                    resizeHandCornerTopLeft.style.width = '6px';
                    resizeHandCornerTopLeft.style.cursor = 'nwse-resize';
                    resizeHandCornerTopLeft.addEventListener('pointerdown', (args) => {
                        if (args.button == 0 && !this._isFullScreen) {
                            startMoveOrResize(args);
                            isResizeTop = true;
                            isResizeLeft = true;
                        }
                    });
                });
                this.modal.appendHTML('div', (resizeHandCornerTopRight) => {
                    resizeHandCornerTopRight.style.position = 'absolute';
                    resizeHandCornerTopRight.style.right = this.options.canModalManualSizingOverlapBrowserWindow ? '-3px' : '0px';
                    resizeHandCornerTopRight.style.top = this.options.canModalManualSizingOverlapBrowserWindow ? '-3px' : '0px';
                    resizeHandCornerTopRight.style.height = '6px';
                    resizeHandCornerTopRight.style.width = '6px';
                    resizeHandCornerTopRight.style.cursor = 'nesw-resize';
                    resizeHandCornerTopRight.addEventListener('pointerdown', (args) => {
                        if (args.button == 0 && !this._isFullScreen) {
                            startMoveOrResize(args);
                            isResizeTop = true;
                            isResizeRight = true;
                        }
                    });
                });
                this.modal.appendHTML('div', (resizeHandCornerBottomLeft) => {
                    resizeHandCornerBottomLeft.style.position = 'absolute';
                    resizeHandCornerBottomLeft.style.left = this.options.canModalManualSizingOverlapBrowserWindow ? '-3px' : '0px';
                    resizeHandCornerBottomLeft.style.bottom = this.options.canModalManualSizingOverlapBrowserWindow ? '-3px' : '0px';
                    resizeHandCornerBottomLeft.style.height = '6px';
                    resizeHandCornerBottomLeft.style.width = '6px';
                    resizeHandCornerBottomLeft.style.cursor = 'nesw-resize';
                    resizeHandCornerBottomLeft.addEventListener('pointerdown', (args) => {
                        if (args.button == 0 && !this._isFullScreen) {
                            startMoveOrResize(args);
                            isResizeBottom = true;
                            isResizeLeft = true;
                        }
                    });
                });
                this.modal.appendHTML('div', (resizeHandCornerBottomRight) => {
                    resizeHandCornerBottomRight.style.position = 'absolute';
                    resizeHandCornerBottomRight.style.right = this.options.canModalManualSizingOverlapBrowserWindow ? '-3px' : '0px';
                    resizeHandCornerBottomRight.style.bottom = this.options.canModalManualSizingOverlapBrowserWindow ? '-3px' : '0px';
                    resizeHandCornerBottomRight.style.height = '6px';
                    resizeHandCornerBottomRight.style.width = '6px';
                    resizeHandCornerBottomRight.style.cursor = 'nwse-resize';
                    resizeHandCornerBottomRight.addEventListener('pointerdown', (args) => {
                        if (args.button == 0 && !this._isFullScreen) {
                            startMoveOrResize(args);
                            isResizeBottom = true;
                            isResizeRight = true;
                        }
                    });
                });
                document.addEventListener('pointerup', this._documentPointerUpEvent = (args) => {
                    isDragging = false;
                    isResizeLeft = false;
                    isResizeRight = false;
                    isResizeTop = false;
                    isResizeBottom = false;
                    startPointerPosition = null;
                    if (disabler != null) {
                        disabler.remove();
                        disabler = null;
                    }
                });
                document.addEventListener('pointermove', this._documentPointerMoveEvent = (args) => {
                    if (isDragging || isResizeLeft || isResizeRight || isResizeTop || isResizeBottom) {
                        if (this.modal.classList.contains('next-admin-modal-autosizing')) { //start move modal
                            initModalManualSizing();
                        }
                    }
                    if (startPointerPosition == null) {
                        return;
                    }
                    let distanceX = args.clientX - startPointerPosition.x;
                    let distanceY = args.clientY - startPointerPosition.y;
                    let distancePercentX = distanceX / window.innerWidth * 100;
                    let distancePercentY = distanceY / window.innerHeight * 100;
                    let originalModalPercentX = startModalClientRect.left / window.innerWidth * 100;
                    let originalModalPercentY = startModalClientRect.top / window.innerHeight * 100;
                    let originalModalPercentWidth = startModalClientRect.width / window.innerWidth * 100;
                    let originalModalPercentHeight = startModalClientRect.height / window.innerHeight * 100;
                    let minModalManualSizingScreenPercentSize = this.options.minModalManualSizingWidth / window.innerWidth * 100;
                    let minModalManualSizingScreenPercentHeight = this.options.minModalManualSizingHeight / window.innerHeight * 100;
                    if (isDragging) {
                        let newModalPercentX = originalModalPercentX + distancePercentX;
                        let newModalPercentY = originalModalPercentY + distancePercentY;
                        if (!this.options.canModalManualSizingOverlapBrowserWindow) {
                            if (newModalPercentX < 0) {
                                newModalPercentX = 0;
                            }
                            if (newModalPercentX + originalModalPercentWidth > 100) {
                                newModalPercentX = 100 - originalModalPercentWidth;
                            }
                            if (newModalPercentY < 0) {
                                newModalPercentY = 0;
                            }
                            if (newModalPercentY + originalModalPercentHeight > 100) {
                                newModalPercentY = 100 - originalModalPercentHeight;
                            }
                        }
                        if (args.clientX < window.innerWidth && args.clientX > 0) {
                            this.modal.style.marginLeft = newModalPercentX + 'vw';
                        }
                        if (args.clientY < window.innerHeight && args.clientY > 0) {
                            this.modal.style.marginTop = newModalPercentY + 'vh';
                        }
                    }
                    if (isResizeLeft) {
                        let newModalPercentX = originalModalPercentX + distancePercentX;
                        if (newModalPercentX < 0) {
                            newModalPercentX = 0;
                        }
                        let newModalPercentWidth = originalModalPercentWidth + (originalModalPercentX - newModalPercentX);
                        if (newModalPercentWidth < minModalManualSizingScreenPercentSize) {
                            newModalPercentX = newModalPercentX - (minModalManualSizingScreenPercentSize - newModalPercentWidth);
                            newModalPercentWidth = minModalManualSizingScreenPercentSize;
                        }
                        this.modal.style.marginLeft = newModalPercentX + 'vw';
                        this.modal.style.width = newModalPercentWidth + 'vw';
                    }
                    if (isResizeRight) {
                        let newModalPercentWidth = originalModalPercentWidth + distancePercentX;
                        if (newModalPercentWidth + originalModalPercentX > 100) {
                            newModalPercentWidth = 100 - originalModalPercentX;
                        }
                        if (newModalPercentWidth < minModalManualSizingScreenPercentSize) {
                            newModalPercentWidth = minModalManualSizingScreenPercentSize;
                        }
                        this.modal.style.width = newModalPercentWidth + 'vw';
                    }
                    if (isResizeTop) {
                        let newModalPercentY = originalModalPercentY + distancePercentY;
                        if (newModalPercentY < 0) {
                            newModalPercentY = 0;
                        }
                        let newModalPercentHeight = originalModalPercentHeight + (originalModalPercentY - newModalPercentY);
                        if (newModalPercentHeight < minModalManualSizingScreenPercentHeight) {
                            newModalPercentY = newModalPercentY - (minModalManualSizingScreenPercentHeight - newModalPercentHeight);
                            newModalPercentHeight = minModalManualSizingScreenPercentHeight;
                        }
                        this.modal.style.marginTop = newModalPercentY + 'vh';
                        this.modal.style.height = newModalPercentHeight + 'vh';
                    }
                    if (isResizeBottom) {
                        let newModalPercentHeight = originalModalPercentHeight + distancePercentY;
                        if (newModalPercentHeight + originalModalPercentY > 100) {
                            newModalPercentHeight = 100 - originalModalPercentY;
                        }
                        if (newModalPercentHeight < minModalManualSizingScreenPercentSize) {
                            newModalPercentHeight = minModalManualSizingScreenPercentSize;
                        }
                        this.modal.style.height = newModalPercentHeight + 'vh';
                    }
                });
            }
            enableFullScreen() {
                if (this._isFullScreen)
                    return;
                if (!this.modal.classList.contains('next-admin-modal-autosizing')) {
                    this._previousManualSizingValues = {};
                    this._previousManualSizingValues.marginLeft = this.modal.style.marginLeft;
                    this._previousManualSizingValues.width = this.modal.style.width;
                    this._previousManualSizingValues.minWidth = this.modal.style.minWidth;
                    this._previousManualSizingValues.marginRight = this.modal.style.marginRight;
                    this._previousManualSizingValues.marginTop = this.modal.style.marginTop;
                    this._previousManualSizingValues.height = this.modal.style.height;
                    this._previousManualSizingValues.minHeight = this.modal.style.minHeight;
                    this._previousManualSizingValues.marginBottom = this.modal.style.marginBottom;
                    this.modal.style.marginLeft = '';
                    this.modal.style.width = '';
                    this.modal.style.minWidth = '';
                    this.modal.style.marginRight = '';
                    this.modal.style.marginTop = '';
                    this.modal.style.height = '';
                    this.modal.style.minHeight = '';
                    this.modal.style.marginBottom = '';
                    this.modal.classList.add('next-admin-modal-autosizing');
                }
                this.modal.classList.add('next-admin-modal-full-screen');
                this._isFullScreen = true;
            }
            disableFullScreen() {
                if (!this._isFullScreen)
                    return;
                this.modal.classList.remove('next-admin-modal-full-screen');
                if (this._previousManualSizingValues != null) {
                    for (let key in this._previousManualSizingValues) {
                        this.modal.style[key] = this._previousManualSizingValues[key];
                    }
                    this.modal.classList.remove('next-admin-modal-autosizing');
                    this._previousManualSizingValues = null;
                }
                this._isFullScreen = false;
            }
            isInFullscreen() {
                return this._isFullScreen;
            }
            toggleFullScreen() {
                if (!this._isFullScreen) {
                    this.enableFullScreen();
                }
                else {
                    this.disableFullScreen();
                }
            }
            passToTop() {
                if (Modal.activModals.length == 0) {
                    this.setZIndex(Modal.startTopZIndex);
                }
                else {
                    this.setZIndex(Modal.activModals.max(e => e.getZIndex()) + 1);
                }
                if (this._minimizedButton && !this._minimizedButton.element.classList.contains('btn-modal-active')) {
                    this._minimizedButton.element.classList.add('btn-modal-active');
                }
            }
            isRegistered() {
                return Modal.activModals.contains(this);
            }
            open(args) {
                if (this.element.parentElement == null) {
                    this.options.parentElement.appendChild(this.element);
                }
                this.passToTop();
                if (this.isOpen()) {
                    return;
                }
                this._isOpen = true;
                this.element.style.display = '';
                this.onOpen.dispatch(this, args);
                this._previousBodyOverflow = document.body.style.overflow;
                document.body.style.overflow = 'hidden';
                if (this.options.openAnimation != null) {
                    this.modal.anim(this.options.openAnimation, {
                        animationSpeed: NextAdmin.AnimationSpeed.faster, onEndAnimation: () => {
                            this.onOpened.dispatch(this, args);
                        }
                    });
                }
                else {
                    this.onOpened.dispatch(this, args);
                }
                if (this.options.canMinimize) {
                    Modal.registerModal(this);
                }
            }
            close(args) {
                if (args == null) {
                    args = {};
                }
                this.onClose.dispatch(this, args);
                if (this.options.onClose) {
                    this.options.onClose(this, args);
                }
                if (args.cancel) {
                    return;
                }
                if (this._documentPointerMoveEvent != null) {
                    document.removeEventListener('pointermove', this._documentPointerMoveEvent);
                }
                if (this._documentPointerUpEvent != null) {
                    document.removeEventListener('pointermove', this._documentPointerUpEvent);
                }
                document.body.style.overflow = this._previousBodyOverflow;
                let endCloseFunc = () => {
                    this._isOpen = false;
                    if (this.options.removeOnClose) {
                        this.element.remove();
                    }
                    else {
                        this.element.style.display = 'none';
                    }
                    this.onClosed.dispatch(this, args);
                };
                if (this.options.closeAnimation != null) {
                    if (this.options.backdropColor) {
                        this.element.anim('fadeOut', {
                            animationSpeed: NextAdmin.AnimationSpeed.faster,
                        });
                    }
                    this.modal.anim(this.options.closeAnimation, {
                        animationSpeed: NextAdmin.AnimationSpeed.faster,
                        onEndAnimation: () => {
                            endCloseFunc();
                        }
                    });
                }
                else {
                    endCloseFunc();
                }
                if (this.options.canMinimize) {
                    Modal.unRegisterModal(this);
                }
            }
            minimize() {
                let endMinimizeFunc = () => {
                    this._isOpen = false;
                    if (this._minimizedButton) {
                        this._minimizedButton.element.classList.remove('btn-modal-active');
                    }
                    if (this.options.removeOnClose) {
                        this.element.remove();
                    }
                    else {
                        this.element.style.display = 'none';
                    }
                };
                if (this.options.closeAnimation != null) {
                    this.element.anim(this.options.minimizeAnimation, {
                        animationSpeed: NextAdmin.AnimationSpeed.faster,
                        onEndAnimation: () => {
                            endMinimizeFunc();
                        }
                    });
                }
                else {
                    endMinimizeFunc();
                }
            }
            maximize() {
                if (this.isOpen()) {
                    return;
                }
                if (this.element.parentElement == null) {
                    this.options.parentElement.appendChild(this.element);
                }
                this._isOpen = true;
                this.element.style.display = '';
                if (this.options.openAnimation != null) {
                    this.element.anim(this.options.maximizeAnimation, { animationSpeed: NextAdmin.AnimationSpeed.faster });
                }
                this.passToTop();
            }
            isOpen() {
                return this._isOpen;
            }
            setZIndex(zIndex) {
                this.element.style.zIndex = zIndex;
            }
            getZIndex() {
                return parseInt(this.element.style.zIndex);
            }
            getTitle() {
                return this.title.innerHTML;
            }
            setTitle(title) {
                let maxTitleLenght = NextAdmin.UserAgent.isDesktop() ? 50 : 30;
                if (title.startsWith('<i')) {
                    maxTitleLenght += 30;
                }
                if (title && title.length > maxTitleLenght) {
                    title = title.substring(0, maxTitleLenght) + '...';
                }
                this.title.innerHTML = title;
                if (this._minimizedButton != null) {
                    this._minimizedButton.setText(title);
                }
                this.onTitleChanged.dispatch(this, title);
            }
            startSpin() {
                this.modal.startSpin('rgba(255,255,255,0.5)', 50);
            }
            stopSpin() {
                this.modal.stopSpin();
            }
            bindEvent(eventHandler, eventAction) {
                if (this.isOpen()) {
                    eventHandler.subscribe(eventAction);
                }
                this.onOpen.subscribe(() => {
                    if (!eventHandler.isSubscribed(eventAction)) {
                        eventHandler.subscribe(eventAction);
                    }
                });
                this.onClosed.subscribe(() => {
                    eventHandler.unsubscribe(eventAction);
                });
            }
        }
        Modal.style = '.next-admin-modal-btn-close{border-top-right-radius:4px}'
            + '.next-admin-modal-toolbar-button{ display:inline-block;float:right;font-size:20px;height:32px;width:32px;text-align:center;cursor:pointer }'
            + '@media (min-width: 1280px) { .next-admin-modal-autosizing.next-admin-modal-large{ margin:0 auto;margin-top:4vh;width:80%;height:95%; } }' //large modal
            + '@media (max-width: 1280px) { .next-admin-modal-autosizing.next-admin-modal-large{ margin:0 auto;margin-top:0vh;width:100%;height:100%; } .next-admin-modal-autosizing.next-admin-modal-large .next-admin-modal-button-full-screen{display:none} }'
            + '@media (max-width: 800px) { .next-admin-modal-autosizing.next-admin-modal-medium{ margin:0 auto;margin-top:0vh;width:100%;height:100%; } .next-admin-modal-autosizing.next-admin-modal-large .next-admin-modal-button-full-screen{display:none} }'
            + '@media (min-width: 800px) { .next-admin-modal-autosizing.next-admin-modal-medium{ margin:0 auto;margin-top:5vh;width:70%;height:90%; } }' //mediaum modal
            + '@media (min-width: 1280px) { .next-admin-modal-autosizing.next-admin-modal-medium{ margin:0 auto;margin-top:5vh;width:50%;height:90%;max-width:900px } }' //mediaum modal
            + '@media (max-width: 800px) { .next-admin-modal-autosizing.next-admin-modal-medium-large{ margin:0 auto;margin-top:0vh;width:100%;height:100%; } .next-admin-modal-autosizing.next-admin-modal-large .next-admin-modal-button-full-screen{display:none} }'
            + '@media (min-width: 800px) { .next-admin-modal-autosizing.next-admin-modal-medium-large{ margin:0 auto;margin-top:5vh;width:90%;height:90%; } }' //mediaum modal
            + '@media (min-width: 1280px) { .next-admin-modal-autosizing.next-admin-modal-medium-large{ margin:0 auto;margin-top:5vh;width:65%;height:90%;max-width:1100px } }' //mediaum modal
            + '@media (max-width: 600px) { .next-admin-modal-autosizing.next-admin-modal-small{ margin:0 auto;margin-top:0vh;width:100%;height:100%; } .next-admin-modal-autosizing.next-admin-modal-large .next-admin-modal-button-full-screen{display:none} }'
            + '@media (min-width: 600px) { .next-admin-modal-autosizing.next-admin-modal-small{ margin:0 auto;margin-top:5vh;width:70%;height:90%; } }' //small modal
            + '@media (min-width: 900px) { .next-admin-modal-autosizing.next-admin-modal-small{ margin:0 auto;margin-top:5vh;width:50%;height:90%; } }' //small modal
            + '@media (min-width: 1280px) { .next-admin-modal-autosizing.next-admin-modal-small{ margin:0 auto;margin-top:5vh;width:35%;height:90%;max-width:600px } }' //small modal
            + '.next-admin-modal-autosizing.next-admin-modal-small-fit-content{ top:50%;transform:perspective(1px) translateY(-50%) }'
            + '@media (max-width: 600px) { .next-admin-modal-autosizing.next-admin-modal-small-fit-content{ margin:auto auto;width:100%; } .next-admin-modal-autosizing.next-admin-modal-large .next-admin-modal-button-full-screen{display:none} }'
            + '@media (min-width: 600px) { .next-admin-modal-autosizing.next-admin-modal-small-fit-content{ margin:auto auto;width:70%; } }' //small modal
            + '@media (min-width: 900px) { .next-admin-modal-autosizing.next-admin-modal-small-fit-content{ margin:auto auto;width:50%; } }' //small modal
            + '@media (min-width: 1280px) { .next-admin-modal-autosizing.next-admin-modal-small-fit-content{ margin:auto auto;width:35%;max-width:600px } }' //small modal
            + '.next-admin-modal-autosizing.next-admin-modal-medium-fit-content{ top:50%;transform:perspective(1px) translateY(-50%) }'
            + '@media (max-width: 800px) { .next-admin-modal-autosizing.next-admin-modal-medium-fit-content{ margin:auto auto;width:100%; } .next-admin-modal-autosizing.next-admin-modal-large .next-admin-modal-button-full-screen{display:none} }'
            + '@media (min-width: 800px) { .next-admin-modal-autosizing.next-admin-modal-medium-fit-content{ margin:auto auto;width:80%; } }' //small modal
            + '@media (min-width: 1280px) { .next-admin-modal-autosizing.next-admin-modal-medium-fit-content{ margin:auto auto;width:50%;max-width:900px } }' //small modal
            + '.next-admin-modal .next-admin-panel-header{border-radius:0px;border-top:0px;border-left:0px;border-right:0px;} .next-admin-modal .next-admin-panel-footer{border-radius:0px;border-bottom:0px;border-left:0px;border-right:0px;} .next-admin-modal .next-admin-panel-body{border-left:0px;border-right:0px;border-bottom:0px}'
            + '.next-admin-modal-full-screen{ margin:0 auto !important;margin-top:0vh !important;width:100% !important;height:100% !important;max-width:unset !important; }' //large screens;
            + `

            .next-admin-modal-backdrop{
                position:fixed;
                top:0px;
                left:0px;
                width:100%;
                height:100%;
                z-index:9999;
            }

            .next-admin-modal{
                max-height:100%;
                position:relative;
                display:flex;
                flex-direction:column;
                box-shadow:0px 0px 4px rgba(0,0,0,0.4);
                border-radius: 4px;
                .next-admin-modal-body {
                    position:relative;
                }
            }

            .next-admin-modal-left-header{
                padding:8px;
            }

            .next-admin-modal-right-header{
                padding:8px;
            }

            .modal-btn-hover{
                text-shadow:0px 0px 2px rgba(0,0,0,0.2);
                font-weight:bold;
            }
            
            .next-admin-modal-default{

                background:rgba(255,255,255,1);

                .next-admin-modal-header{
                    width:100%;
                    border-bottom:1px solid rgba(0,0,0,0.2);
                    color:#222;
                }

                .next-admin-modal-footer{
                    width:100%;
                    border-top:1px solid rgba(0,0,0,0.2);
                }
            }       

            .next-admin-modal-modern{

                background:#fff;
                box-shadow:0px 0px 100px rgba(0,0,0,0.2);
                border-radius: 8px;
                border:1px solid #ddd;
                
                .next-admin-modal-header{
                    width:100%;
                    color:#222;
                }

                .next-admin-modal-body{
                    background:#fff;
                }

                .next-admin-modal-footer{
                    width:100%;
                }
                .next-admin-modal-left-footer{
                    padding:5px;
                }
                .next-admin-modal-right-footer{
                    padding:5px;
                }
            }

            .btn-modal-active{
                border:1px solid #12101d;
            }

            .next-admin-modal-body .ps__rail-y{
                z-index:10;
            }            
            `;
        Modal.onCreated = new NextAdmin.EventHandler();
        Modal.startTopZIndex = 1000;
        Modal.activModals = new Array();
        UI.Modal = Modal;
        let ModalSize;
        (function (ModalSize) {
            ModalSize[ModalSize["small"] = 0] = "small";
            ModalSize[ModalSize["smallFitContent"] = 1] = "smallFitContent";
            ModalSize[ModalSize["medium"] = 2] = "medium";
            ModalSize[ModalSize["mediumFitContent"] = 3] = "mediumFitContent";
            ModalSize[ModalSize["mediumLarge"] = 4] = "mediumLarge";
            ModalSize[ModalSize["large"] = 5] = "large";
        })(ModalSize = UI.ModalSize || (UI.ModalSize = {}));
        let ModalStyle;
        (function (ModalStyle) {
            ModalStyle[ModalStyle["default"] = 0] = "default";
            ModalStyle[ModalStyle["modern"] = 1] = "modern";
        })(ModalStyle = UI.ModalStyle || (UI.ModalStyle = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Modal.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class ChangePasswordModal extends NextAdmin.UI.Modal {
            constructor(options) {
                super({
                    title: NextAdmin.Resources.keyIcon + ' ' + NextAdmin.Resources.changePasswordModalTitle,
                    backdropColor: 'rgba(0,0,0,0.2)',
                    size: UI.ModalSize.smallFitContent, ...options
                });
                this.body.appendHTML('div', (container) => {
                    container.style.padding = '20px';
                    let newPassword1 = container.appendControl(new NextAdmin.UI.Input({
                        label: NextAdmin.Resources.newPassword,
                        labelPosition: NextAdmin.UI.FormControlLabelPosition.top,
                        inputType: NextAdmin.UI.InputType.password
                    }), (input) => {
                        input.element.style.marginBottom = '20px';
                    });
                    let newPassword2 = container.appendControl(new NextAdmin.UI.Input({
                        label: NextAdmin.Resources.newPasswordRepeat,
                        labelPosition: NextAdmin.UI.FormControlLabelPosition.top,
                        inputType: NextAdmin.UI.InputType.password
                    }), (input) => {
                        input.element.style.marginBottom = '20px';
                    });
                    this.rightFooter.appendControl(new UI.Button({
                        text: NextAdmin.Resources.checkIcon + ' ' + NextAdmin.Resources.validate, style: NextAdmin.UI.ButtonStyle.blue,
                        action: async (button) => {
                            if (newPassword1.getValue() != newPassword2.getValue()) {
                                NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.error, NextAdmin.Resources.error_passwordAreNotSame);
                                return;
                            }
                            this.startSpin();
                            let response = await this.options.userClient.changePassword(newPassword1.getValue());
                            this.stopSpin();
                            if (response?.isSuccess) {
                                this.close();
                            }
                            else if (response?.code == 'INVALID_PASSWORD') {
                                NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.error, NextAdmin.Resources.error_invalidPassword);
                            }
                            else {
                                NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.error, response.message);
                            }
                        }
                    }), (btn) => {
                        btn.element.style.cssFloat = 'right';
                        btn.changeEnableStateOnControlsRequiredValueChanged(() => !NextAdmin.String.isNullOrEmpty(newPassword1.getValue()) && !NextAdmin.String.isNullOrEmpty(newPassword2.getValue()), newPassword1, newPassword2);
                    });
                });
            }
        }
        UI.ChangePasswordModal = ChangePasswordModal;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts" />
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class FormControl extends UI.Control {
            constructor(elementType = 'div', options) {
                super(elementType, {
                    ...options
                });
                this.onValueChanged = new NextAdmin.EventHandler();
                this.element['_isFormControl'] = true;
                if (this.options.onValueChanged) {
                    this.onValueChanged.subscribe((sender, args) => {
                        this.options.onValueChanged(this, args);
                    });
                }
                if (this.options.value !== undefined) {
                    setTimeout(() => {
                        this.setValue(this.options.value);
                    }, 1);
                }
                if (this.options.required) {
                    setTimeout(() => {
                        this.displayAsRequired();
                    }, 1);
                }
                if (this.options.disabled) {
                    setTimeout(() => {
                        this.disable();
                    }, 1);
                }
                if (this.options.propertyInfo) {
                    setTimeout(() => {
                        this.setPropertyInfo(this.options.propertyInfo);
                    }, 1);
                }
                FormControl.onCreated.dispatch(this, this.options);
            }
            enable() {
                this.element.enable();
            }
            disable() {
                this.element.disable();
            }
            isEnable() {
                return this.element.isEnable();
            }
            setValue(value, fireChange) {
                this.element.innerHTML = value;
                if (fireChange) {
                    this.onValueChanged.dispatch(this, { value: this.getValue() });
                }
            }
            getValue() {
                return this.element.innerHTML;
            }
            getLabel() {
                return '';
            }
            setLabel(label) {
            }
            setError(message) {
            }
            displayAsRequired() {
            }
            displayAsNotRequired() {
            }
            getPrintableElement(options) {
                let printableElement = document.createElement('table');
                printableElement.style.width = '100%';
                printableElement.appendHTML('tr', (tr) => {
                    let label = this.getLabel();
                    if (!NextAdmin.String.isNullOrWhiteSpace(label)) {
                        tr.appendHTML('td', (td) => {
                            td.style.width = '30%';
                            td.innerHTML = '<b>' + label + '</b>:';
                        });
                    }
                    tr.appendHTML('td', (td) => {
                        td.innerHTML = this.getDisplayValue();
                    });
                });
                return printableElement;
            }
            getDisplayValue() {
                return UI.Helper.getDefaultPropertyDisplayValue(this.getPropertyInfo(), this.getValue());
            }
            /**
             * Should not be called
             * @param dataController
             * @param propertyName
             */
            setDataController(dataController, propertyName) {
                this._dataController = dataController;
                this._bindedPropertyName = propertyName;
                let propertyInfo = null;
                if (propertyName.contains('.')) {
                    propertyInfo = dataController.getDataPropertyInfoFromPath(dataController.options.dataName, propertyName);
                }
                else {
                    propertyInfo = dataController.getDataPropertyInfo_(dataController.options.dataName, propertyName);
                }
                if (propertyInfo != null) {
                    this.setPropertyInfo(propertyInfo);
                }
            }
            getDataController() {
                return this._dataController;
            }
            getBindedPropertyName() {
                return this._bindedPropertyName;
            }
            setPropertyInfo(propertyInfo) {
                this._propertyInfo = propertyInfo;
                if (propertyInfo != null) {
                    if (this._propertyInfo.isRequired && (this.options.required === undefined || this.options.required == true)) {
                        this.displayAsRequired();
                    }
                }
            }
            getPropertyInfo() {
                return this._propertyInfo;
            }
        }
        FormControl.onCreated = new NextAdmin.EventHandler();
        UI.FormControl = FormControl;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="FormControl.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class LabelFormControl extends UI.FormControl {
            constructor(options) {
                super("table", {
                    labelWidth: LabelFormControl.defaultLabelWidth,
                    labelPosition: FormControlLabelPosition.left,
                    ...options
                });
                this._errorMessage = null;
                this._tooltipMessage = null;
                this._disabled = false;
                NextAdmin.Style.append("LayoutFormControl", LabelFormControl.style);
                this.element.classList.add('next-admin-layout-control-table');
                this.element.style.borderSpacing = '0px';
                this.element.style.borderCollapse = 'collapse';
                this.element.style.width = '100%';
                if (this.options.labelPosition == FormControlLabelPosition.left) {
                    this.element.appendHTML('tr', tr => {
                        this.labelContainer = tr.appendHTML('td');
                        this.labelContainer.classList.add('next-admin-layout-form-control-cell');
                        this.setLabelWidth(this.options.labelWidth);
                        this.label = this.labelContainer.appendHTML('label');
                        this.asterisk = this.labelContainer.appendHTML('label');
                        this.asterisk.classList.add('next-admin-layout-form-control-asterisk');
                        this.controlContainer = tr.appendHTML('td');
                        this.controlContainer.classList.add('next-admin-layout-form-control-cell');
                    });
                }
                else {
                    this.element.appendHTML('tr', tr => {
                        if (this.options.labelPosition == FormControlLabelPosition.hidden) {
                            tr.style.display = 'none';
                        }
                        this.labelContainer = tr.appendHTML('td');
                        this.labelContainer.colSpan = 10;
                        this.labelContainer.classList.add('next-admin-layout-form-control-cell');
                        this.label = this.labelContainer.appendHTML('label');
                        this.asterisk = this.labelContainer.appendHTML('label');
                        this.asterisk.classList.add('next-admin-layout-form-control-asterisk');
                    });
                    this.element.appendHTML('tr', tr => {
                        this.controlContainer = tr.appendHTML('td');
                        this.controlContainer.classList.add('next-admin-layout-form-control-cell');
                    });
                }
                this.labelContainer.classList.add('next-admin-layout-form-control-label-container');
                this.controlContainer.classList.add('next-admin-layout-form-control-control-container');
                this.setLabel(this.options.label);
                this.onValueChanged.subscribe(() => {
                    this.setError(null);
                });
                if (this.options.leftAddons) {
                    for (let addon of this.options.leftAddons) {
                        this.addLeftAddon(addon);
                    }
                }
                if (this.options.rightAddons) {
                    for (let addon of this.options.rightAddons) {
                        this.addRightAddon(addon);
                    }
                }
                LabelFormControl.onCreated.dispatch(this, this.options);
            }
            setPropertyInfo(propertyInfo) {
                super.setPropertyInfo(propertyInfo);
                if (!NextAdmin.String.isNullOrEmpty(propertyInfo?.displayName) && NextAdmin.String.isNullOrEmpty(this.getLabel())) {
                    this.setLabel(propertyInfo.displayName);
                }
            }
            setLabelWidth(width) {
                if (this.labelContainer) {
                    this.labelContainer.style.width = width;
                }
            }
            /**
           * Add addon at the right of the control
           * @param addon
           */
            addRightAddon(addon) {
                let newCell = document.createElement('td');
                this.controlContainer.parentElement.appendChild(newCell);
                return this.appendAddonCell(newCell, addon);
            }
            /**
             * Add addon at the left of the input
             * @param addon
             */
            addLeftAddon(addon) {
                let newCell = document.createElement('td');
                this.controlContainer.parentElement.insertBefore(newCell, this.controlContainer);
                return this.appendAddonCell(newCell, addon);
            }
            appendAddonCell(cell, addon) {
                cell.style.width = '0px';
                if (typeof addon == 'string') {
                    addon = cell.appendHTML(addon);
                }
                else if (typeof addon == 'number') {
                    addon = cell.appendControl(this.getFormControlAddon(addon));
                }
                else if (addon instanceof UI.Control) {
                    cell.appendControl(addon);
                }
                else {
                    cell.appendChild(addon);
                }
                return addon;
            }
            getFormControlAddon(addon) {
                switch (addon) {
                    case FormControlAddon.clipboardCopy:
                        return new UI.Button({
                            style: NextAdmin.UI.ButtonStyle.noBg,
                            text: NextAdmin.Resources.copyIcon,
                            popover: NextAdmin.Resources.copy,
                            action: () => {
                                navigator.clipboard.writeText(this.getValue());
                            }
                        });
                    default:
                        throw new Error('InvalidAddon : ' + addon);
                }
            }
            setValue(value, fireChange) {
                this.controlContainer.innerHTML = value;
                if (fireChange) {
                    this.onValueChanged.dispatch(this, { value: this.getValue() });
                }
            }
            getValue() {
                return this.controlContainer.innerHTML;
            }
            setLabel(text) {
                if (!NextAdmin.String.isNullOrEmpty(text)) {
                    this.labelContainer.style.display = '';
                    this.label.style.display = '';
                    this.label.innerHTML = text;
                }
                else {
                    this.labelContainer.style.display = 'none';
                    this.label.style.display = 'none';
                    this.label.innerHTML = '';
                }
                return this;
            }
            getLabel() {
                return this.label?.innerText ?? '';
            }
            setError(message) {
                if (message != null) {
                    this.label.classList.add('next-admin-control-label-error');
                    this.element.classList.add('next-admin-control-error');
                    this.element.setPopover(message);
                }
                else {
                    this.label.classList.remove('next-admin-control-label-error');
                    this.element.classList.remove('next-admin-control-error');
                    this.element.removePopover();
                    if (this._tooltipMessage != null) {
                        this.setTooltip(this._tooltipMessage);
                    }
                }
                this._errorMessage = message;
            }
            setTooltip(message) {
                if (message != null) {
                    this.label.classList.add('next-admin-control-label-info');
                    this.element.classList.add('next-admin-control-label-info');
                    this.element.setPopover(message, this.controlContainer);
                }
                else {
                    this.label.classList.remove('next-admin-control-label-info');
                    this.element.classList.remove('next-admin-control-label-info');
                    this.element.removePopover();
                    if (this._errorMessage != null) {
                        this.setError(this._errorMessage);
                    }
                }
                this._tooltipMessage = message;
            }
            displayAsRequired() {
                this.asterisk.innerHTML = '*';
            }
            displayAsNotRequired() {
                this.asterisk.innerHTML = '';
            }
            isEnable() {
                return !this._disabled;
            }
            enable() {
                this.controlContainer.enable();
                this._disabled = false;
            }
            disable() {
                this._disabled = true;
                this.controlContainer.disable();
            }
            getToolTip() {
                return this._tooltipMessage;
            }
        }
        LabelFormControl.defaultLabelWidth = '30%';
        LabelFormControl.style = `
        .next-admin-layout-form-control-cell {
            /*
            padding-left:2px;
            padding-right:2px;
            */
        }
        .next-admin-control-label-error {
            color:#ff0000
        }
        .next-admin-control-label-info {
            text-decoration:underline
        }
        .next-admin-layout-form-control-label-container {
            color:#444;
            font-size:14px;
        }
        .next-admin-layout-form-control-asterisk{
            color:#105ABE;
        }
        `;
        LabelFormControl.onCreated = new NextAdmin.EventHandler();
        UI.LabelFormControl = LabelFormControl;
        let FormControlAddon;
        (function (FormControlAddon) {
            FormControlAddon[FormControlAddon["clipboardCopy"] = 1] = "clipboardCopy";
        })(FormControlAddon = UI.FormControlAddon || (UI.FormControlAddon = {}));
        let FormControlLabelPosition;
        (function (FormControlLabelPosition) {
            FormControlLabelPosition["left"] = "left";
            FormControlLabelPosition["top"] = "top";
            FormControlLabelPosition["hidden"] = "hidden";
        })(FormControlLabelPosition = UI.FormControlLabelPosition || (UI.FormControlLabelPosition = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="LabelFormControl.ts"/>
/// <reference path="DefaultStyle.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Input extends UI.LabelFormControl {
            constructor(options) {
                super({
                    style: Input.defaultStyle,
                    ...options
                });
                NextAdmin.Style.append("Input", Input.style);
                this.input = this.controlContainer.appendHTML('input');
                this.input.style.width = '100%';
                this.input.classList.add('next-admin-input');
                if (this.options.inputType == InputType.checkbox) {
                    this.input.classList.add('next-admin-input-checkbox');
                }
                if (this.options.inputType == InputType.password) {
                    this.input.setAttribute('autocomplete', 'new-password');
                }
                if (this.options.decimalCount != null) {
                    if (this.options.inputType == null) {
                        this.options.inputType = InputType.number;
                    }
                    let step = '0.';
                    for (let i = 1; i < this.options.decimalCount; i++) {
                        step += '0';
                    }
                    step += '1';
                    this.input.step = step;
                }
                if (this.options.inputType != null) {
                    this.input.type = this.options.inputType;
                }
                if (this.options.inlineGrid) {
                    this.options.style = NextAdmin.UI.InputStyle.noBackground;
                    this.element.classList.add('next-admin-input-inline-grid');
                }
                this.input.addEventListener("input", () => {
                    let value = this.getValue();
                    if (this.options.decimalCount && value) {
                        value = Number(Number(value).toFixed(this.options.decimalCount));
                        this.setValue(value);
                    }
                    this.onValueChanged.dispatch(this, { value: value });
                });
                if (this.options.placeHolder != null) {
                    this.setPlaceholder(this.options.placeHolder);
                }
                this.setStyle(this.options.style);
                this.setSize(this.options.size);
                Input.onCreated.dispatch(this, this.options);
            }
            setStyle(style) {
                switch (style) {
                    default:
                    case InputStyle.default:
                        this.element.classList.add('next-admin-input-default');
                        break;
                    case InputStyle.modern:
                        this.element.classList.add('next-admin-input-modern');
                        break;
                    case InputStyle.noBackground:
                        this.element.classList.add('next-admin-input-no-background');
                        break;
                }
            }
            setSize(size) {
                switch (size) {
                    default:
                    case InputSize.medium:
                        break;
                    case InputSize.large:
                        this.input.classList.add('next-admin-input-large');
                        break;
                    case InputSize.ultraLarge:
                        this.input.classList.add('next-admin-input-ultra-large');
                        break;
                }
            }
            displayAsRequired() {
                super.displayAsRequired();
                this.input.classList.add('next-admin-required');
            }
            displayAsNotRequired() {
                super.displayAsNotRequired();
                if (this.input.classList.contains('next-admin-required')) {
                    this.input.classList.remove('next-admin-required');
                }
            }
            setError(message) {
                super.setError(message);
                if (message != null) {
                    this.input.classList.add('next-admin-error');
                }
                else {
                    this.input.classList.remove('next-admin-error');
                }
            }
            setPropertyInfo(propertyInfo) {
                super.setPropertyInfo(propertyInfo);
                if (propertyInfo?.type == 'number' && this.input.type == 'text') {
                    this.input.type = 'number';
                }
                else if (propertyInfo?.type == 'date' && this.input.type == 'text') {
                    this.input.type = 'date';
                }
            }
            setPlaceholder(text) {
                this.input.setAttribute('placeholder', text);
                return this;
            }
            setValue(value, fireChange) {
                if (value == null) {
                    this.input.value = '';
                }
                else {
                    if (this.input.type == 'date') {
                        if (value instanceof Date) {
                            this.input.value = value.toISOString().split('T')[0];
                        }
                        else {
                            let stringDate = value + '';
                            if (stringDate != '' && stringDate.indexOf('T') != -1) {
                                this.input.value = stringDate.split('T')[0];
                            }
                            else {
                                this.input.value = stringDate;
                            }
                        }
                    }
                    else if (this.input.type == 'time') {
                        if (value instanceof Date) {
                            this.input.value = value.toISOString().split('T')[1];
                        }
                        else {
                            let stringDate = value + '';
                            if (!NextAdmin.String.isNullOrEmpty(stringDate) && stringDate.indexOf('T') != -1) {
                                this.input.value = stringDate.split('T')[1];
                            }
                            else if (!NextAdmin.String.isNullOrEmpty(stringDate) && stringDate.indexOf(' ') != -1) {
                                this.input.value = stringDate.split(' ')[1];
                            }
                            else {
                                this.input.value = stringDate;
                            }
                        }
                    }
                    else if (value && this.input.type == 'number') {
                        let numberValue = Number(value);
                        this.input.value = Number.isInteger(numberValue) ? value : numberValue.toFixed(UI.UserInterfaceHelper.DefaultNumberDecimalCount);
                    }
                    else if (this.input.type == 'checkbox') {
                        if (value == 'true' || value == '1' || value == 'True' || value == true) {
                            this.input.checked = true;
                        }
                        else {
                            this.input.checked = false;
                        }
                    }
                    else {
                        this.input.value = value;
                    }
                }
                value = this.getValue();
                if (fireChange) {
                    this.onValueChanged.dispatch(this, { value: value, origin: UI.ChangeOrigin.code });
                }
            }
            getValue() {
                if (this.input.type == 'checkbox') {
                    return this.input.checked;
                }
                if (this.input.type == 'number' || this.input.type == 'range') {
                    return NextAdmin.String.isNullOrEmpty(this.input.value) ? null : Number(this.input.value);
                }
                if (this.options.outputNullIfEmpty && NextAdmin.String.isNullOrEmpty(this.input.value)) {
                    return null;
                }
                return this.input.value;
            }
            enable() {
                this.input.disabled = false;
                this._disabled = false;
            }
            disable() {
                this.input.disabled = true;
                this._disabled = true;
            }
        }
        Input.style = `

            .next-admin-input { 
                border-radius: 4px;
                height:32px;
                margin:0px;box-sizing:border-box; 
                outline:0px;border:1px solid #ccc; 
                background:rgba(250,250,250,1);
                font-size:14px;
                color:#444;
                padding-left:5px;
            }
            .next-admin-input-large{
                height:38px;
                font-size:18px;
            }
            .next-admin-input-ultra-large{
                height:46px;
                font-size:22px;
            }
            .next-admin-input-checkbox { 
                height:18px;
                margin-top:3px;
            } 
            .next-admin-table .next-admin-input { 
                border:0px;background:rgba(255,255,255,0)
            } 
            .next-admin-table .next-admin-input:hover {
                border:1px solid #ccc
            }
            .next-admin-control-error .next-admin-input { 
                background:#FFC7C7;
            }
            .next-admin-table .next-admin-control-error .next-admin-input { 
                background:rgba(255,0,0,0.3);
            }

            .next-admin-input-modern{
                .next-admin-input{
                    background:#fff;
                    border:1px solid #fff;
                    box-shadow: 0px 0px 2px rgba(0,0,0,0.25);
                    transition: 0.5s;
                }
                .next-admin-input:hover{
                    box-shadow: 0px 0px 2px rgba(0,0,0,0.40);
                }
                .next-admin-input-checkbox{
                    box-shadow: 0px 0px 0px rgba(0,0,0,0) !important;
                }

                *:disabled{
                    color:#999;
                }
                .next-admin-input:focus {
                    border: 1px solid #12101d;
                    text-shadow:0px 0px 2px rgba(0,0,0,0.2);
                }
            }

            .next-admin-input-no-background{
                .next-admin-input{
                    background:rgba(255,255,255,0);
                    border:0px;
                    box-shadow: unset;
                }
                *:disabled{
                    color:#999;
                }
                .next-admin-input:hover {
                    border:0px;
                    box-shadow: 0px 0px 2px rgba(0,0,0,0.40);
                }
            }

            .next-admin-input-inline-grid{
                .next-admin-input{
                    height:46px;
                    border-radius:0px;
                }
            }

            .next-admin-input.next-admin-required{
                background:` + UI.DefaultStyle.RequiredFieldBackground + `;
            }

            .next-admin-input.next-admin-error{
                background:#f5e4e4;
            }

            `;
        Input.onCreated = new NextAdmin.EventHandler();
        UI.Input = Input;
        let InputType;
        (function (InputType) {
            InputType["button"] = "button";
            InputType["checkbox"] = "checkbox";
            InputType["color"] = "color";
            InputType["date"] = "date";
            InputType["datetimeLocal"] = "datetime-local";
            InputType["email"] = "email";
            InputType["file"] = "file";
            InputType["hidden"] = "hidden";
            InputType["image"] = "image";
            InputType["month"] = "month";
            InputType["number"] = "number";
            InputType["password"] = "password";
            InputType["radio"] = "radio";
            InputType["range"] = "range";
            InputType["reset"] = "reset";
            InputType["search"] = "search";
            InputType["submit"] = "submit";
            InputType["tel"] = "tel";
            InputType["text"] = "text";
            InputType["time"] = "time";
            InputType["url"] = "url";
            InputType["week"] = "week";
        })(InputType = UI.InputType || (UI.InputType = {}));
        let InputStyle;
        (function (InputStyle) {
            InputStyle[InputStyle["default"] = 0] = "default";
            InputStyle[InputStyle["modern"] = 1] = "modern";
            InputStyle[InputStyle["noBackground"] = 2] = "noBackground";
        })(InputStyle = UI.InputStyle || (UI.InputStyle = {}));
        let InputSize;
        (function (InputSize) {
            InputSize[InputSize["medium"] = 0] = "medium";
            InputSize[InputSize["large"] = 1] = "large";
            InputSize[InputSize["ultraLarge"] = 2] = "ultraLarge";
        })(InputSize = UI.InputSize || (UI.InputSize = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Input.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Checkbox extends UI.Input {
            constructor(options) {
                super({
                    inputType: NextAdmin.UI.InputType.checkbox,
                    ...options
                });
            }
            getValue() {
                return this.input.checked;
            }
            isChecked() {
                return this.input.checked;
            }
        }
        UI.Checkbox = Checkbox;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Collapsible extends UI.Control {
            constructor(options) {
                super('div', options);
                this.onOpen = new NextAdmin.EventHandlerBase();
                this.onClose = new NextAdmin.EventHandlerBase();
                this._isOpen = false;
                this._isAnimating = false;
                NextAdmin.Style.append('NextAdmin.UI.Collapsible', Collapsible.style);
                this.header = this.element.appendHTML('div', (header) => {
                    header.style.cursor = 'pointer';
                    header.classList.add('next-admin-collapsible-header');
                    this.title = header.appendHTML('span', (titleContainer) => {
                        titleContainer.innerHTML = this.options.title ?? '';
                    });
                    this.caret = header.appendHTML('span', (dropDownIconContainer) => {
                        dropDownIconContainer.style.cssFloat = 'right';
                        dropDownIconContainer.innerHTML = NextAdmin.Resources.iconCaretDown;
                    });
                    header.addEventListener('click', () => {
                        this.toggle();
                    });
                });
                this.collapsableContainer = this.element.appendHTML('div', (collapsableContainer) => {
                    this.body = collapsableContainer.appendHTML('div', (body) => {
                        body.style.paddingTop = '10px';
                        if (this.options.content) {
                            this.setContent(this.options.content);
                        }
                    });
                    collapsableContainer.style.transition = '0.3s';
                    collapsableContainer.style.height = '0px';
                    collapsableContainer.style.overflow = 'auto';
                    if (NextAdmin.UserAgent.isDesktop()) {
                        collapsableContainer.appendPerfectScrollbar();
                    }
                });
                if (this.options.isOpen) {
                    this.open(false);
                }
            }
            async toggle() {
                if (!this._isOpen) {
                    await this.open();
                }
                else {
                    await this.close();
                }
            }
            async open(animate = true) {
                if (this._isOpen || this._isAnimating) {
                    return;
                }
                this._isAnimating = true;
                this.collapsableContainer.style.height = this.body.clientHeight + 'px';
                this.caret.innerHTML = NextAdmin.Resources.iconCaretLeft;
                //2023-12-10:Big hack to solve chrome bug, that cause blanck inputs inside container, so we force the rerender...
                this.collapsableContainer.style.width = '95%';
                if (animate) {
                    await NextAdmin.Timer.sleep(20);
                    this.collapsableContainer.style.width = '100%';
                    await NextAdmin.Timer.sleep(280);
                }
                this.collapsableContainer.style.height = 'unset';
                this.collapsableContainer.style.overflow = '';
                this._isOpen = true;
                this._isAnimating = false;
                this.onOpen.dispatch();
            }
            async close() {
                if (!this._isOpen || this._isAnimating) {
                    return;
                }
                this._isAnimating = true;
                this.collapsableContainer.style.height = this.collapsableContainer.clientHeight + 'px';
                this.caret.innerHTML = NextAdmin.Resources.iconCaretDown;
                await NextAdmin.Timer.sleep(20);
                this.collapsableContainer.style.height = '0px';
                this.collapsableContainer.style.overflow = 'auto';
                await NextAdmin.Timer.sleep(280);
                this._isOpen = false;
                this._isAnimating = false;
                this.onClose.dispatch();
            }
            setContent(content) {
                if (content == null) {
                    this.body.innerHTML = '';
                }
                else if (content instanceof UI.Control) {
                    this.body.appendControl(content);
                }
                else if (typeof content === 'string') {
                    this.body.innerHTML = content;
                }
                else {
                    this.body.appendChild(content);
                }
            }
        }
        Collapsible.style = `

        .next-admin-collapsible-header {
            color:#444;
            font-size:14px;
        }

        .next-admin-collapsible-header:hover {
            color:#666;
        }

        `;
        UI.Collapsible = Collapsible;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class CollapsibleFilter extends NextAdmin.UI.Control {
            constructor(options) {
                super('div', {
                    throttle: 50,
                    autoUdateSearch: true,
                    title: NextAdmin.Resources.searchIcon + ' ' + NextAdmin.Resources.filters,
                    ...options
                });
                this.timer = new NextAdmin.Timer();
                this.element.style.paddingTop = '6px';
                this.element.style.paddingLeft = '6px';
                this.element.style.paddingRight = '6px';
                this.element.appendControl(new UI.Collapsible({ title: this.options.title, isOpen: this.options.isOpen }), (collapsible) => {
                    collapsible.header.style.color = '#105ABE';
                    collapsible.header.style.borderBottom = '1px solid #eee';
                    collapsible.body.style.paddingTop = '0px';
                    this.formLayout = collapsible.body.appendControl(new UI.FormLayout_());
                    if (this.options.items) {
                        for (let item of this.options.items) {
                            this.addItem(item);
                        }
                    }
                });
                if (this.options.grid) {
                    this.grid = this.options.grid;
                    this.grid.onUpdateWhereQuery.subscribe((sender, gridQueryBuilder) => {
                        let resultQueryBuilder = this.updateQuery(gridQueryBuilder);
                        if (resultQueryBuilder) {
                            NextAdmin.Copy.copyTo(resultQueryBuilder, gridQueryBuilder);
                        }
                    });
                }
            }
            addView(viewName, items, active) {
                return this.formLayout.addView(viewName, items, active);
            }
            addItem(item) {
                let control = this.formLayout.addItem(item);
                if (control instanceof UI.FormControl) {
                    if (this.options.autoUdateSearch) {
                        control.onValueChanged.subscribe(() => {
                            this.updateSearch();
                        });
                    }
                }
                return control;
            }
            updateSearch(throttle = this.options.throttle) {
                if (!this.grid) {
                    return;
                }
                if (throttle) {
                    this.timer.throttle(() => {
                        this.grid.updateWhereQuery();
                        this.grid.datasetController.load();
                    }, throttle);
                }
                else {
                    this.grid.updateWhereQuery();
                    this.grid.datasetController.load();
                }
            }
            updateQuery(queryBuilder) {
                if (this.options.onUpdateQuery) {
                    queryBuilder = this.options.onUpdateQuery(queryBuilder);
                }
                return queryBuilder;
            }
        }
        UI.CollapsibleFilter = CollapsibleFilter;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Container extends UI.Control {
            constructor(options) {
                super('div', {
                    width: '1280px',
                    ...options
                });
                this.body = this.element.appendHTML('div', (body) => {
                    body.style.margin = '0 auto';
                    body.style.maxWidth = this.options.width;
                });
            }
        }
        UI.Container = Container;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class DataForm extends UI.Control {
            constructor(options) {
                super('div', {
                    dataController: options.dataController == null ? NextAdmin.Business.DataController_.factory(options.dataName) : options.dataController,
                    ...options
                });
                this.dataController = this.options.dataController;
                NextAdmin.Style.append('Form', DataForm.style);
                this.element.classList.add('next-admin-form');
                this.header = this.element.appendHTML('div', (header) => {
                    header.classList.add('next-admin-form-header');
                    if (this.options.label) {
                        header.innerHTML = this.options.label;
                    }
                });
                this.body = this.element.appendHTML('div', (body) => {
                });
                this.footer = this.element.appendHTML('div', (footer) => {
                    footer.classList.add('next-admin-form-footer');
                    footer.appendControl(new NextAdmin.UI.Toolbar(), (toolbar) => {
                        toolbar.element.style.cssFloat = 'right';
                        toolbar.appendControl(this.cancelButton = new UI.Button({
                            text: NextAdmin.Resources.refreshIcon + ' ' + NextAdmin.Resources.cancel, action: () => {
                                this.dataController.cancel();
                            }
                        }));
                        this.deleteButton = new UI.Button({ text: NextAdmin.Resources.deleteIcon + ' ' + NextAdmin.Resources.delete });
                        toolbar.appendControl(this.saveButton = new UI.Button({
                            text: NextAdmin.Resources.saveIcon + ' ' + NextAdmin.Resources.save,
                            style: UI.ButtonStyle.green,
                            action: () => {
                                this.dataController.save();
                            }
                        }));
                    });
                });
                this.dataController.bindToForm(this);
                if (this.options.label) {
                    this.header.innerHTML = this.options.label;
                }
            }
            enableReadOnly() {
            }
            disableReadOnly() {
            }
        }
        DataForm.style = '.next-admin-form { border:1px solid #ccc;padding-left:5px;padding-right:5px} .next-admin-form-header{border-bottom:1px solid #ccc;padding:5px} .next-admin-form-footer{border-top:1px solid #ccc;padding:5px;min-height:24px}';
        UI.DataForm = DataForm;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Modal.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class DataFormModal extends UI.Modal {
            static createUnique(className, options) {
                let formModal;
                eval('formModal = new ' + className + '(options)');
                if (formModal == null) {
                    console.log('Unable to instanciate FormModal : ' + className);
                    return null;
                }
                return DataFormModal.getUnique(formModal, options?.dataPrimaryKey);
            }
            static createUniqueByDataName(dataName, options) {
                let formModal = DataFormModal.formModalByDataNameFactory(dataName, options);
                if (formModal == null) {
                    console.log('Unable to instanciate FormModal for data : ' + dataName);
                    return null;
                }
                return DataFormModal.getUnique(formModal, options?.dataPrimaryKey);
            }
            static getUnique(formModal, formModalDataPrimaryKey) {
                if (formModalDataPrimaryKey) {
                    let newModalKey = formModal.computeKey(formModalDataPrimaryKey);
                    let registeredModal = UI.Modal.getRegisteredModal(newModalKey);
                    if (registeredModal) {
                        formModal = registeredModal;
                    }
                }
                return formModal;
            }
            constructor(options) {
                super({
                    hasBodyOverflow: true,
                    hasFooterCloseButton: true,
                    dataController: options.dataController == null && NextAdmin.Business.DataController_.factory ? NextAdmin.Business.DataController_.factory(options.dataName) : options.dataController,
                    canSave: true,
                    canDelete: true,
                    canCancel: true,
                    ...options
                });
                this.onValidate = new NextAdmin.EventHandler();
                this.onEndOpen = new NextAdmin.EventHandler();
                this.onInitialize = new NextAdmin.AsyncEventHandler();
                NextAdmin.Style.append('NextAdmin.UI.FormModal', DataFormModal_.Style);
                this.dataController = this.options.dataController;
                if (this.dataController == null) {
                    this.options.isDetailFormModal = true;
                    this.dataController = new NextAdmin.Business.LocalDataController({ dataName: this.options.dataName });
                }
                if (this.options.isDetailFormModal) {
                    this.options.hasValidateButton = true;
                }
                this.dataController.onStartChangeData.subscribe(async (sender, args) => {
                    await this.initialize(args.newData, args.newDataState);
                });
                this.dataController.onStartSaveData.subscribe(async (sender, args) => {
                    await this.beforeSave(args);
                });
                if (this.options.onDataSaved && this.dataController) {
                    this.dataController.onDataSaved.subscribe((sender, args) => this.options.onDataSaved(this, args));
                }
                if (this.options.onDataDeleted && this.dataController) {
                    this.dataController.onDataDeleted.subscribe((sender, data) => this.options.onDataDeleted(this, data));
                }
                if (this.options.title == null) {
                    this.setTitle(this.dataController.getDataDisplayName());
                    this.dataController.onDataChanged.subscribe(() => {
                        this.setTitle(this.dataController.getDataDisplayName() + ' : ' + this.dataController.getDataDisplayValue());
                    });
                    this.dataController.onControlChanged.subscribe(() => {
                        this.setTitle(this.dataController.getDataDisplayName() + ' : ' + this.dataController.getDataDisplayValue());
                    });
                }
                this.rightFooterToolBar = this.rightFooter.appendControl(new UI.Toolbar(), (toolBar) => {
                    toolBar.element.style.cssFloat = 'right';
                    this.cancelButton = new UI.Button({
                        text: NextAdmin.Resources.refreshIcon + ' ' + NextAdmin.Resources.cancel, action: () => {
                            this.dataController.cancel();
                        }
                    });
                    if (this.options.canCancel) {
                        toolBar.appendControl(this.cancelButton);
                    }
                    this.deleteButton = new UI.Button({
                        text: NextAdmin.Resources.deleteIcon + ' ' + NextAdmin.Resources.delete,
                        style: UI.ButtonStyle.red,
                        action: () => {
                            UI.MessageBox.createYesCancel(NextAdmin.Resources.formDeleteMessageTitle, NextAdmin.Resources.formDeleteMessage, async () => {
                                this.startSpin();
                                let result = await this.dataController.delete();
                                this.stopSpin();
                                if (result.success) {
                                    this.close({ chackDataState: false });
                                }
                            });
                        }
                    });
                    if (this.options.canDelete) {
                        toolBar.appendControl(this.deleteButton);
                    }
                    this.saveButton = new UI.Button({
                        text: NextAdmin.Resources.saveIcon + ' ' + NextAdmin.Resources.save,
                        style: UI.ButtonStyle.green,
                        action: () => {
                            this.dataController.save();
                        }
                    });
                    if (this.options.canSave) {
                        toolBar.appendControl(this.saveButton);
                    }
                    if (this.options.hasFooterCloseButton) {
                        toolBar.appendControl(this.footerCloseButton = new UI.Button({
                            text: NextAdmin.Resources.closeIcon + ' ' + NextAdmin.Resources.close,
                            action: () => {
                                this.close({ chackDataState: true });
                            }
                        }));
                    }
                });
                this.dataController.bindToForm(this);
                this.dataController.onDataChanged.subscribe((sender, args) => {
                    this._key = this.computeKey(args.newData[this.dataController.options.dataPrimaryKeyName]);
                    if (NextAdmin.UserAgent.isMobile()) {
                        setTimeout(() => {
                            if (document.activeElement) {
                                document.activeElement.blur();
                                if (args.previousData == null || Object.keys(args.previousData).length === 1) {
                                    this.body.scrollTo(0, 0);
                                }
                            }
                        }, 10);
                    }
                });
                if (this.options.hasValidateButton) {
                    this.saveButton.element.remove();
                    this.deleteButton.element.remove();
                    //this.cancelButton.element.remove();
                    if (this.footerCloseButton) {
                        this.footerCloseButton.element.remove();
                    }
                    this.validateButton = this.rightFooterToolBar.appendControl(new NextAdmin.UI.Button({
                        text: NextAdmin.Resources.checkIcon + ' ' + NextAdmin.Resources.validate,
                        css: { cssFloat: 'right' },
                        action: () => {
                            this.validate();
                        }
                    }));
                    this.dataController.onDataStateChanged.subscribe((sender, args) => {
                        if (args.newState == NextAdmin.Business.DataState.append || args.newState == NextAdmin.Business.DataState.edited) {
                            this.validateButton.enable();
                        }
                        else if (args.newState == NextAdmin.Business.DataState.serialized) {
                            this.validateButton.disable();
                        }
                    });
                }
                DataFormModal_.onCreated.dispatch(this, this.options);
            }
            async validate() {
                this.onValidate.dispatch(this, this.dataController.data);
                if (!this.options.isDetailFormModal) {
                    this.startSpin();
                    let result = await this.dataController.save();
                    this.stopSpin();
                    if (result.success) {
                        this.close();
                    }
                }
                else {
                    this.close();
                }
                return true;
            }
            computeKey(dataPrimaryKey) {
                if (dataPrimaryKey == null) {
                    return null;
                }
                return this['constructor'].name + '_' + this.dataController.options.dataName + '_' + dataPrimaryKey;
            }
            getKey() {
                return this.computeKey(this.dataController.getDataPrimaryKeyValue());
            }
            async open(openArgs) {
                let isAlreadyRegistered = this.isRegistered();
                super.open(openArgs);
                if (!isAlreadyRegistered && openArgs != null) {
                    if (this.options.isDetailFormModal && openArgs.data == null && !openArgs.appendNewData) {
                        throw new Error("Form modal used as detail form modal require data");
                    }
                    this.startSpin();
                    if (openArgs.data != null) {
                        this.originalData = openArgs.data;
                        await this.dataController.setData(NextAdmin.Copy.clone(openArgs.data), openArgs.dataState);
                    }
                    else if (openArgs.dataPrimaryKey != null) {
                        await this.dataController.load(openArgs.dataPrimaryKey, {
                            onGetResponse: (result) => {
                                if (result.success && openArgs?.onDataLoaded) {
                                    openArgs.onDataLoaded(result.data);
                                }
                            }
                        });
                    }
                    else if (openArgs.appendNewData) {
                        await this.dataController.append({
                            onGetResponse: (result) => {
                                if (result.success && openArgs?.onDataLoaded) {
                                    openArgs.onDataLoaded(result.data);
                                }
                            }
                        });
                    }
                    this.stopSpin();
                    this.onEndOpen.dispatch(this, this.dataController.data);
                }
            }
            async initialize(data, dataState) {
                await this.onInitialize.dispatch(this, {
                    data: data,
                    dataState: dataState
                });
                if (this.options.onInitialize) {
                    this.options.onInitialize(this, {
                        data: data,
                        dataState: dataState
                    });
                }
            }
            async beforeSave(args) {
            }
            close(args) {
                args = {
                    chackDataState: !this.options.isDetailFormModal && !this.options.hasValidateButton,
                    ...args
                };
                if (args.chackDataState) {
                    this.dataController.askUserToSaveDataIfNeededAndExecuteAction(() => {
                        super.close(args);
                    });
                }
                else {
                    super.close(args);
                }
            }
            enableReadOnly() {
            }
            disableReadOnly() {
            }
            getData() {
                return this.dataController.data;
            }
            getPropertyName(dataDefPropertyAction) {
                return this.dataController.getPropertyName(dataDefPropertyAction);
            }
        }
        DataFormModal.Style = `
            .next-admin-modal-modern{
                .next-admin-modal-body{

                }
            }    
        `;
        DataFormModal.onCreated = new NextAdmin.EventHandler();
        UI.DataFormModal = DataFormModal;
        class DataFormModal_ extends DataFormModal {
        }
        UI.DataFormModal_ = DataFormModal_;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class FormLayout extends NextAdmin.UI.Control {
            constructor(options) {
                super('div', { rowCount: 0, columnCount: 0, ...options });
                this.rows = new Array();
                this.onDrowCell = new NextAdmin.EventHandler();
                this._columnCount = 0;
                this._rowCount = 0;
                this._controlsDictionary = new NextAdmin.Dictionary();
                this._itemsDictionary = new NextAdmin.Dictionary();
                this._cellsDictionary = new NextAdmin.Dictionary();
                this._viewsDictionary = new NextAdmin.Dictionary();
                this.dataController = this.options.dataController;
                NextAdmin.Style.append('NextAdmin.UI.FormLayout', FormLayout_.style);
                this.element.classList.add('next-admin-form-layout');
                this.element.style.width = '100%';
                this.table = this.element.appendHTML('table', (table) => {
                    table.style.width = '100%';
                });
                this.setStyle(this.options.style);
                this.addView(FormLayout.defaultViewName, [], true);
                this.initialize(this.options.columnCount, this.options.rowCount, this.options.items);
            }
            setStyle(style) {
                switch (style) {
                    case FormLayoutStyle.thinLabels:
                        this.element.classList.add('thin-label');
                        break;
                    default:
                        break;
                }
            }
            initialize(colCount, rowCount, items) {
                this._columnCount = colCount;
                this._rowCount = rowCount;
                this._cellsDictionary = new NextAdmin.Dictionary();
                this._itemsDictionary = new NextAdmin.Dictionary();
                this.rows = [];
                this.table.innerHTML = '';
                this.firstRow = this.table.appendHTML('tr', (row) => {
                    for (let iCol = 0; iCol < this._columnCount; iCol++) {
                        row.appendHTML('td', (td) => {
                            td.style.width = (100 / colCount) + '%';
                        });
                    }
                });
                for (let iRow = 0; iRow < this._rowCount; iRow++) {
                    this.table.appendHTML('tr', (row) => {
                        this.rows.add(row);
                        for (let iCol = 0; iCol < this._columnCount; iCol++) {
                            row.appendHTML('td', (td) => {
                                this._cellsDictionary.add((iCol + 1) + ',' + (iRow + 1), td);
                            });
                        }
                    });
                }
                if (items != null) {
                    for (let item of items) {
                        this.addItem(item);
                    }
                }
            }
            getView(viewName) {
                return this._viewsDictionary.get(viewName);
            }
            addView(viewName, items, active) {
                let view = {
                    name: viewName,
                    items: items ?? []
                };
                this._viewsDictionary.add(viewName, view);
                if (active) {
                    this.setActiveView(viewName);
                }
                return view;
            }
            addViewItems(viewName, items) {
                let view = this.getView(viewName);
                if (view == null) {
                    return this.addView(viewName, items);
                }
                if (items) {
                    for (let item of items) {
                        let existingItem = view.items.firstOrDefault(a => a.id == item.id);
                        if (existingItem) {
                            view.items.replace(existingItem, item);
                        }
                        else {
                            view.items.add(item);
                        }
                    }
                }
                return view;
            }
            addViewItem(viewName, item) {
                let view = this.getView(viewName);
                if (view == null) {
                    return this.addView(viewName, [item]);
                }
                let existingItem = view.items.firstOrDefault(a => a.id == item.id);
                if (existingItem) {
                    view.items.replace(existingItem, item);
                }
                else {
                    view.items.add(item);
                }
                return view;
            }
            setActiveView(viewName) {
                if (NextAdmin.String.isNullOrEmpty(viewName)) {
                    viewName = FormLayout.defaultViewName;
                }
                if (this._activeViewName == viewName)
                    return;
                let view = this._viewsDictionary.get(viewName);
                if (view == null) {
                    throw Error('Unable to find view:' + viewName);
                }
                this._activeViewName = viewName;
                let items = new Array();
                for (let viewItem of view.items) {
                    let control = this._controlsDictionary.get(viewItem.id);
                    if (control == null) {
                        console.log('View: ' + viewName + ', unable to find control : ' + viewItem.id);
                        continue;
                    }
                    items.add({
                        control: control,
                        labelWidth: control instanceof UI.LabelFormControl ? control.options.labelWidth : null,
                        ...viewItem
                    });
                }
                let minColCount = items.max(e => e.col);
                let minRowCount = items.max(e => e.row);
                this.initialize(minColCount, minRowCount, items);
            }
            getActiveView() {
                return this._activeViewName ? this._viewsDictionary.get(this._activeViewName) : null;
            }
            enableResponsiveMode(getActivViewFunc) {
                this.element.appendControl(new UI.ResisingContainer(), (resizingContainer) => {
                    resizingContainer.element.style.width = '100%';
                    resizingContainer.element.style.height = '0px';
                    resizingContainer.element.style.visibility = 'hidden';
                    resizingContainer.onSizeChanged.subscribe(() => {
                        this.setActiveView(getActivViewFunc(this));
                    });
                    this.setActiveView(getActivViewFunc(this));
                });
            }
            setColumnCount(columnCount) {
                if (columnCount > this._columnCount) {
                    for (let iCol = this._columnCount; iCol < columnCount; iCol++) {
                        this.firstRow.appendHTML('td');
                        let iRow = 0;
                        for (let row of this.rows) {
                            row.appendHTML('td', (td) => {
                                this._cellsDictionary.add((iCol + 1) + ',' + (iRow + 1), td);
                            });
                            iRow++;
                        }
                    }
                    for (let cell of this.firstRow.cells) {
                        cell.style.width = (100 / columnCount) + '%';
                    }
                    this._columnCount = columnCount;
                }
                else if (columnCount < this._columnCount) {
                    this.initialize(columnCount, this._rowCount, this._itemsDictionary.getValues());
                }
            }
            setRowCount(rowCount) {
                if (rowCount > this._rowCount) {
                    for (let iRow = this._rowCount; iRow < rowCount; iRow++) {
                        this.table.appendHTML('tr', (row) => {
                            this.rows.add(row);
                            for (let iCol = 0; iCol < this._columnCount; iCol++) {
                                row.appendHTML('td', (td) => {
                                    this._cellsDictionary.add((iCol + 1) + ',' + (iRow + 1), td);
                                });
                            }
                        });
                    }
                    this._rowCount = rowCount;
                }
            }
            setColumnWidth(columnIndex, width) {
                (this.firstRow.cells[columnIndex]).style.width = width;
            }
            addItem(item) {
                if (item.id == null) {
                    if (item.html) {
                        item.id = item.html;
                    }
                }
                if (item.colSpan == null) {
                    item.colSpan = 1;
                }
                if (item.rowSpan == null) {
                    item.rowSpan = 1;
                }
                if (item.id == null) {
                    item.id = NextAdmin.Guid.newGuid().toString();
                }
                if (item.col + item.colSpan - 1 > this._columnCount) {
                    this.setColumnCount(item.col + item.colSpan - 1);
                }
                if (item.row + item.rowSpan - 1 > this._rowCount) {
                    this.setRowCount(item.row + item.rowSpan - 1);
                }
                let activeView = this.getActiveView();
                if (activeView.items.firstOrDefault(a => a.id == item.id) == null) {
                    activeView.items.add({
                        id: item.id,
                        col: item.col,
                        row: item.row,
                        colSpan: item.colSpan,
                        rowSpan: item.rowSpan
                    });
                }
                let cell = this._cellsDictionary.get(item.col + ',' + item.row);
                cell.innerHTML = '';
                let control;
                if (item.control != null) {
                    control = item.control;
                }
                else if (item.controlType != null) {
                    if (item.controlOption != null) {
                        eval("control=new " + item.controlType + "(item.controlOption)");
                    }
                    else {
                        eval("control=new " + item.controlType + "()");
                    }
                }
                else if (item.useDefaultControl && !NextAdmin.String.isNullOrEmpty(item.propertyName) && this.options.dataController != null) {
                    let propertyInfo = this.options.dataController.getDataPropertyInfo_(this.options.dataController.options.dataName, item.propertyName);
                    control = UI.Helper.getDefaultPropertyFormControl(propertyInfo);
                }
                else if (item.html) {
                    control = document.createElement('div');
                    control.innerHTML = item.html;
                }
                if (this.options.dataController != null && item.propertyName != null && control instanceof UI.FormControl && control.getBindedPropertyName() == null) {
                    this.options.dataController.bindControl(control, item.propertyName);
                    control['_bindedPropertyName'] = item.propertyName; /*Not required because dataController.bindControl will set this property */
                }
                if (item.labelWidth && control instanceof UI.LabelFormControl) {
                    control.setLabelWidth(item.labelWidth);
                }
                if (!(control instanceof FormLayout)) {
                    cell.classList.add('next-admin-form-layout-cell');
                }
                if (control) {
                    if (control instanceof UI.Control) {
                        cell.appendControl(control);
                    }
                    else {
                        cell.appendChild(control);
                    }
                    this._controlsDictionary.set(item.id, control);
                }
                let restaurCellToDefault = (c) => {
                    c.colSpan = 1;
                    c.rowSpan = 1;
                    if (c['_adjcentCells'] != null) {
                        for (let adjacentCell of c['_adjcentCells']) {
                            adjacentCell.style.display = '';
                        }
                        c['_adjcentCells'] = [];
                    }
                };
                restaurCellToDefault(cell);
                if (cell['_parentCell'] != null) {
                    restaurCellToDefault(cell['_parentCell']);
                }
                cell.style.display = '';
                cell.colSpan = item.colSpan;
                cell.rowSpan = item.rowSpan;
                let adjcentsCells = [];
                for (let iRow = item.row; iRow <= item.row + item.rowSpan - 1; iRow++) {
                    for (let iCol = item.col; iCol <= item.col + item.colSpan - 1; iCol++) {
                        let adjcentCell = this._cellsDictionary.get(iCol + ',' + iRow);
                        if (adjcentCell == cell)
                            continue;
                        adjcentCell.style.display = 'none';
                        adjcentsCells.add(adjcentCell);
                        adjcentCell['_parentCell'] = cell;
                    }
                }
                cell['_adjcentCells'] = adjcentsCells;
                cell['_control'] = control;
                cell['_id'] = item.id;
                this._itemsDictionary.set(item.id, item);
                if (item.configAction) {
                    item.configAction(control);
                }
                this.onDrowCell.dispatch(this, { cell: cell, options: item, control: control });
                return control;
            }
            removeItemByPosition(col, row) {
                let cell = this._cellsDictionary[col + ',' + row];
                if (cell != null && cell['_control'] != null) {
                    this._itemsDictionary.remove(cell['_id']);
                    cell['_control'].element.remove();
                    delete cell['_id'];
                }
            }
            removeItem(itemId, tryDispose = true) {
                let item = this.getItem(itemId);
                if (!item) {
                    return;
                }
                if (tryDispose && item.control) {
                    if (item.control instanceof NextAdmin.UI.FormControl) {
                        this.dataController.unbindControl(item.control);
                    }
                    if (item.control instanceof UI.Control) {
                        item.control.dispose();
                    }
                }
                let cell = this._cellsDictionary.get(item.col + ',' + item.row);
                if (cell) {
                    cell.innerHTML = '';
                    delete cell['_id'];
                }
                this._controlsDictionary.remove(item.id);
                this._itemsDictionary.remove(item.id);
            }
            moveItem(itemId, targetCol, targetRow, disposeTargetPositionControl = true) {
                let item = this.getItem(itemId);
                if (item == null) {
                    return;
                }
                let targetPositionItem = this.getItemByPosition(targetCol, targetRow);
                if (targetPositionItem) {
                    this.removeItem(targetPositionItem.id, disposeTargetPositionControl);
                }
                this.removeItem(itemId, false);
                item.col = targetCol;
                item.row = targetRow;
                this.addItem(item);
            }
            setFormControlPosition(property, col, row) {
                let control = this.dataController.getControl(property);
                if (control == null) {
                    return;
                }
                let item = this.getItem(property);
                if (item != null) {
                    this.moveItem(item.id, col, row, false);
                }
                else {
                    let itemAtTargetPosition = this.getItemByPosition(col, row);
                    if (itemAtTargetPosition != null) {
                        this.removeItem(itemAtTargetPosition.id, false);
                    }
                    this.addItem({ col: col, row: row, control: control });
                }
            }
            clear() {
                this.initialize(0, 0);
            }
            getItems() {
                return this._itemsDictionary.getValues();
            }
            getItem(id) {
                return this._itemsDictionary.get(id);
            }
            getControl(id) {
                return this._controlsDictionary.get(id);
            }
            getControlByPosition(col, row) {
                let cell = this.getCell(col, row);
                if (cell == null) {
                    return null;
                }
                return cell['_control'];
            }
            getFormControlItem(property) {
                let control = this.dataController.getControl(property);
                return this.getItems().firstOrDefault(a => a.control == control);
            }
            getItemByPosition(col, row) {
                let cell = this._cellsDictionary.get(col + ',' + row);
                if (!cell || !cell['_id']) {
                    return null;
                }
                return this.getItem(cell['_id']);
            }
            getPrintableElement(options) {
                //return document.createElement('table');
                let printableElement = document.createElement('table');
                printableElement.style.width = '100%';
                for (let row of this.rows) {
                    printableElement.appendHTML('tr', (tr) => {
                        for (let cell of row.cells) {
                            tr.appendHTML('td', (td) => {
                                if (cell.style.width != null) {
                                    td.style.width = cell.style.width;
                                }
                                if (cell['_control'] instanceof UI.FormControl) {
                                    td.append(cell['_control'].getPrintableElement());
                                }
                                else {
                                    td.innerHTML = cell.innerHTML;
                                }
                            });
                        }
                    });
                }
                return printableElement;
            }
            getControls() {
                return this._controlsDictionary.getValues().where(a => a instanceof NextAdmin.UI.Control);
            }
            getFormControls() {
                return this._controlsDictionary.getValues().where(a => a instanceof NextAdmin.UI.FormControl);
            }
            unbindControls() {
                for (let control of this._controlsDictionary.getValues()) {
                    if (control instanceof NextAdmin.UI.FormControl) {
                        this.dataController.unbindControl(control);
                    }
                }
            }
            bindControls(updateControlValueFromData = true) {
                for (let control of this._controlsDictionary.getValues()) {
                    if (control instanceof NextAdmin.UI.FormControl && control['_bindedPropertyName']) {
                        this.dataController.bindControl(control, control['_bindedPropertyName']);
                        if (updateControlValueFromData) {
                            control.setValue(this.dataController.data[control['_bindedPropertyName']]);
                        }
                    }
                }
            }
            getRow(rowIndex) {
                return this.rows.length > rowIndex ? this.rows[rowIndex] : null;
            }
            getCell(col, row) {
                return this._cellsDictionary.get(col + ',' + row);
            }
            getCells() {
                return this._cellsDictionary.getValues();
            }
            getRowCount() {
                return this._rowCount;
            }
            getColumnCount() {
                return this._columnCount;
            }
        }
        FormLayout.defaultViewName = 'DEFAULT';
        FormLayout.style = `

        .next-admin-form-layout{

            .next-admin-form-layout-cell{
                padding:5px;
            }
        }
        .next-admin-form-layout.thin-label{
            .next-admin-layout-form-control-label-container{
                padding-left:4px;font-size:12px
            }
        }


        `;
        UI.FormLayout = FormLayout;
        class FormLayout_ extends FormLayout {
        }
        UI.FormLayout_ = FormLayout_;
        let FormLayoutStyle;
        (function (FormLayoutStyle) {
            FormLayoutStyle[FormLayoutStyle["thinLabels"] = 0] = "thinLabels";
        })(FormLayoutStyle = UI.FormLayoutStyle || (UI.FormLayoutStyle = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="FormControl.ts"/>
/// <reference path="Modal.ts"/>
/// <reference path="FormLayout.ts"/>
/// <reference path="DefaultStyle.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class DataGrid extends UI.FormControl {
            constructor(options) {
                super('div', {
                    style: DataGrid_.defaultStyle,
                    hasActionMenu: true,
                    rowsBordered: false,
                    synchronizeDataWithFormModal: true,
                    stretchWidth: true,
                    stretchHeight: true,
                    datasetController: options.datasetController == null && NextAdmin.Business.DatasetController_.factory != null ? NextAdmin.Business.DatasetController_.factory(options.dataName) : options.datasetController,
                    canDiscoverSchema: true,
                    canEdit: true,
                    actionColumnWidth: '100px',
                    selectDataPrimaryKey: true,
                    viewsDataPropertyName: 'controlName',
                    viewsGridIdPropertyName: 'controlData',
                    loadingMode: DataLoadingMode.query,
                    displayNoDataMessage: true,
                    minHeight: '200px',
                    canSelectView: options?.views?.length > 1,
                    enableDoubleClickOpenModal: true,
                    hasTopBar: true,
                    reorderingRowMode: DataGridReorderingRowMode.dragAndDropHandle,
                    columns: [],
                    reports: [],
                    views: [],
                    openAction: options.formModalFactory == null ? null : (row) => {
                        this.openData(row);
                    },
                    addAction: () => {
                        this.appendData();
                    },
                    deleteAction: (grid, rows) => {
                        this.deleteRows(rows);
                    },
                    refreshAction: () => {
                        if (this.datasetController == null) {
                            return;
                        }
                        if (this.datasetController.isDataUpToDate() || (!this.options.canSave && this._masterFormController == null)) {
                            this.datasetController.load();
                        }
                        else {
                            UI.MessageBox.createYesCancel(NextAdmin.Resources.warning, NextAdmin.Resources.lostDataNotSavedMessage, () => {
                                this.datasetController.load();
                            });
                        }
                    },
                    renderActionColumnCell: (cell) => {
                        cell.element.appendControl(this.createActionColumnCellToolbar(cell));
                    },
                    hasContextMenu: true,
                    ...options
                });
                this.columns = new Array();
                this.actionColumn = null;
                this.rows = new Array();
                this.rowDictionary = {};
                this.onDrawCell = new NextAdmin.EventHandler();
                this.onDrawRow = new NextAdmin.EventHandler();
                this.onSelectedRowsChanged = new NextAdmin.EventHandler();
                this.onRowSelected = new NextAdmin.EventHandler();
                this.onRowUnselected = new NextAdmin.EventHandler();
                this.onRowRemoved = new NextAdmin.EventHandler();
                this.onRowAdded = new NextAdmin.EventHandler();
                this.onAddingData = new NextAdmin.EventHandler();
                this.onRemovingData = new NextAdmin.EventHandler();
                this.onAddingDataset = new NextAdmin.EventHandler();
                this.onLoading = new NextAdmin.EventHandler();
                this.onSaving = new NextAdmin.EventHandler();
                this.onValueChanged = new NextAdmin.EventHandler();
                this.onFormModalCreated = new NextAdmin.EventHandler();
                this.onDatasetChanged = new NextAdmin.EventHandler();
                this.onViewsUpdated = new NextAdmin.EventHandler();
                this.onUpdateWhereQuery = new NextAdmin.EventHandler();
                this.onViewChanged = new NextAdmin.EventHandler();
                this.onDoubleClickRow = new NextAdmin.EventHandler();
                this.onOpenContextMenu = new NextAdmin.EventHandler();
                this.onFilterValueChanged = new NextAdmin.EventHandler();
                this.onColumnOrderChanged = new NextAdmin.EventHandler();
                this.onColumnFilterSearchValueChanged = new NextAdmin.EventHandler();
                this.onColumnFilterSelectedValuesChanged = new NextAdmin.EventHandler();
                this._disabled = false;
                this._createdModals = new Array();
                this._previousScrollTop = 0;
                this._suspendChanging = false;
                this.datasetController = this.options.datasetController;
                if (this.options.canExport == null) {
                    this.options.canExport = this.datasetController != null;
                }
                if (this.options.canPrint == null) {
                    this.options.canPrint = this.datasetController != null;
                }
                NextAdmin.Style.append("NextAdmin.UI.Table", UI.Table.style);
                NextAdmin.Style.append("NextAdmin.UI.Grid", DataGrid_.style);
                if (this.options.hasActionColumn == undefined && ((options.deleteMode != null && options.deleteMode != DataDeleteMode.disabled) || options.formModalFactory != null || this.getRowOrderPropertyName() != null)) {
                    this.options.hasActionColumn = true;
                }
                if (this.options.searchMode == null && this.options.canSave == true) {
                    this.options.searchMode = DataSearchMode.disabled;
                }
                if (this.options.canAdd === undefined) {
                    this.options.canAdd = options.formModalFactory != null || options.canEdit;
                }
                DataGrid_.onCreating.dispatch(this, this.options);
                this.element.style.width = this.options.stretchWidth ? '100%' : 'fit-content';
                this.layout = this.element.appendControl(new NextAdmin.UI.FlexLayout({ direction: UI.FlexLayoutDirection.vertical }));
                this.topBar = this.layout.appendHTML('div');
                this.topBar.classList.add('next-admin-table-header');
                this.topBar.appendHTML('table', (table) => {
                    table.style.borderSpacing = '0px';
                    table.style.width = '100%';
                    table.appendHTML('tr', (tr) => {
                        this.leftHeader = tr.appendHTML('td');
                        this.rightHeader = tr.appendHTML('td');
                    });
                });
                if (!this.options.hasTopBar) {
                    this.topBar.style.display = 'none';
                }
                this.stretchContainer = this.layout.appendHTMLStretch('div');
                this.stretchContainer.style.position = 'relative';
                this.bottomBar = this.layout.appendHTML('div');
                this.tableContainer = this.stretchContainer.appendHTML('div');
                this.tableContainer.style.width = this.options.stretchWidth ? '100%' : 'fit-content';
                this.tableContainer.style.display = 'flex';
                this.tableContainer.style.flexDirection = 'column';
                if (this.options.stretchHeight) {
                    this.element.style.height = '100%';
                    this.tableContainer.style.position = 'absolute';
                    this.tableContainer.style.height = '100%';
                    this.tableContainer.style.left = '0px';
                    this.tableContainer.style.top = '0px';
                    this.tableContainer.style.overflow = 'auto';
                    /*
                    if (UserAgent.isDesktop()) {
                        this.tableContainer.appendPerfectScrollbar();
                    }*/
                }
                this.table = this.tableContainer.appendHTML('table');
                this.table.classList.add('next-admin-table');
                this.table.classList.add('next-admin-table');
                if (this.options.stretchWidth) {
                    this.table.style.width = '100%';
                }
                this.tHead = document.createElement('thead');
                this.tHead.classList.add('next-admin-table-thead');
                this.table.appendChild(this.tHead);
                this.headerRow = document.createElement('tr');
                this.headerRow.classList.add('next-admin-table-thead-row');
                this.tHead.appendChild(this.headerRow);
                this.tBody = document.createElement('tbody');
                this.table.appendChild(this.tBody);
                this.tFoot = document.createElement('tfoot');
                this.table.appendChild(this.tFoot);
                this.emptyArea = this.tableContainer.appendHTML('div', (emptyArea) => {
                    emptyArea.style.flexGrow = '1';
                    emptyArea.addEventListener('click', () => {
                        this.unselectRows(true);
                    });
                });
                if (this.getRowOrderPropertyName()) {
                    this._orderingColumnInfo = {
                        column: new DataGridColumn(this, null, { label: 'OrderColumn', propertyName: options.orderPropertyName }),
                        ordering: ColumnOrdering.ascending
                    };
                }
                this.toolBar = this.leftHeader.appendControl(new UI.Toolbar());
                this.filtersContainer = this.topBar.appendHTML('div');
                this.filtersContainer.classList.add('next-admin-table-filter-container');
                this.actionMenuDropDownButton = new UI.DropDownButton({
                    text: NextAdmin.Resources.menuIcon + ' ' + NextAdmin.Resources.menu,
                    dropDownPosition: UI.DropDownPosition.down
                });
                if (this.options.hasActionMenu) {
                    this.toolBar.appendControl(this.actionMenuDropDownButton);
                    this.buttonRefresh = this.actionMenuDropDownButton.addElement({
                        text: NextAdmin.Resources.refreshIcon + ' ' + (this.options.canSave ? NextAdmin.Resources.cancel + ' / ' + NextAdmin.Resources.refresh : NextAdmin.Resources.refresh),
                        action: () => {
                            if (this.options.refreshAction) {
                                this.options.refreshAction(this);
                            }
                        }
                    });
                }
                else {
                    this.buttonRefresh = this.toolBar.appendControl(new UI.Button({
                        text: NextAdmin.Resources.refreshIcon + ' ' + (this.options.canSave ? NextAdmin.Resources.cancel + ' / ' + NextAdmin.Resources.refresh : ''),
                        style: UI.ButtonStyle.bgWhite,
                        action: (btn) => {
                            if (this.options.refreshAction) {
                                this.options.refreshAction(this);
                            }
                        }
                    }));
                }
                if ((this.options.canRefresh !== undefined && this.datasetController == null) || this.options.canRefresh === false || this.options.loadingMode == DataLoadingMode.disabled) {
                    this.buttonRefresh.element.style.display = 'none';
                }
                let elementDisplayName = this?.datasetController?.getDataDisplayName();
                this.buttonAdd = this.toolBar.appendControl(new UI.Button({
                    text: this.options.buttonAddText ?? (elementDisplayName ? NextAdmin.Resources.addIcon + ' ' + NextAdmin.Resources.add + ' : ' + this?.datasetController?.getDataDisplayName() : NextAdmin.Resources.addIcon + ' ' + NextAdmin.Resources.add),
                    style: UI.ButtonStyle.blue,
                    action: () => {
                        if (this.options.addAction != null) {
                            this.options.addAction(this);
                        }
                    }
                }));
                if (!this.options.canAdd) {
                    this.buttonAdd.element.style.display = 'none';
                }
                //update entities
                this.buttonSave = this.toolBar.appendControl(new UI.Button({
                    text: NextAdmin.Resources.saveIcon + ' ' + NextAdmin.Resources.save, style: UI.ButtonStyle.green, action: () => {
                        this.datasetController.save();
                    }
                }));
                this.buttonSave.disable();
                if (!this.options.canSave) {
                    this.buttonSave.element.style.display = 'none';
                }
                this.buttonMultiDelete = new UI.Button({
                    text: NextAdmin.Resources.deleteIcon + ' ' + NextAdmin.Resources.deleteMulti,
                    action: () => {
                        if (this.options.deleteAction) {
                            this.options.deleteAction(this, this.getSelectedRows());
                        }
                    }
                });
                if (this.isMultiDeleteEnabled()) {
                    if (this.options.hasActionMenu) {
                        this.actionMenuDropDownButton.appendControl(this.buttonMultiDelete);
                    }
                    else {
                        this.toolBar.appendControl(this.buttonMultiDelete);
                        this.buttonMultiDelete.setColorStyle(UI.ButtonStyle.red);
                    }
                    this.buttonMultiDelete.disable();
                    this.onDatasetChanged.subscribe(() => {
                        if (this.getRows().where(a => a.isSelected()).length > 0) {
                            this.buttonMultiDelete.enable();
                        }
                        else {
                            this.buttonMultiDelete.disable();
                        }
                    });
                    this.onSelectedRowsChanged.subscribe((sender, selectedRows) => {
                        if (this.getRows().where(a => a.isSelected()).length > 0) {
                            this.buttonMultiDelete.enable();
                        }
                        else {
                            this.buttonMultiDelete.disable();
                        }
                    });
                }
                this.generateReportButton = new NextAdmin.UI.DropDownButton({ text: NextAdmin.Resources.printIcon + ' ' + NextAdmin.Resources.generateDocument });
                this.generateReportButton.dropDown.onOpen.subscribe((dropDown) => {
                    dropDown.clearItems();
                    dropDown.addElement(new UI.DropDownButton({
                        text: NextAdmin.Resources.standardListExport, items: [
                            {
                                text: NextAdmin.Resources.printAll,
                                action: () => {
                                    this.generateReportButton.closeDropDown();
                                    this.exportData({
                                        exportFormat: 'print',
                                        exportSelectedDataOnly: false,
                                        exportVisibleColumnOnly: true,
                                        exportColumnsDisplayNames: true,
                                        exportFormatedValues: true
                                    });
                                }
                            },
                            {
                                text: NextAdmin.Resources.printSelection,
                                action: () => {
                                    this.generateReportButton.closeDropDown();
                                    this.exportData({
                                        exportFormat: 'print',
                                        exportSelectedDataOnly: true,
                                        exportVisibleColumnOnly: true,
                                        exportColumnsDisplayNames: true,
                                        exportFormatedValues: true
                                    });
                                }
                            }
                        ]
                    }));
                    if (this.options.reports != null) {
                        for (let report of this.options.reports) {
                            this.generateReportButton.addElement(new UI.DropDownButton({
                                text: report.label, items: [
                                    {
                                        text: NextAdmin.Resources.printAll,
                                        action: () => {
                                            this.actionMenuDropDownButton.closeDropDown();
                                            let tempDataController = this.datasetController.clone();
                                            tempDataController.take(null);
                                            tempDataController.skip(null);
                                            tempDataController.select(this.datasetController.options.dataPrimaryKeyName);
                                            tempDataController.load({
                                                onGetResponse: (result) => {
                                                    if (result.success) {
                                                        let dataIds = result.dataset.select(e => e[this.datasetController.options.dataPrimaryKeyName]);
                                                        report.action(this, dataIds);
                                                    }
                                                }
                                            });
                                        }
                                    },
                                    {
                                        text: NextAdmin.Resources.printSelection,
                                        action: () => {
                                            this.actionMenuDropDownButton.closeDropDown();
                                            let tempDataController = this.datasetController.clone();
                                            tempDataController.take(null);
                                            tempDataController.skip(null);
                                            tempDataController.select(this.datasetController.options.dataPrimaryKeyName);
                                            let ids = this.getSelectedDataRows().select(e => e.data[this.datasetController.options.dataPrimaryKeyName]);
                                            tempDataController.where(this.datasetController.options.dataPrimaryKeyName + ' IN(' + ids.select(e => '?') + ')', ...ids);
                                            tempDataController.load({
                                                onGetResponse: (result) => {
                                                    if (result.success) {
                                                        let dataIds = result.dataset.select(e => e[this.datasetController.options.dataPrimaryKeyName]);
                                                        report.action(this, dataIds);
                                                    }
                                                }
                                            });
                                        }
                                    }
                                ]
                            }));
                        }
                    }
                });
                this.actionMenuDropDownButton.addElement(this.generateReportButton);
                if (!this.options.canPrint) {
                    this.generateReportButton.element.style.display = 'none';
                }
                this.exportButton = this.actionMenuDropDownButton.addElement({
                    text: NextAdmin.Resources.downloadIcon + ' ' + NextAdmin.Resources.export,
                    action: () => {
                        new ExportModal(this).open();
                    }
                });
                if (!this.options.canExport) {
                    this.exportButton.element.style.display = 'none';
                }
                //GridOption
                if (this.options.actionMenuItems) {
                    this.actionMenuDropDownButton.addItems(this.options.actionMenuItems);
                }
                this.searchBox = new UI.Input({ css: { cssFloat: 'right', maxWidth: '180px' } });
                this.searchBox.setPlaceholder(NextAdmin.Resources.search);
                if (this.options.searchMode == DataSearchMode.server || this.options.searchMode == DataSearchMode.local || (this.options.searchMode === undefined && this.options.columns != null && this.options.columns.firstOrDefault(e => e.searchable) != null)) {
                    this.rightHeader.appendControl(this.searchBox);
                    this.enableSearch();
                }
                else {
                    this.searchBox.element.style.display = 'none';
                }
                this.viewSelect = new UI.Select();
                this.viewSelect.element.style.width = '150px';
                this.initializeViews();
                if (this.options.paginItemCount && this.datasetController != null) {
                    this.datasetController.take(this.options.paginItemCount);
                    this.enableScrollLoading();
                }
                if (this.datasetController != null) {
                    this.datasetController.onStartRequest.subscribe(() => {
                        if (this.options.loadingMode == DataLoadingMode.query) {
                            let containId = false;
                            let columnsToSelect = this.columns.where(e => e != this.actionColumn && e.isQueryble()).select(e => e.options).addRange(this.options.columns.where(e2 => e2.hidden == true)).select((gco) => {
                                if (gco.selectQuery == null) {
                                    if (gco.propertyName == this.datasetController.options.dataPrimaryKeyName) {
                                        containId = true;
                                    }
                                    return gco.propertyName;
                                }
                                let selectQuey = gco.selectQuery;
                                if (!selectQuey.toLowerCase().contains(' as ')) {
                                    selectQuey = selectQuey + ' as ' + gco.propertyName;
                                }
                                if (gco.propertyName == this.datasetController.options.dataPrimaryKeyName) {
                                    containId = true;
                                }
                                return selectQuey;
                            });
                            if (!containId && this.options.selectDataPrimaryKey) {
                                columnsToSelect.add(this.datasetController.options.dataPrimaryKeyName);
                            }
                            let orderPropertyName = this.getRowOrderPropertyName();
                            if (orderPropertyName && !columnsToSelect.contains(orderPropertyName)) {
                                columnsToSelect.add(orderPropertyName);
                            }
                            this.datasetController.select(...columnsToSelect);
                        }
                        else {
                            this.datasetController.select();
                        }
                        if (!this._suspendUpdateDataFromDataController) {
                            if (this.buttonAdd.isEnable()) {
                                this.buttonAdd.startSpin();
                            }
                            if (this.buttonSave.isEnable()) {
                                this.buttonSave.startSpin();
                            }
                            if (this.buttonRefresh.isEnable()) {
                                this.buttonRefresh.startSpin();
                            }
                            this.startSpin();
                        }
                    });
                    this.datasetController.onEndRequest.subscribe(() => {
                        this.buttonAdd.stopSpin();
                        this.buttonSave.stopSpin();
                        this.buttonRefresh.stopSpin();
                        this.stopSpin();
                    });
                    this.datasetController.onDataLoaded.subscribe((sender, result) => {
                        if (!this._suspendUpdateDataFromDataController) {
                            this.setDataset(result.dataset, NextAdmin.Business.DataState.serialized, false);
                        }
                    });
                    this.datasetController.onDataAdded.subscribe((sender, result) => {
                        this.addDataset(result.dataset, NextAdmin.Business.DataState.serialized);
                    });
                    this.datasetController.onDataSaved.subscribe((sender, result) => {
                        if (result.success) {
                            this.setDataset(result.newDataset, NextAdmin.Business.DataState.serialized);
                            this.buttonSave.disable();
                            this.setError(null);
                        }
                        else if (result.errors != null && result.errors.length > 0) {
                            //find member label from columns
                            for (let error of result.errors) {
                                if (error.propertyDisplayName == null) {
                                    let columnMember = this.columns.firstOrDefault(e => e.options.propertyName == error.propertyName);
                                    if (columnMember != null && columnMember.options.label != null) {
                                        error.propertyDisplayName = columnMember.options.label;
                                    }
                                }
                            }
                            this.setError(result.errors);
                            this.datasetController.displayDataErrors(null, NextAdmin.Business.DataControllerActionType.save, result);
                        }
                        else {
                            if (this.datasetController.dataset.firstOrDefault(e => NextAdmin.Business.DataStateHelper.getDataState(e) == NextAdmin.Business.DataState.deleted)) {
                                UI.MessageBox.createOk(NextAdmin.Resources.error, NextAdmin.Resources.defaultDeleteError);
                            }
                            else {
                                this.datasetController.displayDefaultError(result);
                            }
                        }
                    });
                    this.datasetController.onDataAppened.subscribe((sender, result) => {
                        if (this.options.formModalFactory != null) {
                            let modal = this.createModal(result.data);
                            if (modal != null) {
                                modal.open({ data: result.data, dataPrimaryKey: NextAdmin.Business.DataState.append });
                            }
                        }
                        else {
                            this.addDataItem(result.data, NextAdmin.Business.DataState.append, true);
                        }
                    });
                    this.datasetController.onDataCleared.subscribe((result) => {
                        this.clear();
                    });
                }
                if (this.options.page != null && this.options.canSave && this.datasetController != null) {
                    let checkDataState = true;
                    let navigateFromFunc = (sender, args) => {
                        if (checkDataState) {
                            args.cancelNavigation = true;
                            this.datasetController.askUserToSaveDataIfNeededAndExecuteAction(async () => {
                                checkDataState = false;
                                await this.options.page.navigationController.navigateTo(args.nextPage.options.name, args.nextPageParameters);
                                checkDataState = true;
                            });
                        }
                    };
                    this.options.page.onNavigateFrom.subscribe(navigateFromFunc);
                }
                if (this.options.hasContextMenu) {
                    this.tableContainer.oncontextmenu = (e) => {
                        e.stopPropagation();
                        e.preventDefault();
                        this.openContextMenu(e);
                        return false;
                    };
                }
                this.setStyle(this.options.style);
                if (this.options.minHeight) {
                    this.stretchContainer.style.minHeight = this.options.minHeight;
                }
                if (this.options.displayNoDataMessage) {
                    this.noDataMessageContainer = this.stretchContainer.appendHTML('div', (noDataMessageContainer) => {
                        noDataMessageContainer.style.pointerEvents = 'none';
                        noDataMessageContainer.style.position = 'absolute';
                        noDataMessageContainer.style.left = '0px';
                        noDataMessageContainer.style.top = '0px';
                        noDataMessageContainer.style.height = '100%';
                        noDataMessageContainer.style.width = '100%';
                        noDataMessageContainer.anim('fadeIn');
                        noDataMessageContainer.appendHTML('div', (noDataMessage) => {
                            noDataMessage.classList.add('next-admin-table-no-data-message');
                            noDataMessage.style.pointerEvents = 'none';
                            noDataMessage.center();
                            noDataMessage.innerHTML = NextAdmin.Resources.noDataIcon + ' ' + NextAdmin.Resources.noDataAvailable;
                        });
                        this.onRowAdded.subscribe(() => {
                            noDataMessageContainer.style.display = 'none';
                        });
                        this.onRowRemoved.subscribe(() => {
                            if (this.rows.length == 0) {
                                noDataMessageContainer.style.display = '';
                            }
                        });
                    });
                }
                if (this.hasDragAndDropEnabled()) {
                    this.initilizeDragAndDrop();
                }
                DataGrid_.onCreated.dispatch(this, this.options);
            }
            openData(row) {
                let openModel = () => {
                    let modal = this.createModal(row.data);
                    if (modal != null) {
                        if (this.options.openFormModalWithRowData) {
                            modal.open({ data: row.data });
                        }
                        else {
                            modal.open({ dataPrimaryKey: row.data[modal.dataController.options.dataPrimaryKeyName] });
                        }
                    }
                };
                if (!this.options.openFormModalWithRowData && this.options.canSave && this.options.formModalFactory) {
                    this.datasetController.askUserToSaveDataIfNeededAndExecuteAction(() => {
                        openModel();
                    });
                }
                else if (!this.options.openFormModalWithRowData && this._dataController != null && this.options.formModalFactory) {
                    this._dataController.ensureUpToDate(() => {
                        openModel();
                    });
                }
                else if (this._masterFormController != null) {
                    this._masterFormController.ensureUpToDate(() => {
                        openModel();
                    });
                }
                else {
                    openModel();
                }
            }
            appendData() {
                if (this.options.openFormModalWithRowData && this.options.formModalFactory != null) {
                    let modal = this.createModal();
                    modal.open({ appendNewData: true });
                }
                else if (this.datasetController == null) {
                    this.addDataItem({}, NextAdmin.Business.DataState.append, true);
                    return;
                }
                else if (this._masterFormController != null && this.options.formModalFactory != null) {
                    this._masterFormController.ensureUpToDate(async () => {
                        let result = await this.datasetController.append();
                        if (result.success) {
                            let detailProperties = this.datasetController.getDataInfo().propertyInfos;
                            for (let propertyName in detailProperties) {
                                let property = detailProperties[propertyName];
                                if (property.foreignDataName == this._masterFormController.options.dataName) {
                                    result.data[property.name] = this._masterFormController.getDataPrimaryKeyValue();
                                    break;
                                }
                            }
                        }
                    });
                }
                else if (this._dataController != null && this.options.formModalFactory != null) {
                    this._dataController.ensureUpToDate(async () => {
                        let result = await this.datasetController.append();
                        if (result.success) {
                            let detailProperties = this.datasetController.getDataInfo().propertyInfos;
                            for (let propertyName in detailProperties) {
                                let property = detailProperties[propertyName];
                                if (property.foreignDataName == this._dataController.options.dataName) {
                                    result.data[property.name] = this._dataController.getDataPrimaryKeyValue();
                                    break;
                                }
                            }
                        }
                    });
                }
                else if (this.options.canSave && this.options.formModalFactory != null) {
                    this.datasetController.askUserToSaveDataIfNeededAndExecuteAction(() => {
                        this.datasetController.append();
                    });
                }
                else {
                    this.datasetController.append();
                }
            }
            async load(options) {
                options = {
                    updateQuery: true,
                    ...options
                };
                if (this.datasetController == null) {
                    throw Error('Gird:Unable to load data without datasetController');
                }
                if (options?.updateQuery) {
                    this.updateWhereQuery(this.getCurrentView());
                }
                let previousDataset = this.datasetController.dataset;
                this._suspendUpdateDataFromDataController = true;
                if (!options?.updateOnlyIfDataChanged || !previousDataset?.length) {
                    this.startSpin();
                }
                let result = await this.datasetController.load();
                this._suspendUpdateDataFromDataController = false;
                this.stopSpin();
                if (!result?.success) {
                    return null;
                }
                if (options?.updateOnlyIfDataChanged && previousDataset?.length && result?.dataset?.length) {
                    for (let data of previousDataset) {
                        delete data['_state'];
                    }
                    if (JSON.stringify(previousDataset) == JSON.stringify(result.dataset)) {
                        return null;
                    }
                }
                this.setDataset(result.dataset, NextAdmin.Business.DataState.serialized, options?.tryPreserveSelectionAndScroll, options?.fireChange);
                return result.dataset;
            }
            isMultiDeleteEnabled() {
                return this.isMultiSelectEnabled() && this.options.deleteMode != NextAdmin.UI.DataDeleteMode.disabled;
            }
            isMultiSelectEnabled() {
                return this.options.rowSelectionMode == NextAdmin.UI.RowSelectionMode.multiSelect || this.options.rowSelectionMode == NextAdmin.UI.RowSelectionMode.multiSelect_CtrlShift;
            }
            hasDragAndDropEnabled() {
                return this.options.orderPropertyName && this.options.reorderingRowMode != DataGridReorderingRowMode.buttons;
            }
            initilizeDragAndDrop() {
                if (NextAdmin.UserAgent.isDesktop()) {
                    this.tableContainer.addEventListener('pointermove', (event) => {
                        if (this.currentDraggingRow == null) {
                            return;
                        }
                        event.preventDefault();
                        this.dragRow(event.clientX, event.clientY);
                    });
                    this.tableContainer.addEventListener('pointerup', (event) => {
                        if (this.currentDraggingRow == null) {
                            return;
                        }
                        event.preventDefault();
                        this.dropRow();
                    });
                }
                else {
                    this.tableContainer.addEventListener('touchmove', (event) => {
                        if (!event.touches?.length || this.currentDraggingRow == null) {
                            return;
                        }
                        event.preventDefault();
                        event.stopPropagation();
                        let touchX = event.touches[0].clientX;
                        let touchY = event.touches[0].clientY;
                        this.currentHovredRow = null;
                        for (let row of this.rows) {
                            let rowBounding = row.element.getBoundingClientRect();
                            if (rowBounding.left < touchX && rowBounding.right > touchX && rowBounding.top < touchY && rowBounding.bottom > touchY) {
                                this.currentHovredRow = row;
                                break;
                            }
                        }
                        this.dragRow(touchX, touchY);
                    });
                    this.tableContainer.addEventListener('touchend', (event) => {
                        if (this.currentDraggingRow == null) {
                            return;
                        }
                        this.dropRow();
                    });
                }
            }
            startDragRow(row) {
                if (this.currentDraggingRow) {
                    this.dropRow();
                }
                this.unselectRows(true);
                this.selectRow(row, true);
                this.currentDraggingRow = row;
                this.currentDraggingRow.element.classList.add('next-admin-table-dragging-row');
            }
            dragRow(pointerX, pointerY) {
                if (this.currentDraggingRow != null && this.currentHovredRow != null && this.currentHovredRow != this.currentDraggingRow && this.currentHovredRow.element.previousElementSibling != this.currentDraggingRow.element) {
                    this.currentHovredRow.element.insertControlBefore(this.currentDraggingRow);
                }
                else if (this.currentDraggingRow != null && this.currentHovredRow == null && this.tBody.getChildrenElements().lastOrDefault() != this.currentDraggingRow.element) {
                    this.tBody.appendControl(this.currentDraggingRow);
                }
            }
            dropRow() {
                if (this.currentDraggingRow != null) {
                    this.currentDraggingRow.element.classList.remove('next-admin-table-dragging-row');
                    this.currentDraggingRow = null;
                    this.rows = this.getRows();
                    let i = 0;
                    for (let row of this.rows) {
                        row.data[this.options.orderPropertyName] = i;
                        i++;
                    }
                    this.fireChange();
                }
            }
            /**
             * Return all rows in tbody
             * @returns
             */
            getRows() {
                let rows = new Array();
                for (let row of this.tBody.getChildrenElements()) {
                    rows.add(row['_control']);
                }
                return rows;
            }
            /**
             * Return only rows binded to data
             * @returns
             */
            getDataRows() {
                return this.rows;
            }
            setStyle(style) {
                switch (style) {
                    default:
                    case UI.TableStyle.default:
                        this.element.classList.add('next-admin-table-default');
                        break;
                    case UI.TableStyle.modern:
                        this.element.classList.add('next-admin-table-modern');
                        break;
                    case UI.TableStyle.modernNoCellPadding:
                        this.element.classList.add('next-admin-table-modern-no-cell-padding');
                        break;
                    case UI.TableStyle.card:
                        this.element.classList.add('next-admin-table-card');
                        break;
                }
            }
            refreshSelectView() {
                this.viewSelect.clearItems();
                for (let view of this.options.views.orderBy(a => a.displayOrder ?? 0)) {
                    this.viewSelect.addItem(view.id, view.name, view.id == this.options.defaultViewId);
                }
                this.onViewsUpdated.dispatch(this, this.options.views);
            }
            deleteRows(rows) {
                if (this.options.deleteMode == NextAdmin.UI.DataDeleteMode.local) {
                    for (let row of rows) {
                        let removingDataArgs = { data: row.data, cancel: false };
                        this.onRemovingData.dispatch(this, removingDataArgs);
                        if (removingDataArgs.cancel) {
                            continue;
                        }
                        this.removeRow(row);
                    }
                    this.buttonMultiDelete.disable();
                }
                else {
                    if (this.datasetController == null) {
                        throw new Error('please set dataset form to enable hard delete');
                    }
                    UI.MessageBox.createYesCancel(NextAdmin.Resources.formDeleteMessageTitle, NextAdmin.Resources.formDeleteMessage, async () => {
                        let waitBox = NextAdmin.UI.MessageBox.createLoading();
                        let result = await this.datasetController.deleteItems(rows.select(e => e.data));
                        waitBox.close();
                        if (result.success) {
                            for (let row of rows) {
                                let removingDataArgs = { data: row.data, cancel: false };
                                this.onRemovingData.dispatch(this, removingDataArgs);
                                if (removingDataArgs.cancel) {
                                    continue;
                                }
                                this.removeRow(row);
                            }
                            this.buttonMultiDelete.disable();
                        }
                    });
                }
            }
            initializeViews() {
                if (this.options.views != null) {
                    let hasSystemView = this.options.views.where(e => !e.isUserView).count() > 0;
                    if (!hasSystemView) { //Aucune vue systme, elle sera donc cr depuis les colonnes
                        let viewColumns = new Array();
                        for (let columnOption of this.options.columns) {
                            let viewColumnOption = {
                                label: columnOption.label,
                                propertyName: columnOption.propertyName,
                                selectQuery: columnOption.selectQuery,
                                width: columnOption.width,
                                maxWidth: columnOption.maxWidth,
                                minWidth: columnOption.minWidth,
                                cellCss: { ...columnOption.cellCss },
                                defaultOrdering: columnOption.defaultOrdering
                            };
                            viewColumns.add(viewColumnOption);
                        }
                        let systemView = {
                            name: NextAdmin.Resources.systemViewName,
                            id: NextAdmin.Guid.newGuid().toString(),
                            isUserView: false,
                            columns: viewColumns
                        };
                        this.options.views.add(systemView);
                    }
                    this.refreshSelectView();
                    if (this.options.canSelectView) {
                        this.toolBar.appendControl(this.viewSelect);
                    }
                    let activViewId = this.viewSelect.getValue();
                    if (activViewId) {
                        this.setViewById(activViewId, false);
                    }
                    this.viewSelect.onValueChanged.subscribe((sender, args) => {
                        if (args.value != null) {
                            let view = this.options.views.firstOrDefault(e => e.id == args.value);
                            if (view != null) {
                                this.setView(view, true);
                            }
                        }
                    });
                }
                else {
                    this.setView(null, false);
                }
            }
            disable() {
                this.buttonSave.disable();
                this.buttonMultiDelete.disable();
                this.buttonAdd.disable();
                this._disabled = true;
                this.setValue(this.getValue()); //force rerender
            }
            enable() {
                this.buttonSave.enable();
                this.buttonMultiDelete.enable();
                this.buttonAdd.enable();
                this._disabled = false;
                this.setValue(this.getValue()); //force rerender
            }
            isEnable() {
                return !this._disabled;
            }
            setView(view, load = false) {
                this.columns = [];
                this.rows = [];
                this.rowDictionary = {};
                this.headerRow.innerHTML = '';
                this.tBody.innerHTML = '';
                if (this.options.hasActionColumn) {
                    this.addActionColumn();
                }
                if (this.viewFiltersLayout) {
                    this.viewFiltersLayout.element.remove();
                    this.viewFiltersLayout = null;
                }
                if (view == null) {
                    for (let column of this.options.columns) {
                        if (!column.hidden) {
                            this.addColumn(column);
                        }
                    }
                    if (this.options.datasetController != null) {
                        this.options.datasetController.where(null);
                    }
                    if (this.options.orderPropertyName) {
                        this._orderingColumnInfo = {
                            column: new DataGridColumn(this, null, { label: 'OrderColumn', propertyName: this.options.orderPropertyName }),
                            ordering: ColumnOrdering.ascending
                        };
                    }
                }
                else {
                    if (view.orderPropertyName) {
                        this._orderingColumnInfo = {
                            column: new DataGridColumn(this, null, { label: 'OrderColumn', propertyName: view.orderPropertyName }),
                            ordering: ColumnOrdering.ascending
                        };
                    }
                    this.viewSelect.setValue(view.id);
                    for (let viewColumnOpion of view.columns) {
                        let columnOpion = this.options.columns.firstOrDefault(e => e.propertyName == viewColumnOpion.propertyName);
                        let newColumnOption = { ...columnOpion, ...viewColumnOpion };
                        if (!newColumnOption.hidden) {
                            this.addColumn(newColumnOption);
                        }
                    }
                }
                if (this.options.datasetController != null) {
                    if (view != null && view.filters?.length) {
                        this.viewFiltersLayout = this.filtersContainer.appendControl(new UI.CollapsibleFilter({
                            title: NextAdmin.Resources.searchIcon + ' ' + NextAdmin.Resources.userFilters,
                            items: view.filters
                        }));
                        this.viewFiltersLayout.element.style.marginTop = '4px';
                        if (this.viewFiltersLayout.options.items && this.viewFiltersLayout.options.items.length > 0) {
                            for (let item of this.viewFiltersLayout.options.items) {
                                let control = this.viewFiltersLayout.formLayout.getControlByPosition(item.col, item.row);
                                if (control != null) {
                                    control.onValueChanged.subscribe((sender, args) => {
                                        this.onFilterValueChanged.dispatch(this, {
                                            filterName: item.propertyName,
                                            filter: control,
                                            changeArgs: args
                                        });
                                        this.updateWhereQuery(view);
                                        this.options.datasetController.load();
                                    });
                                }
                            }
                        }
                    }
                    this.updateWhereQuery(view);
                }
                let defaultOrderingColumn = this.columns.firstOrDefault(e => e.options.defaultOrdering != null);
                if (defaultOrderingColumn != null) {
                    this.orderBy(defaultOrderingColumn, defaultOrderingColumn.options.defaultOrdering);
                }
                this._currentView = view;
                if (load && this.options.datasetController != null) {
                    this.options.datasetController.load();
                }
                this.onViewChanged.dispatch(this, view);
            }
            getFilter(filterName) {
                let filterGridItem = this.viewFiltersLayout.options.items.firstOrDefault(a => a.propertyName == filterName);
                if (filterGridItem != null) {
                    return this.viewFiltersLayout.formLayout.getControlByPosition(filterGridItem.col, filterGridItem.row);
                }
                return null;
            }
            getFilters() {
                if (this.viewFiltersLayout == null) {
                    return [];
                }
                return this.viewFiltersLayout.options.items.select(a => {
                    if (a != null) {
                        return {
                            filterName: a.propertyName,
                            filter: this.viewFiltersLayout.formLayout.getControlByPosition(a.col, a.row)
                        };
                    }
                    return null;
                }).where(a => a != null);
            }
            getColumn(columnName) {
                return this.columns.firstOrDefault(a => a.options.propertyName == columnName);
            }
            updateWhereQuery(view) {
                let wjereQuery = '';
                let whereArgs = [];
                this._previousScrollTop = 0;
                if (view != null && !NextAdmin.String.isNullOrWhiteSpace(view.filterQuery)) {
                    wjereQuery = view.filterQuery == null ? '' : view.filterQuery.toString();
                    whereArgs = view.filterQueryValues == null ? [] : view.filterQueryValues.clone();
                    if (view.filters != null && this.viewFiltersLayout != null) {
                        let indexOfChar = 0;
                        let indexOfParam = 0;
                        for (; indexOfChar < wjereQuery.length; indexOfChar++) {
                            let char = wjereQuery[indexOfChar];
                            if (char == '?') {
                                let filterName = '';
                                let i = indexOfChar + 1;
                                for (; i < wjereQuery.length; i++) {
                                    if ([' ', ',', '(', ')', '<', '>', '=', '-', '!', '?', '@', '\n', '\r'].contains(wjereQuery[i])) {
                                        break;
                                    }
                                    filterName += wjereQuery[i];
                                }
                                if (!NextAdmin.String.isNullOrWhiteSpace(filterName)) {
                                    wjereQuery = wjereQuery.substring(0, indexOfChar + 1) + wjereQuery.substring(i);
                                    let filterValue = null;
                                    let filterOption = view.filters.firstOrDefault(e => e.propertyName == filterName);
                                    if (filterOption != null) {
                                        let filter = this.viewFiltersLayout.formLayout.getControlByPosition(filterOption.col, filterOption.row);
                                        if (filter != null) {
                                            filterValue = filter.getValue();
                                        }
                                    }
                                    if (filterValue === '') {
                                        filterValue = null;
                                    }
                                    whereArgs.insert(indexOfParam, filterValue);
                                    indexOfParam++;
                                }
                                else {
                                    indexOfParam++;
                                }
                            }
                        }
                    }
                }
                let filterColumns = this.columns.where(c => !NextAdmin.String.isNullOrEmpty(c.filterQuery) && c.filterArgs != null);
                if (filterColumns.count() > 0) {
                    if (!NextAdmin.String.isNullOrEmpty(wjereQuery)) {
                        wjereQuery = '(' + wjereQuery + ') AND ';
                    }
                    wjereQuery += filterColumns.select(a => '(' + a.filterQuery + ')').join(' AND ');
                    for (let filterColumn of filterColumns) {
                        whereArgs.addRange(filterColumn.filterArgs);
                    }
                }
                let queryBuilder = new NextAdmin.Business.QueryBuilder().where(wjereQuery, ...whereArgs);
                this.onUpdateWhereQuery.dispatch(this, queryBuilder);
                if (this.options.onUpdateWhereQuery) {
                    this.options.onUpdateWhereQuery(this, queryBuilder);
                }
                this.options.datasetController.where(queryBuilder.query.whereQuery, ...queryBuilder.query.whereQueryArgs);
            }
            getCurrentView() {
                return this._currentView;
            }
            setViewById(viewId, load = false) {
                this.setView(this.options.views.firstOrDefault(e => e.id == viewId), load);
            }
            setError(errors) {
                if (Array.isArray(errors)) {
                    for (let error of errors) {
                        let row = this.getRowByDataId(error.dataId);
                        if (row != null) {
                            let cell = row.cells.firstOrDefault(e => e.column.options.propertyName == error.propertyName);
                            if (cell != null && cell.control != null) {
                                cell.control.setError(error.message);
                            }
                        }
                    }
                }
                else if (errors == null) {
                    for (let row of this.rows) {
                        for (let cell of row.cells) {
                            if (cell.control != null) {
                                cell.control.setError(null);
                            }
                        }
                    }
                }
            }
            enableSearch() {
                let timer = new NextAdmin.Timer();
                this.searchBox.onValueChanged.subscribe((searchBox, args) => {
                    timer.throttle(() => {
                        this.setSearchValue(args.value, true);
                    }, 500);
                });
            }
            setSearchValue(searchValue, load) {
                this.searchBox.setValue(searchValue, false);
                if ((this.options.searchMode === undefined && this.datasetController != null) || this.options.searchMode == DataSearchMode.server) {
                    let searchProperties = this.columns.where(e => e.isSearchable()).select(e => !NextAdmin.String.isNullOrEmpty(e.options.selectQuery) ? e.options.selectQuery : e.options.propertyName);
                    if (this.options.additionalSearchProperties != null) {
                        searchProperties.addRange(this.options.additionalSearchProperties);
                    }
                    let hiddenSearchableColumnNames = this.options.columns.where(a => a.hidden && a.searchable).select(a => !NextAdmin.String.isNullOrEmpty(a.selectQuery) ? a.selectQuery : a.propertyName);
                    if (hiddenSearchableColumnNames?.length) {
                        searchProperties.addRange(hiddenSearchableColumnNames);
                    }
                    this.datasetController.search(searchProperties, searchValue);
                    if (load) {
                        this.datasetController.load();
                    }
                }
                else { //local search
                    if (NextAdmin.String.isNullOrEmpty(searchValue)) {
                        for (let row of this.rows) {
                            row.element.style.display = '';
                        }
                    }
                    else {
                        let search = searchValue.toLowerCase().removeDiacritics();
                        for (let row of this.rows) {
                            let displayRow = false;
                            let searchProperties = this.columns.where(e => e.options.searchable).select(e => e.options.propertyName);
                            if (this.options.additionalSearchProperties != null) {
                                searchProperties.addRange(this.options.additionalSearchProperties);
                            }
                            for (let searchProperty of searchProperties) {
                                let rowCellValue = row.data[searchProperty];
                                if (typeof rowCellValue == 'string') {
                                    if (rowCellValue.toLowerCase().removeDiacritics().indexOf(search) != -1) {
                                        displayRow = true;
                                        break;
                                    }
                                }
                            }
                            row.element.style.display = displayRow ? '' : 'none';
                        }
                    }
                }
            }
            setDataController(dataController, propertyName) {
                super.setDataController(dataController, propertyName);
                this.buttonSave.element.style.display = 'none';
                this.buttonRefresh.element.style.display = 'none';
            }
            /**
             * This function is used to synchronize grid with master form, and perform separated data loading
             * @param masterController
             * @param detailForeignKey
             * @param masterPrimaryKey
             */
            bindToMasterController(masterController, detailForeignKey, masterPrimaryKey) {
                this._masterFormController = masterController;
                this.buttonSave.element.style.display = 'none';
                this.buttonRefresh.element.style.display = 'none';
                if (masterPrimaryKey == null) {
                    masterPrimaryKey = masterController.options.dataPrimaryKeyName;
                }
                this._foreignKeyName = detailForeignKey;
                this.onFormModalCreated.subscribe((detailModal) => {
                    detailModal.dataController.onStartChangeData.subscribe(async (sender, args) => {
                        if (NextAdmin.Business.DataStateHelper.getDataState(args.newData) == NextAdmin.Business.DataState.append) {
                            args.newData[detailForeignKey] = masterController.getData()[masterPrimaryKey];
                        }
                    });
                });
                masterController.onDataChanged.subscribe((sender, args) => {
                    if (args.newData == null) {
                        this._suspendChanging = true;
                        this.clear();
                        this._suspendChanging = false;
                    }
                    else {
                        let propertyInfo = this.getPropertyInfo();
                        if (propertyInfo == null || args.newData[propertyInfo.name] == null || args.newData[propertyInfo.name].length == 0) { //if we are not binded or if there is no data, we load it manualy
                            this.datasetController.where(detailForeignKey + '=?', args.newData[masterPrimaryKey]);
                            this._suspendChanging = true;
                            this.datasetController.load({
                                onGetResponse: () => {
                                    this._suspendChanging = false;
                                }
                            });
                        }
                    }
                });
            }
            createModal(data) {
                if (this.options.formModalFactory == null) {
                    throw Error('No Modal factory');
                }
                let formModal = this.options.formModalFactory(this.datasetController.options.dataName, {
                    dataName: this.datasetController.options.dataName,
                    dataPrimaryKey: data == null ? null : data[this.datasetController.options.dataPrimaryKeyName],
                    isDetailFormModal: this.options.openFormModalWithRowData
                }, data);
                if (formModal == null) {
                    return null;
                }
                if (!this._createdModals.contains(formModal)) {
                    this._createdModals.add(formModal);
                    formModal.onClose.subscribe(() => {
                        this._createdModals.remove(formModal);
                        if (data && NextAdmin.Business.DataStateHelper.getDataState(data) == NextAdmin.Business.DataState.append) {
                            this.datasetController.dataset.remove(data);
                        }
                    });
                    formModal.dataController.onDataDeleted.subscribe(() => {
                        let pk = formModal.dataController.getDataPrimaryKeyValue();
                        if (pk != null) {
                            let row = this.getRowByDataId(pk);
                            if (row != null) {
                                this.removeRow(row);
                                return;
                            }
                        }
                        if (this.datasetController != null && this.options.loadingMode != DataLoadingMode.disabled) {
                            this.datasetController.load();
                        }
                    });
                    if (this.options.openFormModalWithRowData) {
                        formModal.onValidate.subscribe((modal, data) => {
                            if (formModal.originalData) { //edit
                                let row = this.getRowByData(formModal.originalData);
                                row.setData(data, true);
                            }
                            else { //append
                                this.addDataItem(data, NextAdmin.Business.DataState.append, true);
                            }
                        });
                    }
                    if (this.options.synchronizeDataWithFormModal) {
                        formModal.dataController.onDataSaved.subscribe((sender, args) => {
                            if (args.success) {
                                if (this._dataController != null || this._masterFormController != null || this.options.loadingMode == DataLoadingMode.disabled) {
                                    let pk = formModal.dataController.getDataPrimaryKeyValue();
                                    if (pk != null) {
                                        let row = this.getRowByDataId(pk);
                                        if (row != null) {
                                            row.setData(args.newData);
                                            return;
                                        }
                                    }
                                }
                                if (this.datasetController != null && this.options.loadingMode != DataLoadingMode.disabled) {
                                    this.datasetController.load();
                                }
                            }
                        });
                    }
                    this.onFormModalCreated.dispatch(formModal, data);
                    if (this.options.onFormModalCreated) {
                        this.options.onFormModalCreated(this, { modal: formModal, data: data });
                    }
                }
                return formModal;
            }
            addColumn(options) {
                let th = document.createElement('th');
                th.classList.add('next-admin-table-header-cell');
                this.headerRow.appendChild(th);
                let gridColumn = new DataGridColumn(this, th, options);
                this.columns.add(gridColumn);
                return gridColumn;
            }
            addActionColumn() {
                let th = document.createElement('th');
                th.classList.add('next-admin-table-header-cell');
                th.classList.add('next-admin-table-action-column-cell-header');
                th.style.padding = '0px';
                this.headerRow.appendChild(th);
                let gridColumn = new DataGridColumn(this, th, {
                    label: "Action",
                    width: this.options.actionColumnWidth,
                    orderable: false,
                    onRenderCell: (cell, value) => {
                        cell.element.classList.add('next-admin-table-action-column-cell');
                        if (this.options.renderActionColumnCell) {
                            this.options.renderActionColumnCell(cell);
                        }
                    }
                });
                gridColumn.isActionColumn = true;
                this.actionColumn = gridColumn;
                this.columns.add(gridColumn);
                return gridColumn;
            }
            getRowOrderPropertyName() {
                return this._currentView?.orderPropertyName ?? this.options?.orderPropertyName;
            }
            addDataItem(data, state, fireChange = false) {
                if (state == null && NextAdmin.Business.DataStateHelper.getDataState(data) == null) {
                    state = NextAdmin.Business.DataState.append;
                }
                if (state != null) { //if state asked == null and row has already a state, we keep row state
                    NextAdmin.Business.DataStateHelper.setDataState(data, state);
                }
                this.onAddingData.dispatch(this, { data: data, state: state });
                let orderPropertyName = this.getRowOrderPropertyName();
                if (orderPropertyName && !data[orderPropertyName]) {
                    let maxRowOrder = this.getMaxRowOrder();
                    maxRowOrder++;
                    data[orderPropertyName] = maxRowOrder;
                }
                let row = new DataGridRow_(this);
                this.rowDictionary[row.rowId] = row;
                this.tBody.appendControl(row);
                row.setData(data);
                this.rows.add(row);
                if (state != NextAdmin.Business.DataState.serialized) {
                    this.buttonSave.enable();
                }
                this.onRowAdded.dispatch(this, row);
                this.onDrawRow.dispatch(this, row);
                if (fireChange) {
                    this.fireChange();
                }
                return row;
            }
            insertDataItem(data, previousRow, state = NextAdmin.Business.DataState.append, fireChange = true) {
                NextAdmin.Business.DataStateHelper.setDataState(data, state);
                let row = new DataGridRow_(this);
                this.rowDictionary[row.rowId] = row;
                row.setData(data);
                previousRow.element.after(row.element);
                let indexOfPreviousRow = this.rows.indexOf(previousRow);
                this.rows.insert(indexOfPreviousRow + 1, row);
                let i = 0;
                for (let row of this.rows) {
                    row.data[this.options.orderPropertyName] = i;
                    i++;
                }
                this.onRowAdded.dispatch(this, row);
                this.onDrawRow.dispatch(this, row);
                if (fireChange) {
                    this.fireChange();
                }
                return row;
            }
            addDataset(dataSet, state = NextAdmin.Business.DataState.serialized, fireChange = false) {
                if (dataSet == null)
                    return;
                this.onAddingDataset.dispatch(this, dataSet);
                let rows = new Array();
                for (let data of dataSet) {
                    rows.add(this.addDataItem(data, state, false));
                }
                this.onDatasetChanged.dispatch(this, dataSet);
                if (fireChange) {
                    this.fireChange();
                }
                return rows;
            }
            setDataset(dataSet, state = NextAdmin.Business.DataState.serialized, tryPreserveSelectionAndScroll = true, fireChange = false) {
                let selectedRows = this.getSelectedDataRows();
                this.clear();
                //check if there is order column and if we are in local ordering
                if (dataSet != null && this._orderingColumnInfo?.column?.options?.propertyName != null
                    && ((this.options.orderingMode === undefined && this.options.datasetController == null) || this.options.orderingMode == DataOrderingMode.local || !NextAdmin.String.isNullOrEmpty(this.getRowOrderPropertyName()))) {
                    let orderDataName = this._orderingColumnInfo.column.options.propertyName;
                    if (this._orderingColumnInfo.ordering == ColumnOrdering.ascending) {
                        if (this._orderingColumnInfo.column.options.orderingFunc != null) {
                            let orderFunc = this._orderingColumnInfo.column.options.orderingFunc;
                            dataSet = dataSet.orderBy(e => orderFunc(e, dataSet));
                        }
                        else {
                            dataSet = dataSet.orderBy(e => e[orderDataName]);
                        }
                    }
                    else {
                        if (this._orderingColumnInfo.column.options.orderingFunc != null) {
                            let orderFunc = this._orderingColumnInfo.column.options.orderingFunc;
                            dataSet = dataSet.orderByDescending(e => orderFunc(e, dataSet));
                        }
                        else {
                            dataSet = dataSet.orderByDescending(e => e[orderDataName]);
                        }
                    }
                }
                this.addDataset(dataSet, state, false);
                //try select previous rows selecteds (work only id Data has id primarykey)
                if (this.datasetController?.options?.dataPrimaryKeyName) {
                    for (let previousSelectedRow of selectedRows) {
                        let rowDataId = previousSelectedRow.data[this.datasetController?.options?.dataPrimaryKeyName];
                        if (rowDataId != null) {
                            let newRowToSelect = this.rows.firstOrDefault(e => e.data[this.datasetController?.options?.dataPrimaryKeyName] == rowDataId);
                            if (newRowToSelect != null) {
                                this.selectRow(newRowToSelect);
                            }
                        }
                    }
                }
                if (!tryPreserveSelectionAndScroll) {
                    if (this.tableContainer != null) {
                        this.tableContainer.scrollTo(0, 0);
                    }
                }
                if (state == NextAdmin.Business.DataState.serialized) {
                    this.buttonSave.disable();
                }
                this.onDatasetChanged.dispatch(this, dataSet);
                if (fireChange) {
                    this.fireChange();
                }
            }
            enableScrollLoading() {
                let isLoading = false;
                this.tableContainer.addEventListener('scroll', async (ev) => {
                    if (isLoading || this.datasetController.dataset == null || this.datasetController.dataset.count() == 0)
                        return;
                    if (this.tableContainer.scrollTop > this._previousScrollTop && this.tableContainer.scrollTop + this.tableContainer.offsetHeight > this.tableContainer.scrollHeight - 200) {
                        this._previousScrollTop = this.tableContainer.scrollTop;
                        isLoading = true;
                        this.datasetController.skip(this.datasetController.dataset.count());
                        await this.datasetController.loadAdd();
                        this.datasetController.skip(0);
                        isLoading = false;
                    }
                });
            }
            removeRows(rows, fireChange = true) {
                for (let row of rows) {
                    this.removeRow(row, false);
                }
                if (fireChange) {
                    this.fireChange();
                }
            }
            removeRow(row, fireChange = true) {
                row.element.remove();
                let rowData = row.data;
                if (rowData != null) {
                    if (rowData['_state'] == NextAdmin.Business.DataState.append && this.datasetController != null) {
                        this.datasetController.dataset.remove(rowData);
                    }
                    rowData['_state'] = NextAdmin.Business.DataState.deleted;
                }
                delete this.rowDictionary[row.rowId];
                this.rows.remove(row);
                for (let cell of row.cells) {
                    cell.column.cells.remove(cell);
                }
                if (this.getRowOrderPropertyName()) {
                    this.updateRowsOrder();
                }
                this.onRowRemoved.dispatch(this, row);
                if (row.isSelected()) {
                    let selectedRows = this.getSelectedRows();
                    this.onSelectedRowsChanged.dispatch(this, selectedRows);
                    if (this.options.onSelectedRowsChanged) {
                        this.options.onSelectedRowsChanged(this, selectedRows);
                    }
                }
                if (fireChange) {
                    this.fireChange();
                }
                this.buttonSave.enable();
            }
            removeRowById(rowId, fireChange = true) {
                let row = this.rowDictionary[rowId];
                if (row != undefined) {
                    this.removeRow(row, fireChange);
                }
            }
            getRowById(rowId) {
                return this.rowDictionary[rowId];
            }
            getRowByData(data) {
                return this.rows.firstOrDefault(e => e.data === data);
            }
            /**
             * Require to be binded to datasetform
             * @param dataId
             */
            getRowByDataId(dataId) {
                if (this.datasetController == null) {
                    throw new Error('Unable to get row by id without datasetform');
                }
                return this.rows.firstOrDefault(e => {
                    return e.data[this.datasetController.options.dataPrimaryKeyName] == dataId;
                });
            }
            getDataset() {
                return this.rows.select(e => e.data);
            }
            createActionColumnCellToolbar(cellControl, options) {
                let toolBar = new UI.Toolbar();
                if (!this.isEnable()) {
                    return toolBar;
                }
                options = {
                    hasDeleteButton: this.options.deleteMode != null && this.options.deleteMode != DataDeleteMode.disabled,
                    hasOpenModalButton: this.options.openAction != null,
                    hasOrderingButtons: !NextAdmin.String.isNullOrEmpty(this.getRowOrderPropertyName()) && (this.options.reorderingRowMode == DataGridReorderingRowMode.all || this.options.reorderingRowMode == DataGridReorderingRowMode.buttons),
                    hasDragAndDropHandle: !NextAdmin.String.isNullOrEmpty(this.getRowOrderPropertyName()) && (this.options.reorderingRowMode == DataGridReorderingRowMode.all || this.options.reorderingRowMode == DataGridReorderingRowMode.dragAndDropHandle),
                    ...options
                };
                if (options.hasDeleteButton) {
                    toolBar.appendControl(new UI.Button({
                        text: this.options.deleteMode == DataDeleteMode.server ? NextAdmin.Resources.deleteIcon : NextAdmin.Resources.removeIcon,
                        style: UI.ButtonStyle.red,
                        stopClickEventPropagation: false,
                        action: (deleteButton) => {
                            if (this.options.deleteAction) {
                                this.options.deleteAction(this, [cellControl.row]);
                            }
                        }
                    }));
                }
                if (options.hasOpenModalButton && this.options.openAction != null) {
                    toolBar.appendControl(new UI.Button({
                        text: NextAdmin.Resources.openIcon,
                        style: UI.ButtonStyle.default,
                        stopClickEventPropagation: false,
                        action: (deleteButton) => {
                            this.options.openAction(cellControl.row);
                        }
                    }));
                }
                if (options.hasOrderingButtons) {
                    let t = document.createElement('table');
                    t.style.borderSpacing = '0px';
                    t.appendHTML('tr', (tr) => {
                        tr.appendHTML('td', (td) => {
                            td.style.padding = '0px';
                            td.style.display = 'flex';
                            td.appendControl(new UI.Button({
                                text: '', style: UI.ButtonStyle.bgWhite,
                                size: UI.ButtonSize.extraSmall,
                                stopClickEventPropagation: false,
                                action: () => this.upRow(cellControl.row)
                            }));
                        });
                    });
                    t.appendHTML('tr', (tr) => {
                        tr.appendHTML('td', (td) => {
                            td.style.padding = '0px';
                            td.style.display = 'flex';
                            td.appendControl(new UI.Button({
                                text: '', style: UI.ButtonStyle.bgWhite,
                                size: UI.ButtonSize.extraSmall,
                                stopClickEventPropagation: false,
                                action: () => this.downRow(cellControl.row)
                            }));
                        });
                    });
                    toolBar.appendControl(t);
                }
                if (options.hasDragAndDropHandle) {
                    toolBar.appendHTML('span', (grip) => {
                        grip.innerHTML = NextAdmin.Resources.dragIcon;
                        grip.classList.add('next-admin-drag-row-handler');
                        toolBar.element.style.cursor = 'grab';
                        if (NextAdmin.UserAgent.isDesktop()) {
                            toolBar.element.addEventListener('pointerdown', () => {
                                this.startDragRow(cellControl.row);
                            });
                        }
                        else {
                            toolBar.element.addEventListener('touchstart', () => {
                                this.startDragRow(cellControl.row);
                            });
                        }
                    });
                }
                return toolBar;
            }
            downRow(row) {
                let orderPropertyName = this.getRowOrderPropertyName();
                if (orderPropertyName == null)
                    throw new Error('OrderMemberName needed to change row order');
                let maxRowOrder = this.getMaxRowOrder();
                let rowOrder = row.data[orderPropertyName];
                rowOrder = rowOrder == null ? 0 : Number(rowOrder);
                if (rowOrder == maxRowOrder) {
                    return;
                }
                rowOrder++;
                let otherRow = this.getDataset().firstOrDefault(e => e[orderPropertyName] == rowOrder);
                if (otherRow != null) {
                    otherRow[orderPropertyName] = rowOrder - 1;
                }
                else {
                    this.updateRowsOrder();
                    this.downRow(row);
                    return;
                }
                row.data[orderPropertyName] = rowOrder;
                if (NextAdmin.Business.DataStateHelper.getDataState(row.data) == NextAdmin.Business.DataState.serialized) {
                    NextAdmin.Business.DataStateHelper.setDataState(row.data, NextAdmin.Business.DataState.edited);
                }
                this.updateLocalRowsOrder();
            }
            upRow(row) {
                let orderPropertyName = this.getRowOrderPropertyName();
                if (orderPropertyName == null)
                    throw new Error('OrderMemberName needed to change row order');
                let minRowOrder = this.getMinRowOrder();
                let rowOrder = row.data[orderPropertyName];
                rowOrder = rowOrder == null ? 0 : Number(rowOrder);
                if (rowOrder == minRowOrder) {
                    return;
                }
                rowOrder--;
                let otherRow = this.getDataset().firstOrDefault(e => e[orderPropertyName] == rowOrder);
                if (otherRow != null) {
                    otherRow[orderPropertyName] = rowOrder + 1;
                }
                else {
                    this.updateRowsOrder();
                    this.upRow(row);
                    return;
                }
                row.data[orderPropertyName] = rowOrder;
                if (NextAdmin.Business.DataStateHelper.getDataState(row.data) == NextAdmin.Business.DataState.serialized) {
                    NextAdmin.Business.DataStateHelper.setDataState(row.data, NextAdmin.Business.DataState.edited);
                }
                this.updateLocalRowsOrder();
            }
            getMaxRowOrder() {
                let maxRowOrder = 0;
                let dataset = this.getDataset();
                if (dataset != null && dataset.length > 0) {
                    maxRowOrder = dataset.max(e => {
                        let ro = e[this.getRowOrderPropertyName()];
                        return ro == null ? 0 : ro;
                    });
                }
                return maxRowOrder;
            }
            getMinRowOrder() {
                let maxRowOrder = 0;
                let dataset = this.getDataset();
                if (dataset != null && dataset.length > 0) {
                    maxRowOrder = dataset.min(e => {
                        let ro = e[this.getRowOrderPropertyName()];
                        return ro == null ? 0 : ro;
                    });
                }
                return maxRowOrder;
            }
            updateRowsOrder() {
                let orderedDataSet = this.getDataset().orderBy(e => {
                    let ro = e[this.getRowOrderPropertyName()];
                    return ro == null ? 0 : ro;
                });
                let i = 0;
                for (let data of orderedDataSet) {
                    data[this.getRowOrderPropertyName()] = i;
                    i++;
                }
            }
            clear(fireChange = false) {
                if (this.rows.length > 0) {
                    this.rows = new Array();
                    for (let columnInfo of this.columns) {
                        columnInfo.cells = new Array();
                    }
                    this.tBody.innerHTML = '';
                    if (fireChange) {
                        this.fireChange();
                    }
                }
            }
            selectRow(row, dispatch = true) {
                row.select();
                if (dispatch) {
                    this.onRowSelected.dispatch(this, row);
                    let selectedRows = this.getSelectedRows();
                    this.onSelectedRowsChanged.dispatch(this, selectedRows);
                    if (this.options.onSelectedRowsChanged) {
                        this.options.onSelectedRowsChanged(this, selectedRows);
                    }
                }
                this.onDrawRow.dispatch(this, row);
            }
            rowDoubleClicked(row, e) {
                if (this.options.enableDoubleClickOpenModal && this.options.openAction != null) {
                    this.options.openAction(row);
                }
                this.onDoubleClickRow.dispatch(row, e);
            }
            openContextMenu(e) {
                let selectedDataRows = this.getSelectedDataRows();
                let selectedRows = this.getSelectedRows();
                let isOnlyDataRowSelected = selectedDataRows.length == selectedRows.length && selectedDataRows.length > 0;
                let dropDownMenuItems = new Array();
                let dropDownMenu;
                if (selectedRows?.length && this.options.deleteMode != DataDeleteMode.disabled) {
                    dropDownMenuItems.add({
                        text: this.options.deleteMode == DataDeleteMode.server ? NextAdmin.Resources.deleteIcon + ' ' + NextAdmin.Resources.delete : NextAdmin.Resources.removeIcon + ' ' + NextAdmin.Resources.remove,
                        action: () => {
                            if (this.options.deleteAction) {
                                this.options.deleteAction(this, selectedRows);
                            }
                        }
                    });
                }
                if (selectedDataRows?.length) {
                    if (this.options.openAction != null && isOnlyDataRowSelected) {
                        dropDownMenuItems.add({
                            text: NextAdmin.Resources.openIcon + ' ' + NextAdmin.Resources.open,
                            action: () => {
                                for (let row of this.getSelectedDataRows()) {
                                    this.options.openAction(row);
                                }
                            }
                        });
                    }
                    if (this.options.canPrint && isOnlyDataRowSelected) {
                        let printDropDownButton = new NextAdmin.UI.DropDownButton({ text: NextAdmin.Resources.printIcon + ' ' + NextAdmin.Resources.generateDocument });
                        printDropDownButton.addElement({
                            text: NextAdmin.Resources.standardListExport,
                            action: () => {
                                dropDownMenu.close();
                                this.exportData({
                                    exportFormat: 'print',
                                    exportSelectedDataOnly: true,
                                    exportVisibleColumnOnly: true,
                                    exportColumnsDisplayNames: true,
                                    exportFormatedValues: true
                                });
                            }
                        });
                        if (this.options.reports != null && isOnlyDataRowSelected) {
                            for (let report of this.options.reports) {
                                printDropDownButton.addElement({
                                    text: report.label, action: (dd) => {
                                        dropDownMenu.close();
                                        let tempDataController = this.datasetController.clone();
                                        tempDataController.take(null);
                                        tempDataController.skip(null);
                                        tempDataController.select(this.datasetController.options.dataPrimaryKeyName);
                                        let ids = this.getSelectedDataRows().select(e => e.data[this.datasetController.options.dataPrimaryKeyName]);
                                        tempDataController.where(this.datasetController.options.dataPrimaryKeyName + ' IN(' + ids.select(e => '?') + ')', ...ids);
                                        tempDataController.load({
                                            onGetResponse: (result) => {
                                                if (result.success) {
                                                    let dataIds = result.dataset.select(e => e[this.datasetController.options.dataPrimaryKeyName]);
                                                    report.action(this, dataIds);
                                                }
                                            }
                                        });
                                    }
                                });
                            }
                        }
                        dropDownMenuItems.add(printDropDownButton);
                    }
                }
                else {
                    if (this.options.canAdd && selectedRows.length == 0 && this.buttonAdd.isEnable() && this.buttonAdd.element.style.display != 'none') {
                        dropDownMenuItems.add({
                            text: this.buttonAdd.element.innerHTML,
                            action: () => {
                                this.buttonAdd.executeAction();
                            }
                        });
                    }
                }
                dropDownMenu = new UI.DropDownMenu({ items: dropDownMenuItems, dropDownWidth: '350px' });
                let openContextMenuArgs = {
                    selectedRows: selectedRows,
                    selectedDataRows: selectedDataRows,
                    event: e,
                    dropDownMenu: dropDownMenu,
                    isOnlyDataRowSelected: isOnlyDataRowSelected
                };
                openContextMenuArgs.dropDownMenu = dropDownMenu;
                this.onOpenContextMenu.dispatch(this, openContextMenuArgs);
                if (this.options.onOpenContextMenu) {
                    this.options.onOpenContextMenu(this, openContextMenuArgs);
                }
                if (dropDownMenu.getItems().length > 0) {
                    dropDownMenu.open(e.x + 'px', e.y + 'px');
                }
                return openContextMenuArgs;
            }
            getSelectedDataRows() {
                return this.getDataRows().where(e => e.isSelected());
            }
            getSelectedRows() {
                return this.getSelectedDataRows();
            }
            unselectRow(row, dispatch = true) {
                row.unselect();
                if (dispatch) {
                    this.onRowUnselected.dispatch(this, row);
                    let selectedRows = this.getSelectedRows();
                    this.onSelectedRowsChanged.dispatch(this, selectedRows);
                    if (this.options.onSelectedRowsChanged) {
                        this.options.onSelectedRowsChanged(this, selectedRows);
                    }
                }
                this.onDrawRow.dispatch(this, row);
            }
            unselectRows(dispatch = true, rows) {
                if (rows == null) {
                    rows = this.getSelectedRows();
                }
                for (let row of rows) {
                    this.unselectRow(row, dispatch);
                }
            }
            orderBy(column, ordering, load = true) {
                let isDistantOrdering = (this.datasetController != null && (this.options.orderingMode === undefined || this.options.orderingMode === DataOrderingMode.server));
                if (column == null) {
                    this._orderingColumnInfo = null;
                    for (let column of this.columns) {
                        if (column.headerColumnOrderInfoElement != null) {
                            column.headerColumnOrderInfoElement.style.visibility = 'hidden';
                        }
                    }
                    if (isDistantOrdering) {
                        this.datasetController.orderBy();
                        if (load && this.rows.length > 0) {
                            this.datasetController.load();
                        }
                    }
                    else {
                        if (this.rows.length > 0) {
                            this.updateLocalRowsOrder();
                        }
                    }
                    return;
                }
                if (column.options.propertyName == null) {
                    throw Error('Unable to order column without dataName');
                }
                for (let column of this.columns) {
                    if (column.headerColumnOrderInfoElement != null) {
                        column.headerColumnOrderInfoElement.style.visibility = 'hidden';
                    }
                }
                if (column.headerColumnOrderInfoElement != null) {
                    column.headerColumnOrderInfoElement.style.visibility = '';
                    column.headerColumnOrderInfoElement.innerHTML = ordering == ColumnOrdering.descending ? '' : '';
                }
                this._orderingColumnInfo = { column: column, ordering: ordering };
                if (isDistantOrdering) { //distant ordering
                    this.datasetController.orderBy({ name: !NextAdmin.String.isNullOrEmpty(column.options.selectQuery) ? column.options.selectQuery : column.options.propertyName, desc: ordering == ColumnOrdering.descending });
                    if (load && this.rows.length > 0) {
                        this.datasetController.load();
                    }
                }
                else { //localOrdering
                    if (load && this.rows.length > 0) {
                        this.updateLocalRowsOrder();
                    }
                }
                this.onColumnOrderChanged.dispatch(column, ordering);
            }
            updateLocalRowsOrder() {
                if (this._orderingColumnInfo?.column?.options?.propertyName == null) {
                    throw Error('No ordering column selected');
                }
                this.setDataset(this.getDataset(), null, true);
            }
            getOrderingColumnInfo() {
                return this._orderingColumnInfo;
            }
            reRender() {
                this.setDataset(this.getDataset(), null);
            }
            setValue(value, fireChange) {
                let previousSUspendChanging = this._suspendChanging;
                this._suspendChanging = true;
                this.setDataset(value);
                this._suspendChanging = previousSUspendChanging;
                if (fireChange) {
                    this.onValueChanged.dispatch(this, { value: this.getValue(), origin: UI.ChangeOrigin.code });
                }
            }
            getValue() {
                return this.getDataset();
            }
            fireChange() {
                if (this._suspendChanging)
                    return;
                this.onValueChanged.dispatch(this, null);
            }
            exportData(options) {
                options = {
                    exportFormat: 'csv',
                    exportSelectedDataOnly: true,
                    exportVisibleColumnOnly: true,
                    exportColumnsDisplayNames: true,
                    exportFormatedValues: true,
                    ...options
                };
                let exportAction = (dataset) => {
                    let dataInfo = this.datasetController.getDataInfo();
                    var allPropertiesInfo = this.datasetController.getDataPropertyInfos().where(e => e.displayName != null || e.isPrimaryKey);
                    let columns = this.columns.where(e => e != this.actionColumn);
                    let exportFileDefaultName = (dataInfo.displayName == null ? dataInfo.name : dataInfo.displayName) + '_' + new Date().toISOString() + '.' + options.exportFormat;
                    if (options.exportFormat == 'csv') {
                        let csvString = '';
                        if (options.exportVisibleColumnOnly) {
                            csvString += columns.select(e => options.exportColumnsDisplayNames ? e.headerColumnCaptionElement.textContent :
                                (e.options.selectQuery != null ? e.options.selectQuery : e.options.propertyName)).join(',') + "\r\n";
                            for (let dataItem of dataset) {
                                csvString += columns.select(e => JSON.stringify(dataItem[e.options.propertyName] == null ? null : (options.exportFormatedValues ? UI.Helper.getDefaultPropertyDisplayValue(e.tryGetPropertyInfo(), dataItem[e.options.propertyName]) : dataItem[e.options.propertyName]))).join(',') + "\r\n";
                            }
                        }
                        else {
                            csvString += allPropertiesInfo.select(e => options.exportColumnsDisplayNames && e.displayName ? e.displayName : e.name) + "\r\n";
                            for (let dataItem of dataset) {
                                csvString += allPropertiesInfo.select(e => JSON.stringify(dataItem[e.name] == null ? null : (options.exportFormatedValues ? UI.Helper.getDefaultPropertyDisplayValue(e, dataItem[e.name]) : dataItem[e.name]))).join(',') + "\r\n";
                            }
                        }
                        let url = URL.createObjectURL(new Blob([csvString], { type: "text/csv" }));
                        let linkElement = document.createElement('a');
                        linkElement.setAttribute('href', url);
                        linkElement.setAttribute('download', exportFileDefaultName);
                        linkElement.click();
                    }
                    if (options.exportFormat == 'json') {
                        let formatedDataset = [];
                        for (let dataItem of dataset) {
                            let formatedItem = {};
                            if (options.exportVisibleColumnOnly) {
                                for (let column of columns) {
                                    formatedItem[options.exportColumnsDisplayNames ? column.headerColumnCaptionElement.textContent : column.options.propertyName] = (options.exportFormatedValues ? UI.Helper.getDefaultPropertyDisplayValue(column.tryGetPropertyInfo(), dataItem[column.options.propertyName]) : dataItem[column.options.propertyName]);
                                }
                            }
                            else {
                                for (let propertyInfo of allPropertiesInfo) {
                                    formatedItem[options.exportColumnsDisplayNames && propertyInfo.displayName != null ? propertyInfo.displayName : propertyInfo.name] = (options.exportFormatedValues ? UI.Helper.getDefaultPropertyDisplayValue(propertyInfo, dataItem[propertyInfo.name]) : dataItem[propertyInfo.name]);
                                }
                            }
                            formatedDataset.push(formatedItem);
                        }
                        let url = URL.createObjectURL(new Blob([JSON.stringify(formatedDataset)], { type: "application/json" }));
                        let linkElement = document.createElement('a');
                        linkElement.setAttribute('href', url);
                        linkElement.setAttribute('download', exportFileDefaultName);
                        linkElement.click();
                    }
                    if (options.exportFormat == 'print') {
                        this.print({ dataset: dataset });
                    }
                };
                if ((options.exportSelectedDataOnly && options.exportVisibleColumnOnly)) {
                    exportAction(this.getSelectedDataRows().select(e => e.data));
                }
                else {
                    if (options.exportVisibleColumnOnly) {
                        let dataset = this.getDataset();
                        if (this.options.paginItemCount == null || dataset.length < this.options.paginItemCount) {
                            exportAction(dataset);
                            return;
                        }
                    }
                    if (this._bindedPropertyName != null) {
                        exportAction(this.getDataset());
                    }
                    else {
                        this.getFullDataset((dataset) => {
                            exportAction(dataset);
                        }, !options.exportVisibleColumnOnly, options.exportSelectedDataOnly);
                    }
                }
            }
            getFullDataset(response, loadAllColumns = false, loadSelectedRow = false) {
                let tempDataController = this.datasetController.clone();
                tempDataController.take(null);
                tempDataController.skip(null);
                if (loadAllColumns) {
                    tempDataController.select();
                }
                if (loadSelectedRow) {
                    let ids = this.getSelectedDataRows().select(e => e.data[this.datasetController.options.dataPrimaryKeyName]);
                    tempDataController.where(this.datasetController.options.dataPrimaryKeyName + ' IN(' + ids.select(e => '?') + ')', ...ids);
                }
                tempDataController.load({
                    onGetResponse: () => (result) => {
                        if (result.success) {
                            response(result.dataset);
                        }
                    }
                });
            }
            print(options = {}) {
                let iFrameModal = new NextAdmin.UI.Modal({ title: NextAdmin.Resources.printIcon + ' ' + NextAdmin.Resources.print });
                iFrameModal.body.style.background = '#fff';
                iFrameModal.body.style.overflow = 'hidden';
                iFrameModal.body.appendHTML('iframe', (iframe) => {
                    iframe.addEventListener('load', () => {
                        let dataInfo = this.datasetController.getDataInfo();
                        iframe.contentWindow.document.head.title = dataInfo.displayName != null ? dataInfo.displayName : dataInfo.name + ' (' + NextAdmin.Resources.list + ')';
                        iframe.contentWindow.document.head.innerHTML = '<meta charset="utf-8">';
                        let style = document.createElement('style');
                        style.textContent = 'body{font-family:callibri,sans-serif;}';
                        iframe.contentWindow.document.head.append(style);
                        iframe.contentWindow.document.body.append(this.getPrintableElement(options));
                        iframe.contentWindow.focus();
                        let images = iframe.contentWindow.document.querySelectorAll('img');
                        if (images.length > 0) {
                            let imgLoaedCount = 0;
                            let imgLoad = () => {
                                imgLoaedCount++;
                                if (imgLoaedCount == images.length) {
                                    iframe.contentWindow.print();
                                }
                            };
                            iframe.contentWindow.document.querySelectorAll('img').forEach((img) => {
                                img.addEventListener('load', () => {
                                    imgLoad();
                                });
                            });
                        }
                        else {
                            iframe.contentWindow.print();
                        }
                        iFrameModal.close();
                    });
                    iframe.src = 'about:blank';
                    iframe.style.width = '100%';
                    iframe.style.height = '100%';
                    iframe.frameBorder = '0';
                });
                iFrameModal.body.style.position = 'relative';
                iFrameModal.body.appendHTML('div', (eventBlocker) => {
                    eventBlocker.style.position = 'absolute';
                    eventBlocker.style.width = '100%';
                    eventBlocker.style.height = '100%';
                    eventBlocker.style.left = '0px';
                    eventBlocker.style.top = '0px';
                });
                iFrameModal.open();
                iFrameModal.element.style.display = 'none';
            }
            getPrintableElement(options = {}) {
                let table = new UI.Table();
                table.element.style.fontSize = '11px';
                table.element.style.width = '100%';
                let columns = this.columns.where(e => e != this.actionColumn);
                table.addHeaderRow(...columns.select(e => e.headerColumnCaptionElement.textContent));
                let dataset = options.dataset != null ? options.dataset : this.getDataset();
                let rowNotFound = false;
                for (let dataItem of dataset) {
                    let row = rowNotFound ? null : this.getRowByData(dataItem); //si une ligne n'a dj pas t trouv on ne fait pas de nouveau la recherche
                    if (row != null) {
                        table.addBodyRow(...columns.select(column => {
                            let cell = row.getCellByPropertyName(column.options.propertyName);
                            if (cell.control != null) {
                                return cell.control.getDisplayValue();
                            }
                            else {
                                return cell.element.innerHTML;
                            }
                        }));
                    }
                    else {
                        rowNotFound = true;
                        table.addBodyRow(...columns.select(e => dataItem[e.options.propertyName] == null ? null : UI.Helper.getDefaultPropertyDisplayValue(e.tryGetPropertyInfo(), dataItem[e.options.propertyName])));
                    }
                }
                return table.element;
            }
            getPropertyName(dataDefPropertyAction) {
                return this.datasetController.getPropertyName(dataDefPropertyAction);
            }
        }
        DataGrid.onCreated = new NextAdmin.EventHandler();
        DataGrid.onCreating = new NextAdmin.EventHandler();
        DataGrid.style = `

        .next-admin-table-column-header-required{
            text-decoration:underline;
        } 
        .next-admin-table-header{
            background-color:#FEFEFC;
            padding:5px;
            border-bottom:1px solid #ccc;
        } 
        .next-admin-table-header-cell{
            z-index:1;
            position:sticky;
            top:0px;
            background-color:#FEFEFC; 
            padding:10px;
        } 
        .next-admin-table-cell{
            padding:5px;
        } 
        .next-admin-table-filter-container{

        }
        .next-admin-table-no-data-message{
            font-size:28px;
            text-align:center;
            font-weight:600px;
            color:#888;
        }

        .next-admin-drag-row-handler{
            cursor:grab;
            fontSize:20px;
            margin-left:4px;
            margin-right:4px;
            color:#888;
        }

        .next-admin-table-dragging-row{
            .next-admin-drag-row-handler{
                color:` + UI.DefaultStyle.BlueOne + `;
            }
        }

        .next-admin-table-action-column-cell-header{
            position:sticky;
            left:0;
            z-index:2;
            background:#fff;
        }
        .next-admin-table-action-column-cell{
            position:sticky;
            left:0;
            z-index:1;
            background:#fff;
            //border-top:1px solid #ddd;
            box-shadow:0px 0px 1px rgba(0,0,0,0.5)
        }
        `;
        UI.DataGrid = DataGrid;
        class DataGrid_ extends DataGrid {
        }
        UI.DataGrid_ = DataGrid_;
        class DataGridColumn {
            constructor(grid, th, options) {
                this.cells = new Array();
                this.grid = grid;
                this.options = options;
                this.headerColumnCell = th;
                this.timer = new NextAdmin.Timer();
                if (this.headerColumnCell != null && grid.options.rowsBordered) {
                    this.headerColumnCell.classList.add('next-admin-table-row-border');
                }
                //headerCss
                if (options.headerCss) {
                    NextAdmin.Copy.copyTo(options.headerCss, this.headerColumnCell.style);
                }
                if (options.width) {
                    this.headerColumnCell.style.width = options.width;
                }
                if (options.maxWidth) {
                    this.headerColumnCell.style.width = options.maxWidth;
                }
                if (options.minWidth) {
                    this.headerColumnCell.style.width = options.minWidth;
                }
                if (options.toolTip) {
                    this.headerColumnCell.setPopover(options.toolTip);
                }
                if (th != null) {
                    this.headerColumnToolbar = this.headerColumnCell.appendControl(new NextAdmin.UI.Toolbar());
                    this.headerColumnSearchFilter = this.getDropDownSearchFilter();
                    if (this.headerColumnSearchFilter) {
                        this.headerColumnToolbar.appendControl(this.headerColumnSearchFilter);
                    }
                    this.headerColumnCaptionElement = document.createElement('span');
                    this.headerColumnCaptionElement.innerHTML = this.options.propertyName;
                    if (options.label != null) {
                        this.headerColumnCaptionElement.innerHTML = options.label;
                    }
                    else if (this.options.propertyName != null && this.grid.datasetController != null) {
                        let propertyInfo = this.tryGetPropertyInfo();
                        if (propertyInfo != null) {
                            if (propertyInfo.displayName != null) {
                                this.headerColumnCaptionElement.innerHTML = propertyInfo.displayName;
                            }
                            if (this.options.controlFactory != null && propertyInfo.isRequired) {
                                this.headerColumnCaptionElement.classList.add('next-admin-table-column-header-required');
                            }
                        }
                    }
                    this.headerColumnToolbar.appendControl(this.headerColumnCaptionElement);
                    if (this.isOrderable()) {
                        this.headerColumnOrderInfoElement = document.createElement('span');
                        this.headerColumnOrderInfoElement.style.marginLeft = '5px';
                        this.headerColumnOrderInfoElement.innerHTML = '';
                        this.headerColumnOrderInfoElement.style.visibility = 'hidden';
                        th.addEventListener('click', () => {
                            if (grid.options.orderPropertyName != null) {
                                console.log('unable to change column order because change row order is enabled');
                                return;
                            }
                            let doOrderAction = () => {
                                let orderingInfo = grid.getOrderingColumnInfo();
                                if (orderingInfo == null || orderingInfo.column != this || (orderingInfo.column == this && orderingInfo.ordering == ColumnOrdering.descending)) {
                                    grid.orderBy(this, ColumnOrdering.ascending);
                                }
                                else {
                                    grid.orderBy(this, ColumnOrdering.descending);
                                }
                            };
                            if (this.grid.options.datasetController != null) {
                                this.grid.options.datasetController.displayLostDataMessageIfNeededAndExecuteAction(() => {
                                    doOrderAction();
                                });
                            }
                            else {
                                doOrderAction();
                            }
                        });
                        th.style.cursor = 'pointer';
                        this.headerColumnToolbar.appendControl(this.headerColumnOrderInfoElement);
                    }
                }
            }
            getDropDownSearchFilter() {
                if (!NextAdmin.String.isNullOrEmpty(this.options.propertyName) && this.grid.options.searchMode == DataSearchMode.server && this.options.searchable !== false && this.options.queryble !== false) {
                    let propertyInfo = this.tryGetPropertyInfo();
                    if (propertyInfo?.type == 'string') {
                        return this.getTextSearchFilter();
                    }
                    else if (propertyInfo?.type == 'number') {
                        return this.getNumberSearchFilter();
                    }
                    else if (propertyInfo?.type == 'date') {
                        return this.getDateSearchFilter();
                    }
                    else if (propertyInfo?.type == 'enum') {
                        return this.getEnumSearchFilter();
                    }
                }
                return null;
            }
            getNumberSearchFilter() {
                let headerColumnSearchFilter = new NextAdmin.UI.DropDownButton({
                    text: NextAdmin.Resources.searchIcon,
                    style: NextAdmin.UI.ButtonStyle.noBg,
                    dropDownParentContainer: this.grid.element,
                });
                headerColumnSearchFilter.dropDown.element.style.zIndex = '9999';
                headerColumnSearchFilter.appendHTML('div', (container) => {
                    container.style.padding = '5px';
                    let timer = new NextAdmin.Timer();
                    let minInput = container.appendControl(new NextAdmin.UI.Input({
                        label: NextAdmin.Resources.min,
                        inputType: NextAdmin.UI.InputType.number,
                        onValueChanged: () => {
                            timer.throttle(() => {
                                updateSearch();
                            }, 50);
                        }
                    }));
                    minInput.element.style.marginBottom = '5px';
                    let maxInput = container.appendControl(new NextAdmin.UI.Input({
                        label: NextAdmin.Resources.max,
                        inputType: NextAdmin.UI.InputType.number,
                        onValueChanged: () => {
                            timer.throttle(() => {
                                updateSearch();
                            }, 50);
                        }
                    }));
                    maxInput.element.style.marginBottom = '5px';
                    container.appendControl(new NextAdmin.UI.Button({
                        text: NextAdmin.Resources.removeIcon + ' ' + NextAdmin.Resources.clearFilter,
                        style: NextAdmin.UI.ButtonStyle.blue,
                        css: { minWidth: '100%' },
                        action: () => {
                            minInput.setValue('');
                            maxInput.setValue('');
                            updateSearch();
                        }
                    }));
                    let updateSearch = () => {
                        let min = minInput.getValue();
                        let max = maxInput.getValue();
                        this.filterQuery = '';
                        this.filterArgs = [];
                        if (min) {
                            this.filterQuery += this.options.propertyName + ' >= ?';
                            this.filterArgs.add(min);
                        }
                        if (max) {
                            if (min) {
                                this.filterQuery += ' AND ';
                            }
                            this.filterQuery += this.options.propertyName + ' <= ?';
                            this.filterArgs.add(max);
                        }
                        //this.grid.onColumnFilterSelectedValuesChanged.dispatch(this, selectValues);
                        this.grid.updateWhereQuery(this.grid.getCurrentView());
                        this.grid.datasetController.load();
                        this.updateHeaderColor();
                    };
                });
                return headerColumnSearchFilter;
            }
            getEnumSearchFilter() {
                let propertyInfo = this.tryGetPropertyInfo();
                let headerColumnSearchFilter = new NextAdmin.UI.DropDownButton({
                    text: NextAdmin.Resources.searchIcon,
                    style: NextAdmin.UI.ButtonStyle.noBg,
                    dropDownParentContainer: this.grid.element,
                });
                headerColumnSearchFilter.dropDown.element.style.zIndex = '9999';
                let table;
                headerColumnSearchFilter.appendHTML('div', (tableContainer) => {
                    tableContainer.style.maxHeight = '250px';
                    tableContainer.style.overflow = 'auto';
                    if (NextAdmin.UserAgent.isDesktop()) {
                        tableContainer.appendPerfectScrollbar();
                    }
                    table = tableContainer.appendControl(new NextAdmin.UI.Table({
                        rowSelectionMode: UI.RowSelectionMode.multiSelect,
                        stretchWidth: true,
                        rowHoverable: true,
                        style: UI.TableStyle.modern,
                    }), (table) => {
                        table.element.style.maxHeight = '250px';
                        for (let value of propertyInfo.values) {
                            let row = table.addBodyRow(value.label);
                            row['_value'] = value.value;
                        }
                        table.onSelectedRowsChanged.subscribe((table, rows) => {
                            updateSearch();
                        });
                    });
                });
                headerColumnSearchFilter.appendHTML('div', (footer) => {
                    footer.style.padding = '5px';
                    footer.style.boxShadow = '0px -1px 2px rgba(0,0,0,0.2)';
                    footer.appendControl(new NextAdmin.UI.Button({
                        text: NextAdmin.Resources.removeIcon + ' ' + NextAdmin.Resources.clearFilter,
                        style: NextAdmin.UI.ButtonStyle.blue,
                        css: { minWidth: '100%' },
                        action: () => {
                            table.unselectAll();
                            updateSearch();
                        }
                    }));
                });
                let updateSearch = () => {
                    let selectRows = table.getSelectedRows();
                    if (selectRows.length) {
                        this.filterQuery = this.options.propertyName + ' IN(' + selectRows.select(a => '?').join(',') + ')';
                        this.filterArgs = selectRows.select(a => a['_value']);
                    }
                    else {
                        this.filterQuery = null;
                        this.filterArgs = [];
                    }
                    this.grid.updateWhereQuery(this.grid.getCurrentView());
                    this.grid.datasetController.load();
                    this.updateHeaderColor();
                };
                return headerColumnSearchFilter;
            }
            getDateSearchFilter() {
                let headerColumnSearchFilter = new NextAdmin.UI.DropDownButton({
                    text: NextAdmin.Resources.searchIcon,
                    style: NextAdmin.UI.ButtonStyle.noBg,
                    dropDownParentContainer: this.grid.element,
                });
                headerColumnSearchFilter.dropDown.element.style.zIndex = '9999';
                headerColumnSearchFilter.appendHTML('div', (container) => {
                    container.style.padding = '5px';
                    let timer = new NextAdmin.Timer();
                    let minInput = container.appendControl(new NextAdmin.UI.Input({
                        label: NextAdmin.Resources.start,
                        inputType: NextAdmin.UI.InputType.date,
                        onValueChanged: () => {
                            timer.throttle(() => {
                                updateSearch();
                            }, 50);
                        }
                    }));
                    minInput.element.style.marginBottom = '5px';
                    let maxInput = container.appendControl(new NextAdmin.UI.Input({
                        label: NextAdmin.Resources.end,
                        inputType: NextAdmin.UI.InputType.date,
                        onValueChanged: () => {
                            timer.throttle(() => {
                                updateSearch();
                            }, 50);
                        }
                    }));
                    maxInput.element.style.marginBottom = '5px';
                    container.appendControl(new NextAdmin.UI.Button({
                        text: NextAdmin.Resources.removeIcon + ' ' + NextAdmin.Resources.clearFilter,
                        style: NextAdmin.UI.ButtonStyle.blue,
                        css: { minWidth: '100%' },
                        action: () => {
                            minInput.setValue('');
                            maxInput.setValue('');
                            updateSearch();
                        }
                    }));
                    let updateSearch = () => {
                        let min = minInput.getValue();
                        let max = maxInput.getValue();
                        this.filterQuery = '';
                        this.filterArgs = [];
                        if (min) {
                            this.filterQuery += this.options.propertyName + ' >= ?';
                            this.filterArgs.add(new Date(min));
                        }
                        if (max) {
                            if (min) {
                                this.filterQuery += ' AND ';
                            }
                            this.filterQuery += this.options.propertyName + ' <= ?';
                            this.filterArgs.add(new Date(max));
                        }
                        //this.grid.onColumnFilterSelectedValuesChanged.dispatch(this, selectValues);
                        this.grid.updateWhereQuery(this.grid.getCurrentView());
                        this.grid.datasetController.load();
                        this.updateHeaderColor();
                    };
                });
                return headerColumnSearchFilter;
            }
            getTextSearchFilter() {
                let rightSpace = window.innerWidth - this.headerColumnCell.offsetLeft;
                let headerColumnSearchFilter = new NextAdmin.UI.DropDownButton({
                    text: NextAdmin.Resources.searchIcon,
                    style: NextAdmin.UI.ButtonStyle.noBg,
                    dropDownParentContainer: this.grid.element,
                    dropDownPosition: rightSpace > 300 ? NextAdmin.UI.DropDownPosition.down : NextAdmin.UI.DropDownPosition.downLeft
                });
                headerColumnSearchFilter.dropDown.element.style.zIndex = '9999';
                this.searchBox = headerColumnSearchFilter.addElement(new NextAdmin.UI.Input({
                    placeHolder: NextAdmin.Resources.search,
                    css: { boxShadow: '0px 1px 2px rgba(0,0,0,0.2)' },
                }));
                this.searchBox.controlContainer.style.padding = '5px';
                let gridContainer = headerColumnSearchFilter.addElement(document.createElement('div'));
                gridContainer.style.height = '200px';
                headerColumnSearchFilter.onActionExecuted.subscribe(() => {
                    if (this.searchGrid != null) {
                        return;
                    }
                    this.searchGrid = gridContainer.appendControl(new NextAdmin.UI.DataGrid_({
                        paginItemCount: 200,
                        rowSelectionMode: NextAdmin.UI.RowSelectionMode.multiSelect,
                        rowHoverable: true,
                        dataName: this.grid.datasetController.options.dataName,
                        hasActionColumn: false,
                        searchMode: NextAdmin.UI.DataSearchMode.server,
                        canAdd: false,
                        deleteMode: NextAdmin.UI.DataDeleteMode.disabled,
                        hasContextMenu: false,
                        selectDataPrimaryKey: false,
                        columns: [{ propertyName: this.options.propertyName, selectQuery: this.options.selectQuery, searchable: true, defaultOrdering: ColumnOrdering.ascending }],
                    }));
                    this.searchGrid.tHead.style.display = 'none';
                    this.searchGrid.topBar.style.display = 'none';
                    this.searchGrid.datasetController.where(this.options.propertyName + ' IS NOT NULL');
                    this.searchGrid.datasetController.distinct(true);
                    let searchValue = this.searchBox.getValue();
                    if (!NextAdmin.String.isNullOrEmpty(searchValue)) {
                        this.searchGrid.searchBox.setValue(searchValue, false);
                    }
                    this.searchGrid.onSelectedRowsChanged.subscribe((sender, selectedRows) => {
                        let selectValues = selectedRows.select(a => a.data[this.options.propertyName]);
                        this.filterQuery = selectValues.select(a => this.options.propertyName + ' = ?').join(' OR ');
                        this.filterArgs = selectValues.clone();
                        this.grid.onColumnFilterSelectedValuesChanged.dispatch(this, selectValues);
                        this.grid.updateWhereQuery(this.grid.getCurrentView());
                        this.grid.datasetController.load();
                        this.updateHeaderColor();
                    });
                    this.searchGrid.datasetController.load({
                        onGetResponse: () => () => {
                            setTimeout(() => {
                                if (this.filterArgs && this.filterArgs.length > 0) {
                                    for (let row of this.searchGrid.rows) {
                                        let rowColumnValue = row.data[this.options.propertyName];
                                        if (this.filterArgs.firstOrDefault(a => a == rowColumnValue) != null) {
                                            this.searchGrid.selectRow(row, false);
                                        }
                                    }
                                }
                            }, 20);
                        }
                    });
                });
                this.searchBox.onValueChanged.subscribe((sender, args) => {
                    if (this.searchGrid == null) {
                        return;
                    }
                    this.timer.throttle(() => {
                        let filterValue = this.searchBox.getValue();
                        this.setSearchValue(args.value);
                        this.grid.onColumnFilterSearchValueChanged.dispatch(this, filterValue);
                        this.grid.updateWhereQuery(this.grid.getCurrentView());
                        this.grid.datasetController.load();
                        this.searchGrid.searchBox.setValue(filterValue, true);
                    }, 500);
                });
                headerColumnSearchFilter.appendHTML('div', (footer) => {
                    footer.style.padding = '5px';
                    footer.style.boxShadow = '0px -1px 2px rgba(0,0,0,0.2)';
                    footer.appendControl(new NextAdmin.UI.Button({
                        text: NextAdmin.Resources.removeIcon + ' ' + NextAdmin.Resources.clearFilter,
                        style: NextAdmin.UI.ButtonStyle.blue,
                        css: { minWidth: '100%' },
                        action: () => {
                            this.searchBox.setValue('', true);
                            this.searchGrid.unselectRows(true);
                        }
                    }));
                });
                return headerColumnSearchFilter;
            }
            setSearchValue(value, fireLoad) {
                if (this.headerColumnSearchFilter == null || this.searchBox == null) {
                    return;
                }
                this.searchBox.setValue(value, fireLoad);
                if (!NextAdmin.String.isNullOrEmpty(value)) {
                    let searchparts = value.split(' ');
                    this.filterQuery = searchparts.select(a => 'LOWER(' + this.options.propertyName + ') LIKE LOWER(?)').join(' AND ');
                    this.filterArgs = searchparts.select(a => '%' + a + '%');
                }
                else {
                    this.filterQuery = null;
                    this.filterArgs = null;
                }
                this.updateHeaderColor();
            }
            setFilteredValues(selectValues) {
                if (this.headerColumnSearchFilter == null) {
                    return;
                }
                if (selectValues != null && selectValues.length > 0) {
                    this.filterQuery = selectValues.select(a => this.options.propertyName + ' = ?').join(' OR ');
                    this.filterArgs = selectValues.clone();
                }
                else {
                    this.filterQuery = null;
                    this.filterArgs = null;
                }
                this.updateHeaderColor();
            }
            updateHeaderColor() {
                if (this.headerColumnSearchFilter == null) {
                    return;
                }
                if ((this.filterArgs != null && this.filterArgs.length > 0) || !NextAdmin.String.isNullOrEmpty(this.searchBox?.getValue())) {
                    this.headerColumnCaptionElement.style.color = '#ff0000';
                    this.headerColumnSearchFilter.element.style.color = '#ff0000';
                }
                else {
                    this.headerColumnCaptionElement.style.color = '';
                    this.headerColumnSearchFilter.element.style.color = '';
                }
            }
            tryGetPropertyInfo() {
                if (this._propertyInfo == null && this.grid.datasetController != null) {
                    if (!NextAdmin.String.isNullOrEmpty(this.options.selectQuery) && this.options.selectQuery.contains('.')) {
                        this._propertyInfo = this.grid.datasetController.getDataPropertyInfoFromPath(this.grid.datasetController.options.dataName, this.options.selectQuery);
                    }
                    else {
                        this._propertyInfo = this.grid.datasetController.getDataPropertyInfo_(this.grid.datasetController.options.dataName, this.options.propertyName);
                    }
                }
                return this._propertyInfo;
            }
            isSearchable() {
                if (this == this.grid.actionColumn)
                    return false;
                if (this.options.searchable !== undefined) {
                    return this.options.searchable;
                }
                let propertyInfo = this.tryGetPropertyInfo();
                if (propertyInfo != null && propertyInfo.isQueryable) {
                    return true;
                }
                return false;
            }
            isOrderable() {
                if (this == this.grid.actionColumn)
                    return false;
                if (this.options.orderable !== undefined) {
                    return this.options.orderable;
                }
                let propertyInfo = this.tryGetPropertyInfo();
                if (propertyInfo != null && propertyInfo.isQueryable) {
                    return true;
                }
                return false;
            }
            isQueryble() {
                return this.options.queryble !== false;
            }
        }
        class DataGridRow extends UI.Control {
            constructor(grid) {
                super('tr');
                this.cells = new Array();
                this._selected = false;
                this.element.classList.add('next-admin-table-row');
                this.grid = grid;
                this.element.setAttribute('RowId', this.rowId = NextAdmin.Guid.newGuid().toString());
                if (this.grid.options.rowSelectionMode != null && this.grid.options.rowSelectionMode != UI.RowSelectionMode.disabled) {
                    this.element.style.cursor = 'pointer';
                }
                let lastClickTimeStamp = -1;
                if (this.grid.options.hasContextMenu) {
                    this.element.oncontextmenu = (e) => {
                        e.stopPropagation();
                        e.preventDefault();
                        this.grid.openContextMenu(e);
                        return false;
                    };
                }
                this.element.addEventListener('click', (e) => {
                    //check double click
                    let actualTimeStamp = Date.now();
                    if (actualTimeStamp - lastClickTimeStamp < 500) {
                        this.grid.rowDoubleClicked(this, e);
                        lastClickTimeStamp = -1;
                    }
                    else {
                        lastClickTimeStamp = actualTimeStamp;
                    }
                    if (this.grid.options.rowSelectionMode != undefined && this.grid.options.rowSelectionMode != UI.RowSelectionMode.disabled) {
                        if (this.grid.options.rowSelectionMode == UI.RowSelectionMode.multiSelect) {
                            if (this.isSelected()) {
                                this.unselect();
                            }
                            else {
                                this.select();
                            }
                        }
                        else if (this.grid.options.rowSelectionMode == UI.RowSelectionMode.multiSelect_CtrlShift) {
                            let gridRows = this.grid.getRows();
                            if (e.shiftKey) {
                                let previousSelectedRow = null;
                                let selectRows = gridRows.where(a => a.isSelected());
                                let upToDown = true;
                                if (selectRows.length > 0) {
                                    let lastSelectRow = selectRows.lastOrDefault();
                                    if (gridRows.indexOf(lastSelectRow) < gridRows.indexOf(this)) {
                                        previousSelectedRow = lastSelectRow;
                                    }
                                    else {
                                        previousSelectedRow = selectRows.firstOrDefault();
                                        upToDown = false;
                                    }
                                }
                                else {
                                    previousSelectedRow = gridRows[0];
                                }
                                if (previousSelectedRow != null) {
                                    let previousRowFound = false;
                                    let rows = upToDown ? gridRows : gridRows.clone().reverse();
                                    for (let row of rows) {
                                        if (row == previousSelectedRow) {
                                            previousRowFound = true;
                                        }
                                        if (previousRowFound) {
                                            row.select();
                                        }
                                        if (row == this) {
                                            break;
                                        }
                                    }
                                }
                            }
                            else {
                                if (!e.ctrlKey) {
                                    for (let row of gridRows) {
                                        this.grid.unselectRow(row, false);
                                    }
                                }
                                if (this.isSelected()) {
                                    this.unselect();
                                }
                                else {
                                    this.grid.selectRow(this, false);
                                }
                            }
                        }
                        else {
                            for (let row of this.grid.getRows()) {
                                this.grid.unselectRow(row, false);
                            }
                            this.grid.selectRow(this, false);
                        }
                        let selectedRows = this.grid.getSelectedRows();
                        this.grid.onSelectedRowsChanged.dispatch(this.grid, selectedRows);
                        if (this.grid.options.onSelectedRowsChanged) {
                            this.grid.options.onSelectedRowsChanged(this.grid, selectedRows);
                        }
                    }
                });
                if (this.grid.options.rowHoverable || this.grid.hasDragAndDropEnabled()) {
                    this.element.addEventListener('pointerenter', (e) => {
                        if (this.grid.options.rowHoverable) {
                            this.element.classList.add('next-admin-table-row-hover');
                        }
                        this.grid.currentHovredRow = this;
                    });
                    this.element.addEventListener('pointerleave', (e) => {
                        if (this.grid.options.rowHoverable) {
                            this.element.classList.remove('next-admin-table-row-hover');
                        }
                        if (this.grid.currentHovredRow == this) {
                            this.grid.currentHovredRow = null;
                        }
                    });
                }
            }
            select(addSelectStyle = true) {
                if (this._selected)
                    return;
                if (addSelectStyle) {
                    this.element.classList.add('next-admin-table-row-selected');
                }
                this._selected = true;
            }
            unselect(removeSelectStyle = true) {
                if (!this._selected)
                    return;
                if (removeSelectStyle && this.element.classList.contains('next-admin-table-row-selected')) {
                    this.element.classList.remove('next-admin-table-row-selected');
                }
                this._selected = false;
            }
            isSelected() {
                return this._selected;
            }
            setData(data, fireChange) {
                let cells = this.cells.where(e => e.column != this.grid.actionColumn);
                this.data = data;
                if (cells.length > 0) {
                    for (let cell of cells) {
                        let cellData = data[cell.column.options.propertyName];
                        cell.setValue(cellData);
                    }
                }
                else {
                    for (let column of this.grid.columns) {
                        let cell = new DataGridCell_(this.grid, column, this);
                        cell.setValue(data[column.options.propertyName]);
                        this.cells.add(cell);
                        column.cells.add(cell);
                        this.element.appendChild(cell.element);
                    }
                }
                if (fireChange) {
                    this.grid.fireChange();
                }
            }
            setDataPropertyValue(dataDefPropertyAction, value, fireChange) {
                let propertyName = this.grid.getPropertyName(dataDefPropertyAction);
                this.data[propertyName] = value;
                let control = this.getControl(propertyName);
                if (control) {
                    control.setValue(value, fireChange);
                }
            }
            getControl(propertyName) {
                return this.getCellByPropertyName(propertyName)?.control;
            }
            getDataPKValue() {
                if (this.grid.datasetController == null) {
                    throw new Error('unbale to get data PK value without datasetform');
                }
                return this.data[this.grid.datasetController.options.dataPrimaryKeyName];
            }
            getCellByIndex(index) {
                return this.cells[index];
            }
            getCellByPropertyName(name) {
                return this.cells.firstOrDefault(e => e.column.options.propertyName == name);
            }
        }
        UI.DataGridRow = DataGridRow;
        class DataGridRow_ extends DataGridRow {
        }
        UI.DataGridRow_ = DataGridRow_;
        class DataGridCell extends UI.Control {
            constructor(grid, column, row) {
                super('td');
                this.element.classList.add('next-admin-table-cell');
                if (grid.options.rowsBordered) {
                    this.element.classList.add('next-admin-table-row-border');
                }
                if (grid.options.columnsBordered) {
                    this.element.classList.add('next-admin-table-col-border');
                }
                if (column?.options?.cellCss) {
                    NextAdmin.Copy.copyTo(column.options.cellCss, this.element.style);
                }
                this.grid = grid;
                this.row = row;
                if (column) {
                    this.column = column;
                    this.propertyInfo = column.tryGetPropertyInfo();
                    this.initControl();
                }
            }
            initControl() {
                if (this.grid.options.canEdit === false) {
                    return;
                }
                if (this.column.options.controlFactory != null) {
                    this.setFormControl(this.column.options.controlFactory(this));
                }
                else if (this.column.options.useDefaultControl && this.propertyInfo != null) {
                    let control = UI.Helper.getDefaultPropertyFormControl(this.propertyInfo, this.grid.options.style == UI.TableStyle.modernNoCellPadding);
                    if (control != null) {
                        this.setFormControl(control);
                    }
                }
            }
            setFormControl(control) {
                this.control = control;
                this.element.innerHTML = '';
                if (control == null)
                    return;
                this.element.appendControl(control);
                if (this.propertyInfo != null) {
                    this.control.setPropertyInfo(this.propertyInfo);
                    if (control instanceof UI.LabelFormControl) {
                        control.setLabel('');
                    }
                }
                if (this.grid.isEnable()) {
                    control.onValueChanged.subscribe((sender, args) => {
                        if (this.row.data['_state'] == NextAdmin.Business.DataState.serialized) {
                            this.row.data['_state'] = NextAdmin.Business.DataState.edited;
                        }
                        this.row.data[this.column.options.propertyName] = control.getValue();
                        this.grid.fireChange();
                        this.grid.buttonSave.enable();
                    });
                }
                else {
                    control.disable();
                }
            }
            setValue(value, updateData) {
                this.value = value;
                if (this.control != null) {
                    if (value !== undefined) {
                        this.control.setValue(value);
                        if (this.propertyInfo?.isPrimaryKey && NextAdmin.Business.DataStateHelper.getDataState(this.row.data) != NextAdmin.Business.DataState.append) {
                            this.control.disable();
                        }
                    }
                }
                else {
                    this.element.innerHTML = '';
                    this.element.appendChild(UI.Helper.getDefaultPropertyHtmlElement(this.propertyInfo, value));
                }
                if (this.column.options.onRenderCell != null) {
                    let elementToRender = this.column.options.onRenderCell(this, value);
                    if (elementToRender) {
                        this.element.innerHTML = '';
                        if (typeof elementToRender === 'string' || elementToRender instanceof NextAdmin.String) {
                            this.element.innerHTML = elementToRender;
                        }
                        else if (elementToRender instanceof HTMLElement) {
                            this.element.innerHTML = '';
                            this.element.appendChild(elementToRender);
                        }
                        else if (elementToRender instanceof UI.Control) {
                            this.element.innerHTML = '';
                            this.element.appendControl(elementToRender);
                        }
                    }
                }
                this.grid.onDrawCell.dispatch(this, value);
                if (updateData) {
                    this.setData(value);
                }
            }
            setData(value) {
                this.row.data[this.column.options.propertyName] = value;
            }
            getValue() {
                if (this.control != null) {
                    return this.control.getValue();
                }
                else {
                    return this.element.innerHTML;
                }
            }
        }
        UI.DataGridCell = DataGridCell;
        class DataGridCell_ extends DataGridCell {
        }
        UI.DataGridCell_ = DataGridCell_;
        class ExportModal extends UI.Modal {
            constructor(grid) {
                super({ size: UI.ModalSize.smallFitContent, title: NextAdmin.Resources.dataExportConfig });
                this.body.appendHTML('div', (container) => {
                    container.style.padding = '10px';
                    let formatSelect = container.appendControl(new UI.Select({ label: NextAdmin.Resources.format, items: [{ value: 'csv' }, { value: 'json' }] }), (select) => {
                        select.element.style.marginBottom = '10px';
                    });
                    let fieldNameFormatSelect = container.appendControl(new UI.Select({ label: NextAdmin.Resources.fieldName, items: [{ value: 'label', label: NextAdmin.Resources.label }, { value: 'propertyName', label: NextAdmin.Resources.realName }] }), (select) => {
                        select.element.style.marginBottom = '10px';
                    });
                    let valueFormatSelect = container.appendControl(new UI.Select({ label: NextAdmin.Resources.valueFormat, items: [{ value: 'display', label: NextAdmin.Resources.displayValue }, { value: 'raw', label: NextAdmin.Resources.rawValue }] }), (select) => {
                        select.element.style.marginBottom = '10px';
                    });
                    let columnsSelect = container.appendControl(new UI.Select({ label: NextAdmin.Resources.columns, items: [{ value: 'visible', label: NextAdmin.Resources.visible }, { value: 'all', label: NextAdmin.Resources.all }] }), (select) => {
                        select.element.style.marginBottom = '10px';
                    });
                    let dataSelect = container.appendControl(new UI.Select({ label: NextAdmin.Resources.data, items: [{ value: 'all', label: NextAdmin.Resources.all }, { value: 'selected', label: NextAdmin.Resources.selection }] }), (select) => {
                        select.element.style.marginBottom = '10px';
                    });
                    this.rightFooter.appendControl(new UI.Button({
                        text: NextAdmin.Resources.downloadIcon + ' ' + NextAdmin.Resources.export, style: UI.ButtonStyle.blue, action: () => {
                            this.close();
                            grid.exportData({
                                exportFormat: formatSelect.getValue(),
                                exportSelectedDataOnly: dataSelect.getValue() == 'selected',
                                exportVisibleColumnOnly: columnsSelect.getValue() == 'visible',
                                exportColumnsDisplayNames: fieldNameFormatSelect.getValue() == 'label',
                                exportFormatedValues: valueFormatSelect.getValue() == 'display'
                            });
                        }
                    }), (btn) => {
                        btn.element.style.cssFloat = 'right';
                    });
                });
            }
        }
        UI.ExportModal = ExportModal;
        class FilterGridLayout extends UI.FormLayout_ {
            startConfiguration(grid, onChanged) {
                this.firstRow.cells[0].appendControl(new NextAdmin.UI.Button({
                    text: NextAdmin.Resources.cogIcon + ' ' + NextAdmin.Resources.configure, style: NextAdmin.UI.ButtonStyle.noBg, action: () => {
                        let changeGridColumnRowCountModal = new NextAdmin.UI.Modal({
                            canMinimize: false, canChangeScreenMode: false, size: NextAdmin.UI.ModalSize.smallFitContent
                        });
                        let columnCountInput = changeGridColumnRowCountModal.body.appendControl(new NextAdmin.UI.Input({ label: NextAdmin.Resources.columnCount, value: this._columnCount, inputType: NextAdmin.UI.InputType.number }));
                        let rowCountInput = changeGridColumnRowCountModal.body.appendControl(new NextAdmin.UI.Input({ label: NextAdmin.Resources.rowCount, value: this._rowCount, inputType: NextAdmin.UI.InputType.number }));
                        changeGridColumnRowCountModal.rightFooter.appendControl(new NextAdmin.UI.Button({
                            text: NextAdmin.Resources.validate, style: NextAdmin.UI.ButtonStyle.green, action: () => {
                                let minColCount = this._itemsDictionary.getValues().max(e => e.col);
                                let minRowCount = this._itemsDictionary.getValues().max(e => e.row);
                                if (rowCountInput.getValue() > minRowCount) {
                                    this.setRowCount(rowCountInput.getValue());
                                }
                                if (columnCountInput.getValue() > minColCount) {
                                    this.setColumnCount(columnCountInput.getValue());
                                }
                                appendGridButtons();
                                changeGridColumnRowCountModal.close();
                            }
                        }), (btnOK) => {
                            btnOK.element.style.cssFloat = 'right';
                        });
                        changeGridColumnRowCountModal.open();
                    }
                }), () => {
                });
                let appendAddControlButtonToCell = (cell, cellKey) => {
                    cell.appendControl(new NextAdmin.UI.Button({
                        text: '+',
                        style: NextAdmin.UI.ButtonStyle.noBg,
                        action: (button) => {
                            let appendControlModal = new UI.Modal({
                                size: UI.ModalSize.smallFitContent,
                                title: NextAdmin.Resources.appendControl,
                            });
                            let container = appendControlModal.body.appendHTML('div');
                            container.style.padding = '10px';
                            let filterName = container.appendControl(new UI.Input({ label: NextAdmin.Resources.filterName, css: { marginBottom: '10px' } }));
                            let controlLabel = container.appendControl(new UI.Input({ label: NextAdmin.Resources.label, css: { marginBottom: '10px' } }));
                            let controlType = container.appendControl(new UI.Select({ label: NextAdmin.Resources.control, css: { marginBottom: '10px' } }));
                            controlType.addItem('NextAdmin.UI.Input/text', 'Texte');
                            controlType.addItem('NextAdmin.UI.Input/number', 'Nombre');
                            controlType.addItem('NextAdmin.UI.Input/checkbox', 'Checkbox');
                            controlType.addItem('NextAdmin.UI.Input/date', 'Date');
                            let dataInfos = grid.datasetController.getDataInfo();
                            let propertiesInfos = dataInfos.propertyInfos;
                            for (let propertyName in propertiesInfos) {
                                let propertyInfos = propertiesInfos[propertyName];
                                if (propertyInfos.values?.length) {
                                    controlType.addItem('NextAdmin.UI.Select/enum/' + dataInfos.name + '/' + propertyInfos.name, NextAdmin.Resources.valueSelector + " : " + propertyInfos.displayName);
                                    controlType.addItem('NextAdmin.UI.MultiInputSelect/enum/' + dataInfos.name + '/' + propertyInfos.name, NextAdmin.Resources.multiValuesSelector + " : " + propertyInfos.displayName);
                                }
                            }
                            for (let dataInfo of this.dataInfos) {
                                controlType.addItem('NextAdmin.UI.DataSelect/' + dataInfo.name, NextAdmin.Resources.dataSelector + " : " + dataInfo.displayName);
                            }
                            appendControlModal.rightFooter.appendControl(new UI.Button({
                                text: NextAdmin.Resources.validate, style: UI.ButtonStyle.green, action: () => {
                                    if (NextAdmin.String.isNullOrWhiteSpace(filterName.getValue()) || NextAdmin.String.isNullOrWhiteSpace(controlLabel.getValue()) || NextAdmin.String.isNullOrWhiteSpace(controlType.getValue())) {
                                        NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.error, NextAdmin.Resources.fillAllFieldsMessage);
                                        return;
                                    }
                                    let col = cellKey.split(',')[0];
                                    let row = cellKey.split(',')[1];
                                    let controlInfo = (controlType.getValue() + '').split('/');
                                    let cType = controlInfo[0];
                                    if (cType == 'NextAdmin.UI.Input') {
                                        let inputType = null;
                                        switch (controlInfo[1]) {
                                            case 'text':
                                                inputType = UI.InputType.text;
                                                break;
                                            case 'number':
                                                inputType = UI.InputType.number;
                                                break;
                                            case 'checkbox':
                                                inputType = UI.InputType.checkbox;
                                                break;
                                            case 'date':
                                                inputType = UI.InputType.date;
                                                break;
                                            default:
                                        }
                                        this.addItem({
                                            col: Number(col),
                                            row: Number(row),
                                            controlType: cType,
                                            propertyName: filterName.getValue(),
                                            controlOption: {
                                                label: controlLabel.getValue(),
                                                inputType: inputType,
                                            }
                                        });
                                    }
                                    else if (cType == 'NextAdmin.UI.DataSelect') {
                                        let dataName = controlInfo[1];
                                        let dataInfo = this.dataInfos.firstOrDefault(a => a.name == dataName);
                                        this.addItem({
                                            col: Number(col),
                                            row: Number(row),
                                            controlType: cType,
                                            propertyName: filterName.getValue(),
                                            controlOption: {
                                                label: controlLabel.getValue(),
                                                dataName: controlInfo[1],
                                                displayPropertiesNames: dataInfo.displayPropertiesNames,
                                                allowNullValue: true
                                            }
                                        });
                                    }
                                    else if (cType == 'NextAdmin.UI.Select') {
                                        let type = controlInfo[1];
                                        if (type == 'enum') {
                                            let dataName = controlInfo[2];
                                            let propertyName = controlInfo[3];
                                            let dataInfos = grid.datasetController.getDataInfo();
                                            let propertyInfos = dataInfos.propertyInfos[propertyName];
                                            this.addItem({
                                                col: Number(col),
                                                row: Number(row),
                                                controlType: cType,
                                                propertyName: filterName.getValue(),
                                                controlOption: {
                                                    label: controlLabel.getValue(),
                                                    items: [{ label: '', value: '' }].addRange(propertyInfos.values)
                                                }
                                            });
                                        }
                                    }
                                    else if (cType == 'NextAdmin.UI.MultiInputSelect') {
                                        let type = controlInfo[1];
                                        if (type == 'enum') {
                                            let dataName = controlInfo[2];
                                            let propertyName = controlInfo[3];
                                            let dataInfos = grid.datasetController.getDataInfo();
                                            let propertyInfos = dataInfos.propertyInfos[propertyName];
                                            this.addItem({
                                                col: Number(col),
                                                row: Number(row),
                                                controlType: cType,
                                                propertyName: filterName.getValue(),
                                                controlOption: {
                                                    label: controlLabel.getValue(),
                                                    items: propertyInfos.values,
                                                    outputArray: true,
                                                    outputAllItemValuesIfNoSelect: true,
                                                }
                                            });
                                        }
                                    }
                                    appendControlModal.close();
                                    if (onChanged != null) {
                                        onChanged();
                                    }
                                    cell.style.textAlign = '';
                                    appendRemoveButtonToCell(cell, cellKey);
                                }
                            }), (button) => {
                                button.element.style.cssFloat = 'right';
                            });
                            appendControlModal.open();
                        }
                    }), (ddButton) => {
                        cell['_addButton'] = ddButton;
                        ddButton.element.style.height = '100%';
                    });
                    cell.style.textAlign = 'center';
                };
                let appendRemoveButtonToCell = (cell, cellKey) => {
                    cell.style.position = 'relative';
                    cell.disable();
                    cell.appendControl(new NextAdmin.UI.Button({
                        text: '<b>' + NextAdmin.Resources.removeIcon + '</b>', style: NextAdmin.UI.ButtonStyle.noBg, size: NextAdmin.UI.ButtonSize.medium,
                        action: (btn) => {
                            btn.element.remove();
                            let col = Number(cellKey.split(',')[0]);
                            let row = Number(cellKey.split(',')[1]);
                            this.removeItemByPosition(col, row);
                            cell.enable();
                            appendAddControlButtonToCell(cell, cellKey);
                        }
                    }), (removeCtrlButton) => {
                        cell['_removeButton'] = removeCtrlButton;
                        removeCtrlButton.element.style.color = '#ff0000';
                        removeCtrlButton.element.center();
                        removeCtrlButton.element.style.position = 'absolute';
                        removeCtrlButton.element.style.zIndex = '10';
                    });
                };
                let appendGridButtons = () => {
                    for (let cell of this._cellsDictionary.getKeysValues()) {
                        if (cell.value.children.length == 0) {
                            appendAddControlButtonToCell(cell.value, cell.key);
                        }
                        else if (cell.value['_addButton'] == null) {
                            appendRemoveButtonToCell(cell.value, cell.key);
                        }
                    }
                };
                appendGridButtons();
            }
        }
        UI.FilterGridLayout = FilterGridLayout;
        let ColumnOrdering;
        (function (ColumnOrdering) {
            ColumnOrdering[ColumnOrdering["ascending"] = 0] = "ascending";
            ColumnOrdering[ColumnOrdering["descending"] = 1] = "descending";
        })(ColumnOrdering = UI.ColumnOrdering || (UI.ColumnOrdering = {}));
        let DataDeleteMode;
        (function (DataDeleteMode) {
            DataDeleteMode[DataDeleteMode["disabled"] = 0] = "disabled";
            DataDeleteMode[DataDeleteMode["local"] = 1] = "local";
            DataDeleteMode[DataDeleteMode["server"] = 2] = "server"; //Prompt user and send to server delete query
        })(DataDeleteMode = UI.DataDeleteMode || (UI.DataDeleteMode = {}));
        let DataOrderingMode;
        (function (DataOrderingMode) {
            DataOrderingMode[DataOrderingMode["disabled"] = 0] = "disabled";
            DataOrderingMode[DataOrderingMode["local"] = 1] = "local";
            DataOrderingMode[DataOrderingMode["server"] = 2] = "server"; //Prompt user and send to server delete query
        })(DataOrderingMode = UI.DataOrderingMode || (UI.DataOrderingMode = {}));
        let DataSearchMode;
        (function (DataSearchMode) {
            DataSearchMode[DataSearchMode["disabled"] = 0] = "disabled";
            DataSearchMode[DataSearchMode["local"] = 1] = "local";
            DataSearchMode[DataSearchMode["server"] = 2] = "server";
        })(DataSearchMode = UI.DataSearchMode || (UI.DataSearchMode = {}));
        let DataLoadingMode;
        (function (DataLoadingMode) {
            DataLoadingMode[DataLoadingMode["disabled"] = 0] = "disabled";
            DataLoadingMode[DataLoadingMode["query"] = 1] = "query";
            DataLoadingMode[DataLoadingMode["rawData"] = 2] = "rawData";
        })(DataLoadingMode = UI.DataLoadingMode || (UI.DataLoadingMode = {}));
        let DataGridReorderingRowMode;
        (function (DataGridReorderingRowMode) {
            DataGridReorderingRowMode[DataGridReorderingRowMode["buttons"] = 0] = "buttons";
            DataGridReorderingRowMode[DataGridReorderingRowMode["dragAndDropHandle"] = 1] = "dragAndDropHandle";
            DataGridReorderingRowMode[DataGridReorderingRowMode["all"] = 2] = "all";
        })(DataGridReorderingRowMode = UI.DataGridReorderingRowMode || (UI.DataGridReorderingRowMode = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Input.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class InputSelect extends UI.Input {
            constructor(options) {
                super({
                    autoFill: true,
                    usePerfectScrollbar: false,
                    localOrdering: true,
                    throttle: 50,
                    canSearchData: true,
                    maxDropDownHeight: '250px', ...options
                });
                this.onDropdownOpening = new NextAdmin.EventHandler();
                this.onDropdownOpen = new NextAdmin.EventHandler();
                this.onDropdownClose = new NextAdmin.EventHandler();
                this.timer = new NextAdmin.Timer();
                NextAdmin.Style.append("InputSelect", InputSelect.style);
                this.input.type = 'text';
                //used to kill chrome autcompletion dropdown
                this.input.setAttribute('autocomplete', 'one-time-code');
                this.input.setAttribute('readonly', 'true');
                this.input.addEventListener('focus', () => setTimeout(() => this.input.removeAttribute('readonly'), 100));
                this.input.addEventListener('focusout', () => this.input.setAttribute('readonly', 'true'));
                this.input.addEventListener('pointerdown', (ev) => {
                    ev.stopImmediatePropagation();
                    ev.stopPropagation();
                });
                this.controlContainer.style.position = 'relative';
                this.dropDown = document.createElement('div');
                this.dropDown.classList.add('form-input-select-dropdown');
                this.dropDown.style.position = 'fixed';
                this.dropDown.style.zIndex = '9999999';
                this.dropDown.style.maxHeight = this.options.maxDropDownHeight;
                this.dropDown.style.overflow = 'auto';
                if (this.options.usePerfectScrollbar && NextAdmin.UserAgent.isDesktop()) {
                    this.dropDown.appendPerfectScrollbar();
                }
                this.dropDownTable = new UI.Table({ rowSelectionMode: UI.RowSelectionMode.singleSelect, rowHoverable: true });
                this.dropDownTable.element.style.width = '100%';
                this.dropDownTable.element.style.margin = '0px';
                this.dropDown.appendControl(this.dropDownTable);
                if (this.options.canAddCustomValue) {
                    this._customValueItem = this.dropDownTable.addBodyRow('');
                }
                this.dropDownTable.onRowSelected.subscribe((sender, row) => {
                    this.selectItem(row['_value']);
                });
                this.input.addEventListener('click', () => {
                    this.toggleDropDown();
                });
                this.input.addEventListener('keydown', (event) => {
                    this.onInputKeyDown(event);
                });
                this.input.addEventListener('input', (event) => {
                    this.onInputValueChanging(super.getValue());
                });
                let suspendBlur = false;
                this.input.addEventListener('blur', (event) => {
                    if (suspendBlur) {
                        return;
                    }
                    this.input.focus();
                    if (this.input.type != 'number') {
                        this.input.setSelectionRange(0, 0);
                    }
                    suspendBlur = true;
                    this.input.blur();
                    suspendBlur = false;
                });
                this.openDropDownButton = this.addRightAddon(new UI.Button({
                    style: UI.ButtonStyle.bgWhite,
                    text: '',
                    action: () => {
                        this.toggleDropDown();
                    }
                }));
                if (!this.options.displayDropdownButton) {
                    this.openDropDownButton.element.style.display = 'none';
                }
                this._onClickOutside = (event) => {
                    if (this.dropDown.parentElement == null)
                        return;
                    let elementToTest = event.target;
                    let isOutside = true;
                    do {
                        if (elementToTest == this.dropDown || elementToTest == this.controlContainer || elementToTest == this.openDropDownButton.element || elementToTest == this.element) {
                            isOutside = false;
                            break;
                        }
                        elementToTest = elementToTest.parentNode;
                    } while (elementToTest);
                    if (isOutside) { //click outside
                        this.cancelSelect();
                    }
                };
                if (this.options.items != null) {
                    this.addSelectItems(this.options.items);
                }
                InputSelect.onCreated.dispatch(this, this.options);
            }
            toggleDropDown() {
                if (this.dropDown.parentElement == null) {
                    this.openDropDown();
                }
                else {
                    this.closeDropDown();
                }
            }
            getItemValue(rowElement) {
                return rowElement['_value'];
            }
            getItem(value) {
                return this.getItems().firstOrDefault(a => a['_value'] == value);
            }
            onInputKeyDown(event) {
                if (this.dropDown.parentElement == null) {
                    this.openDropDown();
                }
                if (event.keyCode == 13) { //enter
                    let selectedRow = this.dropDownTable.getSelectedRows().firstOrDefault();
                    if (selectedRow != null) {
                        this.updateValue(selectedRow['_value']);
                    }
                    else {
                        this.updateValue(null);
                    }
                    this.closeDropDown();
                }
                else if (event.keyCode == 27) //escape
                 {
                    this.cancelSelect();
                }
                let newSelectedRow;
                if (event.keyCode == 38) { //arrow up
                    let rows = this.dropDownTable.getBodyRows().where(e => e.style.display != 'none');
                    let selectedRow = this.dropDownTable.getSelectedRows().firstOrDefault();
                    if (selectedRow != null) {
                        let indexNextRow = rows.indexOf(selectedRow) - 1;
                        if (indexNextRow >= 0) {
                            newSelectedRow = rows[indexNextRow];
                            this.dropDownTable.selectRow(newSelectedRow, false);
                        }
                    }
                    else if (rows.length > 0) {
                        newSelectedRow = rows[0];
                        this.dropDownTable.selectRow(newSelectedRow, false);
                    }
                }
                else if (event.keyCode == 40) { //arrow down
                    let rows = this.dropDownTable.getBodyRows().where(e => e.style.display != 'none');
                    let selectedRow = this.dropDownTable.getSelectedRows().firstOrDefault();
                    if (selectedRow != null) {
                        let indexNextRow = rows.indexOf(selectedRow) + 1;
                        if (indexNextRow < rows.length) {
                            newSelectedRow = rows[indexNextRow];
                            this.dropDownTable.selectRow(newSelectedRow, false);
                        }
                    }
                    else if (rows.length > 0) {
                        newSelectedRow = rows[0];
                        this.dropDownTable.selectRow(newSelectedRow, false);
                    }
                }
                if (newSelectedRow) {
                    this.dropDown.scrollTo({ top: newSelectedRow.offsetTop });
                }
            }
            selectItem(value) {
                this.closeDropDown();
                this.updateValue(value);
                if (this.input.type != 'number') {
                    this.input.setSelectionRange(0, 0);
                }
            }
            cancelSelect() {
                this.updateValue(this.getValue());
                this.closeDropDown();
                if (this.options.canSearchData && this.input.type != 'number') {
                    this.input.setSelectionRange(0, 0);
                }
            }
            onInputValueChanging(val) {
                if (this.options.canAddCustomValue && this._customValueItem != null) {
                    this._customValueItem.getCells()[0].innerHTML = val;
                    this._customValueItem['_value'] = val;
                    this.dropDownTable.selectRow(this._customValueItem, false);
                    this._customValueItem.style.display = '';
                }
                if (this.options.canSearchData) {
                    if (this.options.searchAction != null) {
                        if (this.options.throttle) {
                            this.timer.throttle(() => {
                                this.distantSearch(super.getValue());
                            }, this.options.throttle);
                        }
                        else {
                            this.distantSearch(super.getValue());
                        }
                    }
                    else {
                        this.localSearch(super.getValue());
                    }
                }
            }
            load(endSearchAction) {
                let pv = this.dropDown.style.display;
                this.dropDown.style.display = '';
                this.distantSearch('', endSearchAction);
                this.dropDown.style.display = pv;
            }
            distantSearch(searchValue, endSearchAction) {
                if (this.dropDown.parentElement == null) {
                    //return; removed to the impossibility to pre load data before drop down open
                }
                this.startSpin();
                let inputValue = (super.getValue() + '').trim();
                this.options.searchAction(searchValue, (searchResultItems) => {
                    this.stopSpin();
                    this.clearItems();
                    let hasRowSelected = false;
                    if (searchResultItems != null) {
                        if (this.options.localOrdering) {
                            searchResultItems = searchResultItems.orderBy(a => a.label);
                        }
                        for (let valueItem of searchResultItems) {
                            if (valueItem == null)
                                continue;
                            let itemAdded = this.addItem(valueItem.value, valueItem.label);
                            if ((this._customValueItem == null || this._customValueItem.style.display == 'none') && !hasRowSelected) {
                                this.dropDownTable.selectRow(itemAdded, false);
                                hasRowSelected = true;
                            }
                            if (valueItem?.label?.trim() == inputValue) { //if user type exacty a value
                                if (this._customValueItem != null) {
                                    this._customValueItem.style.display = 'none';
                                }
                                this.dropDownTable.selectRow(itemAdded, false);
                            }
                        }
                    }
                    if (endSearchAction != null) {
                        endSearchAction(searchResultItems);
                    }
                });
            }
            localSearch(searchValue) {
                let hasRowSelected = false;
                for (let item of this.dropDownTable.getBodyRows()) {
                    if (item == this._customValueItem)
                        continue;
                    if ((item['_search'] ?? '').toLowerCase().indexOf((searchValue ?? '').toLowerCase().removeDiacritics()) != -1) {
                        item.style.display = '';
                        if ((this._customValueItem == null || this._customValueItem.style.display == 'none') && !hasRowSelected) {
                            this.dropDownTable.selectRow(item, false);
                            hasRowSelected = true;
                        }
                        if (item.cells[0].innerText == searchValue) { //if user type exacty a value
                            if (this._customValueItem != null) {
                                this._customValueItem.style.display = 'none';
                                this.dropDownTable.selectRow(item, false);
                                hasRowSelected = true;
                            }
                        }
                    }
                    else {
                        item.style.display = 'none';
                    }
                }
            }
            openDropDown() {
                if (this.options.canSearchData) {
                    this.input.select();
                }
                let dropDownOpeningArgs = {
                    dropDown: this.dropDown,
                };
                this.onDropdownOpening.dispatch(this, dropDownOpeningArgs);
                if (dropDownOpeningArgs.cancel)
                    return;
                document.body.appendChild(this.dropDown);
                let inputBoundings = this.input.getBoundingClientRect();
                this.dropDown.style.top = (inputBoundings.top + inputBoundings.height) + 'px';
                this.dropDown.style.left = inputBoundings.left + 'px';
                this.dropDown.style.width = inputBoundings.width + 'px';
                if (this.options.searchAction != null) {
                    this.clearItems();
                    this.distantSearch(this.options.resetSearchAtOpen ? '' : super.getValue());
                }
                else {
                    for (let item of this.dropDownTable.getBodyRows()) {
                        item.style.display = '';
                    }
                }
                if (this._customValueItem != null) {
                    this._customValueItem.style.display = 'none';
                }
                this.element.focus();
                this.input.removeAttribute('readonly');
                this.onDropdownOpen.dispatch(this, this.dropDown);
                if (this.options.onDropdownOpen != null) {
                    this.options.onDropdownOpen(this, this.dropDown);
                }
                document.addEventListener('pointerdown', this._onClickOutside);
                document.addEventListener('click', this._onClickOutside);
                document.addEventListener('touchstart', this._onClickOutside);
            }
            closeDropDown() {
                this.input.setAttribute('readonly', 'true'); //used to kill chrome autcompletion dropdown
                this.dropDown.remove();
                this.onDropdownClose.dispatch(this, this.dropDown);
                document.removeEventListener('pointerdown', this._onClickOutside);
                document.removeEventListener('click', this._onClickOutside);
                document.removeEventListener('touchstart', this._onClickOutside);
            }
            getItems() {
                let items = this.dropDownTable.getBodyRows();
                if (this.options.canAddCustomValue && this._customValueItem != null) {
                    items = items.where(e => e != this._customValueItem);
                }
                return items;
            }
            getFilteredItems() {
                return this.getItems().where(e => e.style.display != 'none');
            }
            setPropertyInfo(propertyInfo) {
                super.setPropertyInfo(propertyInfo);
                if (this.options.autoFill && propertyInfo.values != null) {
                    for (let memberValue of propertyInfo.values) {
                        this.addItem(memberValue.value, memberValue.label);
                    }
                }
            }
            addSelectItems(items) {
                for (let item of items) {
                    this.addSelectItem(item);
                }
            }
            setSelectItems(items) {
                this.clearItems();
                this.addSelectItems(items);
            }
            addSelectItem(item) {
                this.addItem(item.value, item.label, item.selected);
            }
            removeItem(rowElement) {
                if (rowElement['_value'] == this.getValue()) {
                    this.setValue(null);
                }
                rowElement.remove();
            }
            getItemsValues() {
                return this.getItems().select(e => e['_value']);
            }
            addItem(value, label = null, selected) {
                if (value == null) {
                    return;
                }
                if (label == null) {
                    label = value.toString();
                }
                let row = this.dropDownTable.addBodyRow(label);
                row['_value'] = value;
                row['_search'] = label.removeDiacritics();
                if (NextAdmin.String.isNullOrEmpty(label)) {
                    row.cells[0].appendHTML('div', (d) => {
                        d.style.minHeight = '15px';
                    });
                }
                if (this.options.canAddCustomValue && this._customValueItem != null && this._customValueItem['_value'] == value) {
                    this._selectedItem = row;
                    this.dropDownTable.selectRow(row, false);
                    this._customValueItem.getCells()[0].innerHTML = label;
                    if (this._customValueItem != null) {
                        this._customValueItem.style.display = 'none';
                    }
                }
                else if (selected) {
                    this._selectedItem = row;
                    this.dropDownTable.selectRow(row, false);
                    if (this._customValueItem != null) {
                        this._customValueItem.style.display = 'none';
                    }
                }
                return row;
            }
            addItems(dataset, captionFunc, valueFunc = null) {
                let items = new Array();
                for (let data of dataset) {
                    let item = this.addItem(captionFunc(data), valueFunc == null ? undefined : valueFunc(data));
                    items.push(item);
                }
                return items;
            }
            setItems(dataset, captionFunc, valueFunc = null) {
                this.clearItems();
                return this.addItems(dataset, captionFunc, valueFunc);
            }
            clearAll() {
                this.clearItems();
                this.setValue(null);
            }
            clearItems() {
                this.dropDownTable.clear();
                if (this.options.canAddCustomValue && this._customValueItem) {
                    this.dropDownTable.tBody.appendChild(this._customValueItem);
                }
            }
            updateValue(value) {
                let previousValue = this.getValue();
                this.setValue(value);
                this.onValueChanged.dispatch(this, { previousValue: previousValue, value: this.getValue() });
            }
            setValue(value, fireChange) {
                let items = this.getItems();
                let item;
                if (items != null) {
                    item = items.firstOrDefault(e => e['_value'] == value);
                }
                if (item != null) {
                    super.setValue(item.innerText);
                    this.dropDownTable.selectRow(item, false);
                    this._selectedItem = item;
                    if (this._customValueItem != null) {
                        this._customValueItem.style.display = 'none';
                    }
                }
                else if (this.options.canAddCustomValue && this._customValueItem != null) {
                    this._customValueItem.getCells()[0].innerHTML = value;
                    this._customValueItem['_value'] = value;
                    this._customValueItem.style.display = '';
                    this._selectedItem = this._customValueItem;
                    super.setValue(value);
                    this.dropDownTable.selectRow(this._customValueItem, false);
                }
                else {
                    this._selectedItem = null;
                    super.setValue('');
                }
                value = this.getValue();
                if (fireChange) {
                    this.onValueChanged.dispatch(this, { value: value, origin: UI.ChangeOrigin.code });
                }
            }
            getValue() {
                let value = null;
                if (this.options.canAddCustomValue && this.dropDownTable.getSelectedRows().firstOrDefault() == this._customValueItem) {
                    value = super.getValue();
                }
                else {
                    value = this._selectedItem ? this._selectedItem['_value'] : null;
                }
                if (value != null && NextAdmin.String.isString(value) && value == '') {
                    return null;
                }
                return value;
            }
            Enable() {
                super.enable();
                this.openDropDownButton.enable();
            }
            Disable() {
                super.disable();
                this.openDropDownButton.disable();
            }
            startSpin() {
                this.openDropDownButton.startSpin();
            }
            stopSpin() {
                this.openDropDownButton.stopSpin();
            }
        }
        InputSelect.style = `
        .form-input-select-dropdown {
            border-radius: 4px; 
            background-color:#fff;
            width:100%;
            border:1px solid #ccc;
            box-shadow:0px 1px 2px rgba(0,0,0,0.4) 
        } 
        .form-input-select-dropdown td {
            padding:5px;
            font-size:14px;
        }
        `;
        InputSelect.onCreated = new NextAdmin.EventHandler();
        UI.InputSelect = InputSelect;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="InputSelect.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class DataSelect extends UI.InputSelect {
            constructor(options) {
                super({
                    canAddData: true,
                    canEditData: true,
                    hasDropDownMenu: true,
                    resetSearchAtOpen: false,
                    canAddCustomValue: false,
                    searchItemsCount: 100,
                    lightButtons: true,
                    allowNullValue: true,
                    searchPropertiesNames: options?.displayPropertiesNames,
                    searchAction: (searchValue, seacrhResultAction) => {
                        this.options.datasetController.take(this.options.searchItemsCount ?? null);
                        if (this.options.orderBy) {
                            this.options.datasetController.orderBy(...this.options.orderBy);
                        }
                        let dataInfo = this.datasetController.getDataInfo();
                        if (dataInfo != null) {
                            this.options.datasetController.search(this.options.searchPropertiesNames
                                .where(a => dataInfo.propertyInfos[a] != null && dataInfo.propertyInfos[a].isQueryable), searchValue); //check that columns are querieable
                        }
                        else {
                            this.options.datasetController.search(this.options.searchPropertiesNames, searchValue);
                        }
                        if (dataInfo && this.options.displayPropertiesNames && this.options.displayPropertiesNames.length > 0
                            && this.options.displayPropertiesNames.firstOrDefault(a => dataInfo.propertyInfos[a] == null || !dataInfo.propertyInfos[a].isQueryable) == null) {
                            let selectColumns = this.options.displayPropertiesNames.clone();
                            if (!selectColumns.contains(this.datasetController.options.dataPrimaryKeyName)) {
                                selectColumns.add(this.datasetController.options.dataPrimaryKeyName);
                            }
                            this.options.datasetController.select(...selectColumns);
                        }
                        this.options.datasetController.where('');
                        if (this.options.onStartLoadData) {
                            this.options.onStartLoadData(this);
                        }
                        this.options.datasetController.load({
                            onGetResponse: (result) => {
                                if (result.success) {
                                    let items = new Array();
                                    for (let data of result.dataset) {
                                        let label = '';
                                        if (this.options.itemDisplayValueFunc) {
                                            label = this.options.itemDisplayValueFunc(data);
                                        }
                                        else {
                                            for (let displayProperty of this.options.displayPropertiesNames) {
                                                if (label != '') {
                                                    label += ' ';
                                                }
                                                label += data[displayProperty];
                                            }
                                        }
                                        items.add({
                                            value: data[this.options.datasetController.options.dataPrimaryKeyName],
                                            label: label
                                        });
                                    }
                                    if (this.options.allowNullValue) {
                                        items.add({
                                            value: '',
                                            label: ''
                                        });
                                    }
                                    seacrhResultAction(items);
                                }
                                else {
                                    seacrhResultAction(null);
                                }
                            }
                        });
                    },
                    ...options
                });
                this.options.datasetController = this.options.datasetController == null && this.options.dataName != null ? NextAdmin.Business.DatasetController_.factory(this.options.dataName) : this.options.datasetController;
                this.datasetController = this.options.datasetController;
                if (this.options.dataName == null && this.datasetController != null) {
                    this.options.dataName = this.datasetController.options.dataName;
                }
                if (this.options.displayPropertiesNames == null && this.options.searchPropertiesNames == null && this.datasetController != null) {
                    let dataInfo = this.datasetController.getDataInfo();
                    if (dataInfo) {
                        this.options.displayPropertiesNames = this.options.searchPropertiesNames = dataInfo.displayPropertiesNames;
                    }
                }
                this.openDropDownButton.element.style.display = 'none';
                this.dropDownMenuButton = this.addLeftAddon(new UI.DropDownButton({
                    text: NextAdmin.Resources.menuIcon,
                    style: UI.ButtonStyle.noBg,
                    onOpeningDropDown: (button, args) => {
                        this.onOpeningDropdownMenu(args);
                    }
                }));
                if (!this.options.hasDropDownMenu || (!this.options.canAddData && !this.options.canEditData)) {
                    this.dropDownMenuButton.hide();
                }
                DataSelect.onCreated.dispatch(this, this.options);
            }
            onOpeningDropdownMenu(args) {
                args.dropDown.clearItems();
                let dataPrimaryKey = this.getValue();
                if (this.options.formModalFactory != null && this.datasetController) {
                    if (this.options.canAddData) {
                        let addButton = args.dropDown.appendControl(new UI.Button({
                            text: NextAdmin.Resources.addIcon + ' ' + NextAdmin.Resources.newEntry,
                            action: () => {
                                let modal;
                                if (this.options.formModalFactory != null) {
                                    modal = this.options.formModalFactory(this.options.dataName, null);
                                }
                                else if (this.options.dataName != null) {
                                    modal = UI.DataFormModal_.formModalByDataNameFactory(this.options.dataName);
                                }
                                else {
                                    console.log('unable to find modal');
                                    return;
                                }
                                modal.open({ appendNewData: true });
                                modal.dataController.onDataSaved.subscribe((sender, args) => {
                                    if (args.newData != null) {
                                        let value = args.newData[this.options.datasetController.options.dataPrimaryKeyName];
                                        this.setValue(value, true);
                                    }
                                });
                                modal.dataController.onDataDeleted.subscribe((sender, data) => {
                                    let value = data[this.options.datasetController.options.dataPrimaryKeyName];
                                    if (this.getValue() == value) {
                                        this.clearAll();
                                    }
                                });
                            }
                        }));
                    }
                    if (this.options.canEditData) {
                        let openButton = args.dropDown.appendControl(new UI.Button({
                            text: NextAdmin.Resources.openIcon + ' ' + NextAdmin.Resources.openEntry,
                            action: () => {
                                let dataPrimaryKey = this.getValue();
                                if (dataPrimaryKey == null) {
                                    return;
                                }
                                let modal;
                                if (this.options.formModalFactory != null) {
                                    modal = this.options.formModalFactory(this.options.dataName, { dataPrimaryKey: dataPrimaryKey });
                                }
                                else if (this.options.dataName != null) {
                                    modal = UI.DataFormModal_.formModalByDataNameFactory(this.options.dataName, { dataPrimaryKey: dataPrimaryKey });
                                }
                                if (modal == null) {
                                    console.log('unable to find modal');
                                    return;
                                }
                                modal.open({ dataPrimaryKey: dataPrimaryKey });
                                modal.dataController.onDataSaved.subscribe((sender, args) => {
                                    if (args.newData != null) {
                                        let value = args.newData[this.options.datasetController.options.dataPrimaryKeyName];
                                        if (this.getValue() == value) {
                                            this.clearAll();
                                            this.setValue(value);
                                        }
                                    }
                                });
                                modal.dataController.onDataDeleted.subscribe((sender, data) => {
                                    let value = data[this.options.datasetController.options.dataPrimaryKeyName];
                                    if (this.getValue() == value) {
                                        this.clearAll();
                                    }
                                });
                            }
                        }));
                        if (dataPrimaryKey == null) {
                            openButton.disable();
                        }
                    }
                }
                if (this.options.canEditData) {
                    let deleteButton = args.dropDown.appendControl(new UI.Button({
                        text: NextAdmin.Resources.deleteIcon + ' ' + NextAdmin.Resources.deleteEntry,
                        action: async () => {
                            let dataPrimaryKey = this.getValue();
                            if (dataPrimaryKey == null) {
                                return;
                            }
                            let previousState = this._dataController?.getDataState();
                            this.setValue(null, true);
                            if (previousState == NextAdmin.Business.DataState.serialized) {
                                let result = await this._dataController.save();
                                if (result?.success) {
                                    this.deleteData(dataPrimaryKey, true);
                                }
                            }
                            else if (this._dataController?.getDataState() == NextAdmin.Business.DataState.edited) {
                                this._dataController.ensureUpToDate(() => {
                                    this.deleteData(dataPrimaryKey, true);
                                });
                            }
                            else {
                                this.deleteData(dataPrimaryKey, true);
                            }
                        }
                    }));
                    if (dataPrimaryKey == null) {
                        deleteButton.disable();
                    }
                }
                let deleteButton = args.dropDown.appendControl(new UI.Button({
                    text: NextAdmin.Resources.clearIcon + ' ' + NextAdmin.Resources.stopUseEntry,
                    action: async () => {
                        this.setValue(null);
                    }
                }));
                if (dataPrimaryKey == null) {
                    deleteButton.disable();
                }
            }
            async deleteData(dataPrimaryKey, displayError) {
                if (dataPrimaryKey == null) {
                    dataPrimaryKey = this.getValue();
                }
                if (dataPrimaryKey == null) {
                    return;
                }
                this.startSpin();
                let item = {};
                item[this.datasetController.options.dataPrimaryKeyName] = dataPrimaryKey;
                await this.datasetController.deleteItems([item], { displayErrors: displayError });
                this.stopSpin();
            }
            setPropertyInfo(propertyInfo) {
                super.setPropertyInfo(propertyInfo);
                if (propertyInfo.isRequired != null && this.options.allowNullValue === undefined) {
                    this.options.allowNullValue = !propertyInfo.isRequired;
                }
                if (this.options.dataName == null && this.options.datasetController == null && propertyInfo.foreignDataName != null) {
                    this.options.dataName = propertyInfo.foreignDataName;
                    this.datasetController = this.options.datasetController = NextAdmin.Business.DatasetController_.factory(propertyInfo.foreignDataName);
                }
                let dataInfo = this.options.datasetController.getDataInfo();
                if (this.options.displayPropertiesNames == null && this.options.datasetController != null) {
                    if (dataInfo.displayPropertiesNames != null) {
                        this.options.displayPropertiesNames = dataInfo.displayPropertiesNames;
                    }
                }
                if (this.options.searchPropertiesNames == null && this.options.datasetController != null) {
                    if (dataInfo.displayPropertiesNames != null) {
                        this.options.searchPropertiesNames = dataInfo.displayPropertiesNames;
                    }
                }
            }
            setValue(value, fireChange) {
                if (!NextAdmin.String.isNullOrEmpty(value)) {
                    let items = this.getItems();
                    let item = items.firstOrDefault(e => e['_value'] == value);
                    if (item == null) { //we set value of non existing item, so we ask a preview value
                        let displayValue;
                        if (this.options.previewValueFunc != null) {
                            displayValue = this.options.previewValueFunc(value);
                        }
                        if (!NextAdmin.String.isNullOrEmpty(displayValue)) {
                            this.addItem(value, displayValue);
                        }
                        else if (this.options.datasetController != null) {
                            let tempItem;
                            if (!NextAdmin.String.isNullOrEmpty(value)) {
                                tempItem = this.addItem(value);
                            }
                            this.options.datasetController.take(1);
                            this.options.datasetController.search(null);
                            this.options.datasetController.select();
                            if (this.options.onStartLoadData) {
                                this.options.onStartLoadData(this);
                            }
                            this.options.datasetController.where(this.options.datasetController.options.dataPrimaryKeyName + ' = ?', value);
                            this.options.datasetController.load({
                                onGetResponse: (result) => {
                                    if (result.success) {
                                        if (tempItem != null) {
                                            this.removeItem(tempItem);
                                        }
                                        let item = result.dataset.firstOrDefault();
                                        if (item != null) {
                                            let label = '';
                                            if (this.options.itemDisplayValueFunc) {
                                                label = this.options.itemDisplayValueFunc(item);
                                            }
                                            else {
                                                for (let displayProperty of this.options.displayPropertiesNames) {
                                                    if (label != '') {
                                                        label += ' ';
                                                    }
                                                    label += item[displayProperty];
                                                }
                                            }
                                            this.addItem(value, label);
                                            super.setValue(value);
                                        }
                                    }
                                }
                            });
                        }
                    }
                }
                super.setValue(value);
                if (fireChange) {
                    this.onValueChanged.dispatch(this, { value: this.getValue(), origin: UI.ChangeOrigin.code });
                }
            }
            async getItemValueData(itemValue) {
                if (itemValue == null) {
                    itemValue = this.getValue();
                }
                if (itemValue == null) {
                    return null;
                }
                return new Promise((resolve) => {
                    let clonedDataController = this.options.datasetController.clone();
                    clonedDataController.take(1);
                    clonedDataController.search(null);
                    clonedDataController.select();
                    clonedDataController.where(this.options.datasetController.options.dataPrimaryKeyName + '=?', itemValue);
                    clonedDataController.load({
                        onGetResponse: (result) => {
                            if (result.dataset != null && result.dataset.length == 1) {
                                resolve(result.dataset[0]);
                                return;
                            }
                            else {
                                resolve(null);
                                return;
                            }
                        }
                    });
                });
            }
            getDisplayValue() {
                return this.input.value;
            }
            disable() {
                super.disable();
                this.dropDownMenuButton.disable();
            }
            enable() {
                super.enable();
                this.dropDown.enable();
            }
        }
        DataSelect.onCreated = new NextAdmin.EventHandler();
        UI.DataSelect = DataSelect;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Button.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class DropDownButton extends UI.Button {
            constructor(options) {
                super({
                    dropDownWidth: '250px',
                    maxDropDownHeight: '400px',
                    dropDownParentContainer: document.body,
                    action: (btn, event) => {
                        this.toggleDropDown();
                    },
                    ...options
                });
                this.dropDownPosition = this.options.dropDownPosition;
                //Style.append("DropDownButton", DropDownButton.style);
                this.dropDown = new UI.DropDownMenu({
                    items: this.options.items,
                    dropDownWidth: this.options.dropDownWidth,
                    maxDropDownHeight: this.options.maxDropDownHeight,
                    parentContainer: this.options.dropDownParentContainer
                });
                if (this.options.openOnHover) {
                    this.openOnHover();
                }
                DropDownButton.onCreated.dispatch(this, this.options);
                this.element.addEventListener('pointerdown', (ev) => {
                    ev.stopPropagation();
                    ev.stopImmediatePropagation();
                });
            }
            openOnHover() {
                if (NextAdmin.UserAgent.isMobile())
                    return;
                let overDropDown = false;
                this.dropDown.element.addEventListener('pointerenter', () => {
                    overDropDown = true;
                });
                this.dropDown.element.addEventListener('pointerleave', () => {
                    overDropDown = false;
                    this.closeDropDown();
                });
                this.element.addEventListener('pointerenter', () => {
                    this.openDropDown();
                });
                this.element.addEventListener('pointerleave', () => {
                    setTimeout(() => {
                        if (!overDropDown) {
                            this.closeDropDown();
                        }
                    }, 200);
                });
            }
            addElement(dropDownItem) {
                return this.dropDown.addElement(dropDownItem);
            }
            addItem(dropDownItem) {
                return this.dropDown.addItem(dropDownItem);
            }
            appendControl(elementOrControl, configAction) {
                this.dropDown.addElement(elementOrControl);
                if (configAction) {
                    configAction(elementOrControl);
                }
                return elementOrControl;
            }
            prependControl(elementOrControl, configAction) {
                let element = this.dropDown.addElement(elementOrControl);
                let controlContainer;
                if (element instanceof UI.Control) {
                    controlContainer = element.element.parentElement;
                }
                else {
                    controlContainer = element.parentElement;
                }
                this.dropDown.element.prepend(controlContainer);
                if (configAction) {
                    configAction(elementOrControl);
                }
                return elementOrControl;
            }
            appendHTML(html, setControlPropertiesAction) {
                return this.appendControl(document.createElement(html), setControlPropertiesAction);
            }
            clearItems() {
                this.dropDown.clearItems();
            }
            addItems(itms) {
                this.dropDown.addItems(itms);
                return this;
            }
            toggleDropDown() {
                if (this.isDropDownOpen()) {
                    this.closeDropDown();
                }
                else {
                    this.openDropDown();
                }
            }
            isDropDownOpen() {
                return this.dropDown.isOpen();
            }
            openDropDown() {
                if (this.options.onOpeningDropDown) {
                    let args = { dropDown: this.dropDown };
                    this.options.onOpeningDropDown(this, args);
                    if (args.cancel) {
                        return;
                    }
                }
                let dropDownPosition = this.dropDownPosition;
                if (dropDownPosition == null) {
                    let rightSpace = window.innerWidth - this.element.getBoundingClientRect().left;
                    dropDownPosition = rightSpace > 400 ? NextAdmin.UI.DropDownPosition.down : NextAdmin.UI.DropDownPosition.downLeft;
                }
                this.dropDown.open('0px', '0px');
                this.dropDown.element.style.visibility = 'hidden';
                setTimeout(() => {
                    this.dropDown.element.style.visibility = 'visible';
                    let buttonBoundings = this.element.getBoundingClientRect();
                    let x = 0;
                    let y = 0;
                    switch (dropDownPosition) {
                        default:
                        case DropDownPosition.downRight:
                            y = buttonBoundings.y - 1;
                            x = buttonBoundings.x + buttonBoundings.width;
                            break;
                        case DropDownPosition.downLeft:
                            y = buttonBoundings.y - 1;
                            x = buttonBoundings.x - this.dropDown.element.offsetWidth;
                            break;
                        case DropDownPosition.upRight:
                            y = buttonBoundings.y + buttonBoundings.height - this.dropDown.element.offsetHeight;
                            x = buttonBoundings.x + buttonBoundings.width;
                            break;
                        case DropDownPosition.upLeft:
                            y = buttonBoundings.y + buttonBoundings.height - this.dropDown.element.offsetHeight;
                            x = buttonBoundings.x - this.dropDown.element.offsetWidth;
                            break;
                        case DropDownPosition.down:
                            y = buttonBoundings.y + buttonBoundings.height - 1;
                            x = buttonBoundings.x;
                            break;
                        case DropDownPosition.up:
                            y = buttonBoundings.y - this.dropDown.element.offsetHeight;
                            x = buttonBoundings.x;
                            break;
                    }
                    this.dropDown.open(x + 'px', y + 'px');
                });
            }
            setDropDownPosition(position) {
                this.dropDownPosition = position;
            }
            closeDropDown() {
                this.dropDown.close();
            }
        }
        DropDownButton.onCreated = new NextAdmin.EventHandler();
        UI.DropDownButton = DropDownButton;
        let DropDownPosition;
        (function (DropDownPosition) {
            DropDownPosition[DropDownPosition["downRight"] = 0] = "downRight";
            DropDownPosition[DropDownPosition["downLeft"] = 1] = "downLeft";
            DropDownPosition[DropDownPosition["upRight"] = 2] = "upRight";
            DropDownPosition[DropDownPosition["upLeft"] = 3] = "upLeft";
            DropDownPosition[DropDownPosition["down"] = 4] = "down";
            DropDownPosition[DropDownPosition["up"] = 5] = "up";
        })(DropDownPosition = UI.DropDownPosition || (UI.DropDownPosition = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Button.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class DropDownMenu extends UI.Control {
            constructor(options) {
                super('div', {
                    dropDownWidth: '250px',
                    maxDropDownHeight: '400px',
                    parentContainer: document.body,
                    ...options
                });
                this.onOpen = new NextAdmin.EventHandler();
                this.onClose = new NextAdmin.EventHandler();
                this.items = Array();
                this.closeOnClickOutside = true;
                this._hasRegisteredEventOnClickOutside = false;
                NextAdmin.Style.append("DropDownButton", DropDownMenu.style);
                this.element.style.position = 'fixed';
                this.element.classList.add('next-admin-drop-down-menu');
                this.element.style.maxHeight = this.options.maxDropDownHeight;
                this.element.style.overflow = 'auto';
                this.element.style.width = this.options.dropDownWidth;
                this.element.addEventListener('wheel', (ev) => {
                    //removed because blocking scroll since perfect scrollbar was remoed
                    /*
                    ev.stopPropagation();
                    ev.preventDefault();
                    */
                });
                if (NextAdmin.UserAgent.isDesktop()) {
                    //this.element.appendPerfectScrollbar();
                }
                if (this.options.items != null) {
                    for (let dropDownItem of this.options.items) {
                        this.addElement(dropDownItem);
                    }
                }
                this._onClickOutside = (event) => {
                    if (this.element.parentElement == null)
                        return;
                    let elementToTest = event.target;
                    let isOutside = true;
                    do {
                        if (elementToTest == this.element) {
                            isOutside = false;
                            break;
                        }
                        elementToTest = elementToTest.parentNode;
                    } while (elementToTest);
                    if (isOutside) { //click outside
                        this.close();
                    }
                };
                DropDownMenu.onCreated.dispatch(this, this.options);
            }
            addItem(dropDownItem) {
                return this.addElement(dropDownItem);
            }
            appendControl(elementOrControl, configAction) {
                this.addElement(elementOrControl);
                if (configAction) {
                    configAction(elementOrControl);
                }
                return elementOrControl;
            }
            appendHTML(html, setControlPropertiesAction) {
                return this.appendControl(document.createElement(html), setControlPropertiesAction);
            }
            addElement(dropDownItem) {
                let item = null;
                this.element.appendHTML('div', (dropDownItemContainer) => {
                    if (dropDownItem instanceof UI.Control) {
                        dropDownItemContainer.appendControl(dropDownItem);
                        if (dropDownItem instanceof UI.DropDownButton) {
                            this.applyButtonItemStyle(dropDownItem);
                            if (!dropDownItem.dropDownPosition) {
                                dropDownItem.dropDownPosition = NextAdmin.UI.DropDownPosition.downRight;
                            }
                            if (!dropDownItem.options.openOnHover) {
                                dropDownItem.openOnHover();
                            }
                            dropDownItem.dropDown.onOpen.subscribe(() => {
                                for (let item of this.items.where(a => a != dropDownItem && a instanceof UI.DropDownButton)) {
                                    item.closeDropDown();
                                }
                            });
                        }
                        else if (dropDownItem instanceof UI.Button) {
                            this.applyButtonItemStyle(dropDownItem);
                            dropDownItem.onActionExecuted.subscribe(() => {
                                this.close();
                            });
                        }
                        item = dropDownItem;
                    }
                    else if (dropDownItem instanceof HTMLElement) {
                        dropDownItemContainer.append(dropDownItem);
                        item = dropDownItem;
                    }
                    else if (dropDownItem.action) {
                        item = dropDownItemContainer.appendControl(new UI.Button({
                            text: dropDownItem.text,
                            style: UI.ButtonStyle.noBg,
                            action: (btn) => {
                                this.close();
                                dropDownItem.action(this, btn);
                            }
                        }), (dropDownItemButton) => {
                            this.applyButtonItemStyle(dropDownItemButton);
                        });
                    }
                    else {
                        item = dropDownItemContainer.appendHTML('div', (titelItem) => {
                            titelItem.style.fontSize = '14px';
                            titelItem.style.fontWeight = 'bold';
                            titelItem.style.textAlign = 'left';
                            titelItem.style.background = '#dee9ff';
                            titelItem.style.cursor = '';
                            titelItem.innerHTML = dropDownItem.text;
                        });
                    }
                });
                this.items.add(item);
                return item;
            }
            getItems() {
                return this.items;
            }
            applyButtonItemStyle(buttonItem) {
                if (buttonItem.getColorStyle() == null || buttonItem.getColorStyle() == UI.ButtonStyle.default) {
                    buttonItem.setColorStyle(NextAdmin.UI.ButtonStyle.noBg);
                }
                buttonItem.element.style.width = '100%';
                buttonItem.element.style.overflow = 'hidden';
                buttonItem.element.style.textAlign = 'left';
                buttonItem.element.addEventListener('pointerover', (btnItem) => {
                    buttonItem.element.style.background = 'rgba(245,245,245,1)';
                });
                buttonItem.element.addEventListener('pointerleave', (btnItem) => {
                    buttonItem.element.style.background = 'unset';
                });
            }
            clearItems() {
                this.element.innerHTML = '';
            }
            addItems(itms) {
                for (let item of itms) {
                    this.addElement(item);
                }
                return this;
            }
            isOpen() {
                return this.element.parentElement != null;
            }
            open(x, y) {
                this.element.style.left = x;
                this.element.style.top = y;
                if (this.element.parentElement == null) {
                    this.options.parentContainer.appendChild(this.element);
                    this.onOpen.dispatch(this, this.element);
                    setTimeout(() => {
                        if (!this._hasRegisteredEventOnClickOutside) {
                            document.addEventListener('pointerdown', this._onClickOutside);
                            document.addEventListener('click', this._onClickOutside);
                            document.addEventListener('touchstart', this._onClickOutside);
                            this._hasRegisteredEventOnClickOutside = true;
                        }
                    }, 1);
                }
            }
            close() {
                if (!this.isOpen())
                    return;
                this.element.remove();
                document.removeEventListener('pointerdown', this._onClickOutside);
                document.removeEventListener('click', this._onClickOutside);
                document.removeEventListener('touchstart', this._onClickOutside);
                this._hasRegisteredEventOnClickOutside = false;
                this.onClose.dispatch(this, this.element);
            }
        }
        DropDownMenu.onCreated = new NextAdmin.EventHandler();
        DropDownMenu.style = '.next-admin-drop-down-menu{border-radius: 4px;background:#fefefe;border:1px solid #ccc;position:fixed;z-index:2000;left:0px;bottom:0px;height:fit-content;box-shadow:0px 1px 1px rgba(0,0,0,0.4)}';
        UI.DropDownMenu = DropDownMenu;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class FlexLayout extends UI.Control {
            constructor(options) {
                super('div', {
                    direction: FlexLayoutDirection.vertical,
                    ...options
                });
                NextAdmin.Style.append('NextAdmin.UI.FlexLayout', FlexLayout.style);
                this.element.classList.add('next-admin-flex-layout');
                this.setDirection(this.options.direction);
            }
            setDirection(direction) {
                switch (direction) {
                    default:
                    case FlexLayoutDirection.vertical:
                        this.element.style.flexDirection = 'column';
                        break;
                    case FlexLayoutDirection.horizontal:
                        this.element.style.flexDirection = 'row';
                        break;
                }
            }
            appendControl(elementOrControl, setControlPropertiesAction) {
                if (elementOrControl instanceof UI.Control) {
                    this.element.appendControl(elementOrControl);
                }
                else {
                    this.element.append(elementOrControl);
                }
                if (setControlPropertiesAction) {
                    setControlPropertiesAction(elementOrControl);
                }
                return elementOrControl;
            }
            appendControlStretch(elementOrControl, setControlPropertiesAction) {
                if (elementOrControl instanceof UI.Control) {
                    this.element.appendControl(elementOrControl);
                    elementOrControl.element.style.flexGrow = '1';
                }
                else {
                    this.element.append(elementOrControl);
                    elementOrControl.style.flexGrow = '1';
                }
                if (setControlPropertiesAction) {
                    setControlPropertiesAction(elementOrControl);
                }
                return elementOrControl;
            }
            appendHTML(html, setControlPropertiesAction) {
                return this.appendControl(document.createElement(html), setControlPropertiesAction);
            }
            appendHTMLStretch(html, setControlPropertiesAction) {
                return this.appendControlStretch(document.createElement(html), setControlPropertiesAction);
            }
            prependControl(elementOrControl, setControlPropertiesAction) {
                if (elementOrControl instanceof UI.Control) {
                    this.element.prependControl(elementOrControl);
                }
                else {
                    this.element.prepend(elementOrControl);
                }
                if (setControlPropertiesAction) {
                    setControlPropertiesAction(elementOrControl);
                }
                return elementOrControl;
            }
            prependControlStretch(elementOrControl, setControlPropertiesAction) {
                if (elementOrControl instanceof UI.Control) {
                    this.element.prependControl(elementOrControl);
                    elementOrControl.element.style.flexGrow = '1';
                }
                else {
                    this.element.prepend(elementOrControl);
                    elementOrControl.style.flexGrow = '1';
                }
                if (setControlPropertiesAction) {
                    setControlPropertiesAction(elementOrControl);
                }
                return elementOrControl;
            }
            prependHTML(html, setControlPropertiesAction) {
                return this.prependControl(document.createElement(html), setControlPropertiesAction);
            }
            prependHTMLStretch(html, setControlPropertiesAction) {
                return this.prependControlStretch(document.createElement(html), setControlPropertiesAction);
            }
        }
        FlexLayout.style = `

        .next-admin-flex-layout{
            width:100%;
            height:100%;
            display:flex;
        }

        `;
        UI.FlexLayout = FlexLayout;
        let FlexLayoutDirection;
        (function (FlexLayoutDirection) {
            FlexLayoutDirection[FlexLayoutDirection["vertical"] = 0] = "vertical";
            FlexLayoutDirection[FlexLayoutDirection["horizontal"] = 1] = "horizontal";
        })(FlexLayoutDirection = UI.FlexLayoutDirection || (UI.FlexLayoutDirection = {}));
        class HorizontalFlexLayout extends FlexLayout {
            constructor(options) {
                super({
                    direction: FlexLayoutDirection.horizontal,
                    ...options
                });
            }
        }
        UI.HorizontalFlexLayout = HorizontalFlexLayout;
        class VerticalFlexLayout extends FlexLayout {
            constructor(options) {
                super({
                    direction: FlexLayoutDirection.vertical,
                    ...options
                });
            }
        }
        UI.VerticalFlexLayout = VerticalFlexLayout;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class FormModal extends NextAdmin.UI.Modal {
            constructor(options) {
                super({
                    size: NextAdmin.UI.ModalSize.mediumFitContent,
                    ...options
                });
                this.formControls = new NextAdmin.Dictionary();
                NextAdmin.Style.append('NextAdmin.UI.FormModal', FormModal.style);
                this.modal.classList.add('next-admin-form-modal');
                this.form = this.body.appendHTML('div', (form) => {
                    form.classList.add('next-admin-form-modal-form');
                });
                this.data = this.options.data ?? {};
                this.validateButton = this.rightFooter.appendControl(new NextAdmin.UI.Button({
                    text: NextAdmin.Resources.validate,
                    style: NextAdmin.UI.ButtonStyle.blue,
                    css: { cssFloat: 'right' },
                    action: () => {
                        this.validate();
                    },
                    ...this.options.validateButtonOption
                }));
            }
            open(args) {
                super.open(args);
                if (args?.data) {
                    this.setData(args?.data);
                }
                setTimeout(() => {
                    this.updateValidateButtonState();
                }, 1);
            }
            updateValidateButtonState() {
                if (this.formControls.getValues().firstOrDefault(a => a.options.required && NextAdmin.String.isNullOrEmpty(a.getValue()))) {
                    this.validateButton.disable();
                }
                else {
                    this.validateButton.enable();
                }
            }
            async validate() {
                this.updateDataFromControls();
                if (this.options.onValidate) {
                    this.options.onValidate(this.data);
                }
            }
            appendFormControl(dataPropertyName, formControl, configAction) {
                this.form.appendControl(formControl, configAction);
                this.bindControl(formControl, dataPropertyName);
                formControl.element.classList.add('form-modal-control');
            }
            bindControl(formControl, dataPropertyName) {
                this.formControls.add(dataPropertyName, formControl);
                if (this.data[dataPropertyName]) {
                    formControl.setValue(this.data[dataPropertyName], false);
                }
                formControl.onValueChanged.subscribe((sender, args) => {
                    this.data[dataPropertyName] = args.value;
                    this.updateValidateButtonState();
                });
                this.updateValidateButtonState();
            }
            setData(data, fireChange) {
                if (data = null) {
                    data = {};
                }
                this.data = data;
                this.updateControlsFromData(fireChange);
                if (!fireChange) {
                    this.updateValidateButtonState();
                }
            }
            updateControlsFromData(fireChange) {
                for (let propertyNameControl of this.formControls.getKeysValues()) {
                    propertyNameControl.value.setValue(this.data[propertyNameControl.key], fireChange);
                }
            }
            updateDataFromControls() {
                for (let propertyNameControl of this.formControls.getKeysValues()) {
                    this.data[propertyNameControl.key] = propertyNameControl.value.getValue();
                }
            }
            getData() {
                return this.data;
            }
        }
        FormModal.style = `

            .next-admin-form-modal{
                .next-admin-form-modal-form{
                    padding-left:20px;
                    padding-right:20px;
                    @media (max-width: 512px) {
                        padding-left:10px;
                        padding-right:10px;
                    }
                    .form-modal-control{
                        margin-top:10px;
                        margin-bottom:10px;
                    }
                }
            }
        `;
        UI.FormModal = FormModal;
        class FormModal_ extends FormModal {
        }
        UI.FormModal_ = FormModal_;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        /*
            DEPRECATED - Use FlexLayout instead
        */
        class StretchLayout extends UI.Control {
            constructor(options) {
                super('div', { stretch: true, ...options });
                this.element.style.display = this.options.stretch ? 'flex' : 'block';
                this.element.style.width = '100%';
                this.element.style.height = '100%';
                switch (this.options.type) {
                    default:
                    case StretchLayoutType.stretchBottom:
                        this.element.style.flexDirection = 'column';
                        this.fixedContainer = this.element.appendHTML('div');
                        this.stretchContainer = this.element.appendHTML('div');
                        this.stretchContainer.style.flexGrow = '1';
                        break;
                    case StretchLayoutType.stretchTop:
                        this.element.style.flexDirection = 'column';
                        this.stretchContainer = this.element.appendHTML('div');
                        this.stretchContainer.style.flexGrow = '1';
                        this.fixedContainer = this.element.appendHTML('div');
                        break;
                    case StretchLayoutType.stretchLeft:
                        this.element.style.flexDirection = 'row';
                        this.stretchContainer = this.element.appendHTML('div');
                        this.stretchContainer.style.flexGrow = '1';
                        this.fixedContainer = this.element.appendHTML('div');
                        break;
                    case StretchLayoutType.stretchRight:
                        this.element.style.flexDirection = 'row';
                        this.fixedContainer = this.element.appendHTML('div');
                        this.stretchContainer = this.element.appendHTML('div');
                        this.stretchContainer.style.flexGrow = '1';
                        break;
                }
                if (this.options.fixedItems != null) {
                    for (let control of this.options.fixedItems) {
                        if (control instanceof HTMLElement) {
                            this.stretchContainer.appendChild(control);
                        }
                        if (control instanceof UI.Control) {
                            this.stretchContainer.appendControl(control);
                        }
                    }
                }
                if (this.options.stretchItem != null) {
                    if (this.options.stretchItem instanceof HTMLElement) {
                        this.stretchContainer.appendChild(this.options.stretchItem);
                    }
                    if (this.options.stretchItem instanceof UI.Control) {
                        this.stretchContainer.appendControl(this.options.stretchItem);
                    }
                }
                StretchLayout.onCreated.dispatch(this, this.options);
            }
        }
        StretchLayout.style = '';
        StretchLayout.onCreated = new NextAdmin.EventHandler();
        UI.StretchLayout = StretchLayout;
        let StretchLayoutType;
        (function (StretchLayoutType) {
            StretchLayoutType[StretchLayoutType["stretchLeft"] = 0] = "stretchLeft";
            StretchLayoutType[StretchLayoutType["stretchRight"] = 1] = "stretchRight";
            StretchLayoutType[StretchLayoutType["stretchTop"] = 2] = "stretchTop";
            StretchLayoutType[StretchLayoutType["stretchBottom"] = 3] = "stretchBottom";
        })(StretchLayoutType = UI.StretchLayoutType || (UI.StretchLayoutType = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="StretchLayout.ts" />
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Panel extends UI.StretchLayout {
            constructor(options) {
                super({
                    hasHeader: true,
                    ...options
                });
                NextAdmin.Style.append('Panel', Panel.style);
                this.header = this.fixedContainer;
                this.body = this.stretchContainer;
                this.element.classList.add('next-admin-panel');
                this.fixedContainer.classList.add('next-admin-panel-header');
                this.stretchContainer.classList.add('next-admin-panel-body');
                this.footer = this.element.appendHTML('div');
                this.footer.classList.add('next-admin-panel-footer');
                if (!this.options.hasHeader) {
                    this.header.style.display = 'none';
                }
                if (!this.options.hasFooter) {
                    this.footer.style.display = 'none';
                }
                this.fixedContainer.appendHTML('table', (table) => {
                    table.style.borderSpacing = '0px';
                    table.style.width = '100%';
                    table.appendHTML('tr', (tr) => {
                        this.leftHeader = tr.appendHTML('td');
                        this.leftHeader.classList.add('next-admin-left-panel-header');
                        this.rightHeader = tr.appendHTML('td');
                        this.rightHeader.classList.add('next-admin-right-panel-header');
                    });
                });
                this.setStyle(this.options.style);
                Panel.onCreated.dispatch(this, this.options);
            }
            setStyle(style) {
                switch (style) {
                    case PanelStyle.noBorder:
                        this.element.classList.add('next-admin-panel-no-border');
                        break;
                    default:
                    case PanelStyle.default:
                        break;
                }
            }
        }
        Panel.style = `
        .next-admin-panel-body {
            border:1px solid #ccc;
            background:#FFF;
        }
        .next-admin-panel-header {
            background:#FEFEFC;
            border-top:1px solid #ccc;
            border-left:1px solid #ccc;
            border-right:1px solid #ccc;
            min-height:25px;
            padding:5px;
            border-top-left-radius:5px;
            border-top-right-radius:5px;
            font-size:16px;
            color:#444;
            font-weight:500;

        }
        .next-admin-panel-footer {
            background:#FEFEFC;
            border-bottom:1px solid #ccc;
            border-left:1px solid #ccc;
            border-right:1px solid #ccc;
            min-height:25px;padding:5px;
            border-bottom-left-radius:5px;
            border-bottom-right-radius:5px
        }
        .next-admin-left-panel-header{
            padding:5px;
        }
        .next-admin-right-panel-header{
            padding:5px;
        }
        .next-admin-panel-no-border{
            .next-admin-panel-body {
                border:0px;
            }
            .next-admin-panel-header {
                border:0px;
            }
            .next-admin-panel-footer {
                border:0px;
            }
        }

        `;
        Panel.onCreated = new NextAdmin.EventHandler();
        UI.Panel = Panel;
        let PanelStyle;
        (function (PanelStyle) {
            PanelStyle[PanelStyle["default"] = 0] = "default";
            PanelStyle[PanelStyle["noBorder"] = 1] = "noBorder";
        })(PanelStyle = UI.PanelStyle || (UI.PanelStyle = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Panel.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class FormPanel extends UI.Panel {
            constructor(options) {
                super({
                    hasFooterToolbar: true,
                    hasFooter: options.hasFooterToolbar === false ? false : true,
                    dataController: options.dataController == null && NextAdmin.Business.DataController_.factory != null ? NextAdmin.Business.DataController_.factory(options.dataName) : options.dataController,
                    ...options
                });
                this.dataController = this.options.dataController;
                if (this.options.label) {
                    this.leftHeader.innerHTML = this.options.label;
                }
                this.body.style.padding = '10px';
                if (this.options.hasFooterToolbar) {
                    this.footer.appendControl(new NextAdmin.UI.Toolbar(), (toolbar) => {
                        toolbar.element.style.cssFloat = 'right';
                        toolbar.appendControl(this.cancelButton = new UI.Button({
                            text: NextAdmin.Resources.refreshIcon + ' ' + NextAdmin.Resources.cancel,
                            action: () => {
                                if (this.dataController != null) {
                                    this.dataController.cancel();
                                }
                            }
                        }));
                        this.deleteButton = new UI.Button({ text: NextAdmin.Resources.deleteIcon + ' ' + NextAdmin.Resources.delete });
                        toolbar.appendControl(this.saveButton = new UI.Button({
                            text: NextAdmin.Resources.saveIcon + ' ' + NextAdmin.Resources.save,
                            style: UI.ButtonStyle.green,
                            action: () => {
                                if (this.dataController != null) {
                                    this.dataController.save();
                                }
                            }
                        }));
                    });
                }
                if (this.dataController != null) {
                    this.dataController.bindToForm(this);
                }
            }
            enableReadOnly() {
            }
            disableReadOnly() {
            }
        }
        UI.FormPanel = FormPanel;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Panel.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class GridFormPanel extends UI.Control {
            constructor(options) {
                super('div', options);
                NextAdmin.Style.append('NextAdmin.UI.GridFormPanel', GridFormPanel.style);
                this.element.classList.add('next-admin-grid-form');
                this.element.style.display = 'flex';
                this.element.style.flexDirection = 'row';
                this.element.appendHTML('div', (leftContainer) => {
                    leftContainer.classList.add('next-admin-grid-form-left-container');
                    this.grid = leftContainer.appendControl(new NextAdmin.UI.DataGrid_({
                        style: NextAdmin.UI.TableStyle.card,
                        openAction: null,
                        hasActionMenu: false,
                        canExport: false,
                        canPrint: false,
                        stretchHeight: false,
                        rowSelectionMode: NextAdmin.UI.RowSelectionMode.singleSelect,
                        rowHoverable: true,
                        addAction: async () => {
                            let data = {};
                            if (this.grid.options.datasetController) {
                                this.grid.startSpin();
                                let appendDataResult = await this.grid.options.datasetController.append();
                                this.grid.stopSpin();
                                if (appendDataResult?.success) {
                                    data = appendDataResult.data;
                                }
                                else {
                                    NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.error, NextAdmin.Resources.unknownError);
                                    return;
                                }
                            }
                            if (this.options.onAppendDataItem) {
                                this.options.onAppendDataItem(this, data);
                            }
                            let row = this.grid.addDataItem(data, NextAdmin.Business.DataState.append);
                            this.grid.selectRow(row);
                        },
                        ...this.options.gridOptions
                    }));
                    this.grid.onSelectedRowsChanged.subscribe((grid, rows) => {
                        let row = rows.firstOrDefault();
                        if (row == null) {
                            return;
                        }
                        if (this.options.onSelectedDataChanged) {
                            this.options.onSelectedDataChanged(row, this.formPanel);
                        }
                        if (this.formPanel.dataController != null) {
                            this.formPanel.display();
                            this.formPanel.startSpin();
                            this.formPanel.dataController.load(row.data[this.formPanel.dataController.options.dataPrimaryKeyName], {
                                onGetResponse: () => {
                                    this.formPanel.stopSpin();
                                }
                            });
                        }
                    });
                    this.grid.onRowAdded.subscribe((sender, row) => {
                        setTimeout(() => {
                            if (this.grid.getSelectedDataRows().length == 0) {
                                this.grid.selectRow(row);
                            }
                        }, 20);
                    });
                    this.grid.onDatasetChanged.subscribe((sender, items) => {
                        if (!items?.length) {
                            this.formPanel.hide();
                        }
                    });
                });
                this.element.appendHTML('div', (rightContainer) => {
                    rightContainer.classList.add('next-admin-grid-form-right-container');
                    this.formPanel = rightContainer.appendControl(new NextAdmin.UI.FormPanel({
                        style: NextAdmin.UI.PanelStyle.noBorder,
                        ...this.options.formPanelOption
                    }));
                    if (this.formPanel.dataController) {
                        this.formPanel.dataController.onDataDeleted.subscribe((sender, result) => {
                            if (this.grid.datasetController) {
                                this.grid.load({ tryPreserveSelectionAndScroll: true });
                            }
                        });
                        this.formPanel.dataController.onDataSaved.subscribe((sender, result) => {
                            if (result.success && this.grid.datasetController) {
                                this.grid.load({ tryPreserveSelectionAndScroll: true });
                            }
                        });
                    }
                    this.formPanel.hide();
                });
                if (this.grid.noDataMessageContainer) {
                    this.element.appendChild(this.grid.noDataMessageContainer);
                }
            }
        }
        GridFormPanel.style = `

        .next-admin-grid-form{
            display:flex;
            flex-direction:row;
            min-height:300px;
            width:100%;

            .next-admin-grid-form-left-container{
                width:50%;
                min-width:50%;
                max-width:50%;
                min-height:100%;
                padding-right:15px;
            }

            .next-admin-grid-form-right-container{
                flex-grow:1;
                min-height:100%;
                padding-left:15px;
            }
        }

        @media screen and (min-width: 1600px) {
            .next-admin-grid-form{
                .next-admin-grid-form-left-container{
                    width:800px;
                    min-width:800px;
                    max-width:800px;
                }
            }
        }

        `;
        UI.GridFormPanel = GridFormPanel;
        class GridFormPanel_ extends GridFormPanel {
        }
        UI.GridFormPanel_ = GridFormPanel_;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        let ChangeOrigin;
        (function (ChangeOrigin) {
            ChangeOrigin[ChangeOrigin["user"] = 0] = "user";
            ChangeOrigin[ChangeOrigin["code"] = 1] = "code";
        })(ChangeOrigin = UI.ChangeOrigin || (UI.ChangeOrigin = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Image extends UI.Control {
            constructor(options) {
                super('div', {
                    style: ImageStyle.none,
                    displayMode: ImageDisplayMode.contain,
                    ...options
                });
                NextAdmin.Style.append("NextAdmin.UI.Image", Image.style);
                this.element.classList.add('next-admin-image-container');
                if (this.options.width) {
                    this.element.style.width = this.options.width;
                }
                if (this.options.height) {
                    this.element.style.width = this.options.height;
                }
                this.image = this.element.appendHTML('img', (image) => {
                    image.classList.add('next-admin-image');
                    image.style.width = '100%';
                    image.style.height = '100%';
                    //image.style.backgroundColor = '#f9f9f9';
                    image.src = this.options.src;
                });
                this.setStyle(this.options.style);
                this.setDisplayMode(this.options.displayMode);
            }
            setStyle(style) {
                switch (style) {
                    default:
                    case ImageStyle.none:
                        break;
                    case ImageStyle.lightBordered:
                        this.image.classList.add('next-admin-image-light-border');
                        break;
                    case ImageStyle.whiteBordered:
                        this.image.classList.add('next-admin-image-white-border');
                        break;
                }
            }
            setDisplayMode(displayMode) {
                switch (displayMode) {
                    default:
                    case ImageDisplayMode.contain:
                        this.image.style.objectFit = 'contain';
                        break;
                    case ImageDisplayMode.cover:
                        this.image.style.objectFit = 'cover';
                        break;
                    case ImageDisplayMode.stretch:
                        this.image.style.objectFit = 'fill';
                        break;
                }
            }
        }
        Image.style = `

        .next-admin-image-container {

            width:100%;
            height:100%;

            .next-admin-image{
                width:100%;
                height:100%;
                object-fit:contain;
            }

            .next-admin-image.next-admin-image-light-border{
                background-color:#f9f9f9;
                border-radius:6px;
                box-shadow:0px 0px 2px rgba(0,0,0,0.25);
            }
            .next-admin-image.next-admin-image-white-border{
                background-color:#f9f9f9;
                border-radius:6px;
                box-shadow:0px 0px 2px rgba(0,0,0,0.25);
            }
        }

        `;
        UI.Image = Image;
        let ImageStyle;
        (function (ImageStyle) {
            ImageStyle[ImageStyle["none"] = 0] = "none";
            ImageStyle[ImageStyle["lightBordered"] = 1] = "lightBordered";
            ImageStyle[ImageStyle["whiteBordered"] = 2] = "whiteBordered";
        })(ImageStyle = UI.ImageStyle || (UI.ImageStyle = {}));
        let ImageDisplayMode;
        (function (ImageDisplayMode) {
            ImageDisplayMode[ImageDisplayMode["contain"] = 0] = "contain";
            ImageDisplayMode[ImageDisplayMode["cover"] = 1] = "cover";
            ImageDisplayMode[ImageDisplayMode["stretch"] = 2] = "stretch";
        })(ImageDisplayMode = UI.ImageDisplayMode || (UI.ImageDisplayMode = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Link extends UI.Control {
            constructor(options) {
                super(options.htmlTag ?? 'a', { ...options });
                this.onActionExecuting = new NextAdmin.EventHandler();
                this.onActionExecuted = new NextAdmin.EventHandler();
                NextAdmin.Style.append('NextAdmin.UI.Link', Link.style);
                this.element.classList.add('next-admin-link');
                if (this.options.text) {
                    this.element.innerHTML = this.options.text;
                }
                if (this.options.popover) {
                    this.element.setPopover(this.options.popover);
                }
                if (this.options.action) {
                    this.action = this.options.action;
                }
                this.element.addEventListener('click', (event) => {
                    if (this.isEnable()) {
                        this.executeAction();
                    }
                });
                if (this.options.href) {
                    this.element.href = this.options.href;
                }
                this.setStyle(this.options.style);
            }
            isEnable() {
                return !this.element.classList.contains('next-admin-link-disabled');
            }
            enable() {
                if (!this.isEnable()) {
                    this.element.classList.remove('next-admin-link-disabled');
                }
            }
            disable() {
                if (this.isEnable()) {
                    this.element.classList.add('next-admin-link-disabled');
                }
            }
            executeAction() {
                this.onActionExecuting.dispatch(this, this.action);
                if (this.action != null) {
                    this.action(this);
                }
                this.onActionExecuted.dispatch(this, this.action);
            }
            setText(text) {
                this.element.innerHTML = text;
                return this;
            }
            getText() {
                return this.element.innerHTML;
            }
            setActive(value = true) {
                if (value && !this.element.classList.contains('next-admin-link-active')) {
                    this.element.classList.add('next-admin-link-active');
                }
                else if (!value && this.element.classList.contains('next-admin-link-active')) {
                    this.element.classList.remove('next-admin-link-active');
                }
            }
            setStyle(style) {
                switch (style) {
                    case LinkStyle.blue:
                    default:
                        this.element.classList.add('blue');
                        break;
                    case LinkStyle.dark:
                        this.element.classList.add('dark');
                        break;
                    case LinkStyle.white:
                        this.element.classList.add('white');
                }
            }
            startSpin() {
                return this.element.startSpin('rgba(255,255,255,0.5)', 20);
            }
            stopSpin() {
                this.element.stopSpin();
            }
        }
        Link.style = `
        .next-admin-link{
            cursor:pointer;
            text-shadow: 0px 0px 2px rgba(0,0,0,0.40);
            text-decoration:none;
        }
        .next-admin-link.blue{
            color:` + UI.DefaultStyle.BlueOne + `;
        }
        .next-admin-link.blue:hover{
            color:'#1a66ce';
        }

        .next-admin-link.dark{
            color:#222;
        }
        .next-admin-link.dark:hover{
            color:#555;
        }


        .next-admin-link.white {
            color:#fff;
        }

        .next-admin-link:hover{
            text-decoration: underline;
        }
        .next-admin-link-disabled{
            color:eee;
            cursor:unset;
            text-decoration: none;
        }
        .next-admin-link-active{
            text-decoration:underline;
        }

        `;
        UI.Link = Link;
        let LinkStyle;
        (function (LinkStyle) {
            LinkStyle[LinkStyle["blue"] = 0] = "blue";
            LinkStyle[LinkStyle["dark"] = 1] = "dark";
            LinkStyle[LinkStyle["white"] = 2] = "white";
        })(LinkStyle = UI.LinkStyle || (UI.LinkStyle = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class MenuModal extends UI.Modal {
            constructor(options) {
                super({
                    backdropColor: UI.DefaultStyle.DarkModalBackdrop,
                    size: UI.ModalSize.smallFitContent,
                    canMoveAndResize: false,
                    canMinimize: false,
                    canClose: false,
                    canChangeScreenMode: false,
                    hasBackButton: true,
                    ...options
                });
                this.leftHeader.style.fontSize = '20px';
                if (NextAdmin.String.isNullOrEmpty(this.options.title)) {
                    this.header.style.height = '3px';
                }
                this.mainContainer = this.body.appendHTML('div', (container) => {
                    container.style.padding = '10px';
                    if (this.options.text) {
                        container.appendHTML('p', this.options.text);
                    }
                });
                if (this.options.items) {
                    for (let item of this.options.items) {
                        this.addElement(item);
                    }
                }
                if (this.options.hasBackButton) {
                    this.addItem({
                        text: NextAdmin.Resources.closeIcon + ' ' + NextAdmin.Resources.close,
                        action: () => {
                            this.close();
                        }
                    });
                }
                this.element.addEventListener('click', () => {
                    this.close();
                });
            }
            addItems(itms) {
                for (let item of itms) {
                    this.addElement(item);
                }
                return this;
            }
            addItem(dropDownItem) {
                return this.addElement(dropDownItem);
            }
            appendControl(elementOrControl, configAction) {
                this.addElement(elementOrControl);
                if (configAction) {
                    configAction(elementOrControl);
                }
                return elementOrControl;
            }
            appendHTML(html, setControlPropertiesAction) {
                return this.appendControl(document.createElement(html), setControlPropertiesAction);
            }
            addElement(dropDownItem) {
                let item = null;
                this.mainContainer.appendHTML('div', (dropDownItemContainer) => {
                    dropDownItemContainer.style.marginTop = '15px';
                    if (dropDownItem instanceof UI.Control) {
                        dropDownItemContainer.appendControl(dropDownItem);
                        if (dropDownItem instanceof UI.DropDownButton) {
                            dropDownItem.setColorStyle(NextAdmin.UI.ButtonStyle.noBg);
                            dropDownItem.element.style.width = '100%';
                            dropDownItem.element.style.textAlign = 'left';
                            if (!dropDownItem.dropDownPosition) {
                                dropDownItem.dropDownPosition = NextAdmin.UI.DropDownPosition.downRight;
                            }
                            if (!dropDownItem.options.openOnHover) {
                                dropDownItem.openOnHover();
                            }
                        }
                        item = dropDownItem;
                    }
                    else if (dropDownItem instanceof HTMLElement) {
                        dropDownItemContainer.append(dropDownItem);
                        item = dropDownItem;
                    }
                    else if (dropDownItem.action) {
                        item = dropDownItemContainer.appendControl(new UI.Button({
                            text: dropDownItem.text,
                            style: UI.ButtonStyle.bgWhite,
                            size: UI.ButtonSize.large,
                            css: { overflow: 'hidden' },
                            action: (btn) => {
                                this.close();
                                dropDownItem.action(this, btn);
                            }
                        }), (dropDownItemButton) => {
                            dropDownItemButton.element.style.width = '100%';
                            dropDownItemButton.element.style.textAlign = 'center';
                            dropDownItemButton.element.addEventListener('pointerover', (btnItem) => {
                                dropDownItemButton.element.style.background = 'rgba(245,245,245,1)';
                            });
                            dropDownItemButton.element.addEventListener('pointerleave', (btnItem) => {
                                dropDownItemButton.element.style.background = 'unset';
                            });
                        });
                    }
                    else {
                        item = dropDownItemContainer.appendHTML('div', (titelItem) => {
                            titelItem.style.fontSize = '14px';
                            titelItem.style.fontWeight = 'bold';
                            titelItem.style.textAlign = 'left';
                            titelItem.style.background = '#dee9ff';
                            titelItem.style.cursor = '';
                            titelItem.innerHTML = dropDownItem.text;
                        });
                    }
                });
                return item;
            }
        }
        UI.MenuModal = MenuModal;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class MessageBox extends UI.Control {
            constructor(options) {
                super('div', options);
                this._button = new Array();
                NextAdmin.Style.append("MessageBox", MessageBox.style);
                if (this.options.parentContainer == null) {
                    this.options.parentContainer = document.body;
                }
                this.element.classList.add('next-admin-msgbox-container');
                this.modal = this.element.appendHTML('div', (modal) => {
                    modal.classList.add('next-admin-msgbox-modal');
                    this.modalContent = modal.appendHTML('div', (modalContent) => {
                        modalContent.classList.add('next-admin-msgbox-modal-content');
                        if (options.imageUrl) {
                            this.image = modalContent.appendHTML('img', (image) => {
                                image.classList.add('next-admin-msgbox-modal-image');
                                image.src = options.imageUrl;
                            });
                        }
                        this.header = modalContent.appendHTML('div', (header) => {
                            header.classList.add('next-admin-msgbox-modal-content-header');
                            header.innerHTML = this.options.title;
                        });
                        this.body = modalContent.appendHTML('div', (body) => {
                            body.classList.add('next-admin-msgbox-modal-content-body');
                            body.style.overflow = 'auto';
                            if (NextAdmin.UserAgent.isDesktop()) {
                                body.appendPerfectScrollbar();
                            }
                            if (this.options.text) {
                                body.innerHTML = this.options.text;
                            }
                        });
                        this.footer = modalContent.appendHTML('div', (footer) => {
                            footer.classList.add('next-admin-msgbox-modal-footer');
                            if (NextAdmin.UserAgent.isDesktop()) {
                                this._desktopButtonToolbar = footer.appendControl(new UI.Toolbar(), (footerToolbar) => {
                                    footerToolbar.element.style.cssFloat = 'right';
                                });
                            }
                        });
                        if (this.options.buttons) {
                            for (let button of this.options.buttons) {
                                this.appendButton(button);
                            }
                        }
                    });
                });
                MessageBox.onCreated.dispatch(this, this.options);
            }
            appendButton(button) {
                if (NextAdmin.UserAgent.isDesktop()) {
                    this._button.add(this._desktopButtonToolbar.appendControl(button));
                }
                else {
                    this.footer.appendHTML('div', (btnContainer) => {
                        btnContainer.style.marginTop = '5px';
                        this._button.add(btnContainer.appendControl(button));
                    });
                }
            }
            prependButton(button) {
                if (NextAdmin.UserAgent.isDesktop()) {
                    this._button.add(this._desktopButtonToolbar.prependControl(button));
                }
                else {
                    this.footer.appendHTML('div', (btnContainer) => {
                        btnContainer.style.marginTop = '5px';
                        this._button.add(btnContainer.prependControl(button));
                    });
                }
            }
            getButtons() {
                return this._button;
            }
            startSpin() {
                this.modal.startSpin();
            }
            close() {
                this.element.anim('fadeOut', {
                    animationSpeed: NextAdmin.AnimationSpeed.faster,
                    onEndAnimation: () => {
                        this.element.remove();
                        document.body.style.overflow = MessageBox._previousBodyOverflow;
                        MessageBox._previousBodyOverflow = null;
                    }
                });
            }
            open() {
                if (this.element.parentElement != null)
                    return;
                if (MessageBox._previousBodyOverflow == null) {
                    MessageBox._previousBodyOverflow = document.body.style.overflow;
                }
                document.body.style.overflow = 'hidden';
                this.options.parentContainer.appendChild(this.element);
                this.element.anim('fadeIn', { animationSpeed: NextAdmin.AnimationSpeed.faster });
            }
            static createOk(title, message, okAction, parentContainer = document.body) {
                let messageBox = new MessageBox({
                    title: title,
                    text: message,
                    parentContainer: parentContainer,
                    buttons: [
                        new UI.Button({
                            text: 'OK', action: () => {
                                if (okAction != null) {
                                    okAction();
                                }
                                messageBox.close();
                            }
                        })
                    ]
                });
                if (parentContainer != null) {
                    messageBox.open();
                }
                return messageBox;
            }
            static createLoading(title = NextAdmin.Resources.loading, message = NextAdmin.Resources.pleaseWait, cancelAction, parentContainer = document.body) {
                let messageBox = new MessageBox({
                    title: title,
                    text: message,
                    parentContainer: parentContainer,
                    buttons: cancelAction ? [new UI.Button({
                            text: NextAdmin.Resources.cancel, action: () => {
                                cancelAction(messageBox);
                                messageBox.close();
                            }
                        })] : null
                });
                //messageBox.header.style.marginTop = '60px';
                let spinner = NextAdmin.Spinner.createDefault(50);
                //spinner.style.marginTop = '40px';
                spinner.style.marginRight = '20px';
                spinner.style.marginLeft = '20vw';
                spinner.style.cssFloat = 'left';
                messageBox.modal.prepend(spinner);
                if (parentContainer != null) {
                    messageBox.open();
                }
                return messageBox;
            }
            static createYesNo(title, message, yesAction, noAction, parentContainer = document.body) {
                let messageBox = new MessageBox({
                    title: title,
                    text: message,
                    parentContainer: parentContainer,
                    buttons: [
                        new UI.Button({
                            text: NextAdmin.Resources.yes, action: () => {
                                if (yesAction != null) {
                                    yesAction(messageBox);
                                }
                                messageBox.close();
                            }
                        }),
                        new UI.Button({
                            text: NextAdmin.Resources.no, action: () => {
                                if (noAction != null) {
                                    noAction(messageBox);
                                }
                                messageBox.close();
                            }
                        })
                    ]
                });
                if (parentContainer != null) {
                    messageBox.open();
                }
                return messageBox;
            }
            static createYesCancel(title, message, yesAction, cancelAction, parentContainer = document.body) {
                let messageBox = new MessageBox({
                    title: title,
                    text: message,
                    parentContainer: parentContainer,
                    buttons: [
                        new UI.Button({
                            text: NextAdmin.Resources.yes, action: () => {
                                if (yesAction != null) {
                                    yesAction(messageBox);
                                }
                                messageBox.close();
                            }
                        }),
                        new UI.Button({
                            text: NextAdmin.Resources.cancel, action: () => {
                                if (cancelAction != null) {
                                    cancelAction(messageBox);
                                }
                                messageBox.close();
                            }
                        })
                    ]
                });
                if (parentContainer != null) {
                    messageBox.open();
                }
                return messageBox;
            }
        }
        MessageBox.onCreated = new NextAdmin.EventHandler();
        MessageBox.style = `
        .next-admin-msgbox-container { 
            position:fixed;
            left:0px;top:0px;width:100%;
            height:100%;background:rgba(0,0,0,0.1);
            z-index:10000;
        }
        .next-admin-msgbox-modal{
            position:relative;
            min-height:70px;
            width:100%;
            margin:0 auto;
            padding-top:40px;
            padding-bottom:60px;
            background:rgba(255,255,255,1);
            box-shadow:0px 0px 100px rgba(0,0,0,0.4);
            top:50%;
            transform:perspective(1px) translateY(-50%);
        }
        .next-admin-msgbox-modal-content {
            height:100%;
            margin-left:15%;
            width:70%;
            position:relative;

            .next-admin-msgbox-modal-image{
                float:left;
                height:100px;
                margin-right:20px;
                border-radius: 5px;
            }

            .next-admin-msgbox-modal-content-header {
                font-weight:bold;
                font-size:20px;
            }
            .next-admin-msgbox-modal-content-body {
                margin-bottom:20px;
                max-height:50vh;
                overflow:auto;
                position:relative;
            }
        }
        .next-admin-msgbox-modal-footer {
            position:relative;
        }
        `;
        MessageBox._previousBodyOverflow = null;
        UI.MessageBox = MessageBox;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="InputSelect.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class MultiInputSelect extends UI.InputSelect {
            constructor(options) {
                super({
                    resetSearchAtOpen: true,
                    canAddCustomValue: false,
                    lightButtons: true,
                    valueCharSeparator: ',',
                    displayCharSeparator: ',',
                    hideDropdownButton: true,
                    canSearchData: false,
                    ...options
                });
                this._selectedItemValues = [];
                this.dropDownTable.options.rowSelectionMode = UI.RowSelectionMode.multiSelect;
                this.dropDownTable.onRowUnselected.subscribe((sender, row) => {
                    this.unselectItem(row['_value']);
                });
                if (this.options.canAddCustomValue) {
                    this.addLeftAddon(new NextAdmin.UI.Button({
                        text: NextAdmin.Resources.addIcon, style: NextAdmin.UI.ButtonStyle.noBg, action: () => {
                            let addValueModal = new NextAdmin.UI.Modal({
                                title: NextAdmin.Resources.addNewItems,
                                size: UI.ModalSize.smallFitContent
                            });
                            addValueModal.body.appendHTML('div', (container) => {
                                container.style.padding = '5px';
                                let valuesInput = container.appendControl(new NextAdmin.UI.Input());
                                valuesInput.element.style.marginBottom = '10px';
                                container.appendHTML('p', NextAdmin.Resources.addNewItemsText + '"' + this.options.displayCharSeparator + '"');
                                let validateAction = () => {
                                    let newItems = (valuesInput.getValue() + '').split(this.options.displayCharSeparator).where(e => !NextAdmin.String.isNullOrEmpty(e));
                                    this.selectItems(newItems, true);
                                    addValueModal.close();
                                };
                                valuesInput.input.addEventListener('keydown', (e) => {
                                    if (e.keyCode == 13) {
                                        validateAction();
                                    }
                                });
                                addValueModal.rightFooter.appendControl(new NextAdmin.UI.Button({
                                    text: NextAdmin.Resources.addIcon + ' ' + NextAdmin.Resources.add, style: NextAdmin.UI.ButtonStyle.blue, action: () => {
                                        validateAction();
                                    }
                                }), (btnAdd) => {
                                    btnAdd.element.style.cssFloat = 'right';
                                });
                            });
                            addValueModal.open();
                        }
                    }));
                }
                if (this.options.canSearchData && this.options.searchAction) {
                    this.controlContainer.disable();
                    this.addLeftAddon(new NextAdmin.UI.Button({
                        text: NextAdmin.Resources.searchIcon, style: NextAdmin.UI.ButtonStyle.noBg, action: () => {
                            let searchModal = new NextAdmin.UI.Modal({ size: NextAdmin.UI.ModalSize.smallFitContent, title: NextAdmin.Resources.search, canChangeScreenMode: false });
                            searchModal.body.appendHTML('div', (container) => {
                                container.style.height = '400px';
                                container.style.padding = '10px';
                                let grid = container.appendControl(new NextAdmin.UI.DataGrid({
                                    rowHoverable: true,
                                    stretchHeight: true,
                                    displayNoDataMessage: false,
                                    minHeight: '300px',
                                    canAdd: false,
                                    deleteMode: NextAdmin.UI.DataDeleteMode.disabled,
                                    hasActionColumn: false,
                                    rowSelectionMode: NextAdmin.UI.RowSelectionMode.multiSelect_CtrlShift,
                                    columns: [
                                        { propertyName: 'label' }
                                    ]
                                }), (grid) => {
                                    grid.onDoubleClickRow.subscribe((row, ev) => {
                                        validateButton.executeAction();
                                    });
                                    grid.tHead.style.display = 'none';
                                    grid.toolBar.element.style.display = 'none';
                                    grid.topBar.style.border = '0px';
                                    let searchBox = grid.topBar.appendControl(new NextAdmin.UI.Input({
                                        onValueChanged: (sender, args) => {
                                            this.timer.throttle(() => {
                                                this.options.searchAction(args.value, (items) => {
                                                    grid.setDataset(items);
                                                });
                                            }, this.options.throttle);
                                        }
                                    }));
                                    searchBox.element.style.marginBottom = '10px';
                                });
                                this.options.searchAction('', (items) => {
                                    grid.setDataset(items);
                                });
                                let validateButton = searchModal.rightFooter.appendControl(new NextAdmin.UI.Button({
                                    css: { cssFloat: 'right' },
                                    text: NextAdmin.Resources.validate, action: () => {
                                        let selectedItems = grid.getSelectedRows().select(a => a.data);
                                        this.clearAll();
                                        this.addSelectItems(selectedItems);
                                        this.setValue(selectedItems.select(a => a.value));
                                        searchModal.close();
                                    }
                                }));
                            });
                            searchModal.open();
                        }
                    }));
                    this.addLeftAddon(new NextAdmin.UI.Button({
                        text: NextAdmin.Resources.closeIcon,
                        style: NextAdmin.UI.ButtonStyle.noBg,
                        //disabled: true,
                        action: () => {
                            this.clearAll();
                        }
                    }));
                }
            }
            onInputKeyDown(event) {
                if (this.dropDown.style.display == 'none') {
                    this.openDropDown();
                }
                if (event.keyCode == 13) { //enter
                    this.closeDropDown();
                }
                else if (event.keyCode == 27) //escape
                 {
                    this.cancelSelect();
                }
                event.preventDefault();
            }
            selectItem(value, addIfNotExist = false) {
                if (value != null) {
                    if (addIfNotExist) {
                        if (!this.getItemsValues().contains(value)) {
                            this.addItem(value);
                        }
                    }
                    if (!this._selectedItemValues.contains(value)) {
                        let clonedvalues = this._selectedItemValues.clone();
                        clonedvalues.add(value);
                        this.updateValue(clonedvalues);
                    }
                }
            }
            selectItems(values, addIfNotExist = false) {
                if (addIfNotExist) {
                    let itemsValues = this.getItemsValues();
                    for (let value of values) {
                        if (!itemsValues.contains(value)) {
                            this.addItem(value);
                        }
                    }
                }
                let clonedvalues = this._selectedItemValues.clone();
                for (let value of values) {
                    if (!this._selectedItemValues.contains(value)) {
                        clonedvalues.add(value);
                    }
                }
                this.updateValue(clonedvalues);
            }
            unselectItem(value) {
                if (value != null) {
                    value = value + '';
                    if (this._selectedItemValues.contains(value)) {
                        let clonedvalues = this._selectedItemValues.clone();
                        clonedvalues.remove(value);
                        this.updateValue(clonedvalues);
                    }
                }
            }
            updateValue(value) {
                let previousValue = this.getValue();
                this.setValue(value);
                this.onValueChanged.dispatch(this, { previousValue: previousValue, value: value });
            }
            cancelSelect() {
                this.closeDropDown();
            }
            openDropDown() {
                super.openDropDown();
                let selectItems = this.getItems().where(e => this._selectedItemValues.contains(e['_value'] + ''));
                this.dropDownTable.getSelectedRows().forEach(e => this.dropDownTable.unselectRow(e));
                selectItems.forEach(e => this.dropDownTable.selectRow(e));
            }
            setValue(value) {
                if (Array.isArray(value)) {
                    this._selectedItemValues = value.select(e => e + '');
                }
                else {
                    this._selectedItemValues = value != null ? value.split(this.options.valueCharSeparator) : [];
                }
                this._selectedItemValues = this._selectedItemValues.distinct();
                let selectItems = this.getItems().where(e => this._selectedItemValues.contains(e['_value'] + ''));
                let displayValue = selectItems.select(e => e.innerText).join(this.options.displayCharSeparator + ' ');
                this.input.value = displayValue;
            }
            getValue() {
                let items = this._selectedItemValues;
                if (!items?.length && this.options.outputAllItemValuesIfNoSelect) {
                    items = this.getItems().select(a => a['_value']);
                }
                if (this.options.outputArray) {
                    return [...items];
                }
                else {
                    return items.where(a => !NextAdmin.String.isNullOrWhiteSpace(a + '')).join(this.options.valueCharSeparator);
                }
            }
            getSelectItemValues() {
                return [...this._selectedItemValues];
            }
        }
        UI.MultiInputSelect = MultiInputSelect;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class NoUiModal extends NextAdmin.UI.Modal {
            constructor(options) {
                super({
                    size: NextAdmin.UI.ModalSize.large,
                    canMoveAndResize: false,
                    canChangeScreenMode: false,
                    canMinimize: false,
                    backdropColor: 'rgba(0,0,0,0.75)',
                    ...options,
                });
                NextAdmin.Style.append('NextAdmin.UI.NoUiModal', NoUiModal.style);
                this.element.classList.add('next-admin-no-ui-modal-container');
            }
        }
        NoUiModal.style = `

        .next-admin-no-ui-modal-container{

            .next-admin-modal{
                background:unset;
                box-shadow:unset;
                .next-admin-modal-header{
                    color:#fff;
                    font-weight:bold;
                    border:0px;
                    .next-admin-modal-btn-close{
                        font-size:32px
                    }
                }
                .next-admin-modal-footer{
                    color:#fff;
                    font-weight:bold;
                    border:0px;
                }
            }
        }
        `;
        UI.NoUiModal = NoUiModal;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class View extends UI.Control {
            constructor(options) {
                super(options?.element ?? 'div', options);
                this._loadedDependencies = [];
                if (this.options.data) {
                    this.data = this.options.data;
                }
                if (this.options.contentUrl != null) {
                    this.contentUrl = this.options.contentUrl;
                }
            }
            async load(contentUrl, data, dependencies) {
                let preparedDependencies = dependencies ? NextAdmin.DependenciesController.preparDependencies(dependencies) : [];
                await this.loadDependencies(preparedDependencies.where(a => a.type != NextAdmin.DependencyType.script));
                if (contentUrl == null) {
                    contentUrl = this.contentUrl;
                }
                if (data == null) {
                    data = this.data;
                }
                if (contentUrl) {
                    let viewContent = await this.loadContent(contentUrl);
                    await this.parse(viewContent, data);
                    this.contentUrl = contentUrl;
                }
                this.data = data;
                await this.loadDependencies(preparedDependencies.where(a => a.type == NextAdmin.DependencyType.script));
            }
            getData() {
                return this.data;
            }
            async updateData(data) {
                if (this.contentUrl == null) {
                    return;
                }
                let viewContent = await this.loadContent(this.contentUrl);
                if (this.data == null) {
                    this.data = {};
                }
                NextAdmin.Copy.copyTo(data, this.data);
                let scripts = this._loadedDependencies.where(a => a.type == NextAdmin.DependencyType.script);
                this.unloadDependencies(scripts);
                await this.parse(viewContent, this.data);
                await this.loadDependencies(scripts);
            }
            async setData(data) {
                if (this.contentUrl == null) {
                    return;
                }
                let viewContent = await this.loadContent(this.contentUrl);
                let scripts = this._loadedDependencies.where(a => a.type == NextAdmin.DependencyType.script);
                this.unloadDependencies(scripts);
                await this.parse(viewContent, data);
                await this.loadDependencies(scripts);
                this.data = data;
            }
            async loadContent(contentUrl) {
                let viewContent = View.viewsContentDictionary.get(contentUrl);
                if (viewContent != null) {
                    return viewContent;
                }
                let response = await fetch(contentUrl);
                if (response && response.ok) {
                    viewContent = await response.text();
                    View.viewsContentDictionary.add(contentUrl, viewContent);
                    return viewContent;
                }
                else {
                    console.log('Unable to load view content:' + contentUrl);
                }
            }
            async loadDependencies(dependencies) {
                if (!dependencies?.length)
                    return;
                await NextAdmin.DependenciesController.load(dependencies);
                this._loadedDependencies.addRange(dependencies);
            }
            unloadDependencies(dependencies) {
                if (!dependencies?.length)
                    return;
                NextAdmin.DependenciesController.unloadRange(dependencies);
                for (let dependencie of dependencies) {
                    this._loadedDependencies.remove(dependencie);
                }
            }
            async parse(content, data) {
                if (this.element.parentNode == null) {
                    throw new Error('view must be appended to be parsed');
                }
                for (let key of content.extractTags("{{", "}}")) {
                    content = content.replaceAll('{{' + key + '}}', data != null && data[key] ? data[key] : "");
                }
                content = content.replaceTags("${", "}", (value) => {
                    return eval(value);
                });
                let subViewsDictionary = new NextAdmin.Dictionary();
                let parseViewTagFunc = (viewTagContent) => {
                    let viewSrc = viewTagContent.extractTags(":'", "'").firstOrDefault();
                    if (viewSrc) {
                        viewTagContent = viewTagContent.replace(":'" + viewSrc + "'", "");
                    }
                    if (!viewSrc) {
                        viewSrc = viewTagContent.extractTags(':"', '"').firstOrDefault();
                        if (viewSrc) {
                            viewTagContent = viewTagContent.replace(':"' + viewSrc + '"', "");
                        }
                    }
                    if (!viewSrc && viewTagContent.contains(':')) {
                        viewSrc = viewTagContent.split(':').lastOrDefault();
                        if (viewSrc) {
                            viewTagContent = viewTagContent.replace(':' + viewSrc, "");
                        }
                    }
                    let tmpViewHtmlTag = '<div ' + viewTagContent + (viewTagContent.endsWith('>') ? '' : '>') + '</div>';
                    var viewDocument = new DOMParser().parseFromString(tmpViewHtmlTag, "text/xml");
                    let viewAttributes = {};
                    let viewElement = viewDocument.firstElementChild;
                    for (let viewAttribute of viewElement.attributes) {
                        viewAttributes[viewAttribute.name] = viewAttribute.value;
                    }
                    let viewId = viewElement.id;
                    if (NextAdmin.String.isNullOrEmpty(viewId)) {
                        viewId = NextAdmin.Guid.newGuid().toString();
                    }
                    let viewData = NextAdmin.String.isNullOrEmpty(viewElement.innerHTML) ? {} : JSON.parse(viewElement.innerHTML);
                    subViewsDictionary.add(viewId, { src: viewSrc, data: viewData, attributes: viewAttributes });
                    return '<div id="' + viewId + '"></div>';
                };
                content = content.replaceTags('<view', '</view>', (viewTagContent) => {
                    return parseViewTagFunc(viewTagContent);
                });
                content = content.replaceTags('<view', '>', (viewTagContent) => {
                    if (viewTagContent.endsWith('/')) {
                        viewTagContent = viewTagContent.substring(0, viewTagContent.length - 1);
                    }
                    return parseViewTagFunc(viewTagContent);
                });
                let subControlsDictionary = new NextAdmin.Dictionary();
                let parseControlTagFunc = (controlTagContent) => {
                    let controlSrc = controlTagContent.extractTags(":'", "'").firstOrDefault();
                    if (controlSrc) {
                        controlTagContent = controlTagContent.replace(":'" + controlSrc + "'", "");
                    }
                    if (!controlSrc) {
                        controlSrc = controlTagContent.extractTags(':"', '"').firstOrDefault();
                        if (controlSrc) {
                            controlTagContent = controlTagContent.replace(':"' + controlSrc + '"', "");
                        }
                    }
                    if (!controlSrc && controlTagContent.contains(':')) {
                        controlSrc = controlTagContent.split(':').lastOrDefault();
                        if (controlSrc) {
                            controlTagContent = controlTagContent.replace(':' + controlSrc, "");
                        }
                    }
                    let tmpViewHtmlTag = '<div ' + controlTagContent + (controlTagContent.endsWith('>') ? '' : '>') + '</div>';
                    var viewDocument = new DOMParser().parseFromString(tmpViewHtmlTag, "text/xml");
                    let controlAttributes = {};
                    let controlElement = viewDocument.firstElementChild;
                    for (let viewAttribute of controlElement.attributes) {
                        controlAttributes[viewAttribute.name] = viewAttribute.value;
                    }
                    let viewId = controlElement.id;
                    if (NextAdmin.String.isNullOrEmpty(viewId)) {
                        viewId = NextAdmin.Guid.newGuid().toString();
                    }
                    let controlOption = NextAdmin.String.isNullOrEmpty(controlElement.innerHTML) ? {} : JSON.parse(controlElement.innerHTML);
                    subControlsDictionary.add(viewId, { src: controlSrc, options: controlOption, attributes: controlAttributes });
                    return '<span id="' + viewId + '"></span>';
                };
                content = content.replaceTags('<control', '</control>', (controlTagContent) => {
                    return parseControlTagFunc(controlTagContent);
                });
                content = content.replaceTags('<control', '>', (controlTagContent) => {
                    if (controlTagContent.endsWith('/')) {
                        controlTagContent = controlTagContent.substring(0, controlTagContent.length - 1);
                    }
                    return parseControlTagFunc(controlTagContent);
                });
                content = content.replaceTags('<echo:', '>', (echoScript) => {
                    if (echoScript.endsWith('/')) {
                        echoScript = echoScript.substring(0, echoScript.length - 1);
                    }
                    let echoResult = '';
                    eval('echoResult = ' + echoScript);
                    return echoResult;
                });
                this.element.innerHTML = content;
                if (this.element.childElementCount == 1) {
                    let rootViewElement = this.element.firstElementChild;
                    rootViewElement['_control'] = this;
                    for (let attribute of this.element.attributes) {
                        rootViewElement.setAttribute(attribute.name, attribute.value);
                    }
                    this.element.parentElement.replaceChild(rootViewElement, this.element);
                    this.element = rootViewElement;
                }
                this.childrenViews = new NextAdmin.Dictionary();
                for (let subViewKeyValue of subViewsDictionary.getKeysValues()) {
                    let subViewElement = document.getElementById(subViewKeyValue.key);
                    if (subViewElement == null) {
                        throw new Error('unable to find sub view element');
                    }
                    let htmlContentSrc = '';
                    let view;
                    let viewOption = { element: subViewElement, id: subViewKeyValue.key };
                    if (subViewKeyValue.value.src.contains('@')) { //view with view class
                        let viewSrcParts = subViewKeyValue.value.src.split('@');
                        htmlContentSrc = viewSrcParts[1] + '.html';
                        await NextAdmin.TypeScript.load(viewSrcParts[1] + '.ts');
                        eval('view = new ' + viewSrcParts[0] + '(viewOption);');
                    }
                    else {
                        if (subViewKeyValue.value.src.endsWith('.html')) {
                            htmlContentSrc = subViewKeyValue.value.src;
                            view = new View(viewOption);
                        }
                        else {
                            eval('view = new ' + subViewKeyValue.value.src + '(viewOption);');
                        }
                    }
                    for (let attributeName in subViewKeyValue.value.attributes) {
                        view.element.setAttribute(attributeName, subViewKeyValue.value.attributes[attributeName]);
                    }
                    this.childrenViews.add(subViewKeyValue.key, view);
                    await view.load(htmlContentSrc, subViewKeyValue.value.data);
                }
                this.childrenControls = new NextAdmin.Dictionary();
                for (let controlKeyValue of subControlsDictionary.getKeysValues()) {
                    let controlElement = document.getElementById(controlKeyValue.key);
                    if (controlElement == null) {
                        throw new Error('unable to find sub control element');
                    }
                    let controlSrcParts = controlKeyValue.value.src.split('@');
                    if (controlSrcParts.length == 2) {
                        let scriptUrl = controlSrcParts[1];
                        await NextAdmin.TypeScript.load(scriptUrl);
                    }
                    let controlClassName = controlSrcParts[0];
                    let controlOptions = { id: controlKeyValue.key, ...controlKeyValue.value.options };
                    let control;
                    eval('control = new ' + controlClassName + '(controlOptions);');
                    for (let attributeName in controlKeyValue.value.attributes) {
                        control.element.setAttribute(attributeName, controlKeyValue.value.attributes[attributeName]);
                    }
                    controlElement.parentElement.replaceChild(control.element, controlElement);
                    this.childrenControls.add(controlKeyValue.key, control);
                }
            }
        }
        View.viewsContentDictionary = new NextAdmin.Dictionary();
        UI.View = View;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
try {
    HTMLElement.prototype.appendView = async function (p1, p2, p3) {
        let view;
        if (p1 instanceof (NextAdmin.UI.View)) {
            view = p1;
            let configAction = p2;
            this.appendControl(view);
            await view.load();
            if (configAction != null) {
                configAction(view);
            }
        }
        else {
            let src = p1;
            let viewOption = p2;
            let configAction = p3;
            let htmlContentSrc = '';
            if (src.contains('@')) { //view with view class
                let viewSrcParts = src.split('@');
                let viewClassName = viewSrcParts[0];
                htmlContentSrc = viewSrcParts[1] + '.html';
                let classExist = false;
                eval('classExist = typeof ' + viewClassName + ' != "undefined"');
                if (!classExist) {
                    await NextAdmin.TypeScript.load(viewSrcParts[1] + '.ts');
                }
                eval('view = new ' + viewClassName + '(viewOption);');
            }
            else {
                if (src.endsWith('.html')) {
                    htmlContentSrc = src;
                    view = new NextAdmin.UI.View(viewOption);
                }
                else {
                    eval('view = new ' + src + '(viewOption);');
                }
            }
            this.appendControl(view);
            await view.load(htmlContentSrc, viewOption?.data);
            if (configAction != null) {
                configAction(view);
            }
        }
        return view;
    };
}
catch {
}
/// <reference path="View.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Page extends UI.View {
            constructor(options) {
                super({
                    disposeOnNavigateFrom: true,
                    container: document.body,
                    navigationController: NextAdmin.Navigation,
                    ...options
                });
                this.onNavigateFrom = new NextAdmin.EventHandler();
                this.onEndNavigateFrom = new NextAdmin.EventHandlerBase();
                this.onNavigateTo = new NextAdmin.EventHandler();
                if (this.options.name == null) {
                    this.options.name = this.constructor.name;
                }
                this.navigationController = this.options.navigationController;
                Page.onCreated.dispatch(this, this.options);
            }
            async navigateTo(args) {
                this.options.container.appendChild(this.element);
                this.parameters = args?.parameters;
                window.scrollTo(0, 0);
                await this.load(args.contentUrl, args.parameters, args.dependencies);
                window.scrollTo(0, 0);
                this.onNavigateTo.dispatch(this, args);
            }
            async navigateFrom(args) {
                this.onNavigateFrom.dispatch(this, args);
            }
            endNavigateFrom() {
                this.unloadDependencies(this._loadedDependencies);
                this.element.remove();
                if (this.options.disposeOnNavigateFrom) {
                    this.dispose();
                }
                this.onEndNavigateFrom.dispatch();
            }
            dispose() {
                this.element.innerHTML = '';
            }
            isActivePage() {
                return this.navigationController.getCurrentPage() == this;
            }
            bindEvent(eventHandler, eventAction) {
                if (this.isActivePage()) {
                    eventHandler.subscribe(eventAction);
                }
                this.onNavigateTo.subscribe(() => {
                    if (!eventHandler.isSubscribed(eventAction)) {
                        eventHandler.subscribe(eventAction);
                    }
                });
                this.onEndNavigateFrom.subscribe(() => {
                    eventHandler.unsubscribe(eventAction);
                });
            }
        }
        Page.onCreated = new NextAdmin.EventHandler();
        UI.Page = Page;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Popover extends UI.Control {
            constructor(options) {
                super('div', options);
                this.onClose = new NextAdmin.EventHandler();
                this._pointerEnter = null;
                this._pointerLeave = null;
                this._isOpen = false;
                if (this.options.removeOnClose == null) {
                    this.options.removeOnClose = true;
                }
                if (this.options.popOnHover === undefined) {
                    this.options.popOnHover = true;
                }
                if (this.options.parentElement == null) {
                    this.options.parentElement = document.body;
                }
                this.element.style.pointerEvents = 'none';
                NextAdmin.Style.append('Popover', Popover.style);
                this.element.classList.add('next-admin-popover');
                this.element.style.maxWidth = this.options.maxWidth != null ? this.options.maxWidth : '250px;';
                this.element.style.minHeight = this.options.minHeight != null ? this.options.minHeight : '25px;';
                if (this.options.innerHTML != null) {
                    this.element.innerHTML = this.options.innerHTML;
                }
                if (this.options.popOnHover && this.options.popElement != null) {
                    this.startPopOnHover();
                }
                Popover.onCreated.dispatch(this, this.options);
            }
            startPopOnHover() {
                if (this._pointerEnter == null) {
                    this.options.popElement.addEventListener('pointerenter', this._pointerEnter = () => {
                        this.open();
                    });
                    this.options.popElement.addEventListener('pointerleave', this._pointerLeave = () => {
                        this.close();
                    });
                }
            }
            stopPopOnHover() {
                if (this._pointerEnter != null) {
                    this.options.popElement.removeEventListener('pointerenter', this._pointerEnter);
                }
                this._pointerEnter = null;
                if (this._pointerLeave != null) {
                    this.options.popElement.removeEventListener('pointerleave', this._pointerLeave);
                }
                this._pointerLeave = null;
            }
            open(options = {}) {
                options = { popElement: this.options.popElement, offsetX: 0, offsetY: 0, ...options };
                if (this._isOpen) {
                    return;
                }
                if (this.element.parentElement == null) {
                    this.options.parentElement.appendChild(this.element);
                }
                this.element.style.display = '';
                if (options.popElement != null) {
                    let popElementBounding = options.popElement.getBoundingClientRect();
                    options.offsetX += popElementBounding.right;
                    options.offsetY += popElementBounding.top + (popElementBounding.height / 2);
                }
                this.element.style.left = options.offsetX + 10 + 'px';
                this.element.style.top = options.offsetY - (this.element.offsetHeight / 2) + 'px';
                if (this.options.openAnimation != null) {
                    this.element.anim(this.options.openAnimation, { animationSpeed: NextAdmin.AnimationSpeed.faster });
                }
                this._isOpen = true;
            }
            setPosition(x, y) {
                this.element.style.left = x + 10 + 'px';
                this.element.style.top = y - (this.element.offsetHeight / 2) + 'px';
            }
            close() {
                if (!this._isOpen)
                    return;
                let closeArgs = {};
                this.onClose.dispatch(this, closeArgs);
                if (closeArgs.cancel) {
                    return;
                }
                this._isOpen = false;
                let endCloseFunc = () => {
                    if (this.options.removeOnClose) {
                        this.element.remove();
                    }
                    else {
                        this.element.style.display = 'none';
                    }
                };
                if (this.options.closeAnimation != null) {
                    this.element.anim(this.options.closeAnimation, {
                        animationSpeed: NextAdmin.AnimationSpeed.faster,
                        onEndAnimation: () => {
                            endCloseFunc();
                        }
                    });
                }
                else {
                    endCloseFunc();
                }
            }
        }
        Popover.style = '.next-admin-popover { padding:5px;border-radius:5px;background:#fff;position:fixed;z-index:9999;border:1px solid #ccc;font-size:12px }'
            + '.next-admin-popover::before {content:" ";position:absolute;top: 50%; right: 100%;margin-top:-11px;border-width:11px;border-style:solid;border-color: transparent #ccc transparent transparent;}'
            + '.next-admin-popover::after {content:" ";position:absolute;top: 50%; right: 100%;margin-top:-10px;border-width:10px;border-style:solid;border-color: transparent #fff transparent transparent;}';
        Popover.onCreated = new NextAdmin.EventHandler();
        UI.Popover = Popover;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
try {
    HTMLElement.prototype.setPopover = function (innerHTML, parentElement) {
        this.removePopover();
        this['_popover'] = new NextAdmin.UI.Popover({ innerHTML: innerHTML, popElement: this, parentElement: parentElement });
        return this['_popover'];
    };
    HTMLElement.prototype.removePopover = function () {
        let popover = this['_popover'];
        if (popover == null) {
            return;
        }
        popover.close();
        popover.stopPopOnHover();
    };
}
catch {
}
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Progress extends UI.LabelFormControl {
            constructor(options) {
                super({
                    style: UI.Input.defaultStyle,
                    max: 100,
                    progressLabelValueFunc: () => {
                        return (this.getValue() + ' / ' + this.options.max).toString();
                    },
                    ...options
                });
                NextAdmin.Style.append("Progress", Progress.style);
                this.controlContainer.style.display = 'flex';
                this.controlContainer.style.alignItems = 'center';
                this.controlContainer.style.position = 'relative';
                this.progress = this.controlContainer.appendHTML('progress');
                this.progress.classList.add('next-admin-progress');
                if (this.options.min) {
                    this.progress.setAttribute('min', this.options.min.toString());
                }
                if (this.options.max) {
                    this.progress.setAttribute('max', this.options.max.toString());
                }
                this.progressLabelContainer = this.controlContainer.appendHTML('div', (progressLabelContainer) => {
                    progressLabelContainer.style.position = 'absolute';
                    progressLabelContainer.style.left = '0px';
                    progressLabelContainer.style.top = '0px';
                    progressLabelContainer.style.width = '100%';
                    progressLabelContainer.style.height = '100%';
                    progressLabelContainer.style.verticalAlign = 'middle';
                    progressLabelContainer.style.textAlign = 'center';
                    progressLabelContainer.style.color = '#fff';
                    progressLabelContainer.style.fontWeight = 'bolder';
                    progressLabelContainer.style.fontSize = '12px';
                    progressLabelContainer.style.paddingTop = '4px';
                    progressLabelContainer.style.textShadow = '0px 0px 2px rgba(0,0,0,1)';
                });
            }
            setLabel(text) {
                this.label.innerHTML = text;
                if (text) {
                    this.label.style.display = '';
                    this.labelContainer.style.display = '';
                }
                else {
                    this.labelContainer.style.display = 'none';
                    this.label.style.display = 'none';
                }
                return this;
            }
            setValue(value, fireChange) {
                this.progress.value = value ?? 0;
                if (fireChange) {
                    this.onValueChanged.dispatch(this, { value: value, origin: UI.ChangeOrigin.code });
                }
                this.updateValueLabel();
            }
            updateValueLabel() {
                this.progressLabelContainer.innerHTML = this.options.progressLabelValueFunc(this);
            }
            getValue() {
                return Number(this.progress.value);
            }
        }
        Progress.style = `

            .next-admin-progress { 
                height:25px;
                width:100%;
                top:50%;
            }

            `;
        Progress.onCreated = new NextAdmin.EventHandler();
        UI.Progress = Progress;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Input.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Range extends UI.Input {
            constructor(options) {
                super({
                    inputType: NextAdmin.UI.InputType.range,
                    hasValueLabel: true,
                    decimalCount: 2,
                    unit: '%',
                    ...options
                });
                if (this.options.step) {
                    this.input.step = this.options.step.toString();
                }
                if (this.options.maxValue) {
                    this.input.max = this.options.maxValue.toString();
                }
                if (this.options.minValue !== undefined) {
                    this.input.min = this.options.minValue.toString();
                }
                this.input.style.boxShadow = 'unset';
                if (this.options.hasValueLabel) {
                    this.appendValueLabel();
                }
            }
            getValue() {
                let value = super.getValue() ?? 0;
                if (this.options.maxValue && value > this.options.maxValue) {
                    return this.options.maxValue;
                }
                if (this.options.minValue !== undefined && value < this.options.minValue) {
                    return this.options.minValue;
                }
                return value;
            }
            setValue(value, fireChange) {
                super.setValue(value, fireChange);
                if (this._valueLabel) {
                    this.updateValueLabel();
                }
            }
            appendValueLabel() {
                this._valueLabel = this.addRightAddon(document.createElement('div'));
                this._valueLabel.style.fontSize = '12px';
                this._valueLabel.style.marginLeft = '10px';
                this._valueLabel.style.color = '#777';
                this._valueLabel.style.width = '60px';
                this.updateValueLabel();
            }
            updateValueLabel() {
                this._valueLabel.innerHTML = this.getValue().toFixed(this.options.decimalCount ?? 0) + (this.options.unit ? ' ' + this.options.unit : '');
            }
        }
        UI.Range = Range;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class RecoverPasswordModal extends NextAdmin.UI.Modal {
            constructor(options) {
                super({
                    size: NextAdmin.UI.ModalSize.smallFitContent,
                    backdropColor: 'rgba(0,0,0,0.2)',
                    title: NextAdmin.Resources.lockIcon + ' ' + NextAdmin.Resources.recoverPassword,
                    ...options
                });
                this.container = this.body.appendHTML('div', (container) => {
                    container.style.padding = '40px';
                    this.loginInput = container.appendControl(new NextAdmin.UI.Input({
                        labelPosition: NextAdmin.UI.FormControlLabelPosition.top,
                        size: NextAdmin.UI.InputSize.large,
                        placeHolder: 'E-mail',
                    }), (emailInput) => {
                        emailInput.setValue(this.options.email);
                        emailInput.element.style.marginBottom = '20px';
                    });
                });
                this.sendEmailButton = this.rightFooter.appendControl(new NextAdmin.UI.Button({
                    css: { cssFloat: 'right' },
                    style: NextAdmin.UI.ButtonStyle.lightBlue,
                    text: NextAdmin.Resources.emailIcon + ' ' + NextAdmin.Resources.recoverMyPassword,
                    action: (button) => {
                        this.sendPasswordRecoveryEmail();
                    }
                }));
                this.sendEmailButton.changeEnableStateOnControlsRequiredValueChanged(() => !NextAdmin.String.isNullOrEmpty(this.loginInput.getValue()), this.loginInput);
            }
            async sendPasswordRecoveryEmail() {
                this.sendEmailButton.startSpin();
                let response = await this.options.userClient.recoverPassword(this.loginInput.getValue());
                this.sendEmailButton.stopSpin();
                if (response?.code == NextAdmin.Models.ApiResponseCode.Success) {
                    NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.emailSent, NextAdmin.Resources.recoverPasswordSuccess);
                    this.close();
                }
                else if (response?.code == 'EMAIL_ERROR') {
                    NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.error, NextAdmin.Resources.recoverPasswordDefaultError);
                    this.close();
                }
                else {
                    NextAdmin.UI.MessageBox.createOk(NextAdmin.Resources.error, NextAdmin.Resources.recoverPasswordInvalidEmail);
                }
            }
        }
        UI.RecoverPasswordModal = RecoverPasswordModal;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class ResisingContainer extends UI.Control {
            //exemple : (16,9), will produce a div that allway stretch with conbtainer and respect 16/9 ratio
            constructor() {
                super('div');
                this.onSizeChanged = new NextAdmin.EventHandler();
                this.element.style.width = '100%';
                this.element.style.height = '100%';
                this.element.style.position = 'relative';
                let iframe = document.createElement('iframe');
                this.element.appendChild(iframe);
                this.container = document.createElement('div');
                this.container.style.position = 'absolute';
                this.container.style.left = '0px';
                this.container.style.top = '0px';
                this.container.style.width = '100%';
                this.container.style.height = '100%';
                this.element.appendChild(this.container);
                iframe.style.position = 'relative';
                iframe.frameBorder = '0';
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                let onsizeChanged = () => {
                    let bounding = iframe.getBoundingClientRect();
                    this.onSizeChanged.dispatch(this.container, bounding);
                };
                iframe.addEventListener('load', () => {
                    onsizeChanged();
                    iframe.contentWindow.addEventListener('resize', (ev) => {
                        onsizeChanged();
                    });
                });
                ResisingContainer.onCreated.dispatch(this, this.options);
            }
        }
        ResisingContainer.onCreated = new NextAdmin.EventHandler();
        UI.ResisingContainer = ResisingContainer;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="LabelFormControl.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class RichTextEditor extends UI.LabelFormControl {
            constructor(options) {
                super({
                    displayToolbar: true,
                    style: RichTextEditor.defaultStyle,
                    ...options
                });
                this.suspendChange = false;
                NextAdmin.Style.append("NextAdmin.UI.RichTextEditor.quillStyle", RichTextEditor.quillCSS);
                NextAdmin.Script.append("NextAdmin.UI.RichTextEditor.quillScript", atob(RichTextEditor.quillB64JS));
                NextAdmin.Style.append('RichTextEditor', RichTextEditor.style);
                if (this.options.inlineGrid) {
                    this.options.style = NextAdmin.UI.RichTextEditorStyle.noBackground;
                    this.options.displayToolbar = false;
                    this.element.classList.add('next-admin-rich-text-editor-inline-grid');
                }
                this.element.classList.add('next-admin-rich-text-editor');
                this.controlContainer.style.verticalAlign = 'top';
                this.controlContainer.style.height = '100%';
                this.editorContainer = this.controlContainer.appendHTML('div', editorContainer => {
                    editorContainer.classList.add('next-admin-editor-container');
                });
                this.quillContainer = this.editorContainer.appendHTML('div');
                this.quill = new Quill(this.quillContainer, {
                    modules: {
                        toolbar: this.options.displayToolbar ? [
                            ['bold', 'italic', 'underline', 'strike'],
                            ['link', 'image'],
                            ['blockquote', 'code-block'],
                            [{ 'header': 1 }, { 'header': 2 }],
                            [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                            [{ 'script': 'sub' }, { 'script': 'super' }],
                            [{ 'indent': '-1' }, { 'indent': '+1' }],
                            [{ 'direction': 'rtl' }],
                            [{ 'size': ['small', false, 'large', 'huge'] }],
                            [{ 'color': [] }, { 'background': [] }],
                            [{ 'font': [] }],
                            [{ 'align': [] }],
                            ['clean'] // remove formatting button
                        ] : null
                    },
                    placeholder: this.options.placeHolder,
                    theme: 'snow'
                });
                this.quill.on('text-change', () => {
                    if (this.suspendChange) {
                        return;
                    }
                    this.onValueChanged.dispatch(this, { value: null });
                });
                this.setStyle(this.options.style);
                RichTextEditor.onCreated.dispatch(this, this.options);
            }
            setStyle(style) {
                switch (style) {
                    default:
                    case RichTextEditorStyle.default:
                        this.element.classList.add('next-admin-rich-text-editor-default');
                        break;
                    case RichTextEditorStyle.modern:
                        this.element.classList.add('next-admin-rich-text-editor-modern');
                        break;
                    case RichTextEditorStyle.noBackground:
                        this.element.classList.add('next-admin-rich-text-editor-no-background');
                        break;
                }
            }
            getLabel() {
                return this.label.innerText;
            }
            getToolbar() {
                return this.element.querySelector('.ql-toolbar');
            }
            addToolbarButton(buttonOption, configAction) {
                let button;
                this.getToolbar().appendHTML('span', (btnContainer) => {
                    btnContainer.classList.add('ql-formats');
                    button = btnContainer.appendControl(new UI.Button({ style: UI.ButtonStyle.noBg, ...buttonOption }));
                    if (configAction != null) {
                        configAction(button);
                    }
                });
                return button;
            }
            addToolbarDropDownButton(buttonOption, configAction) {
                let button;
                this.getToolbar().appendHTML('span', (btnContainer) => {
                    btnContainer.classList.add('ql-formats');
                    button = btnContainer.appendControl(new UI.DropDownButton({ style: UI.ButtonStyle.noBg, ...buttonOption }));
                    if (configAction != null) {
                        configAction(button);
                    }
                });
                return button;
            }
            setValue(value, fireChange) {
                this._value = value;
                setTimeout(() => {
                    this._value = null;
                    if (!fireChange) {
                        this.suspendChange = true;
                    }
                    this.quill.pasteHTML((value ?? '').replace(new RegExp('<p><br></p>', 'g'), '<br/>').replace(new RegExp('<p>', 'g'), '<p><br/>').replaceAll('<p><br/>', '<p>'));
                    this.suspendChange = false;
                }, 0);
            }
            getValue() {
                return this._value ?? this.quill.root.innerHTML.replace(new RegExp('<p><br/>', 'g'), '<p>');
            }
        }
        RichTextEditor.quillB64JS = 'IWZ1bmN0aW9uKHQsZSl7Im9iamVjdCI9PXR5cGVvZiBleHBvcnRzJiYib2JqZWN0Ij09dHlwZW9mIG1vZHVsZT9tb2R1bGUuZXhwb3J0cz1lKCk6ImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoW10sZSk6Im9iamVjdCI9PXR5cGVvZiBleHBvcnRzP2V4cG9ydHMuUXVpbGw9ZSgpOnQuUXVpbGw9ZSgpfSgidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGY/c2VsZjp0aGlzLGZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUocil7aWYobltyXSlyZXR1cm4gbltyXS5leHBvcnRzO3ZhciBvPW5bcl09e2k6cixsOiExLGV4cG9ydHM6e319O3JldHVybiB0W3JdLmNhbGwoby5leHBvcnRzLG8sby5leHBvcnRzLGUpLG8ubD0hMCxvLmV4cG9ydHN9dmFyIG49e307cmV0dXJuIGUubT10LGUuYz1uLGUuZD1mdW5jdGlvbih0LG4scil7ZS5vKHQsbil8fE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LG4se2NvbmZpZ3VyYWJsZTohMSxlbnVtZXJhYmxlOiEwLGdldDpyfSl9LGUubj1mdW5jdGlvbih0KXt2YXIgbj10JiZ0Ll9fZXNNb2R1bGU/ZnVuY3Rpb24oKXtyZXR1cm4gdC5kZWZhdWx0fTpmdW5jdGlvbigpe3JldHVybiB0fTtyZXR1cm4gZS5kKG4sImEiLG4pLG59LGUubz1mdW5jdGlvbih0LGUpe3JldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCxlKX0sZS5wPSIiLGUoZS5zPTQ1KX0oW2Z1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciByPW4oMTcpLG89bigxOCksaT1uKDE5KSxsPW4oNDgpLGE9big0OSkscz1uKDUwKSx1PW4oNTEpLGM9big1MiksZj1uKDExKSxoPW4oMjkpLHA9bigzMCksZD1uKDI4KSx5PW4oMSksdj17U2NvcGU6eS5TY29wZSxjcmVhdGU6eS5jcmVhdGUsZmluZDp5LmZpbmQscXVlcnk6eS5xdWVyeSxyZWdpc3Rlcjp5LnJlZ2lzdGVyLENvbnRhaW5lcjpyLmRlZmF1bHQsRm9ybWF0Om8uZGVmYXVsdCxMZWFmOmkuZGVmYXVsdCxFbWJlZDp1LmRlZmF1bHQsU2Nyb2xsOmwuZGVmYXVsdCxCbG9jazpzLmRlZmF1bHQsSW5saW5lOmEuZGVmYXVsdCxUZXh0OmMuZGVmYXVsdCxBdHRyaWJ1dG9yOntBdHRyaWJ1dGU6Zi5kZWZhdWx0LENsYXNzOmguZGVmYXVsdCxTdHlsZTpwLmRlZmF1bHQsU3RvcmU6ZC5kZWZhdWx0fX07ZS5kZWZhdWx0PXZ9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0LGUpe3ZhciBuPWkodCk7aWYobnVsbD09bil0aHJvdyBuZXcgcygiVW5hYmxlIHRvIGNyZWF0ZSAiK3QrIiBibG90Iik7dmFyIHI9bjtyZXR1cm4gbmV3IHIodCBpbnN0YW5jZW9mIE5vZGV8fHQubm9kZVR5cGU9PT1Ob2RlLlRFWFRfTk9ERT90OnIuY3JlYXRlKGUpLGUpfWZ1bmN0aW9uIG8odCxuKXtyZXR1cm4gdm9pZCAwPT09biYmKG49ITEpLG51bGw9PXQ/bnVsbDpudWxsIT10W2UuREFUQV9LRVldP3RbZS5EQVRBX0tFWV0uYmxvdDpuP28odC5wYXJlbnROb2RlLG4pOm51bGx9ZnVuY3Rpb24gaSh0LGUpe3ZvaWQgMD09PWUmJihlPXAuQU5ZKTt2YXIgbjtpZigic3RyaW5nIj09dHlwZW9mIHQpbj1oW3RdfHx1W3RdO2Vsc2UgaWYodCBpbnN0YW5jZW9mIFRleHR8fHQubm9kZVR5cGU9PT1Ob2RlLlRFWFRfTk9ERSluPWgudGV4dDtlbHNlIGlmKCJudW1iZXIiPT10eXBlb2YgdCl0JnAuTEVWRUwmcC5CTE9DSz9uPWguYmxvY2s6dCZwLkxFVkVMJnAuSU5MSU5FJiYobj1oLmlubGluZSk7ZWxzZSBpZih0IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpe3ZhciByPSh0LmdldEF0dHJpYnV0ZSgiY2xhc3MiKXx8IiIpLnNwbGl0KC9ccysvKTtmb3IodmFyIG8gaW4gcilpZihuPWNbcltvXV0pYnJlYWs7bj1ufHxmW3QudGFnTmFtZV19cmV0dXJuIG51bGw9PW4/bnVsbDplJnAuTEVWRUwmbi5zY29wZSYmZSZwLlRZUEUmbi5zY29wZT9uOm51bGx9ZnVuY3Rpb24gbCgpe2Zvcih2YXIgdD1bXSxlPTA7ZTxhcmd1bWVudHMubGVuZ3RoO2UrKyl0W2VdPWFyZ3VtZW50c1tlXTtpZih0Lmxlbmd0aD4xKXJldHVybiB0Lm1hcChmdW5jdGlvbih0KXtyZXR1cm4gbCh0KX0pO3ZhciBuPXRbMF07aWYoInN0cmluZyIhPXR5cGVvZiBuLmJsb3ROYW1lJiYic3RyaW5nIiE9dHlwZW9mIG4uYXR0ck5hbWUpdGhyb3cgbmV3IHMoIkludmFsaWQgZGVmaW5pdGlvbiIpO2lmKCJhYnN0cmFjdCI9PT1uLmJsb3ROYW1lKXRocm93IG5ldyBzKCJDYW5ub3QgcmVnaXN0ZXIgYWJzdHJhY3QgY2xhc3MiKTtpZihoW24uYmxvdE5hbWV8fG4uYXR0ck5hbWVdPW4sInN0cmluZyI9PXR5cGVvZiBuLmtleU5hbWUpdVtuLmtleU5hbWVdPW47ZWxzZSBpZihudWxsIT1uLmNsYXNzTmFtZSYmKGNbbi5jbGFzc05hbWVdPW4pLG51bGwhPW4udGFnTmFtZSl7QXJyYXkuaXNBcnJheShuLnRhZ05hbWUpP24udGFnTmFtZT1uLnRhZ05hbWUubWFwKGZ1bmN0aW9uKHQpe3JldHVybiB0LnRvVXBwZXJDYXNlKCl9KTpuLnRhZ05hbWU9bi50YWdOYW1lLnRvVXBwZXJDYXNlKCk7dmFyIHI9QXJyYXkuaXNBcnJheShuLnRhZ05hbWUpP24udGFnTmFtZTpbbi50YWdOYW1lXTtyLmZvckVhY2goZnVuY3Rpb24odCl7bnVsbCE9Zlt0XSYmbnVsbCE9bi5jbGFzc05hbWV8fChmW3RdPW4pfSl9cmV0dXJuIG59dmFyIGE9dGhpcyYmdGhpcy5fX2V4dGVuZHN8fGZ1bmN0aW9uKCl7dmFyIHQ9T2JqZWN0LnNldFByb3RvdHlwZU9mfHx7X19wcm90b19fOltdfWluc3RhbmNlb2YgQXJyYXkmJmZ1bmN0aW9uKHQsZSl7dC5fX3Byb3RvX189ZX18fGZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBuIGluIGUpZS5oYXNPd25Qcm9wZXJ0eShuKSYmKHRbbl09ZVtuXSl9O3JldHVybiBmdW5jdGlvbihlLG4pe2Z1bmN0aW9uIHIoKXt0aGlzLmNvbnN0cnVjdG9yPWV9dChlLG4pLGUucHJvdG90eXBlPW51bGw9PT1uP09iamVjdC5jcmVhdGUobik6KHIucHJvdG90eXBlPW4ucHJvdG90eXBlLG5ldyByKX19KCk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBzPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoZSl7dmFyIG49dGhpcztyZXR1cm4gZT0iW1BhcmNobWVudF0gIitlLG49dC5jYWxsKHRoaXMsZSl8fHRoaXMsbi5tZXNzYWdlPWUsbi5uYW1lPW4uY29uc3RydWN0b3IubmFtZSxufXJldHVybiBhKGUsdCksZX0oRXJyb3IpO2UuUGFyY2htZW50RXJyb3I9czt2YXIgdT17fSxjPXt9LGY9e30saD17fTtlLkRBVEFfS0VZPSJfX2Jsb3QiO3ZhciBwOyFmdW5jdGlvbih0KXt0W3QuVFlQRT0zXT0iVFlQRSIsdFt0LkxFVkVMPTEyXT0iTEVWRUwiLHRbdC5BVFRSSUJVVEU9MTNdPSJBVFRSSUJVVEUiLHRbdC5CTE9UPTE0XT0iQkxPVCIsdFt0LklOTElORT03XT0iSU5MSU5FIix0W3QuQkxPQ0s9MTFdPSJCTE9DSyIsdFt0LkJMT0NLX0JMT1Q9MTBdPSJCTE9DS19CTE9UIix0W3QuSU5MSU5FX0JMT1Q9Nl09IklOTElORV9CTE9UIix0W3QuQkxPQ0tfQVRUUklCVVRFPTldPSJCTE9DS19BVFRSSUJVVEUiLHRbdC5JTkxJTkVfQVRUUklCVVRFPTVdPSJJTkxJTkVfQVRUUklCVVRFIix0W3QuQU5ZPTE1XT0iQU5ZIn0ocD1lLlNjb3BlfHwoZS5TY29wZT17fSkpLGUuY3JlYXRlPXIsZS5maW5kPW8sZS5xdWVyeT1pLGUucmVnaXN0ZXI9bH0sZnVuY3Rpb24odCxlKXsidXNlIHN0cmljdCI7dmFyIG49T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxyPU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsbz1mdW5jdGlvbih0KXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgQXJyYXkuaXNBcnJheT9BcnJheS5pc0FycmF5KHQpOiJbb2JqZWN0IEFycmF5XSI9PT1yLmNhbGwodCl9LGk9ZnVuY3Rpb24odCl7aWYoIXR8fCJbb2JqZWN0IE9iamVjdF0iIT09ci5jYWxsKHQpKXJldHVybiExO3ZhciBlPW4uY2FsbCh0LCJjb25zdHJ1Y3RvciIpLG89dC5jb25zdHJ1Y3RvciYmdC5jb25zdHJ1Y3Rvci5wcm90b3R5cGUmJm4uY2FsbCh0LmNvbnN0cnVjdG9yLnByb3RvdHlwZSwiaXNQcm90b3R5cGVPZiIpO2lmKHQuY29uc3RydWN0b3ImJiFlJiYhbylyZXR1cm4hMTt2YXIgaTtmb3IoaSBpbiB0KTtyZXR1cm4gdm9pZCAwPT09aXx8bi5jYWxsKHQsaSl9O3QuZXhwb3J0cz1mdW5jdGlvbiB0KCl7dmFyIGUsbixyLGwsYSxzLHU9YXJndW1lbnRzWzBdLGM9MSxmPWFyZ3VtZW50cy5sZW5ndGgsaD0hMTtmb3IoImJvb2xlYW4iPT10eXBlb2YgdSYmKGg9dSx1PWFyZ3VtZW50c1sxXXx8e30sYz0yKSwobnVsbD09dXx8Im9iamVjdCIhPXR5cGVvZiB1JiYiZnVuY3Rpb24iIT10eXBlb2YgdSkmJih1PXt9KTtjPGY7KytjKWlmKG51bGwhPShlPWFyZ3VtZW50c1tjXSkpZm9yKG4gaW4gZSlyPXVbbl0sbD1lW25dLHUhPT1sJiYoaCYmbCYmKGkobCl8fChhPW8obCkpKT8oYT8oYT0hMSxzPXImJm8ocik/cjpbXSk6cz1yJiZpKHIpP3I6e30sdVtuXT10KGgscyxsKSk6dm9pZCAwIT09bCYmKHVbbl09bCkpO3JldHVybiB1fX0sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiByKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX1mdW5jdGlvbiBvKHQsZSl7aWYoISh0IGluc3RhbmNlb2YgZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIil9ZnVuY3Rpb24gaSh0LGUpe2lmKCF0KXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7cmV0dXJuIWV8fCJvYmplY3QiIT10eXBlb2YgZSYmImZ1bmN0aW9uIiE9dHlwZW9mIGU/dDplfWZ1bmN0aW9uIGwodCxlKXtpZigiZnVuY3Rpb24iIT10eXBlb2YgZSYmbnVsbCE9PWUpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiK3R5cGVvZiBlKTt0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGUmJmUucHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6dCxlbnVtZXJhYmxlOiExLHdyaXRhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH19KSxlJiYoT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0LGUpOnQuX19wcm90b19fPWUpfWZ1bmN0aW9uIGEodCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOnt9O3JldHVybiBudWxsPT10P2U6KCJmdW5jdGlvbiI9PXR5cGVvZiB0LmZvcm1hdHMmJihlPSgwLGYuZGVmYXVsdCkoZSx0LmZvcm1hdHMoKSkpLG51bGw9PXQucGFyZW50fHwic2Nyb2xsIj09dC5wYXJlbnQuYmxvdE5hbWV8fHQucGFyZW50LnN0YXRpY3Muc2NvcGUhPT10LnN0YXRpY3Muc2NvcGU/ZTphKHQucGFyZW50LGUpKX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksZS5kZWZhdWx0PWUuQmxvY2tFbWJlZD1lLmJ1YmJsZUZvcm1hdHM9dm9pZCAwO3ZhciBzPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lW25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsci5rZXkscil9fXJldHVybiBmdW5jdGlvbihlLG4scil7cmV0dXJuIG4mJnQoZS5wcm90b3R5cGUsbiksciYmdChlLHIpLGV9fSgpLHU9ZnVuY3Rpb24gdChlLG4scil7bnVsbD09PWUmJihlPUZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIG89T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLG4pO2lmKHZvaWQgMD09PW8pe3ZhciBpPU9iamVjdC5nZXRQcm90b3R5cGVPZihlKTtyZXR1cm4gbnVsbD09PWk/dm9pZCAwOnQoaSxuLHIpfWlmKCJ2YWx1ZSJpbiBvKXJldHVybiBvLnZhbHVlO3ZhciBsPW8uZ2V0O2lmKHZvaWQgMCE9PWwpcmV0dXJuIGwuY2FsbChyKX0sYz1uKDIpLGY9cihjKSxoPW4oNCkscD1yKGgpLGQ9bigwKSx5PXIoZCksdj1uKDE0KSxiPXIodiksZz1uKDUpLG09cihnKSxfPW4oOCksTz1yKF8pLHc9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSgpe3JldHVybiBvKHRoaXMsZSksaSh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5hcHBseSh0aGlzLGFyZ3VtZW50cykpfXJldHVybiBsKGUsdCkscyhlLFt7a2V5OiJhdHRhY2giLHZhbHVlOmZ1bmN0aW9uKCl7dShlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksImF0dGFjaCIsdGhpcykuY2FsbCh0aGlzKSx0aGlzLmF0dHJpYnV0ZXM9bmV3IHkuZGVmYXVsdC5BdHRyaWJ1dG9yLlN0b3JlKHRoaXMuZG9tTm9kZSl9fSx7a2V5OiJkZWx0YSIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4obmV3IHAuZGVmYXVsdCkuaW5zZXJ0KHRoaXMudmFsdWUoKSwoMCxmLmRlZmF1bHQpKHRoaXMuZm9ybWF0cygpLHRoaXMuYXR0cmlidXRlcy52YWx1ZXMoKSkpfX0se2tleToiZm9ybWF0Iix2YWx1ZTpmdW5jdGlvbih0LGUpe3ZhciBuPXkuZGVmYXVsdC5xdWVyeSh0LHkuZGVmYXVsdC5TY29wZS5CTE9DS19BVFRSSUJVVEUpO251bGwhPW4mJnRoaXMuYXR0cmlidXRlcy5hdHRyaWJ1dGUobixlKX19LHtrZXk6ImZvcm1hdEF0Iix2YWx1ZTpmdW5jdGlvbih0LGUsbixyKXt0aGlzLmZvcm1hdChuLHIpfX0se2tleToiaW5zZXJ0QXQiLHZhbHVlOmZ1bmN0aW9uKHQsbixyKXtpZigic3RyaW5nIj09dHlwZW9mIG4mJm4uZW5kc1dpdGgoIlxuIikpe3ZhciBvPXkuZGVmYXVsdC5jcmVhdGUoeC5ibG90TmFtZSk7dGhpcy5wYXJlbnQuaW5zZXJ0QmVmb3JlKG8sMD09PXQ/dGhpczp0aGlzLm5leHQpLG8uaW5zZXJ0QXQoMCxuLnNsaWNlKDAsLTEpKX1lbHNlIHUoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJpbnNlcnRBdCIsdGhpcykuY2FsbCh0aGlzLHQsbixyKX19XSksZX0oeS5kZWZhdWx0LkVtYmVkKTt3LnNjb3BlPXkuZGVmYXVsdC5TY29wZS5CTE9DS19CTE9UO3ZhciB4PWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUodCl7byh0aGlzLGUpO3ZhciBuPWkodGhpcywoZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSkuY2FsbCh0aGlzLHQpKTtyZXR1cm4gbi5jYWNoZT17fSxufXJldHVybiBsKGUsdCkscyhlLFt7a2V5OiJkZWx0YSIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gbnVsbD09dGhpcy5jYWNoZS5kZWx0YSYmKHRoaXMuY2FjaGUuZGVsdGE9dGhpcy5kZXNjZW5kYW50cyh5LmRlZmF1bHQuTGVhZikucmVkdWNlKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIDA9PT1lLmxlbmd0aCgpP3Q6dC5pbnNlcnQoZS52YWx1ZSgpLGEoZSkpfSxuZXcgcC5kZWZhdWx0KS5pbnNlcnQoIlxuIixhKHRoaXMpKSksdGhpcy5jYWNoZS5kZWx0YX19LHtrZXk6ImRlbGV0ZUF0Iix2YWx1ZTpmdW5jdGlvbih0LG4pe3UoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJkZWxldGVBdCIsdGhpcykuY2FsbCh0aGlzLHQsbiksdGhpcy5jYWNoZT17fX19LHtrZXk6ImZvcm1hdEF0Iix2YWx1ZTpmdW5jdGlvbih0LG4scixvKXtuPD0wfHwoeS5kZWZhdWx0LnF1ZXJ5KHIseS5kZWZhdWx0LlNjb3BlLkJMT0NLKT90K249PT10aGlzLmxlbmd0aCgpJiZ0aGlzLmZvcm1hdChyLG8pOnUoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJmb3JtYXRBdCIsdGhpcykuY2FsbCh0aGlzLHQsTWF0aC5taW4obix0aGlzLmxlbmd0aCgpLXQtMSkscixvKSx0aGlzLmNhY2hlPXt9KX19LHtrZXk6Imluc2VydEF0Iix2YWx1ZTpmdW5jdGlvbih0LG4scil7aWYobnVsbCE9cilyZXR1cm4gdShlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksImluc2VydEF0Iix0aGlzKS5jYWxsKHRoaXMsdCxuLHIpO2lmKDAhPT1uLmxlbmd0aCl7dmFyIG89bi5zcGxpdCgiXG4iKSxpPW8uc2hpZnQoKTtpLmxlbmd0aD4wJiYodDx0aGlzLmxlbmd0aCgpLTF8fG51bGw9PXRoaXMuY2hpbGRyZW4udGFpbD91KGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwiaW5zZXJ0QXQiLHRoaXMpLmNhbGwodGhpcyxNYXRoLm1pbih0LHRoaXMubGVuZ3RoKCktMSksaSk6dGhpcy5jaGlsZHJlbi50YWlsLmluc2VydEF0KHRoaXMuY2hpbGRyZW4udGFpbC5sZW5ndGgoKSxpKSx0aGlzLmNhY2hlPXt9KTt2YXIgbD10aGlzO28ucmVkdWNlKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIGw9bC5zcGxpdCh0LCEwKSxsLmluc2VydEF0KDAsZSksZS5sZW5ndGh9LHQraS5sZW5ndGgpfX19LHtrZXk6Imluc2VydEJlZm9yZSIsdmFsdWU6ZnVuY3Rpb24odCxuKXt2YXIgcj10aGlzLmNoaWxkcmVuLmhlYWQ7dShlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksImluc2VydEJlZm9yZSIsdGhpcykuY2FsbCh0aGlzLHQsbiksciBpbnN0YW5jZW9mIGIuZGVmYXVsdCYmci5yZW1vdmUoKSx0aGlzLmNhY2hlPXt9fX0se2tleToibGVuZ3RoIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiBudWxsPT10aGlzLmNhY2hlLmxlbmd0aCYmKHRoaXMuY2FjaGUubGVuZ3RoPXUoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJsZW5ndGgiLHRoaXMpLmNhbGwodGhpcykrMSksdGhpcy5jYWNoZS5sZW5ndGh9fSx7a2V5OiJtb3ZlQ2hpbGRyZW4iLHZhbHVlOmZ1bmN0aW9uKHQsbil7dShlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksIm1vdmVDaGlsZHJlbiIsdGhpcykuY2FsbCh0aGlzLHQsbiksdGhpcy5jYWNoZT17fX19LHtrZXk6Im9wdGltaXplIix2YWx1ZTpmdW5jdGlvbih0KXt1KGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwib3B0aW1pemUiLHRoaXMpLmNhbGwodGhpcyx0KSx0aGlzLmNhY2hlPXt9fX0se2tleToicGF0aCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHUoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJwYXRoIix0aGlzKS5jYWxsKHRoaXMsdCwhMCl9fSx7a2V5OiJyZW1vdmVDaGlsZCIsdmFsdWU6ZnVuY3Rpb24odCl7dShlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksInJlbW92ZUNoaWxkIix0aGlzKS5jYWxsKHRoaXMsdCksdGhpcy5jYWNoZT17fX19LHtrZXk6InNwbGl0Iix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXSYmYXJndW1lbnRzWzFdO2lmKG4mJigwPT09dHx8dD49dGhpcy5sZW5ndGgoKS0xKSl7dmFyIHI9dGhpcy5jbG9uZSgpO3JldHVybiAwPT09dD8odGhpcy5wYXJlbnQuaW5zZXJ0QmVmb3JlKHIsdGhpcyksdGhpcyk6KHRoaXMucGFyZW50Lmluc2VydEJlZm9yZShyLHRoaXMubmV4dCkscil9dmFyIG89dShlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksInNwbGl0Iix0aGlzKS5jYWxsKHRoaXMsdCxuKTtyZXR1cm4gdGhpcy5jYWNoZT17fSxvfX1dKSxlfSh5LmRlZmF1bHQuQmxvY2spO3guYmxvdE5hbWU9ImJsb2NrIix4LnRhZ05hbWU9IlAiLHguZGVmYXVsdENoaWxkPSJicmVhayIseC5hbGxvd2VkQ2hpbGRyZW49W20uZGVmYXVsdCx5LmRlZmF1bHQuRW1iZWQsTy5kZWZhdWx0XSxlLmJ1YmJsZUZvcm1hdHM9YSxlLkJsb2NrRW1iZWQ9dyxlLmRlZmF1bHQ9eH0sZnVuY3Rpb24odCxlLG4pe3ZhciByPW4oNTQpLG89bigxMiksaT1uKDIpLGw9bigyMCksYT1TdHJpbmcuZnJvbUNoYXJDb2RlKDApLHM9ZnVuY3Rpb24odCl7QXJyYXkuaXNBcnJheSh0KT90aGlzLm9wcz10Om51bGwhPXQmJkFycmF5LmlzQXJyYXkodC5vcHMpP3RoaXMub3BzPXQub3BzOnRoaXMub3BzPVtdfTtzLnByb3RvdHlwZS5pbnNlcnQ9ZnVuY3Rpb24odCxlKXt2YXIgbj17fTtyZXR1cm4gMD09PXQubGVuZ3RoP3RoaXM6KG4uaW5zZXJ0PXQsbnVsbCE9ZSYmIm9iamVjdCI9PXR5cGVvZiBlJiZPYmplY3Qua2V5cyhlKS5sZW5ndGg+MCYmKG4uYXR0cmlidXRlcz1lKSx0aGlzLnB1c2gobikpfSxzLnByb3RvdHlwZS5kZWxldGU9ZnVuY3Rpb24odCl7cmV0dXJuIHQ8PTA/dGhpczp0aGlzLnB1c2goe2RlbGV0ZTp0fSl9LHMucHJvdG90eXBlLnJldGFpbj1mdW5jdGlvbih0LGUpe2lmKHQ8PTApcmV0dXJuIHRoaXM7dmFyIG49e3JldGFpbjp0fTtyZXR1cm4gbnVsbCE9ZSYmIm9iamVjdCI9PXR5cGVvZiBlJiZPYmplY3Qua2V5cyhlKS5sZW5ndGg+MCYmKG4uYXR0cmlidXRlcz1lKSx0aGlzLnB1c2gobil9LHMucHJvdG90eXBlLnB1c2g9ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5vcHMubGVuZ3RoLG49dGhpcy5vcHNbZS0xXTtpZih0PWkoITAse30sdCksIm9iamVjdCI9PXR5cGVvZiBuKXtpZigibnVtYmVyIj09dHlwZW9mIHQuZGVsZXRlJiYibnVtYmVyIj09dHlwZW9mIG4uZGVsZXRlKXJldHVybiB0aGlzLm9wc1tlLTFdPXtkZWxldGU6bi5kZWxldGUrdC5kZWxldGV9LHRoaXM7aWYoIm51bWJlciI9PXR5cGVvZiBuLmRlbGV0ZSYmbnVsbCE9dC5pbnNlcnQmJihlLT0xLCJvYmplY3QiIT10eXBlb2Yobj10aGlzLm9wc1tlLTFdKSkpcmV0dXJuIHRoaXMub3BzLnVuc2hpZnQodCksdGhpcztpZihvKHQuYXR0cmlidXRlcyxuLmF0dHJpYnV0ZXMpKXtpZigic3RyaW5nIj09dHlwZW9mIHQuaW5zZXJ0JiYic3RyaW5nIj09dHlwZW9mIG4uaW5zZXJ0KXJldHVybiB0aGlzLm9wc1tlLTFdPXtpbnNlcnQ6bi5pbnNlcnQrdC5pbnNlcnR9LCJvYmplY3QiPT10eXBlb2YgdC5hdHRyaWJ1dGVzJiYodGhpcy5vcHNbZS0xXS5hdHRyaWJ1dGVzPXQuYXR0cmlidXRlcyksdGhpcztpZigibnVtYmVyIj09dHlwZW9mIHQucmV0YWluJiYibnVtYmVyIj09dHlwZW9mIG4ucmV0YWluKXJldHVybiB0aGlzLm9wc1tlLTFdPXtyZXRhaW46bi5yZXRhaW4rdC5yZXRhaW59LCJvYmplY3QiPT10eXBlb2YgdC5hdHRyaWJ1dGVzJiYodGhpcy5vcHNbZS0xXS5hdHRyaWJ1dGVzPXQuYXR0cmlidXRlcyksdGhpc319cmV0dXJuIGU9PT10aGlzLm9wcy5sZW5ndGg/dGhpcy5vcHMucHVzaCh0KTp0aGlzLm9wcy5zcGxpY2UoZSwwLHQpLHRoaXN9LHMucHJvdG90eXBlLmNob3A9ZnVuY3Rpb24oKXt2YXIgdD10aGlzLm9wc1t0aGlzLm9wcy5sZW5ndGgtMV07cmV0dXJuIHQmJnQucmV0YWluJiYhdC5hdHRyaWJ1dGVzJiZ0aGlzLm9wcy5wb3AoKSx0aGlzfSxzLnByb3RvdHlwZS5maWx0ZXI9ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMub3BzLmZpbHRlcih0KX0scy5wcm90b3R5cGUuZm9yRWFjaD1mdW5jdGlvbih0KXt0aGlzLm9wcy5mb3JFYWNoKHQpfSxzLnByb3RvdHlwZS5tYXA9ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMub3BzLm1hcCh0KX0scy5wcm90b3R5cGUucGFydGl0aW9uPWZ1bmN0aW9uKHQpe3ZhciBlPVtdLG49W107cmV0dXJuIHRoaXMuZm9yRWFjaChmdW5jdGlvbihyKXsodChyKT9lOm4pLnB1c2gocil9KSxbZSxuXX0scy5wcm90b3R5cGUucmVkdWNlPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMub3BzLnJlZHVjZSh0LGUpfSxzLnByb3RvdHlwZS5jaGFuZ2VMZW5ndGg9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5yZWR1Y2UoZnVuY3Rpb24odCxlKXtyZXR1cm4gZS5pbnNlcnQ/dCtsLmxlbmd0aChlKTplLmRlbGV0ZT90LWUuZGVsZXRlOnR9LDApfSxzLnByb3RvdHlwZS5sZW5ndGg9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5yZWR1Y2UoZnVuY3Rpb24odCxlKXtyZXR1cm4gdCtsLmxlbmd0aChlKX0sMCl9LHMucHJvdG90eXBlLnNsaWNlPWZ1bmN0aW9uKHQsZSl7dD10fHwwLCJudW1iZXIiIT10eXBlb2YgZSYmKGU9MS8wKTtmb3IodmFyIG49W10scj1sLml0ZXJhdG9yKHRoaXMub3BzKSxvPTA7bzxlJiZyLmhhc05leHQoKTspe3ZhciBpO288dD9pPXIubmV4dCh0LW8pOihpPXIubmV4dChlLW8pLG4ucHVzaChpKSksbys9bC5sZW5ndGgoaSl9cmV0dXJuIG5ldyBzKG4pfSxzLnByb3RvdHlwZS5jb21wb3NlPWZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1sLml0ZXJhdG9yKHRoaXMub3BzKSxuPWwuaXRlcmF0b3IodC5vcHMpLHI9bmV3IHM7ZS5oYXNOZXh0KCl8fG4uaGFzTmV4dCgpOylpZigiaW5zZXJ0Ij09PW4ucGVla1R5cGUoKSlyLnB1c2gobi5uZXh0KCkpO2Vsc2UgaWYoImRlbGV0ZSI9PT1lLnBlZWtUeXBlKCkpci5wdXNoKGUubmV4dCgpKTtlbHNle3ZhciBvPU1hdGgubWluKGUucGVla0xlbmd0aCgpLG4ucGVla0xlbmd0aCgpKSxpPWUubmV4dChvKSxhPW4ubmV4dChvKTtpZigibnVtYmVyIj09dHlwZW9mIGEucmV0YWluKXt2YXIgdT17fTsibnVtYmVyIj09dHlwZW9mIGkucmV0YWluP3UucmV0YWluPW86dS5pbnNlcnQ9aS5pbnNlcnQ7dmFyIGM9bC5hdHRyaWJ1dGVzLmNvbXBvc2UoaS5hdHRyaWJ1dGVzLGEuYXR0cmlidXRlcywibnVtYmVyIj09dHlwZW9mIGkucmV0YWluKTtjJiYodS5hdHRyaWJ1dGVzPWMpLHIucHVzaCh1KX1lbHNlIm51bWJlciI9PXR5cGVvZiBhLmRlbGV0ZSYmIm51bWJlciI9PXR5cGVvZiBpLnJldGFpbiYmci5wdXNoKGEpfXJldHVybiByLmNob3AoKX0scy5wcm90b3R5cGUuY29uY2F0PWZ1bmN0aW9uKHQpe3ZhciBlPW5ldyBzKHRoaXMub3BzLnNsaWNlKCkpO3JldHVybiB0Lm9wcy5sZW5ndGg+MCYmKGUucHVzaCh0Lm9wc1swXSksZS5vcHM9ZS5vcHMuY29uY2F0KHQub3BzLnNsaWNlKDEpKSksZX0scy5wcm90b3R5cGUuZGlmZj1mdW5jdGlvbih0LGUpe2lmKHRoaXMub3BzPT09dC5vcHMpcmV0dXJuIG5ldyBzO3ZhciBuPVt0aGlzLHRdLm1hcChmdW5jdGlvbihlKXtyZXR1cm4gZS5tYXAoZnVuY3Rpb24obil7aWYobnVsbCE9bi5pbnNlcnQpcmV0dXJuInN0cmluZyI9PXR5cGVvZiBuLmluc2VydD9uLmluc2VydDphO3ZhciByPWU9PT10PyJvbiI6IndpdGgiO3Rocm93IG5ldyBFcnJvcigiZGlmZigpIGNhbGxlZCAiK3IrIiBub24tZG9jdW1lbnQiKX0pLmpvaW4oIiIpfSksaT1uZXcgcyx1PXIoblswXSxuWzFdLGUpLGM9bC5pdGVyYXRvcih0aGlzLm9wcyksZj1sLml0ZXJhdG9yKHQub3BzKTtyZXR1cm4gdS5mb3JFYWNoKGZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10WzFdLmxlbmd0aDtlPjA7KXt2YXIgbj0wO3N3aXRjaCh0WzBdKXtjYXNlIHIuSU5TRVJUOm49TWF0aC5taW4oZi5wZWVrTGVuZ3RoKCksZSksaS5wdXNoKGYubmV4dChuKSk7YnJlYWs7Y2FzZSByLkRFTEVURTpuPU1hdGgubWluKGUsYy5wZWVrTGVuZ3RoKCkpLGMubmV4dChuKSxpLmRlbGV0ZShuKTticmVhaztjYXNlIHIuRVFVQUw6bj1NYXRoLm1pbihjLnBlZWtMZW5ndGgoKSxmLnBlZWtMZW5ndGgoKSxlKTt2YXIgYT1jLm5leHQobikscz1mLm5leHQobik7byhhLmluc2VydCxzLmluc2VydCk/aS5yZXRhaW4obixsLmF0dHJpYnV0ZXMuZGlmZihhLmF0dHJpYnV0ZXMscy5hdHRyaWJ1dGVzKSk6aS5wdXNoKHMpLmRlbGV0ZShuKX1lLT1ufX0pLGkuY2hvcCgpfSxzLnByb3RvdHlwZS5lYWNoTGluZT1mdW5jdGlvbih0LGUpe2U9ZXx8IlxuIjtmb3IodmFyIG49bC5pdGVyYXRvcih0aGlzLm9wcykscj1uZXcgcyxvPTA7bi5oYXNOZXh0KCk7KXtpZigiaW5zZXJ0IiE9PW4ucGVla1R5cGUoKSlyZXR1cm47dmFyIGk9bi5wZWVrKCksYT1sLmxlbmd0aChpKS1uLnBlZWtMZW5ndGgoKSx1PSJzdHJpbmciPT10eXBlb2YgaS5pbnNlcnQ/aS5pbnNlcnQuaW5kZXhPZihlLGEpLWE6LTE7aWYodTwwKXIucHVzaChuLm5leHQoKSk7ZWxzZSBpZih1PjApci5wdXNoKG4ubmV4dCh1KSk7ZWxzZXtpZighMT09PXQocixuLm5leHQoMSkuYXR0cmlidXRlc3x8e30sbykpcmV0dXJuO28rPTEscj1uZXcgc319ci5sZW5ndGgoKT4wJiZ0KHIse30sbyl9LHMucHJvdG90eXBlLnRyYW5zZm9ybT1mdW5jdGlvbih0LGUpe2lmKGU9ISFlLCJudW1iZXIiPT10eXBlb2YgdClyZXR1cm4gdGhpcy50cmFuc2Zvcm1Qb3NpdGlvbih0LGUpO2Zvcih2YXIgbj1sLml0ZXJhdG9yKHRoaXMub3BzKSxyPWwuaXRlcmF0b3IodC5vcHMpLG89bmV3IHM7bi5oYXNOZXh0KCl8fHIuaGFzTmV4dCgpOylpZigiaW5zZXJ0IiE9PW4ucGVla1R5cGUoKXx8IWUmJiJpbnNlcnQiPT09ci5wZWVrVHlwZSgpKWlmKCJpbnNlcnQiPT09ci5wZWVrVHlwZSgpKW8ucHVzaChyLm5leHQoKSk7ZWxzZXt2YXIgaT1NYXRoLm1pbihuLnBlZWtMZW5ndGgoKSxyLnBlZWtMZW5ndGgoKSksYT1uLm5leHQoaSksdT1yLm5leHQoaSk7aWYoYS5kZWxldGUpY29udGludWU7dS5kZWxldGU/by5wdXNoKHUpOm8ucmV0YWluKGksbC5hdHRyaWJ1dGVzLnRyYW5zZm9ybShhLmF0dHJpYnV0ZXMsdS5hdHRyaWJ1dGVzLGUpKX1lbHNlIG8ucmV0YWluKGwubGVuZ3RoKG4ubmV4dCgpKSk7cmV0dXJuIG8uY2hvcCgpfSxzLnByb3RvdHlwZS50cmFuc2Zvcm1Qb3NpdGlvbj1mdW5jdGlvbih0LGUpe2U9ISFlO2Zvcih2YXIgbj1sLml0ZXJhdG9yKHRoaXMub3BzKSxyPTA7bi5oYXNOZXh0KCkmJnI8PXQ7KXt2YXIgbz1uLnBlZWtMZW5ndGgoKSxpPW4ucGVla1R5cGUoKTtuLm5leHQoKSwiZGVsZXRlIiE9PWk/KCJpbnNlcnQiPT09aSYmKHI8dHx8IWUpJiYodCs9bykscis9byk6dC09TWF0aC5taW4obyx0LXIpfXJldHVybiB0fSx0LmV4cG9ydHM9c30sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiByKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX1mdW5jdGlvbiBvKHQsZSl7aWYoISh0IGluc3RhbmNlb2YgZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIil9ZnVuY3Rpb24gaSh0LGUpe2lmKCF0KXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7cmV0dXJuIWV8fCJvYmplY3QiIT10eXBlb2YgZSYmImZ1bmN0aW9uIiE9dHlwZW9mIGU/dDplfWZ1bmN0aW9uIGwodCxlKXtpZigiZnVuY3Rpb24iIT10eXBlb2YgZSYmbnVsbCE9PWUpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiK3R5cGVvZiBlKTt0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGUmJmUucHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6dCxlbnVtZXJhYmxlOiExLHdyaXRhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH19KSxlJiYoT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0LGUpOnQuX19wcm90b19fPWUpfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgYT1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZVtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX1yZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfX0oKSxzPWZ1bmN0aW9uIHQoZSxuLHIpe251bGw9PT1lJiYoZT1GdW5jdGlvbi5wcm90b3R5cGUpO3ZhciBvPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSxuKTtpZih2b2lkIDA9PT1vKXt2YXIgaT1PYmplY3QuZ2V0UHJvdG90eXBlT2YoZSk7cmV0dXJuIG51bGw9PT1pP3ZvaWQgMDp0KGksbixyKX1pZigidmFsdWUiaW4gbylyZXR1cm4gby52YWx1ZTt2YXIgbD1vLmdldDtpZih2b2lkIDAhPT1sKXJldHVybiBsLmNhbGwocil9LHU9big4KSxjPXIodSksZj1uKDApLGg9cihmKSxwPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXtyZXR1cm4gbyh0aGlzLGUpLGkodGhpcywoZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSkuYXBwbHkodGhpcyxhcmd1bWVudHMpKX1yZXR1cm4gbChlLHQpLGEoZSxbe2tleToiZm9ybWF0QXQiLHZhbHVlOmZ1bmN0aW9uKHQsbixyLG8pe2lmKGUuY29tcGFyZSh0aGlzLnN0YXRpY3MuYmxvdE5hbWUscik8MCYmaC5kZWZhdWx0LnF1ZXJ5KHIsaC5kZWZhdWx0LlNjb3BlLkJMT1QpKXt2YXIgaT10aGlzLmlzb2xhdGUodCxuKTtvJiZpLndyYXAocixvKX1lbHNlIHMoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJmb3JtYXRBdCIsdGhpcykuY2FsbCh0aGlzLHQsbixyLG8pfX0se2tleToib3B0aW1pemUiLHZhbHVlOmZ1bmN0aW9uKHQpe2lmKHMoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJvcHRpbWl6ZSIsdGhpcykuY2FsbCh0aGlzLHQpLHRoaXMucGFyZW50IGluc3RhbmNlb2YgZSYmZS5jb21wYXJlKHRoaXMuc3RhdGljcy5ibG90TmFtZSx0aGlzLnBhcmVudC5zdGF0aWNzLmJsb3ROYW1lKT4wKXt2YXIgbj10aGlzLnBhcmVudC5pc29sYXRlKHRoaXMub2Zmc2V0KCksdGhpcy5sZW5ndGgoKSk7dGhpcy5tb3ZlQ2hpbGRyZW4obiksbi53cmFwKHRoaXMpfX19XSxbe2tleToiY29tcGFyZSIsdmFsdWU6ZnVuY3Rpb24odCxuKXt2YXIgcj1lLm9yZGVyLmluZGV4T2YodCksbz1lLm9yZGVyLmluZGV4T2Yobik7cmV0dXJuIHI+PTB8fG8+PTA/ci1vOnQ9PT1uPzA6dDxuPy0xOjF9fV0pLGV9KGguZGVmYXVsdC5JbmxpbmUpO3AuYWxsb3dlZENoaWxkcmVuPVtwLGguZGVmYXVsdC5FbWJlZCxjLmRlZmF1bHRdLHAub3JkZXI9WyJjdXJzb3IiLCJpbmxpbmUiLCJ1bmRlcmxpbmUiLCJzdHJpa2UiLCJpdGFsaWMiLCJib2xkIiwic2NyaXB0IiwibGluayIsImNvZGUiXSxlLmRlZmF1bHQ9cH0sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiByKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX1mdW5jdGlvbiBvKHQsZSxuKXtyZXR1cm4gZSBpbiB0P09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LGUse3ZhbHVlOm4sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KTp0W2VdPW4sdH1mdW5jdGlvbiBpKHQsZSl7aWYoISh0IGluc3RhbmNlb2YgZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIil9ZnVuY3Rpb24gbCh0LGUpe2lmKGU9KDAsTi5kZWZhdWx0KSghMCx7Y29udGFpbmVyOnQsbW9kdWxlczp7Y2xpcGJvYXJkOiEwLGtleWJvYXJkOiEwLGhpc3Rvcnk6ITB9fSxlKSxlLnRoZW1lJiZlLnRoZW1lIT09Uy5ERUZBVUxUUy50aGVtZSl7aWYoZS50aGVtZT1TLmltcG9ydCgidGhlbWVzLyIrZS50aGVtZSksbnVsbD09ZS50aGVtZSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgdGhlbWUgIitlLnRoZW1lKyIuIERpZCB5b3UgcmVnaXN0ZXIgaXQ/Iil9ZWxzZSBlLnRoZW1lPVQuZGVmYXVsdDt2YXIgbj0oMCxOLmRlZmF1bHQpKCEwLHt9LGUudGhlbWUuREVGQVVMVFMpO1tuLGVdLmZvckVhY2goZnVuY3Rpb24odCl7dC5tb2R1bGVzPXQubW9kdWxlc3x8e30sT2JqZWN0LmtleXModC5tb2R1bGVzKS5mb3JFYWNoKGZ1bmN0aW9uKGUpeyEwPT09dC5tb2R1bGVzW2VdJiYodC5tb2R1bGVzW2VdPXt9KX0pfSk7dmFyIHI9T2JqZWN0LmtleXMobi5tb2R1bGVzKS5jb25jYXQoT2JqZWN0LmtleXMoZS5tb2R1bGVzKSksbz1yLnJlZHVjZShmdW5jdGlvbih0LGUpe3ZhciBuPVMuaW1wb3J0KCJtb2R1bGVzLyIrZSk7cmV0dXJuIG51bGw9PW4/UC5lcnJvcigiQ2Fubm90IGxvYWQgIitlKyIgbW9kdWxlLiBBcmUgeW91IHN1cmUgeW91IHJlZ2lzdGVyZWQgaXQ/Iik6dFtlXT1uLkRFRkFVTFRTfHx7fSx0fSx7fSk7cmV0dXJuIG51bGwhPWUubW9kdWxlcyYmZS5tb2R1bGVzLnRvb2xiYXImJmUubW9kdWxlcy50b29sYmFyLmNvbnN0cnVjdG9yIT09T2JqZWN0JiYoZS5tb2R1bGVzLnRvb2xiYXI9e2NvbnRhaW5lcjplLm1vZHVsZXMudG9vbGJhcn0pLGU9KDAsTi5kZWZhdWx0KSghMCx7fSxTLkRFRkFVTFRTLHttb2R1bGVzOm99LG4sZSksWyJib3VuZHMiLCJjb250YWluZXIiLCJzY3JvbGxpbmdDb250YWluZXIiXS5mb3JFYWNoKGZ1bmN0aW9uKHQpeyJzdHJpbmciPT10eXBlb2YgZVt0XSYmKGVbdF09ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlW3RdKSl9KSxlLm1vZHVsZXM9T2JqZWN0LmtleXMoZS5tb2R1bGVzKS5yZWR1Y2UoZnVuY3Rpb24odCxuKXtyZXR1cm4gZS5tb2R1bGVzW25dJiYodFtuXT1lLm1vZHVsZXNbbl0pLHR9LHt9KSxlfWZ1bmN0aW9uIGEodCxlLG4scil7aWYodGhpcy5vcHRpb25zLnN0cmljdCYmIXRoaXMuaXNFbmFibGVkKCkmJmU9PT1nLmRlZmF1bHQuc291cmNlcy5VU0VSKXJldHVybiBuZXcgZC5kZWZhdWx0O3ZhciBvPW51bGw9PW4/bnVsbDp0aGlzLmdldFNlbGVjdGlvbigpLGk9dGhpcy5lZGl0b3IuZGVsdGEsbD10KCk7aWYobnVsbCE9byYmKCEwPT09biYmKG49by5pbmRleCksbnVsbD09cj9vPXUobyxsLGUpOjAhPT1yJiYobz11KG8sbixyLGUpKSx0aGlzLnNldFNlbGVjdGlvbihvLGcuZGVmYXVsdC5zb3VyY2VzLlNJTEVOVCkpLGwubGVuZ3RoKCk+MCl7dmFyIGEscz1bZy5kZWZhdWx0LmV2ZW50cy5URVhUX0NIQU5HRSxsLGksZV07aWYoKGE9dGhpcy5lbWl0dGVyKS5lbWl0LmFwcGx5KGEsW2cuZGVmYXVsdC5ldmVudHMuRURJVE9SX0NIQU5HRV0uY29uY2F0KHMpKSxlIT09Zy5kZWZhdWx0LnNvdXJjZXMuU0lMRU5UKXt2YXIgYzsoYz10aGlzLmVtaXR0ZXIpLmVtaXQuYXBwbHkoYyxzKX19cmV0dXJuIGx9ZnVuY3Rpb24gcyh0LGUsbixyLG8pe3ZhciBpPXt9O3JldHVybiJudW1iZXIiPT10eXBlb2YgdC5pbmRleCYmIm51bWJlciI9PXR5cGVvZiB0Lmxlbmd0aD8ibnVtYmVyIiE9dHlwZW9mIGU/KG89cixyPW4sbj1lLGU9dC5sZW5ndGgsdD10LmluZGV4KTooZT10Lmxlbmd0aCx0PXQuaW5kZXgpOiJudW1iZXIiIT10eXBlb2YgZSYmKG89cixyPW4sbj1lLGU9MCksIm9iamVjdCI9PT0odm9pZCAwPT09bj8idW5kZWZpbmVkIjpjKG4pKT8oaT1uLG89cik6InN0cmluZyI9PXR5cGVvZiBuJiYobnVsbCE9cj9pW25dPXI6bz1uKSxvPW98fGcuZGVmYXVsdC5zb3VyY2VzLkFQSSxbdCxlLGksb119ZnVuY3Rpb24gdSh0LGUsbixyKXtpZihudWxsPT10KXJldHVybiBudWxsO3ZhciBvPXZvaWQgMCxpPXZvaWQgMDtpZihlIGluc3RhbmNlb2YgZC5kZWZhdWx0KXt2YXIgbD1bdC5pbmRleCx0LmluZGV4K3QubGVuZ3RoXS5tYXAoZnVuY3Rpb24odCl7cmV0dXJuIGUudHJhbnNmb3JtUG9zaXRpb24odCxyIT09Zy5kZWZhdWx0LnNvdXJjZXMuVVNFUil9KSxhPWYobCwyKTtvPWFbMF0saT1hWzFdfWVsc2V7dmFyIHM9W3QuaW5kZXgsdC5pbmRleCt0Lmxlbmd0aF0ubWFwKGZ1bmN0aW9uKHQpe3JldHVybiB0PGV8fHQ9PT1lJiZyPT09Zy5kZWZhdWx0LnNvdXJjZXMuVVNFUj90Om4+PTA/dCtuOk1hdGgubWF4KGUsdCtuKX0pLHU9ZihzLDIpO289dVswXSxpPXVbMV19cmV0dXJuIG5ldyB4LlJhbmdlKG8saS1vKX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksZS5kZWZhdWx0PWUub3ZlcmxvYWQ9ZS5leHBhbmRDb25maWc9dm9pZCAwO3ZhciBjPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yP2Z1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdH06ZnVuY3Rpb24odCl7cmV0dXJuIHQmJiJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJnQuY29uc3RydWN0b3I9PT1TeW1ib2wmJnQhPT1TeW1ib2wucHJvdG90eXBlPyJzeW1ib2wiOnR5cGVvZiB0fSxmPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe3ZhciBuPVtdLHI9ITAsbz0hMSxpPXZvaWQgMDt0cnl7Zm9yKHZhciBsLGE9dFtTeW1ib2wuaXRlcmF0b3JdKCk7IShyPShsPWEubmV4dCgpKS5kb25lKSYmKG4ucHVzaChsLnZhbHVlKSwhZXx8bi5sZW5ndGghPT1lKTtyPSEwKTt9Y2F0Y2godCl7bz0hMCxpPXR9ZmluYWxseXt0cnl7IXImJmEucmV0dXJuJiZhLnJldHVybigpfWZpbmFsbHl7aWYobyl0aHJvdyBpfX1yZXR1cm4gbn1yZXR1cm4gZnVuY3Rpb24oZSxuKXtpZihBcnJheS5pc0FycmF5KGUpKXJldHVybiBlO2lmKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoZSkpcmV0dXJuIHQoZSxuKTt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIil9fSgpLGg9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQsZSl7Zm9yKHZhciBuPTA7bjxlLmxlbmd0aDtuKyspe3ZhciByPWVbbl07ci5lbnVtZXJhYmxlPXIuZW51bWVyYWJsZXx8ITEsci5jb25maWd1cmFibGU9ITAsInZhbHVlImluIHImJihyLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCxyLmtleSxyKX19cmV0dXJuIGZ1bmN0aW9uKGUsbixyKXtyZXR1cm4gbiYmdChlLnByb3RvdHlwZSxuKSxyJiZ0KGUsciksZX19KCk7big1Myk7dmFyIHA9big0KSxkPXIocCkseT1uKDU3KSx2PXIoeSksYj1uKDkpLGc9cihiKSxtPW4oNyksXz1yKG0pLE89bigwKSx3PXIoTykseD1uKDIyKSxrPXIoeCksRT1uKDIpLE49cihFKSxqPW4oMTApLEE9cihqKSxxPW4oMzIpLFQ9cihxKSxQPSgwLEEuZGVmYXVsdCkoInF1aWxsIiksUz1mdW5jdGlvbigpe2Z1bmN0aW9uIHQoZSl7dmFyIG49dGhpcyxyPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTp7fTtpZihpKHRoaXMsdCksdGhpcy5vcHRpb25zPWwoZSxyKSx0aGlzLmNvbnRhaW5lcj10aGlzLm9wdGlvbnMuY29udGFpbmVyLG51bGw9PXRoaXMuY29udGFpbmVyKXJldHVybiBQLmVycm9yKCJJbnZhbGlkIFF1aWxsIGNvbnRhaW5lciIsZSk7dGhpcy5vcHRpb25zLmRlYnVnJiZ0LmRlYnVnKHRoaXMub3B0aW9ucy5kZWJ1Zyk7dmFyIG89dGhpcy5jb250YWluZXIuaW5uZXJIVE1MLnRyaW0oKTt0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJxbC1jb250YWluZXIiKSx0aGlzLmNvbnRhaW5lci5pbm5lckhUTUw9IiIsdGhpcy5jb250YWluZXIuX19xdWlsbD10aGlzLHRoaXMucm9vdD10aGlzLmFkZENvbnRhaW5lcigicWwtZWRpdG9yIiksdGhpcy5yb290LmNsYXNzTGlzdC5hZGQoInFsLWJsYW5rIiksdGhpcy5yb290LnNldEF0dHJpYnV0ZSgiZGF0YS1ncmFtbSIsITEpLHRoaXMuc2Nyb2xsaW5nQ29udGFpbmVyPXRoaXMub3B0aW9ucy5zY3JvbGxpbmdDb250YWluZXJ8fHRoaXMucm9vdCx0aGlzLmVtaXR0ZXI9bmV3IGcuZGVmYXVsdCx0aGlzLnNjcm9sbD13LmRlZmF1bHQuY3JlYXRlKHRoaXMucm9vdCx7ZW1pdHRlcjp0aGlzLmVtaXR0ZXIsd2hpdGVsaXN0OnRoaXMub3B0aW9ucy5mb3JtYXRzfSksdGhpcy5lZGl0b3I9bmV3IHYuZGVmYXVsdCh0aGlzLnNjcm9sbCksdGhpcy5zZWxlY3Rpb249bmV3IGsuZGVmYXVsdCh0aGlzLnNjcm9sbCx0aGlzLmVtaXR0ZXIpLHRoaXMudGhlbWU9bmV3IHRoaXMub3B0aW9ucy50aGVtZSh0aGlzLHRoaXMub3B0aW9ucyksdGhpcy5rZXlib2FyZD10aGlzLnRoZW1lLmFkZE1vZHVsZSgia2V5Ym9hcmQiKSx0aGlzLmNsaXBib2FyZD10aGlzLnRoZW1lLmFkZE1vZHVsZSgiY2xpcGJvYXJkIiksdGhpcy5oaXN0b3J5PXRoaXMudGhlbWUuYWRkTW9kdWxlKCJoaXN0b3J5IiksdGhpcy50aGVtZS5pbml0KCksdGhpcy5lbWl0dGVyLm9uKGcuZGVmYXVsdC5ldmVudHMuRURJVE9SX0NIQU5HRSxmdW5jdGlvbih0KXt0PT09Zy5kZWZhdWx0LmV2ZW50cy5URVhUX0NIQU5HRSYmbi5yb290LmNsYXNzTGlzdC50b2dnbGUoInFsLWJsYW5rIixuLmVkaXRvci5pc0JsYW5rKCkpfSksdGhpcy5lbWl0dGVyLm9uKGcuZGVmYXVsdC5ldmVudHMuU0NST0xMX1VQREFURSxmdW5jdGlvbih0LGUpe3ZhciByPW4uc2VsZWN0aW9uLmxhc3RSYW5nZSxvPXImJjA9PT1yLmxlbmd0aD9yLmluZGV4OnZvaWQgMDthLmNhbGwobixmdW5jdGlvbigpe3JldHVybiBuLmVkaXRvci51cGRhdGUobnVsbCxlLG8pfSx0KX0pO3ZhciBzPXRoaXMuY2xpcGJvYXJkLmNvbnZlcnQoIjxkaXYgY2xhc3M9J3FsLWVkaXRvcicgc3R5bGU9XCJ3aGl0ZS1zcGFjZTogbm9ybWFsO1wiPiIrbysiPHA+PGJyPjwvcD48L2Rpdj4iKTt0aGlzLnNldENvbnRlbnRzKHMpLHRoaXMuaGlzdG9yeS5jbGVhcigpLHRoaXMub3B0aW9ucy5wbGFjZWhvbGRlciYmdGhpcy5yb290LnNldEF0dHJpYnV0ZSgiZGF0YS1wbGFjZWhvbGRlciIsdGhpcy5vcHRpb25zLnBsYWNlaG9sZGVyKSx0aGlzLm9wdGlvbnMucmVhZE9ubHkmJnRoaXMuZGlzYWJsZSgpfXJldHVybiBoKHQsbnVsbCxbe2tleToiZGVidWciLHZhbHVlOmZ1bmN0aW9uKHQpeyEwPT09dCYmKHQ9ImxvZyIpLEEuZGVmYXVsdC5sZXZlbCh0KX19LHtrZXk6ImZpbmQiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiB0Ll9fcXVpbGx8fHcuZGVmYXVsdC5maW5kKHQpfX0se2tleToiaW1wb3J0Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gbnVsbD09dGhpcy5pbXBvcnRzW3RdJiZQLmVycm9yKCJDYW5ub3QgaW1wb3J0ICIrdCsiLiBBcmUgeW91IHN1cmUgaXQgd2FzIHJlZ2lzdGVyZWQ/IiksdGhpcy5pbXBvcnRzW3RdfX0se2tleToicmVnaXN0ZXIiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcyxyPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdJiZhcmd1bWVudHNbMl07aWYoInN0cmluZyIhPXR5cGVvZiB0KXt2YXIgbz10LmF0dHJOYW1lfHx0LmJsb3ROYW1lOyJzdHJpbmciPT10eXBlb2Ygbz90aGlzLnJlZ2lzdGVyKCJmb3JtYXRzLyIrbyx0LGUpOk9iamVjdC5rZXlzKHQpLmZvckVhY2goZnVuY3Rpb24ocil7bi5yZWdpc3RlcihyLHRbcl0sZSl9KX1lbHNlIG51bGw9PXRoaXMuaW1wb3J0c1t0XXx8cnx8UC53YXJuKCJPdmVyd3JpdGluZyAiK3QrIiB3aXRoIixlKSx0aGlzLmltcG9ydHNbdF09ZSwodC5zdGFydHNXaXRoKCJibG90cy8iKXx8dC5zdGFydHNXaXRoKCJmb3JtYXRzLyIpKSYmImFic3RyYWN0IiE9PWUuYmxvdE5hbWU/dy5kZWZhdWx0LnJlZ2lzdGVyKGUpOnQuc3RhcnRzV2l0aCgibW9kdWxlcyIpJiYiZnVuY3Rpb24iPT10eXBlb2YgZS5yZWdpc3RlciYmZS5yZWdpc3RlcigpfX1dKSxoKHQsW3trZXk6ImFkZENvbnRhaW5lciIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOm51bGw7aWYoInN0cmluZyI9PXR5cGVvZiB0KXt2YXIgbj10O3Q9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksdC5jbGFzc0xpc3QuYWRkKG4pfXJldHVybiB0aGlzLmNvbnRhaW5lci5pbnNlcnRCZWZvcmUodCxlKSx0fX0se2tleToiYmx1ciIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnNlbGVjdGlvbi5zZXRSYW5nZShudWxsKX19LHtrZXk6ImRlbGV0ZVRleHQiLHZhbHVlOmZ1bmN0aW9uKHQsZSxuKXt2YXIgcj10aGlzLG89cyh0LGUsbiksaT1mKG8sNCk7cmV0dXJuIHQ9aVswXSxlPWlbMV0sbj1pWzNdLGEuY2FsbCh0aGlzLGZ1bmN0aW9uKCl7cmV0dXJuIHIuZWRpdG9yLmRlbGV0ZVRleHQodCxlKX0sbix0LC0xKmUpfX0se2tleToiZGlzYWJsZSIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLmVuYWJsZSghMSl9fSx7a2V5OiJlbmFibGUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9IShhcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXSl8fGFyZ3VtZW50c1swXTt0aGlzLnNjcm9sbC5lbmFibGUodCksdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgicWwtZGlzYWJsZWQiLCF0KX19LHtrZXk6ImZvY3VzIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuc2Nyb2xsaW5nQ29udGFpbmVyLnNjcm9sbFRvcDt0aGlzLnNlbGVjdGlvbi5mb2N1cygpLHRoaXMuc2Nyb2xsaW5nQ29udGFpbmVyLnNjcm9sbFRvcD10LHRoaXMuc2Nyb2xsSW50b1ZpZXcoKX19LHtrZXk6ImZvcm1hdCIsdmFsdWU6ZnVuY3Rpb24odCxlKXt2YXIgbj10aGlzLHI9YXJndW1lbnRzLmxlbmd0aD4yJiZ2b2lkIDAhPT1hcmd1bWVudHNbMl0/YXJndW1lbnRzWzJdOmcuZGVmYXVsdC5zb3VyY2VzLkFQSTtyZXR1cm4gYS5jYWxsKHRoaXMsZnVuY3Rpb24oKXt2YXIgcj1uLmdldFNlbGVjdGlvbighMCksaT1uZXcgZC5kZWZhdWx0O2lmKG51bGw9PXIpcmV0dXJuIGk7aWYody5kZWZhdWx0LnF1ZXJ5KHQsdy5kZWZhdWx0LlNjb3BlLkJMT0NLKSlpPW4uZWRpdG9yLmZvcm1hdExpbmUoci5pbmRleCxyLmxlbmd0aCxvKHt9LHQsZSkpO2Vsc2V7aWYoMD09PXIubGVuZ3RoKXJldHVybiBuLnNlbGVjdGlvbi5mb3JtYXQodCxlKSxpO2k9bi5lZGl0b3IuZm9ybWF0VGV4dChyLmluZGV4LHIubGVuZ3RoLG8oe30sdCxlKSl9cmV0dXJuIG4uc2V0U2VsZWN0aW9uKHIsZy5kZWZhdWx0LnNvdXJjZXMuU0lMRU5UKSxpfSxyKX19LHtrZXk6ImZvcm1hdExpbmUiLHZhbHVlOmZ1bmN0aW9uKHQsZSxuLHIsbyl7dmFyIGk9dGhpcyxsPXZvaWQgMCx1PXModCxlLG4scixvKSxjPWYodSw0KTtyZXR1cm4gdD1jWzBdLGU9Y1sxXSxsPWNbMl0sbz1jWzNdLGEuY2FsbCh0aGlzLGZ1bmN0aW9uKCl7cmV0dXJuIGkuZWRpdG9yLmZvcm1hdExpbmUodCxlLGwpfSxvLHQsMCl9fSx7a2V5OiJmb3JtYXRUZXh0Iix2YWx1ZTpmdW5jdGlvbih0LGUsbixyLG8pe3ZhciBpPXRoaXMsbD12b2lkIDAsdT1zKHQsZSxuLHIsbyksYz1mKHUsNCk7cmV0dXJuIHQ9Y1swXSxlPWNbMV0sbD1jWzJdLG89Y1szXSxhLmNhbGwodGhpcyxmdW5jdGlvbigpe3JldHVybiBpLmVkaXRvci5mb3JtYXRUZXh0KHQsZSxsKX0sbyx0LDApfX0se2tleToiZ2V0Qm91bmRzIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgZT1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06MCxuPXZvaWQgMDtuPSJudW1iZXIiPT10eXBlb2YgdD90aGlzLnNlbGVjdGlvbi5nZXRCb3VuZHModCxlKTp0aGlzLnNlbGVjdGlvbi5nZXRCb3VuZHModC5pbmRleCx0Lmxlbmd0aCk7dmFyIHI9dGhpcy5jb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7cmV0dXJue2JvdHRvbTpuLmJvdHRvbS1yLnRvcCxoZWlnaHQ6bi5oZWlnaHQsbGVmdDpuLmxlZnQtci5sZWZ0LHJpZ2h0Om4ucmlnaHQtci5sZWZ0LHRvcDpuLnRvcC1yLnRvcCx3aWR0aDpuLndpZHRofX19LHtrZXk6ImdldENvbnRlbnRzIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTowLGU9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOnRoaXMuZ2V0TGVuZ3RoKCktdCxuPXModCxlKSxyPWYobiwyKTtyZXR1cm4gdD1yWzBdLGU9clsxXSx0aGlzLmVkaXRvci5nZXRDb250ZW50cyh0LGUpfX0se2tleToiZ2V0Rm9ybWF0Iix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTp0aGlzLmdldFNlbGVjdGlvbighMCksZT1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06MDtyZXR1cm4ibnVtYmVyIj09dHlwZW9mIHQ/dGhpcy5lZGl0b3IuZ2V0Rm9ybWF0KHQsZSk6dGhpcy5lZGl0b3IuZ2V0Rm9ybWF0KHQuaW5kZXgsdC5sZW5ndGgpfX0se2tleToiZ2V0SW5kZXgiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiB0Lm9mZnNldCh0aGlzLnNjcm9sbCl9fSx7a2V5OiJnZXRMZW5ndGgiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2Nyb2xsLmxlbmd0aCgpfX0se2tleToiZ2V0TGVhZiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuc2Nyb2xsLmxlYWYodCl9fSx7a2V5OiJnZXRMaW5lIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5zY3JvbGwubGluZSh0KX19LHtrZXk6ImdldExpbmVzIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTowLGU9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOk51bWJlci5NQVhfVkFMVUU7cmV0dXJuIm51bWJlciIhPXR5cGVvZiB0P3RoaXMuc2Nyb2xsLmxpbmVzKHQuaW5kZXgsdC5sZW5ndGgpOnRoaXMuc2Nyb2xsLmxpbmVzKHQsZSl9fSx7a2V5OiJnZXRNb2R1bGUiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLnRoZW1lLm1vZHVsZXNbdF19fSx7a2V5OiJnZXRTZWxlY3Rpb24iLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdJiZhcmd1bWVudHNbMF0mJnRoaXMuZm9jdXMoKSx0aGlzLnVwZGF0ZSgpLHRoaXMuc2VsZWN0aW9uLmdldFJhbmdlKClbMF19fSx7a2V5OiJnZXRUZXh0Iix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTowLGU9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOnRoaXMuZ2V0TGVuZ3RoKCktdCxuPXModCxlKSxyPWYobiwyKTtyZXR1cm4gdD1yWzBdLGU9clsxXSx0aGlzLmVkaXRvci5nZXRUZXh0KHQsZSl9fSx7a2V5OiJoYXNGb2N1cyIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zZWxlY3Rpb24uaGFzRm9jdXMoKX19LHtrZXk6Imluc2VydEVtYmVkIix2YWx1ZTpmdW5jdGlvbihlLG4scil7dmFyIG89dGhpcyxpPWFyZ3VtZW50cy5sZW5ndGg+MyYmdm9pZCAwIT09YXJndW1lbnRzWzNdP2FyZ3VtZW50c1szXTp0LnNvdXJjZXMuQVBJO3JldHVybiBhLmNhbGwodGhpcyxmdW5jdGlvbigpe3JldHVybiBvLmVkaXRvci5pbnNlcnRFbWJlZChlLG4scil9LGksZSl9fSx7a2V5OiJpbnNlcnRUZXh0Iix2YWx1ZTpmdW5jdGlvbih0LGUsbixyLG8pe3ZhciBpPXRoaXMsbD12b2lkIDAsdT1zKHQsMCxuLHIsbyksYz1mKHUsNCk7cmV0dXJuIHQ9Y1swXSxsPWNbMl0sbz1jWzNdLGEuY2FsbCh0aGlzLGZ1bmN0aW9uKCl7cmV0dXJuIGkuZWRpdG9yLmluc2VydFRleHQodCxlLGwpfSxvLHQsZS5sZW5ndGgpfX0se2tleToiaXNFbmFibGVkIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiF0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoInFsLWRpc2FibGVkIil9fSx7a2V5OiJvZmYiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZW1pdHRlci5vZmYuYXBwbHkodGhpcy5lbWl0dGVyLGFyZ3VtZW50cyl9fSx7a2V5OiJvbiIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbWl0dGVyLm9uLmFwcGx5KHRoaXMuZW1pdHRlcixhcmd1bWVudHMpfX0se2tleToib25jZSIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbWl0dGVyLm9uY2UuYXBwbHkodGhpcy5lbWl0dGVyLGFyZ3VtZW50cyl9fSx7a2V5OiJwYXN0ZUhUTUwiLHZhbHVlOmZ1bmN0aW9uKHQsZSxuKXt0aGlzLmNsaXBib2FyZC5kYW5nZXJvdXNseVBhc3RlSFRNTCh0LGUsbil9fSx7a2V5OiJyZW1vdmVGb3JtYXQiLHZhbHVlOmZ1bmN0aW9uKHQsZSxuKXt2YXIgcj10aGlzLG89cyh0LGUsbiksaT1mKG8sNCk7cmV0dXJuIHQ9aVswXSxlPWlbMV0sbj1pWzNdLGEuY2FsbCh0aGlzLGZ1bmN0aW9uKCl7cmV0dXJuIHIuZWRpdG9yLnJlbW92ZUZvcm1hdCh0LGUpfSxuLHQpfX0se2tleToic2Nyb2xsSW50b1ZpZXciLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5zZWxlY3Rpb24uc2Nyb2xsSW50b1ZpZXcodGhpcy5zY3JvbGxpbmdDb250YWluZXIpfX0se2tleToic2V0Q29udGVudHMiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMsbj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06Zy5kZWZhdWx0LnNvdXJjZXMuQVBJO3JldHVybiBhLmNhbGwodGhpcyxmdW5jdGlvbigpe3Q9bmV3IGQuZGVmYXVsdCh0KTt2YXIgbj1lLmdldExlbmd0aCgpLHI9ZS5lZGl0b3IuZGVsZXRlVGV4dCgwLG4pLG89ZS5lZGl0b3IuYXBwbHlEZWx0YSh0KSxpPW8ub3BzW28ub3BzLmxlbmd0aC0xXTtyZXR1cm4gbnVsbCE9aSYmInN0cmluZyI9PXR5cGVvZiBpLmluc2VydCYmIlxuIj09PWkuaW5zZXJ0W2kuaW5zZXJ0Lmxlbmd0aC0xXSYmKGUuZWRpdG9yLmRlbGV0ZVRleHQoZS5nZXRMZW5ndGgoKS0xLDEpLG8uZGVsZXRlKDEpKSxyLmNvbXBvc2Uobyl9LG4pfX0se2tleToic2V0U2VsZWN0aW9uIix2YWx1ZTpmdW5jdGlvbihlLG4scil7aWYobnVsbD09ZSl0aGlzLnNlbGVjdGlvbi5zZXRSYW5nZShudWxsLG58fHQuc291cmNlcy5BUEkpO2Vsc2V7dmFyIG89cyhlLG4sciksaT1mKG8sNCk7ZT1pWzBdLG49aVsxXSxyPWlbM10sdGhpcy5zZWxlY3Rpb24uc2V0UmFuZ2UobmV3IHguUmFuZ2UoZSxuKSxyKSxyIT09Zy5kZWZhdWx0LnNvdXJjZXMuU0lMRU5UJiZ0aGlzLnNlbGVjdGlvbi5zY3JvbGxJbnRvVmlldyh0aGlzLnNjcm9sbGluZ0NvbnRhaW5lcil9fX0se2tleToic2V0VGV4dCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOmcuZGVmYXVsdC5zb3VyY2VzLkFQSSxuPShuZXcgZC5kZWZhdWx0KS5pbnNlcnQodCk7cmV0dXJuIHRoaXMuc2V0Q29udGVudHMobixlKX19LHtrZXk6InVwZGF0ZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06Zy5kZWZhdWx0LnNvdXJjZXMuVVNFUixlPXRoaXMuc2Nyb2xsLnVwZGF0ZSh0KTtyZXR1cm4gdGhpcy5zZWxlY3Rpb24udXBkYXRlKHQpLGV9fSx7a2V5OiJ1cGRhdGVDb250ZW50cyIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcyxuPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTpnLmRlZmF1bHQuc291cmNlcy5BUEk7cmV0dXJuIGEuY2FsbCh0aGlzLGZ1bmN0aW9uKCl7cmV0dXJuIHQ9bmV3IGQuZGVmYXVsdCh0KSxlLmVkaXRvci5hcHBseURlbHRhKHQsbil9LG4sITApfX1dKSx0fSgpO1MuREVGQVVMVFM9e2JvdW5kczpudWxsLGZvcm1hdHM6bnVsbCxtb2R1bGVzOnt9LHBsYWNlaG9sZGVyOiIiLHJlYWRPbmx5OiExLHNjcm9sbGluZ0NvbnRhaW5lcjpudWxsLHN0cmljdDohMCx0aGVtZToiZGVmYXVsdCJ9LFMuZXZlbnRzPWcuZGVmYXVsdC5ldmVudHMsUy5zb3VyY2VzPWcuZGVmYXVsdC5zb3VyY2VzLFMudmVyc2lvbj0iMS4zLjYiLFMuaW1wb3J0cz17ZGVsdGE6ZC5kZWZhdWx0LHBhcmNobWVudDp3LmRlZmF1bHQsImNvcmUvbW9kdWxlIjpfLmRlZmF1bHQsImNvcmUvdGhlbWUiOlQuZGVmYXVsdH0sZS5leHBhbmRDb25maWc9bCxlLm92ZXJsb2FkPXMsZS5kZWZhdWx0PVN9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgbz1mdW5jdGlvbiB0KGUpe3ZhciBuPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTp7fTtyKHRoaXMsdCksdGhpcy5xdWlsbD1lLHRoaXMub3B0aW9ucz1ufTtvLkRFRkFVTFRTPXt9LGUuZGVmYXVsdD1vfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBvKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gaSh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBsPW4oMCksYT1mdW5jdGlvbih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19KGwpLHM9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSgpe3JldHVybiByKHRoaXMsZSksbyh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5hcHBseSh0aGlzLGFyZ3VtZW50cykpfXJldHVybiBpKGUsdCksZX0oYS5kZWZhdWx0LlRleHQpO2UuZGVmYXVsdD1zfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fWZ1bmN0aW9uIG8odCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBpKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gbCh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBhPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lW25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsci5rZXkscil9fXJldHVybiBmdW5jdGlvbihlLG4scil7cmV0dXJuIG4mJnQoZS5wcm90b3R5cGUsbiksciYmdChlLHIpLGV9fSgpLHM9ZnVuY3Rpb24gdChlLG4scil7bnVsbD09PWUmJihlPUZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIG89T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLG4pO2lmKHZvaWQgMD09PW8pe3ZhciBpPU9iamVjdC5nZXRQcm90b3R5cGVPZihlKTtyZXR1cm4gbnVsbD09PWk/dm9pZCAwOnQoaSxuLHIpfWlmKCJ2YWx1ZSJpbiBvKXJldHVybiBvLnZhbHVlO3ZhciBsPW8uZ2V0O2lmKHZvaWQgMCE9PWwpcmV0dXJuIGwuY2FsbChyKX0sdT1uKDU4KSxjPXIodSksZj1uKDEwKSxoPXIoZikscD0oMCxoLmRlZmF1bHQpKCJxdWlsbDpldmVudHMiKTtbInNlbGVjdGlvbmNoYW5nZSIsIm1vdXNlZG93biIsIm1vdXNldXAiLCJjbGljayJdLmZvckVhY2goZnVuY3Rpb24odCl7ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcih0LGZ1bmN0aW9uKCl7Zm9yKHZhciB0PWFyZ3VtZW50cy5sZW5ndGgsZT1BcnJheSh0KSxuPTA7bjx0O24rKyllW25dPWFyZ3VtZW50c1tuXTtbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5xbC1jb250YWluZXIiKSkuZm9yRWFjaChmdW5jdGlvbih0KXtpZih0Ll9fcXVpbGwmJnQuX19xdWlsbC5lbWl0dGVyKXt2YXIgbjsobj10Ll9fcXVpbGwuZW1pdHRlcikuaGFuZGxlRE9NLmFwcGx5KG4sZSl9fSl9KX0pO3ZhciBkPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXtvKHRoaXMsZSk7dmFyIHQ9aSh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5jYWxsKHRoaXMpKTtyZXR1cm4gdC5saXN0ZW5lcnM9e30sdC5vbigiZXJyb3IiLHAuZXJyb3IpLHR9cmV0dXJuIGwoZSx0KSxhKGUsW3trZXk6ImVtaXQiLHZhbHVlOmZ1bmN0aW9uKCl7cC5sb2cuYXBwbHkocCxhcmd1bWVudHMpLHMoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJlbWl0Iix0aGlzKS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fSx7a2V5OiJoYW5kbGVET00iLHZhbHVlOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1hcmd1bWVudHMubGVuZ3RoLG49QXJyYXkoZT4xP2UtMTowKSxyPTE7cjxlO3IrKyluW3ItMV09YXJndW1lbnRzW3JdOyh0aGlzLmxpc3RlbmVyc1t0LnR5cGVdfHxbXSkuZm9yRWFjaChmdW5jdGlvbihlKXt2YXIgcj1lLm5vZGUsbz1lLmhhbmRsZXI7KHQudGFyZ2V0PT09cnx8ci5jb250YWlucyh0LnRhcmdldCkpJiZvLmFwcGx5KHZvaWQgMCxbdF0uY29uY2F0KG4pKX0pfX0se2tleToibGlzdGVuRE9NIix2YWx1ZTpmdW5jdGlvbih0LGUsbil7dGhpcy5saXN0ZW5lcnNbdF18fCh0aGlzLmxpc3RlbmVyc1t0XT1bXSksdGhpcy5saXN0ZW5lcnNbdF0ucHVzaCh7bm9kZTplLGhhbmRsZXI6bn0pfX1dKSxlfShjLmRlZmF1bHQpO2QuZXZlbnRzPXtFRElUT1JfQ0hBTkdFOiJlZGl0b3ItY2hhbmdlIixTQ1JPTExfQkVGT1JFX1VQREFURToic2Nyb2xsLWJlZm9yZS11cGRhdGUiLFNDUk9MTF9PUFRJTUlaRToic2Nyb2xsLW9wdGltaXplIixTQ1JPTExfVVBEQVRFOiJzY3JvbGwtdXBkYXRlIixTRUxFQ1RJT05fQ0hBTkdFOiJzZWxlY3Rpb24tY2hhbmdlIixURVhUX0NIQU5HRToidGV4dC1jaGFuZ2UifSxkLnNvdXJjZXM9e0FQSToiYXBpIixTSUxFTlQ6InNpbGVudCIsVVNFUjoidXNlciJ9LGUuZGVmYXVsdD1kfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCl7aWYoaS5pbmRleE9mKHQpPD1pLmluZGV4T2YobCkpe2Zvcih2YXIgZSxuPWFyZ3VtZW50cy5sZW5ndGgscj1BcnJheShuPjE/bi0xOjApLG89MTtvPG47bysrKXJbby0xXT1hcmd1bWVudHNbb107KGU9Y29uc29sZSlbdF0uYXBwbHkoZSxyKX19ZnVuY3Rpb24gbyh0KXtyZXR1cm4gaS5yZWR1Y2UoZnVuY3Rpb24oZSxuKXtyZXR1cm4gZVtuXT1yLmJpbmQoY29uc29sZSxuLHQpLGV9LHt9KX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIGk9WyJlcnJvciIsIndhcm4iLCJsb2ciLCJpbmZvIl0sbD0id2FybiI7ci5sZXZlbD1vLmxldmVsPWZ1bmN0aW9uKHQpe2w9dH0sZS5kZWZhdWx0PW99LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciByPW4oMSksbz1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlLG4pe3ZvaWQgMD09PW4mJihuPXt9KSx0aGlzLmF0dHJOYW1lPXQsdGhpcy5rZXlOYW1lPWU7dmFyIG89ci5TY29wZS5UWVBFJnIuU2NvcGUuQVRUUklCVVRFO251bGwhPW4uc2NvcGU/dGhpcy5zY29wZT1uLnNjb3BlJnIuU2NvcGUuTEVWRUx8bzp0aGlzLnNjb3BlPXIuU2NvcGUuQVRUUklCVVRFLG51bGwhPW4ud2hpdGVsaXN0JiYodGhpcy53aGl0ZWxpc3Q9bi53aGl0ZWxpc3QpfXJldHVybiB0LmtleXM9ZnVuY3Rpb24odCl7cmV0dXJuW10ubWFwLmNhbGwodC5hdHRyaWJ1dGVzLGZ1bmN0aW9uKHQpe3JldHVybiB0Lm5hbWV9KX0sdC5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKHQsZSl7cmV0dXJuISF0aGlzLmNhbkFkZCh0LGUpJiYodC5zZXRBdHRyaWJ1dGUodGhpcy5rZXlOYW1lLGUpLCEwKX0sdC5wcm90b3R5cGUuY2FuQWRkPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG51bGwhPXIucXVlcnkodCxyLlNjb3BlLkJMT1QmKHRoaXMuc2NvcGV8ci5TY29wZS5UWVBFKSkmJihudWxsPT10aGlzLndoaXRlbGlzdHx8KCJzdHJpbmciPT10eXBlb2YgZT90aGlzLndoaXRlbGlzdC5pbmRleE9mKGUucmVwbGFjZSgvWyInXS9nLCIiKSk+LTE6dGhpcy53aGl0ZWxpc3QuaW5kZXhPZihlKT4tMSkpfSx0LnByb3RvdHlwZS5yZW1vdmU9ZnVuY3Rpb24odCl7dC5yZW1vdmVBdHRyaWJ1dGUodGhpcy5rZXlOYW1lKX0sdC5wcm90b3R5cGUudmFsdWU9ZnVuY3Rpb24odCl7dmFyIGU9dC5nZXRBdHRyaWJ1dGUodGhpcy5rZXlOYW1lKTtyZXR1cm4gdGhpcy5jYW5BZGQodCxlKSYmZT9lOiIifSx0fSgpO2UuZGVmYXVsdD1vfSxmdW5jdGlvbih0LGUsbil7ZnVuY3Rpb24gcih0KXtyZXR1cm4gbnVsbD09PXR8fHZvaWQgMD09PXR9ZnVuY3Rpb24gbyh0KXtyZXR1cm4hKCF0fHwib2JqZWN0IiE9dHlwZW9mIHR8fCJudW1iZXIiIT10eXBlb2YgdC5sZW5ndGgpJiYoImZ1bmN0aW9uIj09dHlwZW9mIHQuY29weSYmImZ1bmN0aW9uIj09dHlwZW9mIHQuc2xpY2UmJiEodC5sZW5ndGg+MCYmIm51bWJlciIhPXR5cGVvZiB0WzBdKSl9ZnVuY3Rpb24gaSh0LGUsbil7dmFyIGksYztpZihyKHQpfHxyKGUpKXJldHVybiExO2lmKHQucHJvdG90eXBlIT09ZS5wcm90b3R5cGUpcmV0dXJuITE7aWYocyh0KSlyZXR1cm4hIXMoZSkmJih0PWwuY2FsbCh0KSxlPWwuY2FsbChlKSx1KHQsZSxuKSk7aWYobyh0KSl7aWYoIW8oZSkpcmV0dXJuITE7aWYodC5sZW5ndGghPT1lLmxlbmd0aClyZXR1cm4hMTtmb3IoaT0wO2k8dC5sZW5ndGg7aSsrKWlmKHRbaV0hPT1lW2ldKXJldHVybiExO3JldHVybiEwfXRyeXt2YXIgZj1hKHQpLGg9YShlKX1jYXRjaCh0KXtyZXR1cm4hMX1pZihmLmxlbmd0aCE9aC5sZW5ndGgpcmV0dXJuITE7Zm9yKGYuc29ydCgpLGguc29ydCgpLGk9Zi5sZW5ndGgtMTtpPj0wO2ktLSlpZihmW2ldIT1oW2ldKXJldHVybiExO2ZvcihpPWYubGVuZ3RoLTE7aT49MDtpLS0paWYoYz1mW2ldLCF1KHRbY10sZVtjXSxuKSlyZXR1cm4hMTtyZXR1cm4gdHlwZW9mIHQ9PXR5cGVvZiBlfXZhciBsPUFycmF5LnByb3RvdHlwZS5zbGljZSxhPW4oNTUpLHM9big1NiksdT10LmV4cG9ydHM9ZnVuY3Rpb24odCxlLG4pe3JldHVybiBufHwobj17fSksdD09PWV8fCh0IGluc3RhbmNlb2YgRGF0ZSYmZSBpbnN0YW5jZW9mIERhdGU/dC5nZXRUaW1lKCk9PT1lLmdldFRpbWUoKTohdHx8IWV8fCJvYmplY3QiIT10eXBlb2YgdCYmIm9iamVjdCIhPXR5cGVvZiBlP24uc3RyaWN0P3Q9PT1lOnQ9PWU6aSh0LGUsbikpfX0sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiByKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX1mdW5jdGlvbiBvKHQsZSl7aWYoISh0IGluc3RhbmNlb2YgZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIil9ZnVuY3Rpb24gaSh0LGUpe2lmKCF0KXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7cmV0dXJuIWV8fCJvYmplY3QiIT10eXBlb2YgZSYmImZ1bmN0aW9uIiE9dHlwZW9mIGU/dDplfWZ1bmN0aW9uIGwodCxlKXtpZigiZnVuY3Rpb24iIT10eXBlb2YgZSYmbnVsbCE9PWUpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiK3R5cGVvZiBlKTt0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGUmJmUucHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6dCxlbnVtZXJhYmxlOiExLHdyaXRhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH19KSxlJiYoT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0LGUpOnQuX19wcm90b19fPWUpfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxlLmRlZmF1bHQ9ZS5Db2RlPXZvaWQgMDt2YXIgYT1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXt2YXIgbj1bXSxyPSEwLG89ITEsaT12b2lkIDA7dHJ5e2Zvcih2YXIgbCxhPXRbU3ltYm9sLml0ZXJhdG9yXSgpOyEocj0obD1hLm5leHQoKSkuZG9uZSkmJihuLnB1c2gobC52YWx1ZSksIWV8fG4ubGVuZ3RoIT09ZSk7cj0hMCk7fWNhdGNoKHQpe289ITAsaT10fWZpbmFsbHl7dHJ5eyFyJiZhLnJldHVybiYmYS5yZXR1cm4oKX1maW5hbGx5e2lmKG8pdGhyb3cgaX19cmV0dXJuIG59cmV0dXJuIGZ1bmN0aW9uKGUsbil7aWYoQXJyYXkuaXNBcnJheShlKSlyZXR1cm4gZTtpZihTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGUpKXJldHVybiB0KGUsbik7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpfX0oKSxzPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lW25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsci5rZXkscil9fXJldHVybiBmdW5jdGlvbihlLG4scil7cmV0dXJuIG4mJnQoZS5wcm90b3R5cGUsbiksciYmdChlLHIpLGV9fSgpLHU9ZnVuY3Rpb24gdChlLG4scil7bnVsbD09PWUmJihlPUZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIG89T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLG4pO2lmKHZvaWQgMD09PW8pe3ZhciBpPU9iamVjdC5nZXRQcm90b3R5cGVPZihlKTtyZXR1cm4gbnVsbD09PWk/dm9pZCAwOnQoaSxuLHIpfWlmKCJ2YWx1ZSJpbiBvKXJldHVybiBvLnZhbHVlO3ZhciBsPW8uZ2V0O2lmKHZvaWQgMCE9PWwpcmV0dXJuIGwuY2FsbChyKX0sYz1uKDQpLGY9cihjKSxoPW4oMCkscD1yKGgpLGQ9bigzKSx5PXIoZCksdj1uKDUpLGI9cih2KSxnPW4oOCksbT1yKGcpLF89ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSgpe3JldHVybiBvKHRoaXMsZSksaSh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5hcHBseSh0aGlzLGFyZ3VtZW50cykpfXJldHVybiBsKGUsdCksZX0oYi5kZWZhdWx0KTtfLmJsb3ROYW1lPSJjb2RlIixfLnRhZ05hbWU9IkNPREUiO3ZhciBPPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXtyZXR1cm4gbyh0aGlzLGUpLGkodGhpcywoZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSkuYXBwbHkodGhpcyxhcmd1bWVudHMpKX1yZXR1cm4gbChlLHQpLHMoZSxbe2tleToiZGVsdGEiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcyxlPXRoaXMuZG9tTm9kZS50ZXh0Q29udGVudDtyZXR1cm4gZS5lbmRzV2l0aCgiXG4iKSYmKGU9ZS5zbGljZSgwLC0xKSksZS5zcGxpdCgiXG4iKS5yZWR1Y2UoZnVuY3Rpb24oZSxuKXtyZXR1cm4gZS5pbnNlcnQobikuaW5zZXJ0KCJcbiIsdC5mb3JtYXRzKCkpfSxuZXcgZi5kZWZhdWx0KX19LHtrZXk6ImZvcm1hdCIsdmFsdWU6ZnVuY3Rpb24odCxuKXtpZih0IT09dGhpcy5zdGF0aWNzLmJsb3ROYW1lfHwhbil7dmFyIHI9dGhpcy5kZXNjZW5kYW50KG0uZGVmYXVsdCx0aGlzLmxlbmd0aCgpLTEpLG89YShyLDEpLGk9b1swXTtudWxsIT1pJiZpLmRlbGV0ZUF0KGkubGVuZ3RoKCktMSwxKSx1KGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwiZm9ybWF0Iix0aGlzKS5jYWxsKHRoaXMsdCxuKX19fSx7a2V5OiJmb3JtYXRBdCIsdmFsdWU6ZnVuY3Rpb24odCxuLHIsbyl7aWYoMCE9PW4mJm51bGwhPXAuZGVmYXVsdC5xdWVyeShyLHAuZGVmYXVsdC5TY29wZS5CTE9DSykmJihyIT09dGhpcy5zdGF0aWNzLmJsb3ROYW1lfHxvIT09dGhpcy5zdGF0aWNzLmZvcm1hdHModGhpcy5kb21Ob2RlKSkpe3ZhciBpPXRoaXMubmV3bGluZUluZGV4KHQpO2lmKCEoaTwwfHxpPj10K24pKXt2YXIgbD10aGlzLm5ld2xpbmVJbmRleCh0LCEwKSsxLGE9aS1sKzEscz10aGlzLmlzb2xhdGUobCxhKSx1PXMubmV4dDtzLmZvcm1hdChyLG8pLHUgaW5zdGFuY2VvZiBlJiZ1LmZvcm1hdEF0KDAsdC1sK24tYSxyLG8pfX19fSx7a2V5OiJpbnNlcnRBdCIsdmFsdWU6ZnVuY3Rpb24odCxlLG4pe2lmKG51bGw9PW4pe3ZhciByPXRoaXMuZGVzY2VuZGFudChtLmRlZmF1bHQsdCksbz1hKHIsMiksaT1vWzBdLGw9b1sxXTtpLmluc2VydEF0KGwsZSl9fX0se2tleToibGVuZ3RoIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZG9tTm9kZS50ZXh0Q29udGVudC5sZW5ndGg7cmV0dXJuIHRoaXMuZG9tTm9kZS50ZXh0Q29udGVudC5lbmRzV2l0aCgiXG4iKT90OnQrMX19LHtrZXk6Im5ld2xpbmVJbmRleCIsdmFsdWU6ZnVuY3Rpb24odCl7aWYoYXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0mJmFyZ3VtZW50c1sxXSlyZXR1cm4gdGhpcy5kb21Ob2RlLnRleHRDb250ZW50LnNsaWNlKDAsdCkubGFzdEluZGV4T2YoIlxuIik7dmFyIGU9dGhpcy5kb21Ob2RlLnRleHRDb250ZW50LnNsaWNlKHQpLmluZGV4T2YoIlxuIik7cmV0dXJuIGU+LTE/dCtlOi0xfX0se2tleToib3B0aW1pemUiLHZhbHVlOmZ1bmN0aW9uKHQpe3RoaXMuZG9tTm9kZS50ZXh0Q29udGVudC5lbmRzV2l0aCgiXG4iKXx8dGhpcy5hcHBlbmRDaGlsZChwLmRlZmF1bHQuY3JlYXRlKCJ0ZXh0IiwiXG4iKSksdShlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksIm9wdGltaXplIix0aGlzKS5jYWxsKHRoaXMsdCk7dmFyIG49dGhpcy5uZXh0O251bGwhPW4mJm4ucHJldj09PXRoaXMmJm4uc3RhdGljcy5ibG90TmFtZT09PXRoaXMuc3RhdGljcy5ibG90TmFtZSYmdGhpcy5zdGF0aWNzLmZvcm1hdHModGhpcy5kb21Ob2RlKT09PW4uc3RhdGljcy5mb3JtYXRzKG4uZG9tTm9kZSkmJihuLm9wdGltaXplKHQpLG4ubW92ZUNoaWxkcmVuKHRoaXMpLG4ucmVtb3ZlKCkpfX0se2tleToicmVwbGFjZSIsdmFsdWU6ZnVuY3Rpb24odCl7dShlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksInJlcGxhY2UiLHRoaXMpLmNhbGwodGhpcyx0KSxbXS5zbGljZS5jYWxsKHRoaXMuZG9tTm9kZS5xdWVyeVNlbGVjdG9yQWxsKCIqIikpLmZvckVhY2goZnVuY3Rpb24odCl7dmFyIGU9cC5kZWZhdWx0LmZpbmQodCk7bnVsbD09ZT90LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodCk6ZSBpbnN0YW5jZW9mIHAuZGVmYXVsdC5FbWJlZD9lLnJlbW92ZSgpOmUudW53cmFwKCl9KX19XSxbe2tleToiY3JlYXRlIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgbj11KGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSksImNyZWF0ZSIsdGhpcykuY2FsbCh0aGlzLHQpO3JldHVybiBuLnNldEF0dHJpYnV0ZSgic3BlbGxjaGVjayIsITEpLG59fSx7a2V5OiJmb3JtYXRzIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiEwfX1dKSxlfSh5LmRlZmF1bHQpO08uYmxvdE5hbWU9ImNvZGUtYmxvY2siLE8udGFnTmFtZT0iUFJFIixPLlRBQj0iICAiLGUuQ29kZT1fLGUuZGVmYXVsdD1PfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBvKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gaSh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBsPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lW25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsci5rZXkscil9fXJldHVybiBmdW5jdGlvbihlLG4scil7cmV0dXJuIG4mJnQoZS5wcm90b3R5cGUsbiksciYmdChlLHIpLGV9fSgpLGE9ZnVuY3Rpb24gdChlLG4scil7bnVsbD09PWUmJihlPUZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIG89T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLG4pO2lmKHZvaWQgMD09PW8pe3ZhciBpPU9iamVjdC5nZXRQcm90b3R5cGVPZihlKTtyZXR1cm4gbnVsbD09PWk/dm9pZCAwOnQoaSxuLHIpfWlmKCJ2YWx1ZSJpbiBvKXJldHVybiBvLnZhbHVlO3ZhciBsPW8uZ2V0O2lmKHZvaWQgMCE9PWwpcmV0dXJuIGwuY2FsbChyKX0scz1uKDApLHU9ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fShzKSxjPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXtyZXR1cm4gcih0aGlzLGUpLG8odGhpcywoZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSkuYXBwbHkodGhpcyxhcmd1bWVudHMpKX1yZXR1cm4gaShlLHQpLGwoZSxbe2tleToiaW5zZXJ0SW50byIsdmFsdWU6ZnVuY3Rpb24odCxuKXswPT09dC5jaGlsZHJlbi5sZW5ndGg/YShlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksImluc2VydEludG8iLHRoaXMpLmNhbGwodGhpcyx0LG4pOnRoaXMucmVtb3ZlKCl9fSx7a2V5OiJsZW5ndGgiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIDB9fSx7a2V5OiJ2YWx1ZSIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4iIn19XSxbe2tleToidmFsdWUiLHZhbHVlOmZ1bmN0aW9uKCl7fX1dKSxlfSh1LmRlZmF1bHQuRW1iZWQpO2MuYmxvdE5hbWU9ImJyZWFrIixjLnRhZ05hbWU9IkJSIixlLmRlZmF1bHQ9Y30sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiByKHQsZSl7aWYoISh0IGluc3RhbmNlb2YgZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIil9ZnVuY3Rpb24gbyh0LGUpe2lmKCF0KXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7cmV0dXJuIWV8fCJvYmplY3QiIT10eXBlb2YgZSYmImZ1bmN0aW9uIiE9dHlwZW9mIGU/dDplfWZ1bmN0aW9uIGkodCxlKXtpZigiZnVuY3Rpb24iIT10eXBlb2YgZSYmbnVsbCE9PWUpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiK3R5cGVvZiBlKTt0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGUmJmUucHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6dCxlbnVtZXJhYmxlOiExLHdyaXRhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH19KSxlJiYoT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0LGUpOnQuX19wcm90b19fPWUpfWZ1bmN0aW9uIGwodCxlKXt2YXIgbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7bi5ocmVmPXQ7dmFyIHI9bi5ocmVmLnNsaWNlKDAsbi5ocmVmLmluZGV4T2YoIjoiKSk7cmV0dXJuIGUuaW5kZXhPZihyKT4tMX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksZS5zYW5pdGl6ZT1lLmRlZmF1bHQ9dm9pZCAwO3ZhciBhPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lW25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsci5rZXkscil9fXJldHVybiBmdW5jdGlvbihlLG4scil7cmV0dXJuIG4mJnQoZS5wcm90b3R5cGUsbiksciYmdChlLHIpLGV9fSgpLHM9ZnVuY3Rpb24gdChlLG4scil7bnVsbD09PWUmJihlPUZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIG89T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLG4pO2lmKHZvaWQgMD09PW8pe3ZhciBpPU9iamVjdC5nZXRQcm90b3R5cGVPZihlKTtyZXR1cm4gbnVsbD09PWk/dm9pZCAwOnQoaSxuLHIpfWlmKCJ2YWx1ZSJpbiBvKXJldHVybiBvLnZhbHVlO3ZhciBsPW8uZ2V0O2lmKHZvaWQgMCE9PWwpcmV0dXJuIGwuY2FsbChyKX0sdT1uKDUpLGM9ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fSh1KSxmPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXtyZXR1cm4gcih0aGlzLGUpLG8odGhpcywoZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSkuYXBwbHkodGhpcyxhcmd1bWVudHMpKX1yZXR1cm4gaShlLHQpLGEoZSxbe2tleToiZm9ybWF0Iix2YWx1ZTpmdW5jdGlvbih0LG4pe2lmKHQhPT10aGlzLnN0YXRpY3MuYmxvdE5hbWV8fCFuKXJldHVybiBzKGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwiZm9ybWF0Iix0aGlzKS5jYWxsKHRoaXMsdCxuKTtuPXRoaXMuY29uc3RydWN0b3Iuc2FuaXRpemUobiksdGhpcy5kb21Ob2RlLnNldEF0dHJpYnV0ZSgiaHJlZiIsbil9fV0sW3trZXk6ImNyZWF0ZSIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIG49cyhlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpLCJjcmVhdGUiLHRoaXMpLmNhbGwodGhpcyx0KTtyZXR1cm4gdD10aGlzLnNhbml0aXplKHQpLG4uc2V0QXR0cmlidXRlKCJocmVmIix0KSxuLnNldEF0dHJpYnV0ZSgidGFyZ2V0IiwiX2JsYW5rIiksbn19LHtrZXk6ImZvcm1hdHMiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiB0LmdldEF0dHJpYnV0ZSgiaHJlZiIpfX0se2tleToic2FuaXRpemUiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBsKHQsdGhpcy5QUk9UT0NPTF9XSElURUxJU1QpP3Q6dGhpcy5TQU5JVElaRURfVVJMfX1dKSxlfShjLmRlZmF1bHQpO2YuYmxvdE5hbWU9ImxpbmsiLGYudGFnTmFtZT0iQSIsZi5TQU5JVElaRURfVVJMPSJhYm91dDpibGFuayIsZi5QUk9UT0NPTF9XSElURUxJU1Q9WyJodHRwIiwiaHR0cHMiLCJtYWlsdG8iLCJ0ZWwiXSxlLmRlZmF1bHQ9ZixlLnNhbml0aXplPWx9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19ZnVuY3Rpb24gbyh0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIGkodCxlKXt0LnNldEF0dHJpYnV0ZShlLCEoInRydWUiPT09dC5nZXRBdHRyaWJ1dGUoZSkpKX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIGw9ImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmInN5bWJvbCI9PXR5cGVvZiBTeW1ib2wuaXRlcmF0b3I/ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0fTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmdC5jb25zdHJ1Y3Rvcj09PVN5bWJvbCYmdCE9PVN5bWJvbC5wcm90b3R5cGU/InN5bWJvbCI6dHlwZW9mIHR9LGE9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQsZSl7Zm9yKHZhciBuPTA7bjxlLmxlbmd0aDtuKyspe3ZhciByPWVbbl07ci5lbnVtZXJhYmxlPXIuZW51bWVyYWJsZXx8ITEsci5jb25maWd1cmFibGU9ITAsInZhbHVlImluIHImJihyLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCxyLmtleSxyKX19cmV0dXJuIGZ1bmN0aW9uKGUsbixyKXtyZXR1cm4gbiYmdChlLnByb3RvdHlwZSxuKSxyJiZ0KGUsciksZX19KCkscz1uKDI1KSx1PXIocyksYz1uKDEwNiksZj1yKGMpLGg9MCxwPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdChlKXt2YXIgbj10aGlzO28odGhpcyx0KSx0aGlzLnNlbGVjdD1lLHRoaXMuY29udGFpbmVyPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKSx0aGlzLmJ1aWxkUGlja2VyKCksdGhpcy5zZWxlY3Quc3R5bGUuZGlzcGxheT0ibm9uZSIsdGhpcy5zZWxlY3QucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5jb250YWluZXIsdGhpcy5zZWxlY3QpLHRoaXMubGFiZWwuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIixmdW5jdGlvbigpe24udG9nZ2xlUGlja2VyKCl9KSx0aGlzLmxhYmVsLmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLGZ1bmN0aW9uKHQpe3N3aXRjaCh0LmtleUNvZGUpe2Nhc2UgdS5kZWZhdWx0LmtleXMuRU5URVI6bi50b2dnbGVQaWNrZXIoKTticmVhaztjYXNlIHUuZGVmYXVsdC5rZXlzLkVTQ0FQRTpuLmVzY2FwZSgpLHQucHJldmVudERlZmF1bHQoKX19KSx0aGlzLnNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLHRoaXMudXBkYXRlLmJpbmQodGhpcykpfXJldHVybiBhKHQsW3trZXk6InRvZ2dsZVBpY2tlciIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCJxbC1leHBhbmRlZCIpLGkodGhpcy5sYWJlbCwiYXJpYS1leHBhbmRlZCIpLGkodGhpcy5vcHRpb25zLCJhcmlhLWhpZGRlbiIpfX0se2tleToiYnVpbGRJdGVtIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLG49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpO3JldHVybiBuLnRhYkluZGV4PSIwIixuLnNldEF0dHJpYnV0ZSgicm9sZSIsImJ1dHRvbiIpLG4uY2xhc3NMaXN0LmFkZCgicWwtcGlja2VyLWl0ZW0iKSx0Lmhhc0F0dHJpYnV0ZSgidmFsdWUiKSYmbi5zZXRBdHRyaWJ1dGUoImRhdGEtdmFsdWUiLHQuZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpKSx0LnRleHRDb250ZW50JiZuLnNldEF0dHJpYnV0ZSgiZGF0YS1sYWJlbCIsdC50ZXh0Q29udGVudCksbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsZnVuY3Rpb24oKXtlLnNlbGVjdEl0ZW0obiwhMCl9KSxuLmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLGZ1bmN0aW9uKHQpe3N3aXRjaCh0LmtleUNvZGUpe2Nhc2UgdS5kZWZhdWx0LmtleXMuRU5URVI6ZS5zZWxlY3RJdGVtKG4sITApLHQucHJldmVudERlZmF1bHQoKTticmVhaztjYXNlIHUuZGVmYXVsdC5rZXlzLkVTQ0FQRTplLmVzY2FwZSgpLHQucHJldmVudERlZmF1bHQoKX19KSxufX0se2tleToiYnVpbGRMYWJlbCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7cmV0dXJuIHQuY2xhc3NMaXN0LmFkZCgicWwtcGlja2VyLWxhYmVsIiksdC5pbm5lckhUTUw9Zi5kZWZhdWx0LHQudGFiSW5kZXg9IjAiLHQuc2V0QXR0cmlidXRlKCJyb2xlIiwiYnV0dG9uIiksdC5zZXRBdHRyaWJ1dGUoImFyaWEtZXhwYW5kZWQiLCJmYWxzZSIpLHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHQpLHR9fSx7a2V5OiJidWlsZE9wdGlvbnMiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcyxlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTtlLmNsYXNzTGlzdC5hZGQoInFsLXBpY2tlci1vcHRpb25zIiksZS5zZXRBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIiwidHJ1ZSIpLGUudGFiSW5kZXg9Ii0xIixlLmlkPSJxbC1waWNrZXItb3B0aW9ucy0iK2gsaCs9MSx0aGlzLmxhYmVsLnNldEF0dHJpYnV0ZSgiYXJpYS1jb250cm9scyIsZS5pZCksdGhpcy5vcHRpb25zPWUsW10uc2xpY2UuY2FsbCh0aGlzLnNlbGVjdC5vcHRpb25zKS5mb3JFYWNoKGZ1bmN0aW9uKG4pe3ZhciByPXQuYnVpbGRJdGVtKG4pO2UuYXBwZW5kQ2hpbGQociksITA9PT1uLnNlbGVjdGVkJiZ0LnNlbGVjdEl0ZW0ocil9KSx0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZChlKX19LHtrZXk6ImJ1aWxkUGlja2VyIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXM7W10uc2xpY2UuY2FsbCh0aGlzLnNlbGVjdC5hdHRyaWJ1dGVzKS5mb3JFYWNoKGZ1bmN0aW9uKGUpe3QuY29udGFpbmVyLnNldEF0dHJpYnV0ZShlLm5hbWUsZS52YWx1ZSl9KSx0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJxbC1waWNrZXIiKSx0aGlzLmxhYmVsPXRoaXMuYnVpbGRMYWJlbCgpLHRoaXMuYnVpbGRPcHRpb25zKCl9fSx7a2V5OiJlc2NhcGUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpczt0aGlzLmNsb3NlKCksc2V0VGltZW91dChmdW5jdGlvbigpe3JldHVybiB0LmxhYmVsLmZvY3VzKCl9LDEpfX0se2tleToiY2xvc2UiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgicWwtZXhwYW5kZWQiKSx0aGlzLmxhYmVsLnNldEF0dHJpYnV0ZSgiYXJpYS1leHBhbmRlZCIsImZhbHNlIiksdGhpcy5vcHRpb25zLnNldEF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iLCJ0cnVlIil9fSx7a2V5OiJzZWxlY3RJdGVtIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgZT1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXSYmYXJndW1lbnRzWzFdLG49dGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvcigiLnFsLXNlbGVjdGVkIik7aWYodCE9PW4mJihudWxsIT1uJiZuLmNsYXNzTGlzdC5yZW1vdmUoInFsLXNlbGVjdGVkIiksbnVsbCE9dCYmKHQuY2xhc3NMaXN0LmFkZCgicWwtc2VsZWN0ZWQiKSx0aGlzLnNlbGVjdC5zZWxlY3RlZEluZGV4PVtdLmluZGV4T2YuY2FsbCh0LnBhcmVudE5vZGUuY2hpbGRyZW4sdCksdC5oYXNBdHRyaWJ1dGUoImRhdGEtdmFsdWUiKT90aGlzLmxhYmVsLnNldEF0dHJpYnV0ZSgiZGF0YS12YWx1ZSIsdC5nZXRBdHRyaWJ1dGUoImRhdGEtdmFsdWUiKSk6dGhpcy5sYWJlbC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtdmFsdWUiKSx0Lmhhc0F0dHJpYnV0ZSgiZGF0YS1sYWJlbCIpP3RoaXMubGFiZWwuc2V0QXR0cmlidXRlKCJkYXRhLWxhYmVsIix0LmdldEF0dHJpYnV0ZSgiZGF0YS1sYWJlbCIpKTp0aGlzLmxhYmVsLnJlbW92ZUF0dHJpYnV0ZSgiZGF0YS1sYWJlbCIpLGUpKSl7aWYoImZ1bmN0aW9uIj09dHlwZW9mIEV2ZW50KXRoaXMuc2VsZWN0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJjaGFuZ2UiKSk7ZWxzZSBpZigib2JqZWN0Ij09PSgidW5kZWZpbmVkIj09dHlwZW9mIEV2ZW50PyJ1bmRlZmluZWQiOmwoRXZlbnQpKSl7dmFyIHI9ZG9jdW1lbnQuY3JlYXRlRXZlbnQoIkV2ZW50Iik7ci5pbml0RXZlbnQoImNoYW5nZSIsITAsITApLHRoaXMuc2VsZWN0LmRpc3BhdGNoRXZlbnQocil9dGhpcy5jbG9zZSgpfX19LHtrZXk6InVwZGF0ZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD12b2lkIDA7aWYodGhpcy5zZWxlY3Quc2VsZWN0ZWRJbmRleD4tMSl7dmFyIGU9dGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvcigiLnFsLXBpY2tlci1vcHRpb25zIikuY2hpbGRyZW5bdGhpcy5zZWxlY3Quc2VsZWN0ZWRJbmRleF07dD10aGlzLnNlbGVjdC5vcHRpb25zW3RoaXMuc2VsZWN0LnNlbGVjdGVkSW5kZXhdLHRoaXMuc2VsZWN0SXRlbShlKX1lbHNlIHRoaXMuc2VsZWN0SXRlbShudWxsKTt2YXIgbj1udWxsIT10JiZ0IT09dGhpcy5zZWxlY3QucXVlcnlTZWxlY3Rvcigib3B0aW9uW3NlbGVjdGVkXSIpO3RoaXMubGFiZWwuY2xhc3NMaXN0LnRvZ2dsZSgicWwtYWN0aXZlIixuKX19XSksdH0oKTtlLmRlZmF1bHQ9cH0sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiByKHQpe3ZhciBlPWEuZmluZCh0KTtpZihudWxsPT1lKXRyeXtlPWEuY3JlYXRlKHQpfWNhdGNoKG4pe2U9YS5jcmVhdGUoYS5TY29wZS5JTkxJTkUpLFtdLnNsaWNlLmNhbGwodC5jaGlsZE5vZGVzKS5mb3JFYWNoKGZ1bmN0aW9uKHQpe2UuZG9tTm9kZS5hcHBlbmRDaGlsZCh0KX0pLHQucGFyZW50Tm9kZSYmdC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChlLmRvbU5vZGUsdCksZS5hdHRhY2goKX1yZXR1cm4gZX12YXIgbz10aGlzJiZ0aGlzLl9fZXh0ZW5kc3x8ZnVuY3Rpb24oKXt2YXIgdD1PYmplY3Quc2V0UHJvdG90eXBlT2Z8fHtfX3Byb3RvX186W119aW5zdGFuY2VvZiBBcnJheSYmZnVuY3Rpb24odCxlKXt0Ll9fcHJvdG9fXz1lfXx8ZnVuY3Rpb24odCxlKXtmb3IodmFyIG4gaW4gZSllLmhhc093blByb3BlcnR5KG4pJiYodFtuXT1lW25dKX07cmV0dXJuIGZ1bmN0aW9uKGUsbil7ZnVuY3Rpb24gcigpe3RoaXMuY29uc3RydWN0b3I9ZX10KGUsbiksZS5wcm90b3R5cGU9bnVsbD09PW4/T2JqZWN0LmNyZWF0ZShuKTooci5wcm90b3R5cGU9bi5wcm90b3R5cGUsbmV3IHIpfX0oKTtPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIGk9big0NyksbD1uKDI3KSxhPW4oMSkscz1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKGUpe3ZhciBuPXQuY2FsbCh0aGlzLGUpfHx0aGlzO3JldHVybiBuLmJ1aWxkKCksbn1yZXR1cm4gbyhlLHQpLGUucHJvdG90eXBlLmFwcGVuZENoaWxkPWZ1bmN0aW9uKHQpe3RoaXMuaW5zZXJ0QmVmb3JlKHQpfSxlLnByb3RvdHlwZS5hdHRhY2g9ZnVuY3Rpb24oKXt0LnByb3RvdHlwZS5hdHRhY2guY2FsbCh0aGlzKSx0aGlzLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24odCl7dC5hdHRhY2goKX0pfSxlLnByb3RvdHlwZS5idWlsZD1mdW5jdGlvbigpe3ZhciB0PXRoaXM7dGhpcy5jaGlsZHJlbj1uZXcgaS5kZWZhdWx0LFtdLnNsaWNlLmNhbGwodGhpcy5kb21Ob2RlLmNoaWxkTm9kZXMpLnJldmVyc2UoKS5mb3JFYWNoKGZ1bmN0aW9uKGUpe3RyeXt2YXIgbj1yKGUpO3QuaW5zZXJ0QmVmb3JlKG4sdC5jaGlsZHJlbi5oZWFkfHx2b2lkIDApfWNhdGNoKHQpe2lmKHQgaW5zdGFuY2VvZiBhLlBhcmNobWVudEVycm9yKXJldHVybjt0aHJvdyB0fX0pfSxlLnByb3RvdHlwZS5kZWxldGVBdD1mdW5jdGlvbih0LGUpe2lmKDA9PT10JiZlPT09dGhpcy5sZW5ndGgoKSlyZXR1cm4gdGhpcy5yZW1vdmUoKTt0aGlzLmNoaWxkcmVuLmZvckVhY2hBdCh0LGUsZnVuY3Rpb24odCxlLG4pe3QuZGVsZXRlQXQoZSxuKX0pfSxlLnByb3RvdHlwZS5kZXNjZW5kYW50PWZ1bmN0aW9uKHQsbil7dmFyIHI9dGhpcy5jaGlsZHJlbi5maW5kKG4pLG89clswXSxpPXJbMV07cmV0dXJuIG51bGw9PXQuYmxvdE5hbWUmJnQobyl8fG51bGwhPXQuYmxvdE5hbWUmJm8gaW5zdGFuY2VvZiB0P1tvLGldOm8gaW5zdGFuY2VvZiBlP28uZGVzY2VuZGFudCh0LGkpOltudWxsLC0xXX0sZS5wcm90b3R5cGUuZGVzY2VuZGFudHM9ZnVuY3Rpb24odCxuLHIpe3ZvaWQgMD09PW4mJihuPTApLHZvaWQgMD09PXImJihyPU51bWJlci5NQVhfVkFMVUUpO3ZhciBvPVtdLGk9cjtyZXR1cm4gdGhpcy5jaGlsZHJlbi5mb3JFYWNoQXQobixyLGZ1bmN0aW9uKG4scixsKXsobnVsbD09dC5ibG90TmFtZSYmdChuKXx8bnVsbCE9dC5ibG90TmFtZSYmbiBpbnN0YW5jZW9mIHQpJiZvLnB1c2gobiksbiBpbnN0YW5jZW9mIGUmJihvPW8uY29uY2F0KG4uZGVzY2VuZGFudHModCxyLGkpKSksaS09bH0pLG99LGUucHJvdG90eXBlLmRldGFjaD1mdW5jdGlvbigpe3RoaXMuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbih0KXt0LmRldGFjaCgpfSksdC5wcm90b3R5cGUuZGV0YWNoLmNhbGwodGhpcyl9LGUucHJvdG90eXBlLmZvcm1hdEF0PWZ1bmN0aW9uKHQsZSxuLHIpe3RoaXMuY2hpbGRyZW4uZm9yRWFjaEF0KHQsZSxmdW5jdGlvbih0LGUsbyl7dC5mb3JtYXRBdChlLG8sbixyKX0pfSxlLnByb3RvdHlwZS5pbnNlcnRBdD1mdW5jdGlvbih0LGUsbil7dmFyIHI9dGhpcy5jaGlsZHJlbi5maW5kKHQpLG89clswXSxpPXJbMV07aWYobylvLmluc2VydEF0KGksZSxuKTtlbHNle3ZhciBsPW51bGw9PW4/YS5jcmVhdGUoInRleHQiLGUpOmEuY3JlYXRlKGUsbik7dGhpcy5hcHBlbmRDaGlsZChsKX19LGUucHJvdG90eXBlLmluc2VydEJlZm9yZT1mdW5jdGlvbih0LGUpe2lmKG51bGwhPXRoaXMuc3RhdGljcy5hbGxvd2VkQ2hpbGRyZW4mJiF0aGlzLnN0YXRpY3MuYWxsb3dlZENoaWxkcmVuLnNvbWUoZnVuY3Rpb24oZSl7cmV0dXJuIHQgaW5zdGFuY2VvZiBlfSkpdGhyb3cgbmV3IGEuUGFyY2htZW50RXJyb3IoIkNhbm5vdCBpbnNlcnQgIit0LnN0YXRpY3MuYmxvdE5hbWUrIiBpbnRvICIrdGhpcy5zdGF0aWNzLmJsb3ROYW1lKTt0Lmluc2VydEludG8odGhpcyxlKX0sZS5wcm90b3R5cGUubGVuZ3RoPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY2hpbGRyZW4ucmVkdWNlKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQrZS5sZW5ndGgoKX0sMCl9LGUucHJvdG90eXBlLm1vdmVDaGlsZHJlbj1mdW5jdGlvbih0LGUpe3RoaXMuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihuKXt0Lmluc2VydEJlZm9yZShuLGUpfSl9LGUucHJvdG90eXBlLm9wdGltaXplPWZ1bmN0aW9uKGUpe2lmKHQucHJvdG90eXBlLm9wdGltaXplLmNhbGwodGhpcyxlKSwwPT09dGhpcy5jaGlsZHJlbi5sZW5ndGgpaWYobnVsbCE9dGhpcy5zdGF0aWNzLmRlZmF1bHRDaGlsZCl7dmFyIG49YS5jcmVhdGUodGhpcy5zdGF0aWNzLmRlZmF1bHRDaGlsZCk7dGhpcy5hcHBlbmRDaGlsZChuKSxuLm9wdGltaXplKGUpfWVsc2UgdGhpcy5yZW1vdmUoKX0sZS5wcm90b3R5cGUucGF0aD1mdW5jdGlvbih0LG4pe3ZvaWQgMD09PW4mJihuPSExKTt2YXIgcj10aGlzLmNoaWxkcmVuLmZpbmQodCxuKSxvPXJbMF0saT1yWzFdLGw9W1t0aGlzLHRdXTtyZXR1cm4gbyBpbnN0YW5jZW9mIGU/bC5jb25jYXQoby5wYXRoKGksbikpOihudWxsIT1vJiZsLnB1c2goW28saV0pLGwpfSxlLnByb3RvdHlwZS5yZW1vdmVDaGlsZD1mdW5jdGlvbih0KXt0aGlzLmNoaWxkcmVuLnJlbW92ZSh0KX0sZS5wcm90b3R5cGUucmVwbGFjZT1mdW5jdGlvbihuKXtuIGluc3RhbmNlb2YgZSYmbi5tb3ZlQ2hpbGRyZW4odGhpcyksdC5wcm90b3R5cGUucmVwbGFjZS5jYWxsKHRoaXMsbil9LGUucHJvdG90eXBlLnNwbGl0PWZ1bmN0aW9uKHQsZSl7aWYodm9pZCAwPT09ZSYmKGU9ITEpLCFlKXtpZigwPT09dClyZXR1cm4gdGhpcztpZih0PT09dGhpcy5sZW5ndGgoKSlyZXR1cm4gdGhpcy5uZXh0fXZhciBuPXRoaXMuY2xvbmUoKTtyZXR1cm4gdGhpcy5wYXJlbnQuaW5zZXJ0QmVmb3JlKG4sdGhpcy5uZXh0KSx0aGlzLmNoaWxkcmVuLmZvckVhY2hBdCh0LHRoaXMubGVuZ3RoKCksZnVuY3Rpb24odCxyLG8pe3Q9dC5zcGxpdChyLGUpLG4uYXBwZW5kQ2hpbGQodCl9KSxufSxlLnByb3RvdHlwZS51bndyYXA9ZnVuY3Rpb24oKXt0aGlzLm1vdmVDaGlsZHJlbih0aGlzLnBhcmVudCx0aGlzLm5leHQpLHRoaXMucmVtb3ZlKCl9LGUucHJvdG90eXBlLnVwZGF0ZT1mdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMsbz1bXSxpPVtdO3QuZm9yRWFjaChmdW5jdGlvbih0KXt0LnRhcmdldD09PW4uZG9tTm9kZSYmImNoaWxkTGlzdCI9PT10LnR5cGUmJihvLnB1c2guYXBwbHkobyx0LmFkZGVkTm9kZXMpLGkucHVzaC5hcHBseShpLHQucmVtb3ZlZE5vZGVzKSl9KSxpLmZvckVhY2goZnVuY3Rpb24odCl7aWYoIShudWxsIT10LnBhcmVudE5vZGUmJiJJRlJBTUUiIT09dC50YWdOYW1lJiZkb2N1bWVudC5ib2R5LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKHQpJk5vZGUuRE9DVU1FTlRfUE9TSVRJT05fQ09OVEFJTkVEX0JZKSl7dmFyIGU9YS5maW5kKHQpO251bGwhPWUmJihudWxsIT1lLmRvbU5vZGUucGFyZW50Tm9kZSYmZS5kb21Ob2RlLnBhcmVudE5vZGUhPT1uLmRvbU5vZGV8fGUuZGV0YWNoKCkpfX0pLG8uZmlsdGVyKGZ1bmN0aW9uKHQpe3JldHVybiB0LnBhcmVudE5vZGU9PW4uZG9tTm9kZX0pLnNvcnQoZnVuY3Rpb24odCxlKXtyZXR1cm4gdD09PWU/MDp0LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGUpJk5vZGUuRE9DVU1FTlRfUE9TSVRJT05fRk9MTE9XSU5HPzE6LTF9KS5mb3JFYWNoKGZ1bmN0aW9uKHQpe3ZhciBlPW51bGw7bnVsbCE9dC5uZXh0U2libGluZyYmKGU9YS5maW5kKHQubmV4dFNpYmxpbmcpKTt2YXIgbz1yKHQpO28ubmV4dD09ZSYmbnVsbCE9by5uZXh0fHwobnVsbCE9by5wYXJlbnQmJm8ucGFyZW50LnJlbW92ZUNoaWxkKG4pLG4uaW5zZXJ0QmVmb3JlKG8sZXx8dm9pZCAwKSl9KX0sZX0obC5kZWZhdWx0KTtlLmRlZmF1bHQ9c30sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0Ijt2YXIgcj10aGlzJiZ0aGlzLl9fZXh0ZW5kc3x8ZnVuY3Rpb24oKXt2YXIgdD1PYmplY3Quc2V0UHJvdG90eXBlT2Z8fHtfX3Byb3RvX186W119aW5zdGFuY2VvZiBBcnJheSYmZnVuY3Rpb24odCxlKXt0Ll9fcHJvdG9fXz1lfXx8ZnVuY3Rpb24odCxlKXtmb3IodmFyIG4gaW4gZSllLmhhc093blByb3BlcnR5KG4pJiYodFtuXT1lW25dKX07cmV0dXJuIGZ1bmN0aW9uKGUsbil7ZnVuY3Rpb24gcigpe3RoaXMuY29uc3RydWN0b3I9ZX10KGUsbiksZS5wcm90b3R5cGU9bnVsbD09PW4/T2JqZWN0LmNyZWF0ZShuKTooci5wcm90b3R5cGU9bi5wcm90b3R5cGUsbmV3IHIpfX0oKTtPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIG89bigxMSksaT1uKDI4KSxsPW4oMTcpLGE9bigxKSxzPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoZSl7dmFyIG49dC5jYWxsKHRoaXMsZSl8fHRoaXM7cmV0dXJuIG4uYXR0cmlidXRlcz1uZXcgaS5kZWZhdWx0KG4uZG9tTm9kZSksbn1yZXR1cm4gcihlLHQpLGUuZm9ybWF0cz1mdW5jdGlvbih0KXtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIHRoaXMudGFnTmFtZXx8KEFycmF5LmlzQXJyYXkodGhpcy50YWdOYW1lKT90LnRhZ05hbWUudG9Mb3dlckNhc2UoKTp2b2lkIDApfSxlLnByb3RvdHlwZS5mb3JtYXQ9ZnVuY3Rpb24odCxlKXt2YXIgbj1hLnF1ZXJ5KHQpO24gaW5zdGFuY2VvZiBvLmRlZmF1bHQ/dGhpcy5hdHRyaWJ1dGVzLmF0dHJpYnV0ZShuLGUpOmUmJihudWxsPT1ufHx0PT09dGhpcy5zdGF0aWNzLmJsb3ROYW1lJiZ0aGlzLmZvcm1hdHMoKVt0XT09PWV8fHRoaXMucmVwbGFjZVdpdGgodCxlKSl9LGUucHJvdG90eXBlLmZvcm1hdHM9ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmF0dHJpYnV0ZXMudmFsdWVzKCksZT10aGlzLnN0YXRpY3MuZm9ybWF0cyh0aGlzLmRvbU5vZGUpO3JldHVybiBudWxsIT1lJiYodFt0aGlzLnN0YXRpY3MuYmxvdE5hbWVdPWUpLHR9LGUucHJvdG90eXBlLnJlcGxhY2VXaXRoPWZ1bmN0aW9uKGUsbil7dmFyIHI9dC5wcm90b3R5cGUucmVwbGFjZVdpdGguY2FsbCh0aGlzLGUsbik7cmV0dXJuIHRoaXMuYXR0cmlidXRlcy5jb3B5KHIpLHJ9LGUucHJvdG90eXBlLnVwZGF0ZT1mdW5jdGlvbihlLG4pe3ZhciByPXRoaXM7dC5wcm90b3R5cGUudXBkYXRlLmNhbGwodGhpcyxlLG4pLGUuc29tZShmdW5jdGlvbih0KXtyZXR1cm4gdC50YXJnZXQ9PT1yLmRvbU5vZGUmJiJhdHRyaWJ1dGVzIj09PXQudHlwZX0pJiZ0aGlzLmF0dHJpYnV0ZXMuYnVpbGQoKX0sZS5wcm90b3R5cGUud3JhcD1mdW5jdGlvbihuLHIpe3ZhciBvPXQucHJvdG90eXBlLndyYXAuY2FsbCh0aGlzLG4scik7cmV0dXJuIG8gaW5zdGFuY2VvZiBlJiZvLnN0YXRpY3Muc2NvcGU9PT10aGlzLnN0YXRpY3Muc2NvcGUmJnRoaXMuYXR0cmlidXRlcy5tb3ZlKG8pLG99LGV9KGwuZGVmYXVsdCk7ZS5kZWZhdWx0PXN9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7dmFyIHI9dGhpcyYmdGhpcy5fX2V4dGVuZHN8fGZ1bmN0aW9uKCl7dmFyIHQ9T2JqZWN0LnNldFByb3RvdHlwZU9mfHx7X19wcm90b19fOltdfWluc3RhbmNlb2YgQXJyYXkmJmZ1bmN0aW9uKHQsZSl7dC5fX3Byb3RvX189ZX18fGZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBuIGluIGUpZS5oYXNPd25Qcm9wZXJ0eShuKSYmKHRbbl09ZVtuXSl9O3JldHVybiBmdW5jdGlvbihlLG4pe2Z1bmN0aW9uIHIoKXt0aGlzLmNvbnN0cnVjdG9yPWV9dChlLG4pLGUucHJvdG90eXBlPW51bGw9PT1uP09iamVjdC5jcmVhdGUobik6KHIucHJvdG90eXBlPW4ucHJvdG90eXBlLG5ldyByKX19KCk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBvPW4oMjcpLGk9bigxKSxsPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXtyZXR1cm4gbnVsbCE9PXQmJnQuYXBwbHkodGhpcyxhcmd1bWVudHMpfHx0aGlzfXJldHVybiByKGUsdCksZS52YWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4hMH0sZS5wcm90b3R5cGUuaW5kZXg9ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5kb21Ob2RlPT09dHx8dGhpcy5kb21Ob2RlLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKHQpJk5vZGUuRE9DVU1FTlRfUE9TSVRJT05fQ09OVEFJTkVEX0JZP01hdGgubWluKGUsMSk6LTF9LGUucHJvdG90eXBlLnBvc2l0aW9uPWZ1bmN0aW9uKHQsZSl7dmFyIG49W10uaW5kZXhPZi5jYWxsKHRoaXMucGFyZW50LmRvbU5vZGUuY2hpbGROb2Rlcyx0aGlzLmRvbU5vZGUpO3JldHVybiB0PjAmJihuKz0xKSxbdGhpcy5wYXJlbnQuZG9tTm9kZSxuXX0sZS5wcm90b3R5cGUudmFsdWU9ZnVuY3Rpb24oKXtyZXR1cm4gdD17fSx0W3RoaXMuc3RhdGljcy5ibG90TmFtZV09dGhpcy5zdGF0aWNzLnZhbHVlKHRoaXMuZG9tTm9kZSl8fCEwLHQ7dmFyIHR9LGUuc2NvcGU9aS5TY29wZS5JTkxJTkVfQkxPVCxlfShvLmRlZmF1bHQpO2UuZGVmYXVsdD1sfSxmdW5jdGlvbih0LGUsbil7ZnVuY3Rpb24gcih0KXt0aGlzLm9wcz10LHRoaXMuaW5kZXg9MCx0aGlzLm9mZnNldD0wfXZhciBvPW4oMTIpLGk9bigyKSxsPXthdHRyaWJ1dGVzOntjb21wb3NlOmZ1bmN0aW9uKHQsZSxuKXsib2JqZWN0IiE9dHlwZW9mIHQmJih0PXt9KSwib2JqZWN0IiE9dHlwZW9mIGUmJihlPXt9KTt2YXIgcj1pKCEwLHt9LGUpO258fChyPU9iamVjdC5rZXlzKHIpLnJlZHVjZShmdW5jdGlvbih0LGUpe3JldHVybiBudWxsIT1yW2VdJiYodFtlXT1yW2VdKSx0fSx7fSkpO2Zvcih2YXIgbyBpbiB0KXZvaWQgMCE9PXRbb10mJnZvaWQgMD09PWVbb10mJihyW29dPXRbb10pO3JldHVybiBPYmplY3Qua2V5cyhyKS5sZW5ndGg+MD9yOnZvaWQgMH0sZGlmZjpmdW5jdGlvbih0LGUpeyJvYmplY3QiIT10eXBlb2YgdCYmKHQ9e30pLCJvYmplY3QiIT10eXBlb2YgZSYmKGU9e30pO3ZhciBuPU9iamVjdC5rZXlzKHQpLmNvbmNhdChPYmplY3Qua2V5cyhlKSkucmVkdWNlKGZ1bmN0aW9uKG4scil7cmV0dXJuIG8odFtyXSxlW3JdKXx8KG5bcl09dm9pZCAwPT09ZVtyXT9udWxsOmVbcl0pLG59LHt9KTtyZXR1cm4gT2JqZWN0LmtleXMobikubGVuZ3RoPjA/bjp2b2lkIDB9LHRyYW5zZm9ybTpmdW5jdGlvbih0LGUsbil7aWYoIm9iamVjdCIhPXR5cGVvZiB0KXJldHVybiBlO2lmKCJvYmplY3QiPT10eXBlb2YgZSl7aWYoIW4pcmV0dXJuIGU7dmFyIHI9T2JqZWN0LmtleXMoZSkucmVkdWNlKGZ1bmN0aW9uKG4scil7cmV0dXJuIHZvaWQgMD09PXRbcl0mJihuW3JdPWVbcl0pLG59LHt9KTtyZXR1cm4gT2JqZWN0LmtleXMocikubGVuZ3RoPjA/cjp2b2lkIDB9fX0saXRlcmF0b3I6ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyByKHQpfSxsZW5ndGg6ZnVuY3Rpb24odCl7cmV0dXJuIm51bWJlciI9PXR5cGVvZiB0LmRlbGV0ZT90LmRlbGV0ZToibnVtYmVyIj09dHlwZW9mIHQucmV0YWluP3QucmV0YWluOiJzdHJpbmciPT10eXBlb2YgdC5pbnNlcnQ/dC5pbnNlcnQubGVuZ3RoOjF9fTtyLnByb3RvdHlwZS5oYXNOZXh0PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucGVla0xlbmd0aCgpPDEvMH0sci5wcm90b3R5cGUubmV4dD1mdW5jdGlvbih0KXt0fHwodD0xLzApO3ZhciBlPXRoaXMub3BzW3RoaXMuaW5kZXhdO2lmKGUpe3ZhciBuPXRoaXMub2Zmc2V0LHI9bC5sZW5ndGgoZSk7aWYodD49ci1uPyh0PXItbix0aGlzLmluZGV4Kz0xLHRoaXMub2Zmc2V0PTApOnRoaXMub2Zmc2V0Kz10LCJudW1iZXIiPT10eXBlb2YgZS5kZWxldGUpcmV0dXJue2RlbGV0ZTp0fTt2YXIgbz17fTtyZXR1cm4gZS5hdHRyaWJ1dGVzJiYoby5hdHRyaWJ1dGVzPWUuYXR0cmlidXRlcyksIm51bWJlciI9PXR5cGVvZiBlLnJldGFpbj9vLnJldGFpbj10OiJzdHJpbmciPT10eXBlb2YgZS5pbnNlcnQ/by5pbnNlcnQ9ZS5pbnNlcnQuc3Vic3RyKG4sdCk6by5pbnNlcnQ9ZS5pbnNlcnQsb31yZXR1cm57cmV0YWluOjEvMH19LHIucHJvdG90eXBlLnBlZWs9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHNbdGhpcy5pbmRleF19LHIucHJvdG90eXBlLnBlZWtMZW5ndGg9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHNbdGhpcy5pbmRleF0/bC5sZW5ndGgodGhpcy5vcHNbdGhpcy5pbmRleF0pLXRoaXMub2Zmc2V0OjEvMH0sci5wcm90b3R5cGUucGVla1R5cGU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHNbdGhpcy5pbmRleF0/Im51bWJlciI9PXR5cGVvZiB0aGlzLm9wc1t0aGlzLmluZGV4XS5kZWxldGU/ImRlbGV0ZSI6Im51bWJlciI9PXR5cGVvZiB0aGlzLm9wc1t0aGlzLmluZGV4XS5yZXRhaW4/InJldGFpbiI6Imluc2VydCI6InJldGFpbiJ9LHQuZXhwb3J0cz1sfSxmdW5jdGlvbih0LGUpe3ZhciBuPWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHQodCxlKXtyZXR1cm4gbnVsbCE9ZSYmdCBpbnN0YW5jZW9mIGV9ZnVuY3Rpb24gZShuLHIsbyxpLGMpe2Z1bmN0aW9uIGYobixvKXtpZihudWxsPT09bilyZXR1cm4gbnVsbDtpZigwPT09bylyZXR1cm4gbjt2YXIgeSx2O2lmKCJvYmplY3QiIT10eXBlb2YgbilyZXR1cm4gbjtpZih0KG4sYSkpeT1uZXcgYTtlbHNlIGlmKHQobixzKSl5PW5ldyBzO2Vsc2UgaWYodChuLHUpKXk9bmV3IHUoZnVuY3Rpb24odCxlKXtuLnRoZW4oZnVuY3Rpb24oZSl7dChmKGUsby0xKSl9LGZ1bmN0aW9uKHQpe2UoZih0LG8tMSkpfSl9KTtlbHNlIGlmKGUuX19pc0FycmF5KG4pKXk9W107ZWxzZSBpZihlLl9faXNSZWdFeHAobikpeT1uZXcgUmVnRXhwKG4uc291cmNlLGwobikpLG4ubGFzdEluZGV4JiYoeS5sYXN0SW5kZXg9bi5sYXN0SW5kZXgpO2Vsc2UgaWYoZS5fX2lzRGF0ZShuKSl5PW5ldyBEYXRlKG4uZ2V0VGltZSgpKTtlbHNle2lmKGQmJkJ1ZmZlci5pc0J1ZmZlcihuKSlyZXR1cm4geT1uZXcgQnVmZmVyKG4ubGVuZ3RoKSxuLmNvcHkoeSkseTt0KG4sRXJyb3IpP3k9T2JqZWN0LmNyZWF0ZShuKTp2b2lkIDA9PT1pPyh2PU9iamVjdC5nZXRQcm90b3R5cGVPZihuKSx5PU9iamVjdC5jcmVhdGUodikpOih5PU9iamVjdC5jcmVhdGUoaSksdj1pKX1pZihyKXt2YXIgYj1oLmluZGV4T2Yobik7aWYoLTEhPWIpcmV0dXJuIHBbYl07aC5wdXNoKG4pLHAucHVzaCh5KX10KG4sYSkmJm4uZm9yRWFjaChmdW5jdGlvbih0LGUpe3ZhciBuPWYoZSxvLTEpLHI9Zih0LG8tMSk7eS5zZXQobixyKX0pLHQobixzKSYmbi5mb3JFYWNoKGZ1bmN0aW9uKHQpe3ZhciBlPWYodCxvLTEpO3kuYWRkKGUpfSk7Zm9yKHZhciBnIGluIG4pe3ZhciBtO3YmJihtPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodixnKSksbSYmbnVsbD09bS5zZXR8fCh5W2ddPWYobltnXSxvLTEpKX1pZihPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKWZvcih2YXIgXz1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG4pLGc9MDtnPF8ubGVuZ3RoO2crKyl7dmFyIE89X1tnXSx3PU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobixPKTsoIXd8fHcuZW51bWVyYWJsZXx8YykmJih5W09dPWYobltPXSxvLTEpLHcuZW51bWVyYWJsZXx8T2JqZWN0LmRlZmluZVByb3BlcnR5KHksTyx7ZW51bWVyYWJsZTohMX0pKX1pZihjKWZvcih2YXIgeD1PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhuKSxnPTA7Zzx4Lmxlbmd0aDtnKyspe3ZhciBrPXhbZ10sdz1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG4sayk7dyYmdy5lbnVtZXJhYmxlfHwoeVtrXT1mKG5ba10sby0xKSxPYmplY3QuZGVmaW5lUHJvcGVydHkoeSxrLHtlbnVtZXJhYmxlOiExfSkpfXJldHVybiB5fSJvYmplY3QiPT10eXBlb2YgciYmKG89ci5kZXB0aCxpPXIucHJvdG90eXBlLGM9ci5pbmNsdWRlTm9uRW51bWVyYWJsZSxyPXIuY2lyY3VsYXIpO3ZhciBoPVtdLHA9W10sZD0idW5kZWZpbmVkIiE9dHlwZW9mIEJ1ZmZlcjtyZXR1cm4gdm9pZCAwPT09ciYmKHI9ITApLHZvaWQgMD09PW8mJihvPTEvMCksZihuLG8pfWZ1bmN0aW9uIG4odCl7cmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0KX1mdW5jdGlvbiByKHQpe3JldHVybiJvYmplY3QiPT10eXBlb2YgdCYmIltvYmplY3QgRGF0ZV0iPT09bih0KX1mdW5jdGlvbiBvKHQpe3JldHVybiJvYmplY3QiPT10eXBlb2YgdCYmIltvYmplY3QgQXJyYXldIj09PW4odCl9ZnVuY3Rpb24gaSh0KXtyZXR1cm4ib2JqZWN0Ij09dHlwZW9mIHQmJiJbb2JqZWN0IFJlZ0V4cF0iPT09bih0KX1mdW5jdGlvbiBsKHQpe3ZhciBlPSIiO3JldHVybiB0Lmdsb2JhbCYmKGUrPSJnIiksdC5pZ25vcmVDYXNlJiYoZSs9ImkiKSx0Lm11bHRpbGluZSYmKGUrPSJtIiksZX12YXIgYTt0cnl7YT1NYXB9Y2F0Y2godCl7YT1mdW5jdGlvbigpe319dmFyIHM7dHJ5e3M9U2V0fWNhdGNoKHQpe3M9ZnVuY3Rpb24oKXt9fXZhciB1O3RyeXt1PVByb21pc2V9Y2F0Y2godCl7dT1mdW5jdGlvbigpe319cmV0dXJuIGUuY2xvbmVQcm90b3R5cGU9ZnVuY3Rpb24odCl7aWYobnVsbD09PXQpcmV0dXJuIG51bGw7dmFyIGU9ZnVuY3Rpb24oKXt9O3JldHVybiBlLnByb3RvdHlwZT10LG5ldyBlfSxlLl9fb2JqVG9TdHI9bixlLl9faXNEYXRlPXIsZS5fX2lzQXJyYXk9byxlLl9faXNSZWdFeHA9aSxlLl9fZ2V0UmVnRXhwRmxhZ3M9bCxlfSgpOyJvYmplY3QiPT10eXBlb2YgdCYmdC5leHBvcnRzJiYodC5leHBvcnRzPW4pfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fWZ1bmN0aW9uIG8odCl7aWYoQXJyYXkuaXNBcnJheSh0KSl7Zm9yKHZhciBlPTAsbj1BcnJheSh0Lmxlbmd0aCk7ZTx0Lmxlbmd0aDtlKyspbltlXT10W2VdO3JldHVybiBufXJldHVybiBBcnJheS5mcm9tKHQpfWZ1bmN0aW9uIGkodCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBsKHQsZSl7dHJ5e2UucGFyZW50Tm9kZX1jYXRjaCh0KXtyZXR1cm4hMX1yZXR1cm4gZSBpbnN0YW5jZW9mIFRleHQmJihlPWUucGFyZW50Tm9kZSksdC5jb250YWlucyhlKX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksZS5kZWZhdWx0PWUuUmFuZ2U9dm9pZCAwO3ZhciBhPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe3ZhciBuPVtdLHI9ITAsbz0hMSxpPXZvaWQgMDt0cnl7Zm9yKHZhciBsLGE9dFtTeW1ib2wuaXRlcmF0b3JdKCk7IShyPShsPWEubmV4dCgpKS5kb25lKSYmKG4ucHVzaChsLnZhbHVlKSwhZXx8bi5sZW5ndGghPT1lKTtyPSEwKTt9Y2F0Y2godCl7bz0hMCxpPXR9ZmluYWxseXt0cnl7IXImJmEucmV0dXJuJiZhLnJldHVybigpfWZpbmFsbHl7aWYobyl0aHJvdyBpfX1yZXR1cm4gbn1yZXR1cm4gZnVuY3Rpb24oZSxuKXtpZihBcnJheS5pc0FycmF5KGUpKXJldHVybiBlO2lmKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoZSkpcmV0dXJuIHQoZSxuKTt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIil9fSgpLHM9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQsZSl7Zm9yKHZhciBuPTA7bjxlLmxlbmd0aDtuKyspe3ZhciByPWVbbl07ci5lbnVtZXJhYmxlPXIuZW51bWVyYWJsZXx8ITEsci5jb25maWd1cmFibGU9ITAsInZhbHVlImluIHImJihyLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCxyLmtleSxyKX19cmV0dXJuIGZ1bmN0aW9uKGUsbixyKXtyZXR1cm4gbiYmdChlLnByb3RvdHlwZSxuKSxyJiZ0KGUsciksZX19KCksdT1uKDApLGM9cih1KSxmPW4oMjEpLGg9cihmKSxwPW4oMTIpLGQ9cihwKSx5PW4oOSksdj1yKHkpLGI9bigxMCksZz1yKGIpLG09KDAsZy5kZWZhdWx0KSgicXVpbGw6c2VsZWN0aW9uIiksXz1mdW5jdGlvbiB0KGUpe3ZhciBuPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTowO2kodGhpcyx0KSx0aGlzLmluZGV4PWUsdGhpcy5sZW5ndGg9bn0sTz1mdW5jdGlvbigpe2Z1bmN0aW9uIHQoZSxuKXt2YXIgcj10aGlzO2kodGhpcyx0KSx0aGlzLmVtaXR0ZXI9bix0aGlzLnNjcm9sbD1lLHRoaXMuY29tcG9zaW5nPSExLHRoaXMubW91c2VEb3duPSExLHRoaXMucm9vdD10aGlzLnNjcm9sbC5kb21Ob2RlLHRoaXMuY3Vyc29yPWMuZGVmYXVsdC5jcmVhdGUoImN1cnNvciIsdGhpcyksdGhpcy5sYXN0UmFuZ2U9dGhpcy5zYXZlZFJhbmdlPW5ldyBfKDAsMCksdGhpcy5oYW5kbGVDb21wb3NpdGlvbigpLHRoaXMuaGFuZGxlRHJhZ2dpbmcoKSx0aGlzLmVtaXR0ZXIubGlzdGVuRE9NKCJzZWxlY3Rpb25jaGFuZ2UiLGRvY3VtZW50LGZ1bmN0aW9uKCl7ci5tb3VzZURvd258fHNldFRpbWVvdXQoci51cGRhdGUuYmluZChyLHYuZGVmYXVsdC5zb3VyY2VzLlVTRVIpLDEpfSksdGhpcy5lbWl0dGVyLm9uKHYuZGVmYXVsdC5ldmVudHMuRURJVE9SX0NIQU5HRSxmdW5jdGlvbih0LGUpe3Q9PT12LmRlZmF1bHQuZXZlbnRzLlRFWFRfQ0hBTkdFJiZlLmxlbmd0aCgpPjAmJnIudXBkYXRlKHYuZGVmYXVsdC5zb3VyY2VzLlNJTEVOVCl9KSx0aGlzLmVtaXR0ZXIub24odi5kZWZhdWx0LmV2ZW50cy5TQ1JPTExfQkVGT1JFX1VQREFURSxmdW5jdGlvbigpe2lmKHIuaGFzRm9jdXMoKSl7dmFyIHQ9ci5nZXROYXRpdmVSYW5nZSgpO251bGwhPXQmJnQuc3RhcnQubm9kZSE9PXIuY3Vyc29yLnRleHROb2RlJiZyLmVtaXR0ZXIub25jZSh2LmRlZmF1bHQuZXZlbnRzLlNDUk9MTF9VUERBVEUsZnVuY3Rpb24oKXt0cnl7ci5zZXROYXRpdmVSYW5nZSh0LnN0YXJ0Lm5vZGUsdC5zdGFydC5vZmZzZXQsdC5lbmQubm9kZSx0LmVuZC5vZmZzZXQpfWNhdGNoKHQpe319KX19KSx0aGlzLmVtaXR0ZXIub24odi5kZWZhdWx0LmV2ZW50cy5TQ1JPTExfT1BUSU1JWkUsZnVuY3Rpb24odCxlKXtpZihlLnJhbmdlKXt2YXIgbj1lLnJhbmdlLG89bi5zdGFydE5vZGUsaT1uLnN0YXJ0T2Zmc2V0LGw9bi5lbmROb2RlLGE9bi5lbmRPZmZzZXQ7ci5zZXROYXRpdmVSYW5nZShvLGksbCxhKX19KSx0aGlzLnVwZGF0ZSh2LmRlZmF1bHQuc291cmNlcy5TSUxFTlQpfXJldHVybiBzKHQsW3trZXk6ImhhbmRsZUNvbXBvc2l0aW9uIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXM7dGhpcy5yb290LmFkZEV2ZW50TGlzdGVuZXIoImNvbXBvc2l0aW9uc3RhcnQiLGZ1bmN0aW9uKCl7dC5jb21wb3Npbmc9ITB9KSx0aGlzLnJvb3QuYWRkRXZlbnRMaXN0ZW5lcigiY29tcG9zaXRpb25lbmQiLGZ1bmN0aW9uKCl7aWYodC5jb21wb3Npbmc9ITEsdC5jdXJzb3IucGFyZW50KXt2YXIgZT10LmN1cnNvci5yZXN0b3JlKCk7aWYoIWUpcmV0dXJuO3NldFRpbWVvdXQoZnVuY3Rpb24oKXt0LnNldE5hdGl2ZVJhbmdlKGUuc3RhcnROb2RlLGUuc3RhcnRPZmZzZXQsZS5lbmROb2RlLGUuZW5kT2Zmc2V0KX0sMSl9fSl9fSx7a2V5OiJoYW5kbGVEcmFnZ2luZyIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzO3RoaXMuZW1pdHRlci5saXN0ZW5ET00oIm1vdXNlZG93biIsZG9jdW1lbnQuYm9keSxmdW5jdGlvbigpe3QubW91c2VEb3duPSEwfSksdGhpcy5lbWl0dGVyLmxpc3RlbkRPTSgibW91c2V1cCIsZG9jdW1lbnQuYm9keSxmdW5jdGlvbigpe3QubW91c2VEb3duPSExLHQudXBkYXRlKHYuZGVmYXVsdC5zb3VyY2VzLlVTRVIpfSl9fSx7a2V5OiJmb2N1cyIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLmhhc0ZvY3VzKCl8fCh0aGlzLnJvb3QuZm9jdXMoKSx0aGlzLnNldFJhbmdlKHRoaXMuc2F2ZWRSYW5nZSkpfX0se2tleToiZm9ybWF0Iix2YWx1ZTpmdW5jdGlvbih0LGUpe2lmKG51bGw9PXRoaXMuc2Nyb2xsLndoaXRlbGlzdHx8dGhpcy5zY3JvbGwud2hpdGVsaXN0W3RdKXt0aGlzLnNjcm9sbC51cGRhdGUoKTt2YXIgbj10aGlzLmdldE5hdGl2ZVJhbmdlKCk7aWYobnVsbCE9biYmbi5uYXRpdmUuY29sbGFwc2VkJiYhYy5kZWZhdWx0LnF1ZXJ5KHQsYy5kZWZhdWx0LlNjb3BlLkJMT0NLKSl7aWYobi5zdGFydC5ub2RlIT09dGhpcy5jdXJzb3IudGV4dE5vZGUpe3ZhciByPWMuZGVmYXVsdC5maW5kKG4uc3RhcnQubm9kZSwhMSk7aWYobnVsbD09cilyZXR1cm47aWYociBpbnN0YW5jZW9mIGMuZGVmYXVsdC5MZWFmKXt2YXIgbz1yLnNwbGl0KG4uc3RhcnQub2Zmc2V0KTtyLnBhcmVudC5pbnNlcnRCZWZvcmUodGhpcy5jdXJzb3Isbyl9ZWxzZSByLmluc2VydEJlZm9yZSh0aGlzLmN1cnNvcixuLnN0YXJ0Lm5vZGUpO3RoaXMuY3Vyc29yLmF0dGFjaCgpfXRoaXMuY3Vyc29yLmZvcm1hdCh0LGUpLHRoaXMuc2Nyb2xsLm9wdGltaXplKCksdGhpcy5zZXROYXRpdmVSYW5nZSh0aGlzLmN1cnNvci50ZXh0Tm9kZSx0aGlzLmN1cnNvci50ZXh0Tm9kZS5kYXRhLmxlbmd0aCksdGhpcy51cGRhdGUoKX19fX0se2tleToiZ2V0Qm91bmRzIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgZT1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06MCxuPXRoaXMuc2Nyb2xsLmxlbmd0aCgpO3Q9TWF0aC5taW4odCxuLTEpLGU9TWF0aC5taW4odCtlLG4tMSktdDt2YXIgcj12b2lkIDAsbz10aGlzLnNjcm9sbC5sZWFmKHQpLGk9YShvLDIpLGw9aVswXSxzPWlbMV07aWYobnVsbD09bClyZXR1cm4gbnVsbDt2YXIgdT1sLnBvc2l0aW9uKHMsITApLGM9YSh1LDIpO3I9Y1swXSxzPWNbMV07dmFyIGY9ZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtpZihlPjApe2Yuc2V0U3RhcnQocixzKTt2YXIgaD10aGlzLnNjcm9sbC5sZWFmKHQrZSkscD1hKGgsMik7aWYobD1wWzBdLHM9cFsxXSxudWxsPT1sKXJldHVybiBudWxsO3ZhciBkPWwucG9zaXRpb24ocywhMCkseT1hKGQsMik7cmV0dXJuIHI9eVswXSxzPXlbMV0sZi5zZXRFbmQocixzKSxmLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpfXZhciB2PSJsZWZ0IixiPXZvaWQgMDtyZXR1cm4gciBpbnN0YW5jZW9mIFRleHQ/KHM8ci5kYXRhLmxlbmd0aD8oZi5zZXRTdGFydChyLHMpLGYuc2V0RW5kKHIscysxKSk6KGYuc2V0U3RhcnQocixzLTEpLGYuc2V0RW5kKHIscyksdj0icmlnaHQiKSxiPWYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpOihiPWwuZG9tTm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxzPjAmJih2PSJyaWdodCIpKSx7Ym90dG9tOmIudG9wK2IuaGVpZ2h0LGhlaWdodDpiLmhlaWdodCxsZWZ0OmJbdl0scmlnaHQ6Ylt2XSx0b3A6Yi50b3Asd2lkdGg6MH19fSx7a2V5OiJnZXROYXRpdmVSYW5nZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD1kb2N1bWVudC5nZXRTZWxlY3Rpb24oKTtpZihudWxsPT10fHx0LnJhbmdlQ291bnQ8PTApcmV0dXJuIG51bGw7dmFyIGU9dC5nZXRSYW5nZUF0KDApO2lmKG51bGw9PWUpcmV0dXJuIG51bGw7dmFyIG49dGhpcy5ub3JtYWxpemVOYXRpdmUoZSk7cmV0dXJuIG0uaW5mbygiZ2V0TmF0aXZlUmFuZ2UiLG4pLG59fSx7a2V5OiJnZXRSYW5nZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmdldE5hdGl2ZVJhbmdlKCk7cmV0dXJuIG51bGw9PXQ/W251bGwsbnVsbF06W3RoaXMubm9ybWFsaXplZFRvUmFuZ2UodCksdF19fSx7a2V5OiJoYXNGb2N1cyIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gZG9jdW1lbnQuYWN0aXZlRWxlbWVudD09PXRoaXMucm9vdH19LHtrZXk6Im5vcm1hbGl6ZWRUb1JhbmdlIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLG49W1t0LnN0YXJ0Lm5vZGUsdC5zdGFydC5vZmZzZXRdXTt0Lm5hdGl2ZS5jb2xsYXBzZWR8fG4ucHVzaChbdC5lbmQubm9kZSx0LmVuZC5vZmZzZXRdKTt2YXIgcj1uLm1hcChmdW5jdGlvbih0KXt2YXIgbj1hKHQsMikscj1uWzBdLG89blsxXSxpPWMuZGVmYXVsdC5maW5kKHIsITApLGw9aS5vZmZzZXQoZS5zY3JvbGwpO3JldHVybiAwPT09bz9sOmkgaW5zdGFuY2VvZiBjLmRlZmF1bHQuQ29udGFpbmVyP2wraS5sZW5ndGgoKTpsK2kuaW5kZXgocixvKX0pLGk9TWF0aC5taW4oTWF0aC5tYXguYXBwbHkoTWF0aCxvKHIpKSx0aGlzLnNjcm9sbC5sZW5ndGgoKS0xKSxsPU1hdGgubWluLmFwcGx5KE1hdGgsW2ldLmNvbmNhdChvKHIpKSk7cmV0dXJuIG5ldyBfKGwsaS1sKX19LHtrZXk6Im5vcm1hbGl6ZU5hdGl2ZSIsdmFsdWU6ZnVuY3Rpb24odCl7aWYoIWwodGhpcy5yb290LHQuc3RhcnRDb250YWluZXIpfHwhdC5jb2xsYXBzZWQmJiFsKHRoaXMucm9vdCx0LmVuZENvbnRhaW5lcikpcmV0dXJuIG51bGw7dmFyIGU9e3N0YXJ0Ontub2RlOnQuc3RhcnRDb250YWluZXIsb2Zmc2V0OnQuc3RhcnRPZmZzZXR9LGVuZDp7bm9kZTp0LmVuZENvbnRhaW5lcixvZmZzZXQ6dC5lbmRPZmZzZXR9LG5hdGl2ZTp0fTtyZXR1cm5bZS5zdGFydCxlLmVuZF0uZm9yRWFjaChmdW5jdGlvbih0KXtmb3IodmFyIGU9dC5ub2RlLG49dC5vZmZzZXQ7IShlIGluc3RhbmNlb2YgVGV4dCkmJmUuY2hpbGROb2Rlcy5sZW5ndGg+MDspaWYoZS5jaGlsZE5vZGVzLmxlbmd0aD5uKWU9ZS5jaGlsZE5vZGVzW25dLG49MDtlbHNle2lmKGUuY2hpbGROb2Rlcy5sZW5ndGghPT1uKWJyZWFrO2U9ZS5sYXN0Q2hpbGQsbj1lIGluc3RhbmNlb2YgVGV4dD9lLmRhdGEubGVuZ3RoOmUuY2hpbGROb2Rlcy5sZW5ndGgrMX10Lm5vZGU9ZSx0Lm9mZnNldD1ufSksZX19LHtrZXk6InJhbmdlVG9OYXRpdmUiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMsbj10LmNvbGxhcHNlZD9bdC5pbmRleF06W3QuaW5kZXgsdC5pbmRleCt0Lmxlbmd0aF0scj1bXSxvPXRoaXMuc2Nyb2xsLmxlbmd0aCgpO3JldHVybiBuLmZvckVhY2goZnVuY3Rpb24odCxuKXt0PU1hdGgubWluKG8tMSx0KTt2YXIgaT12b2lkIDAsbD1lLnNjcm9sbC5sZWFmKHQpLHM9YShsLDIpLHU9c1swXSxjPXNbMV0sZj11LnBvc2l0aW9uKGMsMCE9PW4pLGg9YShmLDIpO2k9aFswXSxjPWhbMV0sci5wdXNoKGksYyl9KSxyLmxlbmd0aDwyJiYocj1yLmNvbmNhdChyKSkscn19LHtrZXk6InNjcm9sbEludG9WaWV3Iix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLmxhc3RSYW5nZTtpZihudWxsIT1lKXt2YXIgbj10aGlzLmdldEJvdW5kcyhlLmluZGV4LGUubGVuZ3RoKTtpZihudWxsIT1uKXt2YXIgcj10aGlzLnNjcm9sbC5sZW5ndGgoKS0xLG89dGhpcy5zY3JvbGwubGluZShNYXRoLm1pbihlLmluZGV4LHIpKSxpPWEobywxKSxsPWlbMF0scz1sO2lmKGUubGVuZ3RoPjApe3ZhciB1PXRoaXMuc2Nyb2xsLmxpbmUoTWF0aC5taW4oZS5pbmRleCtlLmxlbmd0aCxyKSk7cz1hKHUsMSlbMF19aWYobnVsbCE9bCYmbnVsbCE9cyl7dmFyIGM9dC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtuLnRvcDxjLnRvcD90LnNjcm9sbFRvcC09Yy50b3Atbi50b3A6bi5ib3R0b20+Yy5ib3R0b20mJih0LnNjcm9sbFRvcCs9bi5ib3R0b20tYy5ib3R0b20pfX19fX0se2tleToic2V0TmF0aXZlUmFuZ2UiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7dmFyIG49YXJndW1lbnRzLmxlbmd0aD4yJiZ2b2lkIDAhPT1hcmd1bWVudHNbMl0/YXJndW1lbnRzWzJdOnQscj1hcmd1bWVudHMubGVuZ3RoPjMmJnZvaWQgMCE9PWFyZ3VtZW50c1szXT9hcmd1bWVudHNbM106ZSxvPWFyZ3VtZW50cy5sZW5ndGg+NCYmdm9pZCAwIT09YXJndW1lbnRzWzRdJiZhcmd1bWVudHNbNF07aWYobS5pbmZvKCJzZXROYXRpdmVSYW5nZSIsdCxlLG4sciksbnVsbD09dHx8bnVsbCE9dGhpcy5yb290LnBhcmVudE5vZGUmJm51bGwhPXQucGFyZW50Tm9kZSYmbnVsbCE9bi5wYXJlbnROb2RlKXt2YXIgaT1kb2N1bWVudC5nZXRTZWxlY3Rpb24oKTtpZihudWxsIT1pKWlmKG51bGwhPXQpe3RoaXMuaGFzRm9jdXMoKXx8dGhpcy5yb290LmZvY3VzKCk7dmFyIGw9KHRoaXMuZ2V0TmF0aXZlUmFuZ2UoKXx8e30pLm5hdGl2ZTtpZihudWxsPT1sfHxvfHx0IT09bC5zdGFydENvbnRhaW5lcnx8ZSE9PWwuc3RhcnRPZmZzZXR8fG4hPT1sLmVuZENvbnRhaW5lcnx8ciE9PWwuZW5kT2Zmc2V0KXsiQlIiPT10LnRhZ05hbWUmJihlPVtdLmluZGV4T2YuY2FsbCh0LnBhcmVudE5vZGUuY2hpbGROb2Rlcyx0KSx0PXQucGFyZW50Tm9kZSksIkJSIj09bi50YWdOYW1lJiYocj1bXS5pbmRleE9mLmNhbGwobi5wYXJlbnROb2RlLmNoaWxkTm9kZXMsbiksbj1uLnBhcmVudE5vZGUpO3ZhciBhPWRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7YS5zZXRTdGFydCh0LGUpLGEuc2V0RW5kKG4sciksaS5yZW1vdmVBbGxSYW5nZXMoKSxpLmFkZFJhbmdlKGEpfX1lbHNlIGkucmVtb3ZlQWxsUmFuZ2VzKCksdGhpcy5yb290LmJsdXIoKSxkb2N1bWVudC5ib2R5LmZvY3VzKCl9fX0se2tleToic2V0UmFuZ2UiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdJiZhcmd1bWVudHNbMV0sbj1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06di5kZWZhdWx0LnNvdXJjZXMuQVBJO2lmKCJzdHJpbmciPT10eXBlb2YgZSYmKG49ZSxlPSExKSxtLmluZm8oInNldFJhbmdlIix0KSxudWxsIT10KXt2YXIgcj10aGlzLnJhbmdlVG9OYXRpdmUodCk7dGhpcy5zZXROYXRpdmVSYW5nZS5hcHBseSh0aGlzLG8ocikuY29uY2F0KFtlXSkpfWVsc2UgdGhpcy5zZXROYXRpdmVSYW5nZShudWxsKTt0aGlzLnVwZGF0ZShuKX19LHtrZXk6InVwZGF0ZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06di5kZWZhdWx0LnNvdXJjZXMuVVNFUixlPXRoaXMubGFzdFJhbmdlLG49dGhpcy5nZXRSYW5nZSgpLHI9YShuLDIpLG89clswXSxpPXJbMV07aWYodGhpcy5sYXN0UmFuZ2U9byxudWxsIT10aGlzLmxhc3RSYW5nZSYmKHRoaXMuc2F2ZWRSYW5nZT10aGlzLmxhc3RSYW5nZSksISgwLGQuZGVmYXVsdCkoZSx0aGlzLmxhc3RSYW5nZSkpe3ZhciBsOyF0aGlzLmNvbXBvc2luZyYmbnVsbCE9aSYmaS5uYXRpdmUuY29sbGFwc2VkJiZpLnN0YXJ0Lm5vZGUhPT10aGlzLmN1cnNvci50ZXh0Tm9kZSYmdGhpcy5jdXJzb3IucmVzdG9yZSgpO3ZhciBzPVt2LmRlZmF1bHQuZXZlbnRzLlNFTEVDVElPTl9DSEFOR0UsKDAsaC5kZWZhdWx0KSh0aGlzLmxhc3RSYW5nZSksKDAsaC5kZWZhdWx0KShlKSx0XTtpZigobD10aGlzLmVtaXR0ZXIpLmVtaXQuYXBwbHkobCxbdi5kZWZhdWx0LmV2ZW50cy5FRElUT1JfQ0hBTkdFXS5jb25jYXQocykpLHQhPT12LmRlZmF1bHQuc291cmNlcy5TSUxFTlQpe3ZhciB1Oyh1PXRoaXMuZW1pdHRlcikuZW1pdC5hcHBseSh1LHMpfX19fV0pLHR9KCk7ZS5SYW5nZT1fLGUuZGVmYXVsdD1PfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fWZ1bmN0aW9uIG8odCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBpKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gbCh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBhPW4oMCkscz1yKGEpLHU9bigzKSxjPXIodSksZj1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKCl7cmV0dXJuIG8odGhpcyxlKSxpKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9cmV0dXJuIGwoZSx0KSxlfShzLmRlZmF1bHQuQ29udGFpbmVyKTtmLmFsbG93ZWRDaGlsZHJlbj1bYy5kZWZhdWx0LHUuQmxvY2tFbWJlZCxmXSxlLmRlZmF1bHQ9Zn0sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiByKHQsZSl7aWYoISh0IGluc3RhbmNlb2YgZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIil9ZnVuY3Rpb24gbyh0LGUpe2lmKCF0KXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7cmV0dXJuIWV8fCJvYmplY3QiIT10eXBlb2YgZSYmImZ1bmN0aW9uIiE9dHlwZW9mIGU/dDplfWZ1bmN0aW9uIGkodCxlKXtpZigiZnVuY3Rpb24iIT10eXBlb2YgZSYmbnVsbCE9PWUpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiK3R5cGVvZiBlKTt0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGUmJmUucHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6dCxlbnVtZXJhYmxlOiExLHdyaXRhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH19KSxlJiYoT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0LGUpOnQuX19wcm90b19fPWUpfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxlLkNvbG9yU3R5bGU9ZS5Db2xvckNsYXNzPWUuQ29sb3JBdHRyaWJ1dG9yPXZvaWQgMDt2YXIgbD1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZVtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX1yZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfX0oKSxhPWZ1bmN0aW9uIHQoZSxuLHIpe251bGw9PT1lJiYoZT1GdW5jdGlvbi5wcm90b3R5cGUpO3ZhciBvPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSxuKTtpZih2b2lkIDA9PT1vKXt2YXIgaT1PYmplY3QuZ2V0UHJvdG90eXBlT2YoZSk7cmV0dXJuIG51bGw9PT1pP3ZvaWQgMDp0KGksbixyKX1pZigidmFsdWUiaW4gbylyZXR1cm4gby52YWx1ZTt2YXIgbD1vLmdldDtpZih2b2lkIDAhPT1sKXJldHVybiBsLmNhbGwocil9LHM9bigwKSx1PWZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX0ocyksYz1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKCl7cmV0dXJuIHIodGhpcyxlKSxvKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9cmV0dXJuIGkoZSx0KSxsKGUsW3trZXk6InZhbHVlIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgbj1hKGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwidmFsdWUiLHRoaXMpLmNhbGwodGhpcyx0KTtyZXR1cm4gbi5zdGFydHNXaXRoKCJyZ2IoIik/KG49bi5yZXBsYWNlKC9eW15cZF0rLywiIikucmVwbGFjZSgvW15cZF0rJC8sIiIpLCIjIituLnNwbGl0KCIsIikubWFwKGZ1bmN0aW9uKHQpe3JldHVybigiMDAiK3BhcnNlSW50KHQpLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpfSkuam9pbigiIikpOm59fV0pLGV9KHUuZGVmYXVsdC5BdHRyaWJ1dG9yLlN0eWxlKSxmPW5ldyB1LmRlZmF1bHQuQXR0cmlidXRvci5DbGFzcygiY29sb3IiLCJxbC1jb2xvciIse3Njb3BlOnUuZGVmYXVsdC5TY29wZS5JTkxJTkV9KSxoPW5ldyBjKCJjb2xvciIsImNvbG9yIix7c2NvcGU6dS5kZWZhdWx0LlNjb3BlLklOTElORX0pO2UuQ29sb3JBdHRyaWJ1dG9yPWMsZS5Db2xvckNsYXNzPWYsZS5Db2xvclN0eWxlPWh9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19ZnVuY3Rpb24gbyh0LGUsbil7cmV0dXJuIGUgaW4gdD9PYmplY3QuZGVmaW5lUHJvcGVydHkodCxlLHt2YWx1ZTpuLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwfSk6dFtlXT1uLHR9ZnVuY3Rpb24gaSh0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIGwodCxlKXtpZighdCl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiFlfHwib2JqZWN0IiE9dHlwZW9mIGUmJiJmdW5jdGlvbiIhPXR5cGVvZiBlP3Q6ZX1mdW5jdGlvbiBhKHQsZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUmJm51bGwhPT1lKXRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIit0eXBlb2YgZSk7dC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlJiZlLnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOnQsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksZSYmKE9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YodCxlKTp0Ll9fcHJvdG9fXz1lKX1mdW5jdGlvbiBzKHQsZSl7dmFyIG4scj10PT09RC5rZXlzLkxFRlQ/InByZWZpeCI6InN1ZmZpeCI7cmV0dXJuIG49e2tleTp0LHNoaWZ0S2V5OmUsYWx0S2V5Om51bGx9LG8obixyLC9eJC8pLG8obiwiaGFuZGxlciIsZnVuY3Rpb24obil7dmFyIHI9bi5pbmRleDt0PT09RC5rZXlzLlJJR0hUJiYocis9bi5sZW5ndGgrMSk7dmFyIG89dGhpcy5xdWlsbC5nZXRMZWFmKHIpO3JldHVybiEoYihvLDEpWzBdaW5zdGFuY2VvZiBULmRlZmF1bHQuRW1iZWQpfHwodD09PUQua2V5cy5MRUZUP2U/dGhpcy5xdWlsbC5zZXRTZWxlY3Rpb24obi5pbmRleC0xLG4ubGVuZ3RoKzEsUy5kZWZhdWx0LnNvdXJjZXMuVVNFUik6dGhpcy5xdWlsbC5zZXRTZWxlY3Rpb24obi5pbmRleC0xLFMuZGVmYXVsdC5zb3VyY2VzLlVTRVIpOmU/dGhpcy5xdWlsbC5zZXRTZWxlY3Rpb24obi5pbmRleCxuLmxlbmd0aCsxLFMuZGVmYXVsdC5zb3VyY2VzLlVTRVIpOnRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKG4uaW5kZXgrbi5sZW5ndGgrMSxTLmRlZmF1bHQuc291cmNlcy5VU0VSKSwhMSl9KSxufWZ1bmN0aW9uIHUodCxlKXtpZighKDA9PT10LmluZGV4fHx0aGlzLnF1aWxsLmdldExlbmd0aCgpPD0xKSl7dmFyIG49dGhpcy5xdWlsbC5nZXRMaW5lKHQuaW5kZXgpLHI9YihuLDEpLG89clswXSxpPXt9O2lmKDA9PT1lLm9mZnNldCl7dmFyIGw9dGhpcy5xdWlsbC5nZXRMaW5lKHQuaW5kZXgtMSksYT1iKGwsMSkscz1hWzBdO2lmKG51bGwhPXMmJnMubGVuZ3RoKCk+MSl7dmFyIHU9by5mb3JtYXRzKCksYz10aGlzLnF1aWxsLmdldEZvcm1hdCh0LmluZGV4LTEsMSk7aT1BLmRlZmF1bHQuYXR0cmlidXRlcy5kaWZmKHUsYyl8fHt9fX12YXIgZj0vW1x1RDgwMC1cdURCRkZdW1x1REMwMC1cdURGRkZdJC8udGVzdChlLnByZWZpeCk/MjoxO3RoaXMucXVpbGwuZGVsZXRlVGV4dCh0LmluZGV4LWYsZixTLmRlZmF1bHQuc291cmNlcy5VU0VSKSxPYmplY3Qua2V5cyhpKS5sZW5ndGg+MCYmdGhpcy5xdWlsbC5mb3JtYXRMaW5lKHQuaW5kZXgtZixmLGksUy5kZWZhdWx0LnNvdXJjZXMuVVNFUiksdGhpcy5xdWlsbC5mb2N1cygpfX1mdW5jdGlvbiBjKHQsZSl7dmFyIG49L15bXHVEODAwLVx1REJGRl1bXHVEQzAwLVx1REZGRl0vLnRlc3QoZS5zdWZmaXgpPzI6MTtpZighKHQuaW5kZXg+PXRoaXMucXVpbGwuZ2V0TGVuZ3RoKCktbikpe3ZhciByPXt9LG89MCxpPXRoaXMucXVpbGwuZ2V0TGluZSh0LmluZGV4KSxsPWIoaSwxKSxhPWxbMF07aWYoZS5vZmZzZXQ+PWEubGVuZ3RoKCktMSl7dmFyIHM9dGhpcy5xdWlsbC5nZXRMaW5lKHQuaW5kZXgrMSksdT1iKHMsMSksYz11WzBdO2lmKGMpe3ZhciBmPWEuZm9ybWF0cygpLGg9dGhpcy5xdWlsbC5nZXRGb3JtYXQodC5pbmRleCwxKTtyPUEuZGVmYXVsdC5hdHRyaWJ1dGVzLmRpZmYoZixoKXx8e30sbz1jLmxlbmd0aCgpfX10aGlzLnF1aWxsLmRlbGV0ZVRleHQodC5pbmRleCxuLFMuZGVmYXVsdC5zb3VyY2VzLlVTRVIpLE9iamVjdC5rZXlzKHIpLmxlbmd0aD4wJiZ0aGlzLnF1aWxsLmZvcm1hdExpbmUodC5pbmRleCtvLTEsbixyLFMuZGVmYXVsdC5zb3VyY2VzLlVTRVIpfX1mdW5jdGlvbiBmKHQpe3ZhciBlPXRoaXMucXVpbGwuZ2V0TGluZXModCksbj17fTtpZihlLmxlbmd0aD4xKXt2YXIgcj1lWzBdLmZvcm1hdHMoKSxvPWVbZS5sZW5ndGgtMV0uZm9ybWF0cygpO249QS5kZWZhdWx0LmF0dHJpYnV0ZXMuZGlmZihvLHIpfHx7fX10aGlzLnF1aWxsLmRlbGV0ZVRleHQodCxTLmRlZmF1bHQuc291cmNlcy5VU0VSKSxPYmplY3Qua2V5cyhuKS5sZW5ndGg+MCYmdGhpcy5xdWlsbC5mb3JtYXRMaW5lKHQuaW5kZXgsMSxuLFMuZGVmYXVsdC5zb3VyY2VzLlVTRVIpLHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKHQuaW5kZXgsUy5kZWZhdWx0LnNvdXJjZXMuU0lMRU5UKSx0aGlzLnF1aWxsLmZvY3VzKCl9ZnVuY3Rpb24gaCh0LGUpe3ZhciBuPXRoaXM7dC5sZW5ndGg+MCYmdGhpcy5xdWlsbC5zY3JvbGwuZGVsZXRlQXQodC5pbmRleCx0Lmxlbmd0aCk7dmFyIHI9T2JqZWN0LmtleXMoZS5mb3JtYXQpLnJlZHVjZShmdW5jdGlvbih0LG4pe3JldHVybiBULmRlZmF1bHQucXVlcnkobixULmRlZmF1bHQuU2NvcGUuQkxPQ0spJiYhQXJyYXkuaXNBcnJheShlLmZvcm1hdFtuXSkmJih0W25dPWUuZm9ybWF0W25dKSx0fSx7fSk7dGhpcy5xdWlsbC5pbnNlcnRUZXh0KHQuaW5kZXgsIlxuIixyLFMuZGVmYXVsdC5zb3VyY2VzLlVTRVIpLHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKHQuaW5kZXgrMSxTLmRlZmF1bHQuc291cmNlcy5TSUxFTlQpLHRoaXMucXVpbGwuZm9jdXMoKSxPYmplY3Qua2V5cyhlLmZvcm1hdCkuZm9yRWFjaChmdW5jdGlvbih0KXtudWxsPT1yW3RdJiYoQXJyYXkuaXNBcnJheShlLmZvcm1hdFt0XSl8fCJsaW5rIiE9PXQmJm4ucXVpbGwuZm9ybWF0KHQsZS5mb3JtYXRbdF0sUy5kZWZhdWx0LnNvdXJjZXMuVVNFUikpfSl9ZnVuY3Rpb24gcCh0KXtyZXR1cm57a2V5OkQua2V5cy5UQUIsc2hpZnRLZXk6IXQsZm9ybWF0OnsiY29kZS1ibG9jayI6ITB9LGhhbmRsZXI6ZnVuY3Rpb24oZSl7dmFyIG49VC5kZWZhdWx0LnF1ZXJ5KCJjb2RlLWJsb2NrIikscj1lLmluZGV4LG89ZS5sZW5ndGgsaT10aGlzLnF1aWxsLnNjcm9sbC5kZXNjZW5kYW50KG4sciksbD1iKGksMiksYT1sWzBdLHM9bFsxXTtpZihudWxsIT1hKXt2YXIgdT10aGlzLnF1aWxsLmdldEluZGV4KGEpLGM9YS5uZXdsaW5lSW5kZXgocywhMCkrMSxmPWEubmV3bGluZUluZGV4KHUrcytvKSxoPWEuZG9tTm9kZS50ZXh0Q29udGVudC5zbGljZShjLGYpLnNwbGl0KCJcbiIpO3M9MCxoLmZvckVhY2goZnVuY3Rpb24oZSxpKXt0PyhhLmluc2VydEF0KGMrcyxuLlRBQikscys9bi5UQUIubGVuZ3RoLDA9PT1pP3IrPW4uVEFCLmxlbmd0aDpvKz1uLlRBQi5sZW5ndGgpOmUuc3RhcnRzV2l0aChuLlRBQikmJihhLmRlbGV0ZUF0KGMrcyxuLlRBQi5sZW5ndGgpLHMtPW4uVEFCLmxlbmd0aCwwPT09aT9yLT1uLlRBQi5sZW5ndGg6by09bi5UQUIubGVuZ3RoKSxzKz1lLmxlbmd0aCsxfSksdGhpcy5xdWlsbC51cGRhdGUoUy5kZWZhdWx0LnNvdXJjZXMuVVNFUiksdGhpcy5xdWlsbC5zZXRTZWxlY3Rpb24ocixvLFMuZGVmYXVsdC5zb3VyY2VzLlNJTEVOVCl9fX19ZnVuY3Rpb24gZCh0KXtyZXR1cm57a2V5OnRbMF0udG9VcHBlckNhc2UoKSxzaG9ydEtleTohMCxoYW5kbGVyOmZ1bmN0aW9uKGUsbil7dGhpcy5xdWlsbC5mb3JtYXQodCwhbi5mb3JtYXRbdF0sUy5kZWZhdWx0LnNvdXJjZXMuVVNFUil9fX1mdW5jdGlvbiB5KHQpe2lmKCJzdHJpbmciPT10eXBlb2YgdHx8Im51bWJlciI9PXR5cGVvZiB0KXJldHVybiB5KHtrZXk6dH0pO2lmKCJvYmplY3QiPT09KHZvaWQgMD09PXQ/InVuZGVmaW5lZCI6dih0KSkmJih0PSgwLF8uZGVmYXVsdCkodCwhMSkpLCJzdHJpbmciPT10eXBlb2YgdC5rZXkpaWYobnVsbCE9RC5rZXlzW3Qua2V5LnRvVXBwZXJDYXNlKCldKXQua2V5PUQua2V5c1t0LmtleS50b1VwcGVyQ2FzZSgpXTtlbHNle2lmKDEhPT10LmtleS5sZW5ndGgpcmV0dXJuIG51bGw7dC5rZXk9dC5rZXkudG9VcHBlckNhc2UoKS5jaGFyQ29kZUF0KDApfXJldHVybiB0LnNob3J0S2V5JiYodFtCXT10LnNob3J0S2V5LGRlbGV0ZSB0LnNob3J0S2V5KSx0fU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxlLlNIT1JUS0VZPWUuZGVmYXVsdD12b2lkIDA7dmFyIHY9ImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmInN5bWJvbCI9PXR5cGVvZiBTeW1ib2wuaXRlcmF0b3I/ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0fTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmdC5jb25zdHJ1Y3Rvcj09PVN5bWJvbCYmdCE9PVN5bWJvbC5wcm90b3R5cGU/InN5bWJvbCI6dHlwZW9mIHR9LGI9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQsZSl7dmFyIG49W10scj0hMCxvPSExLGk9dm9pZCAwO3RyeXtmb3IodmFyIGwsYT10W1N5bWJvbC5pdGVyYXRvcl0oKTshKHI9KGw9YS5uZXh0KCkpLmRvbmUpJiYobi5wdXNoKGwudmFsdWUpLCFlfHxuLmxlbmd0aCE9PWUpO3I9ITApO31jYXRjaCh0KXtvPSEwLGk9dH1maW5hbGx5e3RyeXshciYmYS5yZXR1cm4mJmEucmV0dXJuKCl9ZmluYWxseXtpZihvKXRocm93IGl9fXJldHVybiBufXJldHVybiBmdW5jdGlvbihlLG4pe2lmKEFycmF5LmlzQXJyYXkoZSkpcmV0dXJuIGU7aWYoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChlKSlyZXR1cm4gdChlLG4pO3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKX19KCksZz1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZVtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX1yZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfX0oKSxtPW4oMjEpLF89cihtKSxPPW4oMTIpLHc9cihPKSx4PW4oMiksaz1yKHgpLEU9big0KSxOPXIoRSksaj1uKDIwKSxBPXIoaikscT1uKDApLFQ9cihxKSxQPW4oNiksUz1yKFApLEM9bigxMCksTD1yKEMpLE09big3KSxSPXIoTSksST0oMCxMLmRlZmF1bHQpKCJxdWlsbDprZXlib2FyZCIpLEI9L01hYy9pLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKT8ibWV0YUtleSI6ImN0cmxLZXkiLEQ9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSh0LG4pe2kodGhpcyxlKTt2YXIgcj1sKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmNhbGwodGhpcyx0LG4pKTtyZXR1cm4gci5iaW5kaW5ncz17fSxPYmplY3Qua2V5cyhyLm9wdGlvbnMuYmluZGluZ3MpLmZvckVhY2goZnVuY3Rpb24oZSl7KCJsaXN0IGF1dG9maWxsIiE9PWV8fG51bGw9PXQuc2Nyb2xsLndoaXRlbGlzdHx8dC5zY3JvbGwud2hpdGVsaXN0Lmxpc3QpJiZyLm9wdGlvbnMuYmluZGluZ3NbZV0mJnIuYWRkQmluZGluZyhyLm9wdGlvbnMuYmluZGluZ3NbZV0pfSksci5hZGRCaW5kaW5nKHtrZXk6ZS5rZXlzLkVOVEVSLHNoaWZ0S2V5Om51bGx9LGgpLHIuYWRkQmluZGluZyh7a2V5OmUua2V5cy5FTlRFUixtZXRhS2V5Om51bGwsY3RybEtleTpudWxsLGFsdEtleTpudWxsfSxmdW5jdGlvbigpe30pLC9GaXJlZm94L2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KT8oci5hZGRCaW5kaW5nKHtrZXk6ZS5rZXlzLkJBQ0tTUEFDRX0se2NvbGxhcHNlZDohMH0sdSksci5hZGRCaW5kaW5nKHtrZXk6ZS5rZXlzLkRFTEVURX0se2NvbGxhcHNlZDohMH0sYykpOihyLmFkZEJpbmRpbmcoe2tleTplLmtleXMuQkFDS1NQQUNFfSx7Y29sbGFwc2VkOiEwLHByZWZpeDovXi4/JC99LHUpLHIuYWRkQmluZGluZyh7a2V5OmUua2V5cy5ERUxFVEV9LHtjb2xsYXBzZWQ6ITAsc3VmZml4Oi9eLj8kL30sYykpLHIuYWRkQmluZGluZyh7a2V5OmUua2V5cy5CQUNLU1BBQ0V9LHtjb2xsYXBzZWQ6ITF9LGYpLHIuYWRkQmluZGluZyh7a2V5OmUua2V5cy5ERUxFVEV9LHtjb2xsYXBzZWQ6ITF9LGYpLHIuYWRkQmluZGluZyh7a2V5OmUua2V5cy5CQUNLU1BBQ0UsYWx0S2V5Om51bGwsY3RybEtleTpudWxsLG1ldGFLZXk6bnVsbCxzaGlmdEtleTpudWxsfSx7Y29sbGFwc2VkOiEwLG9mZnNldDowfSx1KSxyLmxpc3RlbigpLHJ9cmV0dXJuIGEoZSx0KSxnKGUsbnVsbCxbe2tleToibWF0Y2giLHZhbHVlOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIGU9eShlKSwhWyJhbHRLZXkiLCJjdHJsS2V5IiwibWV0YUtleSIsInNoaWZ0S2V5Il0uc29tZShmdW5jdGlvbihuKXtyZXR1cm4hIWVbbl0hPT10W25dJiZudWxsIT09ZVtuXX0pJiZlLmtleT09PSh0LndoaWNofHx0LmtleUNvZGUpfX1dKSxnKGUsW3trZXk6ImFkZEJpbmRpbmciLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTp7fSxuPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTp7fSxyPXkodCk7aWYobnVsbD09cnx8bnVsbD09ci5rZXkpcmV0dXJuIEkud2FybigiQXR0ZW1wdGVkIHRvIGFkZCBpbnZhbGlkIGtleWJvYXJkIGJpbmRpbmciLHIpOyJmdW5jdGlvbiI9PXR5cGVvZiBlJiYoZT17aGFuZGxlcjplfSksImZ1bmN0aW9uIj09dHlwZW9mIG4mJihuPXtoYW5kbGVyOm59KSxyPSgwLGsuZGVmYXVsdCkocixlLG4pLHRoaXMuYmluZGluZ3Nbci5rZXldPXRoaXMuYmluZGluZ3Nbci5rZXldfHxbXSx0aGlzLmJpbmRpbmdzW3Iua2V5XS5wdXNoKHIpfX0se2tleToibGlzdGVuIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXM7dGhpcy5xdWlsbC5yb290LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLGZ1bmN0aW9uKG4pe2lmKCFuLmRlZmF1bHRQcmV2ZW50ZWQpe3ZhciByPW4ud2hpY2h8fG4ua2V5Q29kZSxvPSh0LmJpbmRpbmdzW3JdfHxbXSkuZmlsdGVyKGZ1bmN0aW9uKHQpe3JldHVybiBlLm1hdGNoKG4sdCl9KTtpZigwIT09by5sZW5ndGgpe3ZhciBpPXQucXVpbGwuZ2V0U2VsZWN0aW9uKCk7aWYobnVsbCE9aSYmdC5xdWlsbC5oYXNGb2N1cygpKXt2YXIgbD10LnF1aWxsLmdldExpbmUoaS5pbmRleCksYT1iKGwsMikscz1hWzBdLHU9YVsxXSxjPXQucXVpbGwuZ2V0TGVhZihpLmluZGV4KSxmPWIoYywyKSxoPWZbMF0scD1mWzFdLGQ9MD09PWkubGVuZ3RoP1toLHBdOnQucXVpbGwuZ2V0TGVhZihpLmluZGV4K2kubGVuZ3RoKSx5PWIoZCwyKSxnPXlbMF0sbT15WzFdLF89aCBpbnN0YW5jZW9mIFQuZGVmYXVsdC5UZXh0P2gudmFsdWUoKS5zbGljZSgwLHApOiIiLE89ZyBpbnN0YW5jZW9mIFQuZGVmYXVsdC5UZXh0P2cudmFsdWUoKS5zbGljZShtKToiIix4PXtjb2xsYXBzZWQ6MD09PWkubGVuZ3RoLGVtcHR5OjA9PT1pLmxlbmd0aCYmcy5sZW5ndGgoKTw9MSxmb3JtYXQ6dC5xdWlsbC5nZXRGb3JtYXQoaSksb2Zmc2V0OnUscHJlZml4Ol8sc3VmZml4Ok99O28uc29tZShmdW5jdGlvbihlKXtpZihudWxsIT1lLmNvbGxhcHNlZCYmZS5jb2xsYXBzZWQhPT14LmNvbGxhcHNlZClyZXR1cm4hMTtpZihudWxsIT1lLmVtcHR5JiZlLmVtcHR5IT09eC5lbXB0eSlyZXR1cm4hMTtpZihudWxsIT1lLm9mZnNldCYmZS5vZmZzZXQhPT14Lm9mZnNldClyZXR1cm4hMTtpZihBcnJheS5pc0FycmF5KGUuZm9ybWF0KSl7aWYoZS5mb3JtYXQuZXZlcnkoZnVuY3Rpb24odCl7cmV0dXJuIG51bGw9PXguZm9ybWF0W3RdfSkpcmV0dXJuITF9ZWxzZSBpZigib2JqZWN0Ij09PXYoZS5mb3JtYXQpJiYhT2JqZWN0LmtleXMoZS5mb3JtYXQpLmV2ZXJ5KGZ1bmN0aW9uKHQpe3JldHVybiEwPT09ZS5mb3JtYXRbdF0/bnVsbCE9eC5mb3JtYXRbdF06ITE9PT1lLmZvcm1hdFt0XT9udWxsPT14LmZvcm1hdFt0XTooMCx3LmRlZmF1bHQpKGUuZm9ybWF0W3RdLHguZm9ybWF0W3RdKX0pKXJldHVybiExO3JldHVybiEobnVsbCE9ZS5wcmVmaXgmJiFlLnByZWZpeC50ZXN0KHgucHJlZml4KSkmJighKG51bGwhPWUuc3VmZml4JiYhZS5zdWZmaXgudGVzdCh4LnN1ZmZpeCkpJiYhMCE9PWUuaGFuZGxlci5jYWxsKHQsaSx4KSl9KSYmbi5wcmV2ZW50RGVmYXVsdCgpfX19fSl9fV0pLGV9KFIuZGVmYXVsdCk7RC5rZXlzPXtCQUNLU1BBQ0U6OCxUQUI6OSxFTlRFUjoxMyxFU0NBUEU6MjcsTEVGVDozNyxVUDozOCxSSUdIVDozOSxET1dOOjQwLERFTEVURTo0Nn0sRC5ERUZBVUxUUz17YmluZGluZ3M6e2JvbGQ6ZCgiYm9sZCIpLGl0YWxpYzpkKCJpdGFsaWMiKSx1bmRlcmxpbmU6ZCgidW5kZXJsaW5lIiksaW5kZW50OntrZXk6RC5rZXlzLlRBQixmb3JtYXQ6WyJibG9ja3F1b3RlIiwiaW5kZW50IiwibGlzdCJdLGhhbmRsZXI6ZnVuY3Rpb24odCxlKXtpZihlLmNvbGxhcHNlZCYmMCE9PWUub2Zmc2V0KXJldHVybiEwO3RoaXMucXVpbGwuZm9ybWF0KCJpbmRlbnQiLCIrMSIsUy5kZWZhdWx0LnNvdXJjZXMuVVNFUil9fSxvdXRkZW50OntrZXk6RC5rZXlzLlRBQixzaGlmdEtleTohMCxmb3JtYXQ6WyJibG9ja3F1b3RlIiwiaW5kZW50IiwibGlzdCJdLGhhbmRsZXI6ZnVuY3Rpb24odCxlKXtpZihlLmNvbGxhcHNlZCYmMCE9PWUub2Zmc2V0KXJldHVybiEwO3RoaXMucXVpbGwuZm9ybWF0KCJpbmRlbnQiLCItMSIsUy5kZWZhdWx0LnNvdXJjZXMuVVNFUil9fSwib3V0ZGVudCBiYWNrc3BhY2UiOntrZXk6RC5rZXlzLkJBQ0tTUEFDRSxjb2xsYXBzZWQ6ITAsc2hpZnRLZXk6bnVsbCxtZXRhS2V5Om51bGwsY3RybEtleTpudWxsLGFsdEtleTpudWxsLGZvcm1hdDpbImluZGVudCIsImxpc3QiXSxvZmZzZXQ6MCxoYW5kbGVyOmZ1bmN0aW9uKHQsZSl7bnVsbCE9ZS5mb3JtYXQuaW5kZW50P3RoaXMucXVpbGwuZm9ybWF0KCJpbmRlbnQiLCItMSIsUy5kZWZhdWx0LnNvdXJjZXMuVVNFUik6bnVsbCE9ZS5mb3JtYXQubGlzdCYmdGhpcy5xdWlsbC5mb3JtYXQoImxpc3QiLCExLFMuZGVmYXVsdC5zb3VyY2VzLlVTRVIpfX0sImluZGVudCBjb2RlLWJsb2NrIjpwKCEwKSwib3V0ZGVudCBjb2RlLWJsb2NrIjpwKCExKSwicmVtb3ZlIHRhYiI6e2tleTpELmtleXMuVEFCLHNoaWZ0S2V5OiEwLGNvbGxhcHNlZDohMCxwcmVmaXg6L1x0JC8saGFuZGxlcjpmdW5jdGlvbih0KXt0aGlzLnF1aWxsLmRlbGV0ZVRleHQodC5pbmRleC0xLDEsUy5kZWZhdWx0LnNvdXJjZXMuVVNFUil9fSx0YWI6e2tleTpELmtleXMuVEFCLGhhbmRsZXI6ZnVuY3Rpb24odCl7dGhpcy5xdWlsbC5oaXN0b3J5LmN1dG9mZigpO3ZhciBlPShuZXcgTi5kZWZhdWx0KS5yZXRhaW4odC5pbmRleCkuZGVsZXRlKHQubGVuZ3RoKS5pbnNlcnQoIlx0Iik7dGhpcy5xdWlsbC51cGRhdGVDb250ZW50cyhlLFMuZGVmYXVsdC5zb3VyY2VzLlVTRVIpLHRoaXMucXVpbGwuaGlzdG9yeS5jdXRvZmYoKSx0aGlzLnF1aWxsLnNldFNlbGVjdGlvbih0LmluZGV4KzEsUy5kZWZhdWx0LnNvdXJjZXMuU0lMRU5UKX19LCJsaXN0IGVtcHR5IGVudGVyIjp7a2V5OkQua2V5cy5FTlRFUixjb2xsYXBzZWQ6ITAsZm9ybWF0OlsibGlzdCJdLGVtcHR5OiEwLGhhbmRsZXI6ZnVuY3Rpb24odCxlKXt0aGlzLnF1aWxsLmZvcm1hdCgibGlzdCIsITEsUy5kZWZhdWx0LnNvdXJjZXMuVVNFUiksZS5mb3JtYXQuaW5kZW50JiZ0aGlzLnF1aWxsLmZvcm1hdCgiaW5kZW50IiwhMSxTLmRlZmF1bHQuc291cmNlcy5VU0VSKX19LCJjaGVja2xpc3QgZW50ZXIiOntrZXk6RC5rZXlzLkVOVEVSLGNvbGxhcHNlZDohMCxmb3JtYXQ6e2xpc3Q6ImNoZWNrZWQifSxoYW5kbGVyOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMucXVpbGwuZ2V0TGluZSh0LmluZGV4KSxuPWIoZSwyKSxyPW5bMF0sbz1uWzFdLGk9KDAsay5kZWZhdWx0KSh7fSxyLmZvcm1hdHMoKSx7bGlzdDoiY2hlY2tlZCJ9KSxsPShuZXcgTi5kZWZhdWx0KS5yZXRhaW4odC5pbmRleCkuaW5zZXJ0KCJcbiIsaSkucmV0YWluKHIubGVuZ3RoKCktby0xKS5yZXRhaW4oMSx7bGlzdDoidW5jaGVja2VkIn0pO3RoaXMucXVpbGwudXBkYXRlQ29udGVudHMobCxTLmRlZmF1bHQuc291cmNlcy5VU0VSKSx0aGlzLnF1aWxsLnNldFNlbGVjdGlvbih0LmluZGV4KzEsUy5kZWZhdWx0LnNvdXJjZXMuU0lMRU5UKSx0aGlzLnF1aWxsLnNjcm9sbEludG9WaWV3KCl9fSwiaGVhZGVyIGVudGVyIjp7a2V5OkQua2V5cy5FTlRFUixjb2xsYXBzZWQ6ITAsZm9ybWF0OlsiaGVhZGVyIl0sc3VmZml4Oi9eJC8saGFuZGxlcjpmdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMucXVpbGwuZ2V0TGluZSh0LmluZGV4KSxyPWIobiwyKSxvPXJbMF0saT1yWzFdLGw9KG5ldyBOLmRlZmF1bHQpLnJldGFpbih0LmluZGV4KS5pbnNlcnQoIlxuIixlLmZvcm1hdCkucmV0YWluKG8ubGVuZ3RoKCktaS0xKS5yZXRhaW4oMSx7aGVhZGVyOm51bGx9KTt0aGlzLnF1aWxsLnVwZGF0ZUNvbnRlbnRzKGwsUy5kZWZhdWx0LnNvdXJjZXMuVVNFUiksdGhpcy5xdWlsbC5zZXRTZWxlY3Rpb24odC5pbmRleCsxLFMuZGVmYXVsdC5zb3VyY2VzLlNJTEVOVCksdGhpcy5xdWlsbC5zY3JvbGxJbnRvVmlldygpfX0sImxpc3QgYXV0b2ZpbGwiOntrZXk6IiAiLGNvbGxhcHNlZDohMCxmb3JtYXQ6e2xpc3Q6ITF9LHByZWZpeDovXlxzKj8oXGQrXC58LXxcKnxcWyA/XF18XFt4XF0pJC8saGFuZGxlcjpmdW5jdGlvbih0LGUpe3ZhciBuPWUucHJlZml4Lmxlbmd0aCxyPXRoaXMucXVpbGwuZ2V0TGluZSh0LmluZGV4KSxvPWIociwyKSxpPW9bMF0sbD1vWzFdO2lmKGw+bilyZXR1cm4hMDt2YXIgYT12b2lkIDA7c3dpdGNoKGUucHJlZml4LnRyaW0oKSl7Y2FzZSJbXSI6Y2FzZSJbIF0iOmE9InVuY2hlY2tlZCI7YnJlYWs7Y2FzZSJbeF0iOmE9ImNoZWNrZWQiO2JyZWFrO2Nhc2UiLSI6Y2FzZSIqIjphPSJidWxsZXQiO2JyZWFrO2RlZmF1bHQ6YT0ib3JkZXJlZCJ9dGhpcy5xdWlsbC5pbnNlcnRUZXh0KHQuaW5kZXgsIiAiLFMuZGVmYXVsdC5zb3VyY2VzLlVTRVIpLHRoaXMucXVpbGwuaGlzdG9yeS5jdXRvZmYoKTt2YXIgcz0obmV3IE4uZGVmYXVsdCkucmV0YWluKHQuaW5kZXgtbCkuZGVsZXRlKG4rMSkucmV0YWluKGkubGVuZ3RoKCktMi1sKS5yZXRhaW4oMSx7bGlzdDphfSk7dGhpcy5xdWlsbC51cGRhdGVDb250ZW50cyhzLFMuZGVmYXVsdC5zb3VyY2VzLlVTRVIpLHRoaXMucXVpbGwuaGlzdG9yeS5jdXRvZmYoKSx0aGlzLnF1aWxsLnNldFNlbGVjdGlvbih0LmluZGV4LW4sUy5kZWZhdWx0LnNvdXJjZXMuU0lMRU5UKX19LCJjb2RlIGV4aXQiOntrZXk6RC5rZXlzLkVOVEVSLGNvbGxhcHNlZDohMCxmb3JtYXQ6WyJjb2RlLWJsb2NrIl0scHJlZml4Oi9cblxuJC8sc3VmZml4Oi9eXHMrJC8saGFuZGxlcjpmdW5jdGlvbih0KXt2YXIgZT10aGlzLnF1aWxsLmdldExpbmUodC5pbmRleCksbj1iKGUsMikscj1uWzBdLG89blsxXSxpPShuZXcgTi5kZWZhdWx0KS5yZXRhaW4odC5pbmRleCtyLmxlbmd0aCgpLW8tMikucmV0YWluKDEseyJjb2RlLWJsb2NrIjpudWxsfSkuZGVsZXRlKDEpO3RoaXMucXVpbGwudXBkYXRlQ29udGVudHMoaSxTLmRlZmF1bHQuc291cmNlcy5VU0VSKX19LCJlbWJlZCBsZWZ0IjpzKEQua2V5cy5MRUZULCExKSwiZW1iZWQgbGVmdCBzaGlmdCI6cyhELmtleXMuTEVGVCwhMCksImVtYmVkIHJpZ2h0IjpzKEQua2V5cy5SSUdIVCwhMSksImVtYmVkIHJpZ2h0IHNoaWZ0IjpzKEQua2V5cy5SSUdIVCwhMCl9fSxlLmRlZmF1bHQ9RCxlLlNIT1JUS0VZPUJ9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7dC5leHBvcnRzPXthbGlnbjp7IiI6big3NSksY2VudGVyOm4oNzYpLHJpZ2h0Om4oNzcpLGp1c3RpZnk6big3OCl9LGJhY2tncm91bmQ6big3OSksYmxvY2txdW90ZTpuKDgwKSxib2xkOm4oODEpLGNsZWFuOm4oODIpLGNvZGU6big0MCksImNvZGUtYmxvY2siOm4oNDApLGNvbG9yOm4oODMpLGRpcmVjdGlvbjp7IiI6big4NCkscnRsOm4oODUpfSxmbG9hdDp7Y2VudGVyOm4oODYpLGZ1bGw6big4NyksbGVmdDpuKDg4KSxyaWdodDpuKDg5KX0sZm9ybXVsYTpuKDkwKSxoZWFkZXI6ezE6big5MSksMjpuKDkyKX0saXRhbGljOm4oOTMpLGltYWdlOm4oOTQpLGluZGVudDp7IisxIjpuKDk1KSwiLTEiOm4oOTYpfSxsaW5rOm4oOTcpLGxpc3Q6e29yZGVyZWQ6big5OCksYnVsbGV0Om4oOTkpLGNoZWNrOm4oMTAwKX0sc2NyaXB0OntzdWI6bigxMDEpLHN1cGVyOm4oMTAyKX0sc3RyaWtlOm4oMTAzKSx1bmRlcmxpbmU6bigxMDQpLHZpZGVvOm4oMTA1KX19LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciByPW4oMSksbz1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCl7dGhpcy5kb21Ob2RlPXQsdGhpcy5kb21Ob2RlW3IuREFUQV9LRVldPXtibG90OnRoaXN9fXJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkodC5wcm90b3R5cGUsInN0YXRpY3MiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvcn0sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KSx0LmNyZWF0ZT1mdW5jdGlvbih0KXtpZihudWxsPT10aGlzLnRhZ05hbWUpdGhyb3cgbmV3IHIuUGFyY2htZW50RXJyb3IoIkJsb3QgZGVmaW5pdGlvbiBtaXNzaW5nIHRhZ05hbWUiKTt2YXIgZTtyZXR1cm4gQXJyYXkuaXNBcnJheSh0aGlzLnRhZ05hbWUpPygic3RyaW5nIj09dHlwZW9mIHQmJih0PXQudG9VcHBlckNhc2UoKSxwYXJzZUludCh0KS50b1N0cmluZygpPT09dCYmKHQ9cGFyc2VJbnQodCkpKSxlPSJudW1iZXIiPT10eXBlb2YgdD9kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRoaXMudGFnTmFtZVt0LTFdKTp0aGlzLnRhZ05hbWUuaW5kZXhPZih0KT4tMT9kb2N1bWVudC5jcmVhdGVFbGVtZW50KHQpOmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGhpcy50YWdOYW1lWzBdKSk6ZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRoaXMudGFnTmFtZSksdGhpcy5jbGFzc05hbWUmJmUuY2xhc3NMaXN0LmFkZCh0aGlzLmNsYXNzTmFtZSksZX0sdC5wcm90b3R5cGUuYXR0YWNoPWZ1bmN0aW9uKCl7bnVsbCE9dGhpcy5wYXJlbnQmJih0aGlzLnNjcm9sbD10aGlzLnBhcmVudC5zY3JvbGwpfSx0LnByb3RvdHlwZS5jbG9uZT1mdW5jdGlvbigpe3ZhciB0PXRoaXMuZG9tTm9kZS5jbG9uZU5vZGUoITEpO3JldHVybiByLmNyZWF0ZSh0KX0sdC5wcm90b3R5cGUuZGV0YWNoPWZ1bmN0aW9uKCl7bnVsbCE9dGhpcy5wYXJlbnQmJnRoaXMucGFyZW50LnJlbW92ZUNoaWxkKHRoaXMpLGRlbGV0ZSB0aGlzLmRvbU5vZGVbci5EQVRBX0tFWV19LHQucHJvdG90eXBlLmRlbGV0ZUF0PWZ1bmN0aW9uKHQsZSl7dGhpcy5pc29sYXRlKHQsZSkucmVtb3ZlKCl9LHQucHJvdG90eXBlLmZvcm1hdEF0PWZ1bmN0aW9uKHQsZSxuLG8pe3ZhciBpPXRoaXMuaXNvbGF0ZSh0LGUpO2lmKG51bGwhPXIucXVlcnkobixyLlNjb3BlLkJMT1QpJiZvKWkud3JhcChuLG8pO2Vsc2UgaWYobnVsbCE9ci5xdWVyeShuLHIuU2NvcGUuQVRUUklCVVRFKSl7dmFyIGw9ci5jcmVhdGUodGhpcy5zdGF0aWNzLnNjb3BlKTtpLndyYXAobCksbC5mb3JtYXQobixvKX19LHQucHJvdG90eXBlLmluc2VydEF0PWZ1bmN0aW9uKHQsZSxuKXt2YXIgbz1udWxsPT1uP3IuY3JlYXRlKCJ0ZXh0IixlKTpyLmNyZWF0ZShlLG4pLGk9dGhpcy5zcGxpdCh0KTt0aGlzLnBhcmVudC5pbnNlcnRCZWZvcmUobyxpKX0sdC5wcm90b3R5cGUuaW5zZXJ0SW50bz1mdW5jdGlvbih0LGUpe3ZvaWQgMD09PWUmJihlPW51bGwpLG51bGwhPXRoaXMucGFyZW50JiZ0aGlzLnBhcmVudC5jaGlsZHJlbi5yZW1vdmUodGhpcyk7dmFyIG49bnVsbDt0LmNoaWxkcmVuLmluc2VydEJlZm9yZSh0aGlzLGUpLG51bGwhPWUmJihuPWUuZG9tTm9kZSksdGhpcy5kb21Ob2RlLnBhcmVudE5vZGU9PXQuZG9tTm9kZSYmdGhpcy5kb21Ob2RlLm5leHRTaWJsaW5nPT1ufHx0LmRvbU5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMuZG9tTm9kZSxuKSx0aGlzLnBhcmVudD10LHRoaXMuYXR0YWNoKCl9LHQucHJvdG90eXBlLmlzb2xhdGU9ZnVuY3Rpb24odCxlKXt2YXIgbj10aGlzLnNwbGl0KHQpO3JldHVybiBuLnNwbGl0KGUpLG59LHQucHJvdG90eXBlLmxlbmd0aD1mdW5jdGlvbigpe3JldHVybiAxfSx0LnByb3RvdHlwZS5vZmZzZXQ9ZnVuY3Rpb24odCl7cmV0dXJuIHZvaWQgMD09PXQmJih0PXRoaXMucGFyZW50KSxudWxsPT10aGlzLnBhcmVudHx8dGhpcz09dD8wOnRoaXMucGFyZW50LmNoaWxkcmVuLm9mZnNldCh0aGlzKSt0aGlzLnBhcmVudC5vZmZzZXQodCl9LHQucHJvdG90eXBlLm9wdGltaXplPWZ1bmN0aW9uKHQpe251bGwhPXRoaXMuZG9tTm9kZVtyLkRBVEFfS0VZXSYmZGVsZXRlIHRoaXMuZG9tTm9kZVtyLkRBVEFfS0VZXS5tdXRhdGlvbnN9LHQucHJvdG90eXBlLnJlbW92ZT1mdW5jdGlvbigpe251bGwhPXRoaXMuZG9tTm9kZS5wYXJlbnROb2RlJiZ0aGlzLmRvbU5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmRvbU5vZGUpLHRoaXMuZGV0YWNoKCl9LHQucHJvdG90eXBlLnJlcGxhY2U9ZnVuY3Rpb24odCl7bnVsbCE9dC5wYXJlbnQmJih0LnBhcmVudC5pbnNlcnRCZWZvcmUodGhpcyx0Lm5leHQpLHQucmVtb3ZlKCkpfSx0LnByb3RvdHlwZS5yZXBsYWNlV2l0aD1mdW5jdGlvbih0LGUpe3ZhciBuPSJzdHJpbmciPT10eXBlb2YgdD9yLmNyZWF0ZSh0LGUpOnQ7cmV0dXJuIG4ucmVwbGFjZSh0aGlzKSxufSx0LnByb3RvdHlwZS5zcGxpdD1mdW5jdGlvbih0LGUpe3JldHVybiAwPT09dD90aGlzOnRoaXMubmV4dH0sdC5wcm90b3R5cGUudXBkYXRlPWZ1bmN0aW9uKHQsZSl7fSx0LnByb3RvdHlwZS53cmFwPWZ1bmN0aW9uKHQsZSl7dmFyIG49InN0cmluZyI9PXR5cGVvZiB0P3IuY3JlYXRlKHQsZSk6dDtyZXR1cm4gbnVsbCE9dGhpcy5wYXJlbnQmJnRoaXMucGFyZW50Lmluc2VydEJlZm9yZShuLHRoaXMubmV4dCksbi5hcHBlbmRDaGlsZCh0aGlzKSxufSx0LmJsb3ROYW1lPSJhYnN0cmFjdCIsdH0oKTtlLmRlZmF1bHQ9b30sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIHI9bigxMSksbz1uKDI5KSxpPW4oMzApLGw9bigxKSxhPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0KXt0aGlzLmF0dHJpYnV0ZXM9e30sdGhpcy5kb21Ob2RlPXQsdGhpcy5idWlsZCgpfXJldHVybiB0LnByb3RvdHlwZS5hdHRyaWJ1dGU9ZnVuY3Rpb24odCxlKXtlP3QuYWRkKHRoaXMuZG9tTm9kZSxlKSYmKG51bGwhPXQudmFsdWUodGhpcy5kb21Ob2RlKT90aGlzLmF0dHJpYnV0ZXNbdC5hdHRyTmFtZV09dDpkZWxldGUgdGhpcy5hdHRyaWJ1dGVzW3QuYXR0ck5hbWVdKToodC5yZW1vdmUodGhpcy5kb21Ob2RlKSxkZWxldGUgdGhpcy5hdHRyaWJ1dGVzW3QuYXR0ck5hbWVdKX0sdC5wcm90b3R5cGUuYnVpbGQ9ZnVuY3Rpb24oKXt2YXIgdD10aGlzO3RoaXMuYXR0cmlidXRlcz17fTt2YXIgZT1yLmRlZmF1bHQua2V5cyh0aGlzLmRvbU5vZGUpLG49by5kZWZhdWx0LmtleXModGhpcy5kb21Ob2RlKSxhPWkuZGVmYXVsdC5rZXlzKHRoaXMuZG9tTm9kZSk7ZS5jb25jYXQobikuY29uY2F0KGEpLmZvckVhY2goZnVuY3Rpb24oZSl7dmFyIG49bC5xdWVyeShlLGwuU2NvcGUuQVRUUklCVVRFKTtuIGluc3RhbmNlb2Ygci5kZWZhdWx0JiYodC5hdHRyaWJ1dGVzW24uYXR0ck5hbWVdPW4pfSl9LHQucHJvdG90eXBlLmNvcHk9ZnVuY3Rpb24odCl7dmFyIGU9dGhpcztPYmplY3Qua2V5cyh0aGlzLmF0dHJpYnV0ZXMpLmZvckVhY2goZnVuY3Rpb24obil7dmFyIHI9ZS5hdHRyaWJ1dGVzW25dLnZhbHVlKGUuZG9tTm9kZSk7dC5mb3JtYXQobixyKX0pfSx0LnByb3RvdHlwZS5tb3ZlPWZ1bmN0aW9uKHQpe3ZhciBlPXRoaXM7dGhpcy5jb3B5KHQpLE9iamVjdC5rZXlzKHRoaXMuYXR0cmlidXRlcykuZm9yRWFjaChmdW5jdGlvbih0KXtlLmF0dHJpYnV0ZXNbdF0ucmVtb3ZlKGUuZG9tTm9kZSl9KSx0aGlzLmF0dHJpYnV0ZXM9e319LHQucHJvdG90eXBlLnZhbHVlcz1mdW5jdGlvbigpe3ZhciB0PXRoaXM7cmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuYXR0cmlidXRlcykucmVkdWNlKGZ1bmN0aW9uKGUsbil7cmV0dXJuIGVbbl09dC5hdHRyaWJ1dGVzW25dLnZhbHVlKHQuZG9tTm9kZSksZX0se30pfSx0fSgpO2UuZGVmYXVsdD1hfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCxlKXtyZXR1cm4odC5nZXRBdHRyaWJ1dGUoImNsYXNzIil8fCIiKS5zcGxpdCgvXHMrLykuZmlsdGVyKGZ1bmN0aW9uKHQpe3JldHVybiAwPT09dC5pbmRleE9mKGUrIi0iKX0pfXZhciBvPXRoaXMmJnRoaXMuX19leHRlbmRzfHxmdW5jdGlvbigpe3ZhciB0PU9iamVjdC5zZXRQcm90b3R5cGVPZnx8e19fcHJvdG9fXzpbXX1pbnN0YW5jZW9mIEFycmF5JiZmdW5jdGlvbih0LGUpe3QuX19wcm90b19fPWV9fHxmdW5jdGlvbih0LGUpe2Zvcih2YXIgbiBpbiBlKWUuaGFzT3duUHJvcGVydHkobikmJih0W25dPWVbbl0pfTtyZXR1cm4gZnVuY3Rpb24oZSxuKXtmdW5jdGlvbiByKCl7dGhpcy5jb25zdHJ1Y3Rvcj1lfXQoZSxuKSxlLnByb3RvdHlwZT1udWxsPT09bj9PYmplY3QuY3JlYXRlKG4pOihyLnByb3RvdHlwZT1uLnByb3RvdHlwZSxuZXcgcil9fSgpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgaT1uKDExKSxsPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXtyZXR1cm4gbnVsbCE9PXQmJnQuYXBwbHkodGhpcyxhcmd1bWVudHMpfHx0aGlzfXJldHVybiBvKGUsdCksZS5rZXlzPWZ1bmN0aW9uKHQpe3JldHVybih0LmdldEF0dHJpYnV0ZSgiY2xhc3MiKXx8IiIpLnNwbGl0KC9ccysvKS5tYXAoZnVuY3Rpb24odCl7cmV0dXJuIHQuc3BsaXQoIi0iKS5zbGljZSgwLC0xKS5qb2luKCItIil9KX0sZS5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKHQsZSl7cmV0dXJuISF0aGlzLmNhbkFkZCh0LGUpJiYodGhpcy5yZW1vdmUodCksdC5jbGFzc0xpc3QuYWRkKHRoaXMua2V5TmFtZSsiLSIrZSksITApfSxlLnByb3RvdHlwZS5yZW1vdmU9ZnVuY3Rpb24odCl7cih0LHRoaXMua2V5TmFtZSkuZm9yRWFjaChmdW5jdGlvbihlKXt0LmNsYXNzTGlzdC5yZW1vdmUoZSl9KSwwPT09dC5jbGFzc0xpc3QubGVuZ3RoJiZ0LnJlbW92ZUF0dHJpYnV0ZSgiY2xhc3MiKX0sZS5wcm90b3R5cGUudmFsdWU9ZnVuY3Rpb24odCl7dmFyIGU9cih0LHRoaXMua2V5TmFtZSlbMF18fCIiLG49ZS5zbGljZSh0aGlzLmtleU5hbWUubGVuZ3RoKzEpO3JldHVybiB0aGlzLmNhbkFkZCh0LG4pP246IiJ9LGV9KGkuZGVmYXVsdCk7ZS5kZWZhdWx0PWx9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0KXt2YXIgZT10LnNwbGl0KCItIiksbj1lLnNsaWNlKDEpLm1hcChmdW5jdGlvbih0KXtyZXR1cm4gdFswXS50b1VwcGVyQ2FzZSgpK3Quc2xpY2UoMSl9KS5qb2luKCIiKTtyZXR1cm4gZVswXStufXZhciBvPXRoaXMmJnRoaXMuX19leHRlbmRzfHxmdW5jdGlvbigpe3ZhciB0PU9iamVjdC5zZXRQcm90b3R5cGVPZnx8e19fcHJvdG9fXzpbXX1pbnN0YW5jZW9mIEFycmF5JiZmdW5jdGlvbih0LGUpe3QuX19wcm90b19fPWV9fHxmdW5jdGlvbih0LGUpe2Zvcih2YXIgbiBpbiBlKWUuaGFzT3duUHJvcGVydHkobikmJih0W25dPWVbbl0pfTtyZXR1cm4gZnVuY3Rpb24oZSxuKXtmdW5jdGlvbiByKCl7dGhpcy5jb25zdHJ1Y3Rvcj1lfXQoZSxuKSxlLnByb3RvdHlwZT1udWxsPT09bj9PYmplY3QuY3JlYXRlKG4pOihyLnByb3RvdHlwZT1uLnByb3RvdHlwZSxuZXcgcil9fSgpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgaT1uKDExKSxsPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXtyZXR1cm4gbnVsbCE9PXQmJnQuYXBwbHkodGhpcyxhcmd1bWVudHMpfHx0aGlzfXJldHVybiBvKGUsdCksZS5rZXlzPWZ1bmN0aW9uKHQpe3JldHVybih0LmdldEF0dHJpYnV0ZSgic3R5bGUiKXx8IiIpLnNwbGl0KCI7IikubWFwKGZ1bmN0aW9uKHQpe3JldHVybiB0LnNwbGl0KCI6IilbMF0udHJpbSgpfSl9LGUucHJvdG90eXBlLmFkZD1mdW5jdGlvbih0LGUpe3JldHVybiEhdGhpcy5jYW5BZGQodCxlKSYmKHQuc3R5bGVbcih0aGlzLmtleU5hbWUpXT1lLCEwKX0sZS5wcm90b3R5cGUucmVtb3ZlPWZ1bmN0aW9uKHQpe3Quc3R5bGVbcih0aGlzLmtleU5hbWUpXT0iIix0LmdldEF0dHJpYnV0ZSgic3R5bGUiKXx8dC5yZW1vdmVBdHRyaWJ1dGUoInN0eWxlIil9LGUucHJvdG90eXBlLnZhbHVlPWZ1bmN0aW9uKHQpe3ZhciBlPXQuc3R5bGVbcih0aGlzLmtleU5hbWUpXTtyZXR1cm4gdGhpcy5jYW5BZGQodCxlKT9lOiIifSxlfShpLmRlZmF1bHQpO2UuZGVmYXVsdD1sfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fWZ1bmN0aW9uIG8odCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBpKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gbCh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBhPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe3ZhciBuPVtdLHI9ITAsbz0hMSxpPXZvaWQgMDt0cnl7Zm9yKHZhciBsLGE9dFtTeW1ib2wuaXRlcmF0b3JdKCk7IShyPShsPWEubmV4dCgpKS5kb25lKSYmKG4ucHVzaChsLnZhbHVlKSwhZXx8bi5sZW5ndGghPT1lKTtyPSEwKTt9Y2F0Y2godCl7bz0hMCxpPXR9ZmluYWxseXt0cnl7IXImJmEucmV0dXJuJiZhLnJldHVybigpfWZpbmFsbHl7aWYobyl0aHJvdyBpfX1yZXR1cm4gbn1yZXR1cm4gZnVuY3Rpb24oZSxuKXtpZihBcnJheS5pc0FycmF5KGUpKXJldHVybiBlO2lmKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoZSkpcmV0dXJuIHQoZSxuKTt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIil9fSgpLHM9ZnVuY3Rpb24gdChlLG4scil7bnVsbD09PWUmJihlPUZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIG89T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLG4pO2lmKHZvaWQgMD09PW8pe3ZhciBpPU9iamVjdC5nZXRQcm90b3R5cGVPZihlKTtyZXR1cm4gbnVsbD09PWk/dm9pZCAwOnQoaSxuLHIpfWlmKCJ2YWx1ZSJpbiBvKXJldHVybiBvLnZhbHVlO3ZhciBsPW8uZ2V0O2lmKHZvaWQgMCE9PWwpcmV0dXJuIGwuY2FsbChyKX0sdT1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZVtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX1yZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfX0oKSxjPW4oMCksZj1yKGMpLGg9big4KSxwPXIoaCksZD1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKHQsbil7byh0aGlzLGUpO3ZhciByPWkodGhpcywoZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSkuY2FsbCh0aGlzLHQpKTtyZXR1cm4gci5zZWxlY3Rpb249bixyLnRleHROb2RlPWRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGUuQ09OVEVOVFMpLHIuZG9tTm9kZS5hcHBlbmRDaGlsZChyLnRleHROb2RlKSxyLl9sZW5ndGg9MCxyfXJldHVybiBsKGUsdCksdShlLG51bGwsW3trZXk6InZhbHVlIix2YWx1ZTpmdW5jdGlvbigpe319XSksdShlLFt7a2V5OiJkZXRhY2giLHZhbHVlOmZ1bmN0aW9uKCl7bnVsbCE9dGhpcy5wYXJlbnQmJnRoaXMucGFyZW50LnJlbW92ZUNoaWxkKHRoaXMpfX0se2tleToiZm9ybWF0Iix2YWx1ZTpmdW5jdGlvbih0LG4pe2lmKDAhPT10aGlzLl9sZW5ndGgpcmV0dXJuIHMoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJmb3JtYXQiLHRoaXMpLmNhbGwodGhpcyx0LG4pO2Zvcih2YXIgcj10aGlzLG89MDtudWxsIT1yJiZyLnN0YXRpY3Muc2NvcGUhPT1mLmRlZmF1bHQuU2NvcGUuQkxPQ0tfQkxPVDspbys9ci5vZmZzZXQoci5wYXJlbnQpLHI9ci5wYXJlbnQ7bnVsbCE9ciYmKHRoaXMuX2xlbmd0aD1lLkNPTlRFTlRTLmxlbmd0aCxyLm9wdGltaXplKCksci5mb3JtYXRBdChvLGUuQ09OVEVOVFMubGVuZ3RoLHQsbiksdGhpcy5fbGVuZ3RoPTApfX0se2tleToiaW5kZXgiLHZhbHVlOmZ1bmN0aW9uKHQsbil7cmV0dXJuIHQ9PT10aGlzLnRleHROb2RlPzA6cyhlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksImluZGV4Iix0aGlzKS5jYWxsKHRoaXMsdCxuKX19LHtrZXk6Imxlbmd0aCIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbGVuZ3RofX0se2tleToicG9zaXRpb24iLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuW3RoaXMudGV4dE5vZGUsdGhpcy50ZXh0Tm9kZS5kYXRhLmxlbmd0aF19fSx7a2V5OiJyZW1vdmUiLHZhbHVlOmZ1bmN0aW9uKCl7cyhlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksInJlbW92ZSIsdGhpcykuY2FsbCh0aGlzKSx0aGlzLnBhcmVudD1udWxsfX0se2tleToicmVzdG9yZSIsdmFsdWU6ZnVuY3Rpb24oKXtpZighdGhpcy5zZWxlY3Rpb24uY29tcG9zaW5nJiZudWxsIT10aGlzLnBhcmVudCl7dmFyIHQ9dGhpcy50ZXh0Tm9kZSxuPXRoaXMuc2VsZWN0aW9uLmdldE5hdGl2ZVJhbmdlKCkscj12b2lkIDAsbz12b2lkIDAsaT12b2lkIDA7aWYobnVsbCE9biYmbi5zdGFydC5ub2RlPT09dCYmbi5lbmQubm9kZT09PXQpe3ZhciBsPVt0LG4uc3RhcnQub2Zmc2V0LG4uZW5kLm9mZnNldF07cj1sWzBdLG89bFsxXSxpPWxbMl19Zm9yKDtudWxsIT10aGlzLmRvbU5vZGUubGFzdENoaWxkJiZ0aGlzLmRvbU5vZGUubGFzdENoaWxkIT09dGhpcy50ZXh0Tm9kZTspdGhpcy5kb21Ob2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMuZG9tTm9kZS5sYXN0Q2hpbGQsdGhpcy5kb21Ob2RlKTtpZih0aGlzLnRleHROb2RlLmRhdGEhPT1lLkNPTlRFTlRTKXt2YXIgcz10aGlzLnRleHROb2RlLmRhdGEuc3BsaXQoZS5DT05URU5UUykuam9pbigiIik7dGhpcy5uZXh0IGluc3RhbmNlb2YgcC5kZWZhdWx0PyhyPXRoaXMubmV4dC5kb21Ob2RlLHRoaXMubmV4dC5pbnNlcnRBdCgwLHMpLHRoaXMudGV4dE5vZGUuZGF0YT1lLkNPTlRFTlRTKToodGhpcy50ZXh0Tm9kZS5kYXRhPXMsdGhpcy5wYXJlbnQuaW5zZXJ0QmVmb3JlKGYuZGVmYXVsdC5jcmVhdGUodGhpcy50ZXh0Tm9kZSksdGhpcyksdGhpcy50ZXh0Tm9kZT1kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShlLkNPTlRFTlRTKSx0aGlzLmRvbU5vZGUuYXBwZW5kQ2hpbGQodGhpcy50ZXh0Tm9kZSkpfWlmKHRoaXMucmVtb3ZlKCksbnVsbCE9byl7dmFyIHU9W28saV0ubWFwKGZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLm1heCgwLE1hdGgubWluKHIuZGF0YS5sZW5ndGgsdC0xKSl9KSxjPWEodSwyKTtyZXR1cm4gbz1jWzBdLGk9Y1sxXSx7c3RhcnROb2RlOnIsc3RhcnRPZmZzZXQ6byxlbmROb2RlOnIsZW5kT2Zmc2V0Oml9fX19fSx7a2V5OiJ1cGRhdGUiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcztpZih0LnNvbWUoZnVuY3Rpb24odCl7cmV0dXJuImNoYXJhY3RlckRhdGEiPT09dC50eXBlJiZ0LnRhcmdldD09PW4udGV4dE5vZGV9KSl7dmFyIHI9dGhpcy5yZXN0b3JlKCk7ciYmKGUucmFuZ2U9cil9fX0se2tleToidmFsdWUiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIiJ9fV0pLGV9KGYuZGVmYXVsdC5FbWJlZCk7ZC5ibG90TmFtZT0iY3Vyc29yIixkLmNsYXNzTmFtZT0icWwtY3Vyc29yIixkLnRhZ05hbWU9InNwYW4iLGQuQ09OVEVOVFM9Ilx1ZmVmZiIsZS5kZWZhdWx0PWR9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgbz1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZVtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX1yZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfX0oKSxpPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdChlLG4pe3IodGhpcyx0KSx0aGlzLnF1aWxsPWUsdGhpcy5vcHRpb25zPW4sdGhpcy5tb2R1bGVzPXt9fXJldHVybiBvKHQsW3trZXk6ImluaXQiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcztPYmplY3Qua2V5cyh0aGlzLm9wdGlvbnMubW9kdWxlcykuZm9yRWFjaChmdW5jdGlvbihlKXtudWxsPT10Lm1vZHVsZXNbZV0mJnQuYWRkTW9kdWxlKGUpfSl9fSx7a2V5OiJhZGRNb2R1bGUiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMucXVpbGwuY29uc3RydWN0b3IuaW1wb3J0KCJtb2R1bGVzLyIrdCk7cmV0dXJuIHRoaXMubW9kdWxlc1t0XT1uZXcgZSh0aGlzLnF1aWxsLHRoaXMub3B0aW9ucy5tb2R1bGVzW3RdfHx7fSksdGhpcy5tb2R1bGVzW3RdfX1dKSx0fSgpO2kuREVGQVVMVFM9e21vZHVsZXM6e319LGkudGhlbWVzPXtkZWZhdWx0Oml9LGUuZGVmYXVsdD1pfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fWZ1bmN0aW9uIG8odCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBpKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gbCh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBhPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lW25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsci5rZXkscil9fXJldHVybiBmdW5jdGlvbihlLG4scil7cmV0dXJuIG4mJnQoZS5wcm90b3R5cGUsbiksciYmdChlLHIpLGV9fSgpLHM9ZnVuY3Rpb24gdChlLG4scil7bnVsbD09PWUmJihlPUZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIG89T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLG4pO2lmKHZvaWQgMD09PW8pe3ZhciBpPU9iamVjdC5nZXRQcm90b3R5cGVPZihlKTtyZXR1cm4gbnVsbD09PWk/dm9pZCAwOnQoaSxuLHIpfWlmKCJ2YWx1ZSJpbiBvKXJldHVybiBvLnZhbHVlO3ZhciBsPW8uZ2V0O2lmKHZvaWQgMCE9PWwpcmV0dXJuIGwuY2FsbChyKX0sdT1uKDApLGM9cih1KSxmPW4oOCksaD1yKGYpLHA9Ilx1ZmVmZiIsZD1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKHQpe28odGhpcyxlKTt2YXIgbj1pKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmNhbGwodGhpcyx0KSk7cmV0dXJuIG4uY29udGVudE5vZGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpLG4uY29udGVudE5vZGUuc2V0QXR0cmlidXRlKCJjb250ZW50ZWRpdGFibGUiLCExKSxbXS5zbGljZS5jYWxsKG4uZG9tTm9kZS5jaGlsZE5vZGVzKS5mb3JFYWNoKGZ1bmN0aW9uKHQpe24uY29udGVudE5vZGUuYXBwZW5kQ2hpbGQodCl9KSxuLmxlZnRHdWFyZD1kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShwKSxuLnJpZ2h0R3VhcmQ9ZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocCksbi5kb21Ob2RlLmFwcGVuZENoaWxkKG4ubGVmdEd1YXJkKSxuLmRvbU5vZGUuYXBwZW5kQ2hpbGQobi5jb250ZW50Tm9kZSksbi5kb21Ob2RlLmFwcGVuZENoaWxkKG4ucmlnaHRHdWFyZCksbn1yZXR1cm4gbChlLHQpLGEoZSxbe2tleToiaW5kZXgiLHZhbHVlOmZ1bmN0aW9uKHQsbil7cmV0dXJuIHQ9PT10aGlzLmxlZnRHdWFyZD8wOnQ9PT10aGlzLnJpZ2h0R3VhcmQ/MTpzKGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwiaW5kZXgiLHRoaXMpLmNhbGwodGhpcyx0LG4pfX0se2tleToicmVzdG9yZSIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIGU9dm9pZCAwLG49dm9pZCAwLHI9dC5kYXRhLnNwbGl0KHApLmpvaW4oIiIpO2lmKHQ9PT10aGlzLmxlZnRHdWFyZClpZih0aGlzLnByZXYgaW5zdGFuY2VvZiBoLmRlZmF1bHQpe3ZhciBvPXRoaXMucHJldi5sZW5ndGgoKTt0aGlzLnByZXYuaW5zZXJ0QXQobyxyKSxlPXtzdGFydE5vZGU6dGhpcy5wcmV2LmRvbU5vZGUsc3RhcnRPZmZzZXQ6bytyLmxlbmd0aH19ZWxzZSBuPWRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHIpLHRoaXMucGFyZW50Lmluc2VydEJlZm9yZShjLmRlZmF1bHQuY3JlYXRlKG4pLHRoaXMpLGU9e3N0YXJ0Tm9kZTpuLHN0YXJ0T2Zmc2V0OnIubGVuZ3RofTtlbHNlIHQ9PT10aGlzLnJpZ2h0R3VhcmQmJih0aGlzLm5leHQgaW5zdGFuY2VvZiBoLmRlZmF1bHQ/KHRoaXMubmV4dC5pbnNlcnRBdCgwLHIpLGU9e3N0YXJ0Tm9kZTp0aGlzLm5leHQuZG9tTm9kZSxzdGFydE9mZnNldDpyLmxlbmd0aH0pOihuPWRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHIpLHRoaXMucGFyZW50Lmluc2VydEJlZm9yZShjLmRlZmF1bHQuY3JlYXRlKG4pLHRoaXMubmV4dCksZT17c3RhcnROb2RlOm4sc3RhcnRPZmZzZXQ6ci5sZW5ndGh9KSk7cmV0dXJuIHQuZGF0YT1wLGV9fSx7a2V5OiJ1cGRhdGUiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpczt0LmZvckVhY2goZnVuY3Rpb24odCl7aWYoImNoYXJhY3RlckRhdGEiPT09dC50eXBlJiYodC50YXJnZXQ9PT1uLmxlZnRHdWFyZHx8dC50YXJnZXQ9PT1uLnJpZ2h0R3VhcmQpKXt2YXIgcj1uLnJlc3RvcmUodC50YXJnZXQpO3ImJihlLnJhbmdlPXIpfX0pfX1dKSxlfShjLmRlZmF1bHQuRW1iZWQpO2UuZGVmYXVsdD1kfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxlLkFsaWduU3R5bGU9ZS5BbGlnbkNsYXNzPWUuQWxpZ25BdHRyaWJ1dGU9dm9pZCAwO3ZhciByPW4oMCksbz1mdW5jdGlvbih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19KHIpLGk9e3Njb3BlOm8uZGVmYXVsdC5TY29wZS5CTE9DSyx3aGl0ZWxpc3Q6WyJyaWdodCIsImNlbnRlciIsImp1c3RpZnkiXX0sbD1uZXcgby5kZWZhdWx0LkF0dHJpYnV0b3IuQXR0cmlidXRlKCJhbGlnbiIsImFsaWduIixpKSxhPW5ldyBvLmRlZmF1bHQuQXR0cmlidXRvci5DbGFzcygiYWxpZ24iLCJxbC1hbGlnbiIsaSkscz1uZXcgby5kZWZhdWx0LkF0dHJpYnV0b3IuU3R5bGUoImFsaWduIiwidGV4dC1hbGlnbiIsaSk7ZS5BbGlnbkF0dHJpYnV0ZT1sLGUuQWxpZ25DbGFzcz1hLGUuQWxpZ25TdHlsZT1zfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxlLkJhY2tncm91bmRTdHlsZT1lLkJhY2tncm91bmRDbGFzcz12b2lkIDA7dmFyIHI9bigwKSxvPWZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX0ociksaT1uKDI0KSxsPW5ldyBvLmRlZmF1bHQuQXR0cmlidXRvci5DbGFzcygiYmFja2dyb3VuZCIsInFsLWJnIix7c2NvcGU6by5kZWZhdWx0LlNjb3BlLklOTElORX0pLGE9bmV3IGkuQ29sb3JBdHRyaWJ1dG9yKCJiYWNrZ3JvdW5kIiwiYmFja2dyb3VuZC1jb2xvciIse3Njb3BlOm8uZGVmYXVsdC5TY29wZS5JTkxJTkV9KTtlLkJhY2tncm91bmRDbGFzcz1sLGUuQmFja2dyb3VuZFN0eWxlPWF9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pLGUuRGlyZWN0aW9uU3R5bGU9ZS5EaXJlY3Rpb25DbGFzcz1lLkRpcmVjdGlvbkF0dHJpYnV0ZT12b2lkIDA7dmFyIHI9bigwKSxvPWZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX0ociksaT17c2NvcGU6by5kZWZhdWx0LlNjb3BlLkJMT0NLLHdoaXRlbGlzdDpbInJ0bCJdfSxsPW5ldyBvLmRlZmF1bHQuQXR0cmlidXRvci5BdHRyaWJ1dGUoImRpcmVjdGlvbiIsImRpciIsaSksYT1uZXcgby5kZWZhdWx0LkF0dHJpYnV0b3IuQ2xhc3MoImRpcmVjdGlvbiIsInFsLWRpcmVjdGlvbiIsaSkscz1uZXcgby5kZWZhdWx0LkF0dHJpYnV0b3IuU3R5bGUoImRpcmVjdGlvbiIsImRpcmVjdGlvbiIsaSk7ZS5EaXJlY3Rpb25BdHRyaWJ1dGU9bCxlLkRpcmVjdGlvbkNsYXNzPWEsZS5EaXJlY3Rpb25TdHlsZT1zfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBvKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gaSh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pLGUuRm9udENsYXNzPWUuRm9udFN0eWxlPXZvaWQgMDt2YXIgbD1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZVtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX1yZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfX0oKSxhPWZ1bmN0aW9uIHQoZSxuLHIpe251bGw9PT1lJiYoZT1GdW5jdGlvbi5wcm90b3R5cGUpO3ZhciBvPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSxuKTtpZih2b2lkIDA9PT1vKXt2YXIgaT1PYmplY3QuZ2V0UHJvdG90eXBlT2YoZSk7cmV0dXJuIG51bGw9PT1pP3ZvaWQgMDp0KGksbixyKX1pZigidmFsdWUiaW4gbylyZXR1cm4gby52YWx1ZTt2YXIgbD1vLmdldDtpZih2b2lkIDAhPT1sKXJldHVybiBsLmNhbGwocil9LHM9bigwKSx1PWZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX0ocyksYz17c2NvcGU6dS5kZWZhdWx0LlNjb3BlLklOTElORSx3aGl0ZWxpc3Q6WyJzZXJpZiIsIm1vbm9zcGFjZSJdfSxmPW5ldyB1LmRlZmF1bHQuQXR0cmlidXRvci5DbGFzcygiZm9udCIsInFsLWZvbnQiLGMpLGg9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSgpe3JldHVybiByKHRoaXMsZSksbyh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5hcHBseSh0aGlzLGFyZ3VtZW50cykpfXJldHVybiBpKGUsdCksbChlLFt7a2V5OiJ2YWx1ZSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGEoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJ2YWx1ZSIsdGhpcykuY2FsbCh0aGlzLHQpLnJlcGxhY2UoL1siJ10vZywiIil9fV0pLGV9KHUuZGVmYXVsdC5BdHRyaWJ1dG9yLlN0eWxlKSxwPW5ldyBoKCJmb250IiwiZm9udC1mYW1pbHkiLGMpO2UuRm9udFN0eWxlPXAsZS5Gb250Q2xhc3M9Zn0sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksZS5TaXplU3R5bGU9ZS5TaXplQ2xhc3M9dm9pZCAwO3ZhciByPW4oMCksbz1mdW5jdGlvbih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19KHIpLGk9bmV3IG8uZGVmYXVsdC5BdHRyaWJ1dG9yLkNsYXNzKCJzaXplIiwicWwtc2l6ZSIse3Njb3BlOm8uZGVmYXVsdC5TY29wZS5JTkxJTkUsd2hpdGVsaXN0Olsic21hbGwiLCJsYXJnZSIsImh1Z2UiXX0pLGw9bmV3IG8uZGVmYXVsdC5BdHRyaWJ1dG9yLlN0eWxlKCJzaXplIiwiZm9udC1zaXplIix7c2NvcGU6by5kZWZhdWx0LlNjb3BlLklOTElORSx3aGl0ZWxpc3Q6WyIxMHB4IiwiMThweCIsIjMycHgiXX0pO2UuU2l6ZUNsYXNzPWksZS5TaXplU3R5bGU9bH0sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiByKHQsZSl7aWYoISh0IGluc3RhbmNlb2YgZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIil9ZnVuY3Rpb24gbyh0LGUpe2lmKCF0KXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7cmV0dXJuIWV8fCJvYmplY3QiIT10eXBlb2YgZSYmImZ1bmN0aW9uIiE9dHlwZW9mIGU/dDplfWZ1bmN0aW9uIGkodCxlKXtpZigiZnVuY3Rpb24iIT10eXBlb2YgZSYmbnVsbCE9PWUpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiK3R5cGVvZiBlKTt0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGUmJmUucHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6dCxlbnVtZXJhYmxlOiExLHdyaXRhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH19KSxlJiYoT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0LGUpOnQuX19wcm90b19fPWUpfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgbD1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZVtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX1yZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfX0oKSxhPWZ1bmN0aW9uIHQoZSxuLHIpe251bGw9PT1lJiYoZT1GdW5jdGlvbi5wcm90b3R5cGUpO3ZhciBvPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSxuKTtpZih2b2lkIDA9PT1vKXt2YXIgaT1PYmplY3QuZ2V0UHJvdG90eXBlT2YoZSk7cmV0dXJuIG51bGw9PT1pP3ZvaWQgMDp0KGksbixyKX1pZigidmFsdWUiaW4gbylyZXR1cm4gby52YWx1ZTt2YXIgbD1vLmdldDtpZih2b2lkIDAhPT1sKXJldHVybiBsLmNhbGwocil9LHM9big1KSx1PWZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX0ocyksYz1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKCl7cmV0dXJuIHIodGhpcyxlKSxvKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9cmV0dXJuIGkoZSx0KSxsKGUsW3trZXk6Im9wdGltaXplIix2YWx1ZTpmdW5jdGlvbih0KXthKGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwib3B0aW1pemUiLHRoaXMpLmNhbGwodGhpcyx0KSx0aGlzLmRvbU5vZGUudGFnTmFtZSE9PXRoaXMuc3RhdGljcy50YWdOYW1lWzBdJiZ0aGlzLnJlcGxhY2VXaXRoKHRoaXMuc3RhdGljcy5ibG90TmFtZSl9fV0sW3trZXk6ImNyZWF0ZSIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gYShlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpLCJjcmVhdGUiLHRoaXMpLmNhbGwodGhpcyl9fSx7a2V5OiJmb3JtYXRzIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiEwfX1dKSxlfSh1LmRlZmF1bHQpO2MuYmxvdE5hbWU9ImJvbGQiLGMudGFnTmFtZT1bIlNUUk9ORyIsIkIiXSxlLmRlZmF1bHQ9Y30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPHBvbHlsaW5lIGNsYXNzPSJxbC1ldmVuIHFsLXN0cm9rZSIgcG9pbnRzPSI1IDcgMyA5IDUgMTEiPjwvcG9seWxpbmU+IDxwb2x5bGluZSBjbGFzcz0icWwtZXZlbiBxbC1zdHJva2UiIHBvaW50cz0iMTMgNyAxNSA5IDEzIDExIj48L3BvbHlsaW5lPiA8bGluZSBjbGFzcz1xbC1zdHJva2UgeDE9MTAgeDI9OCB5MT01IHkyPTEzPjwvbGluZT4gPC9zdmc+J30sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiByKHQsZSl7aWYoISh0IGluc3RhbmNlb2YgZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIil9ZnVuY3Rpb24gbyh0LGUpe2lmKCF0KXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7cmV0dXJuIWV8fCJvYmplY3QiIT10eXBlb2YgZSYmImZ1bmN0aW9uIiE9dHlwZW9mIGU/dDplfWZ1bmN0aW9uIGkodCxlKXtpZigiZnVuY3Rpb24iIT10eXBlb2YgZSYmbnVsbCE9PWUpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiK3R5cGVvZiBlKTt0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGUmJmUucHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6dCxlbnVtZXJhYmxlOiExLHdyaXRhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH19KSxlJiYoT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0LGUpOnQuX19wcm90b19fPWUpfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgbD1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZVtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX1yZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfX0oKSxhPWZ1bmN0aW9uIHQoZSxuLHIpe251bGw9PT1lJiYoZT1GdW5jdGlvbi5wcm90b3R5cGUpO3ZhciBvPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSxuKTtpZih2b2lkIDA9PT1vKXt2YXIgaT1PYmplY3QuZ2V0UHJvdG90eXBlT2YoZSk7cmV0dXJuIG51bGw9PT1pP3ZvaWQgMDp0KGksbixyKX1pZigidmFsdWUiaW4gbylyZXR1cm4gby52YWx1ZTt2YXIgbD1vLmdldDtpZih2b2lkIDAhPT1sKXJldHVybiBsLmNhbGwocil9LHM9bigxNiksdT1mdW5jdGlvbih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19KHMpLGM9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSh0LG4pe3IodGhpcyxlKTt2YXIgaT1vKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmNhbGwodGhpcyx0KSk7cmV0dXJuIGkubGFiZWwuaW5uZXJIVE1MPW4saS5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgicWwtY29sb3ItcGlja2VyIiksW10uc2xpY2UuY2FsbChpLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCIucWwtcGlja2VyLWl0ZW0iKSwwLDcpLmZvckVhY2goZnVuY3Rpb24odCl7dC5jbGFzc0xpc3QuYWRkKCJxbC1wcmltYXJ5Iil9KSxpfXJldHVybiBpKGUsdCksbChlLFt7a2V5OiJidWlsZEl0ZW0iLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBuPWEoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJidWlsZEl0ZW0iLHRoaXMpLmNhbGwodGhpcyx0KTtyZXR1cm4gbi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3I9dC5nZXRBdHRyaWJ1dGUoInZhbHVlIil8fCIiLG59fSx7a2V5OiJzZWxlY3RJdGVtIix2YWx1ZTpmdW5jdGlvbih0LG4pe2EoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJzZWxlY3RJdGVtIix0aGlzKS5jYWxsKHRoaXMsdCxuKTt2YXIgcj10aGlzLmxhYmVsLnF1ZXJ5U2VsZWN0b3IoIi5xbC1jb2xvci1sYWJlbCIpLG89dD90LmdldEF0dHJpYnV0ZSgiZGF0YS12YWx1ZSIpfHwiIjoiIjtyJiYoImxpbmUiPT09ci50YWdOYW1lP3Iuc3R5bGUuc3Ryb2tlPW86ci5zdHlsZS5maWxsPW8pfX1dKSxlfSh1LmRlZmF1bHQpO2UuZGVmYXVsdD1jfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBvKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gaSh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBsPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lW25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsci5rZXkscil9fXJldHVybiBmdW5jdGlvbihlLG4scil7cmV0dXJuIG4mJnQoZS5wcm90b3R5cGUsbiksciYmdChlLHIpLGV9fSgpLGE9ZnVuY3Rpb24gdChlLG4scil7bnVsbD09PWUmJihlPUZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIG89T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLG4pO2lmKHZvaWQgMD09PW8pe3ZhciBpPU9iamVjdC5nZXRQcm90b3R5cGVPZihlKTtyZXR1cm4gbnVsbD09PWk/dm9pZCAwOnQoaSxuLHIpfWlmKCJ2YWx1ZSJpbiBvKXJldHVybiBvLnZhbHVlO3ZhciBsPW8uZ2V0O2lmKHZvaWQgMCE9PWwpcmV0dXJuIGwuY2FsbChyKX0scz1uKDE2KSx1PWZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX0ocyksYz1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKHQsbil7cih0aGlzLGUpO3ZhciBpPW8odGhpcywoZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSkuY2FsbCh0aGlzLHQpKTtyZXR1cm4gaS5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgicWwtaWNvbi1waWNrZXIiKSxbXS5mb3JFYWNoLmNhbGwoaS5jb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgiLnFsLXBpY2tlci1pdGVtIiksZnVuY3Rpb24odCl7dC5pbm5lckhUTUw9blt0LmdldEF0dHJpYnV0ZSgiZGF0YS12YWx1ZSIpfHwiIl19KSxpLmRlZmF1bHRJdGVtPWkuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoIi5xbC1zZWxlY3RlZCIpLGkuc2VsZWN0SXRlbShpLmRlZmF1bHRJdGVtKSxpfXJldHVybiBpKGUsdCksbChlLFt7a2V5OiJzZWxlY3RJdGVtIix2YWx1ZTpmdW5jdGlvbih0LG4pe2EoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJzZWxlY3RJdGVtIix0aGlzKS5jYWxsKHRoaXMsdCxuKSx0PXR8fHRoaXMuZGVmYXVsdEl0ZW0sdGhpcy5sYWJlbC5pbm5lckhUTUw9dC5pbm5lckhUTUx9fV0pLGV9KHUuZGVmYXVsdCk7ZS5kZWZhdWx0PWN9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgbz1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZVtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX1yZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfX0oKSxpPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdChlLG4pe3ZhciBvPXRoaXM7cih0aGlzLHQpLHRoaXMucXVpbGw9ZSx0aGlzLmJvdW5kc0NvbnRhaW5lcj1ufHxkb2N1bWVudC5ib2R5LHRoaXMucm9vdD1lLmFkZENvbnRhaW5lcigicWwtdG9vbHRpcCIpLHRoaXMucm9vdC5pbm5lckhUTUw9dGhpcy5jb25zdHJ1Y3Rvci5URU1QTEFURSx0aGlzLnF1aWxsLnJvb3Q9PT10aGlzLnF1aWxsLnNjcm9sbGluZ0NvbnRhaW5lciYmdGhpcy5xdWlsbC5yb290LmFkZEV2ZW50TGlzdGVuZXIoInNjcm9sbCIsZnVuY3Rpb24oKXtvLnJvb3Quc3R5bGUubWFyZ2luVG9wPS0xKm8ucXVpbGwucm9vdC5zY3JvbGxUb3ArInB4In0pLHRoaXMuaGlkZSgpfXJldHVybiBvKHQsW3trZXk6ImhpZGUiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5yb290LmNsYXNzTGlzdC5hZGQoInFsLWhpZGRlbiIpfX0se2tleToicG9zaXRpb24iLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPXQubGVmdCt0LndpZHRoLzItdGhpcy5yb290Lm9mZnNldFdpZHRoLzIsbj10LmJvdHRvbSt0aGlzLnF1aWxsLnJvb3Quc2Nyb2xsVG9wO3RoaXMucm9vdC5zdHlsZS5sZWZ0PWUrInB4Iix0aGlzLnJvb3Quc3R5bGUudG9wPW4rInB4Iix0aGlzLnJvb3QuY2xhc3NMaXN0LnJlbW92ZSgicWwtZmxpcCIpO3ZhciByPXRoaXMuYm91bmRzQ29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLG89dGhpcy5yb290LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLGk9MDtpZihvLnJpZ2h0PnIucmlnaHQmJihpPXIucmlnaHQtby5yaWdodCx0aGlzLnJvb3Quc3R5bGUubGVmdD1lK2krInB4Iiksby5sZWZ0PHIubGVmdCYmKGk9ci5sZWZ0LW8ubGVmdCx0aGlzLnJvb3Quc3R5bGUubGVmdD1lK2krInB4Iiksby5ib3R0b20+ci5ib3R0b20pe3ZhciBsPW8uYm90dG9tLW8udG9wLGE9dC5ib3R0b20tdC50b3ArbDt0aGlzLnJvb3Quc3R5bGUudG9wPW4tYSsicHgiLHRoaXMucm9vdC5jbGFzc0xpc3QuYWRkKCJxbC1mbGlwIil9cmV0dXJuIGl9fSx7a2V5OiJzaG93Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMucm9vdC5jbGFzc0xpc3QucmVtb3ZlKCJxbC1lZGl0aW5nIiksdGhpcy5yb290LmNsYXNzTGlzdC5yZW1vdmUoInFsLWhpZGRlbiIpfX1dKSx0fSgpO2UuZGVmYXVsdD1pfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fWZ1bmN0aW9uIG8odCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBpKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gbCh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9ZnVuY3Rpb24gYSh0KXt2YXIgZT10Lm1hdGNoKC9eKD86KGh0dHBzPyk6XC9cLyk/KD86KD86d3d3fG0pXC4pP3lvdXR1YmVcLmNvbVwvd2F0Y2guKnY9KFthLXpBLVowLTlfLV0rKS8pfHx0Lm1hdGNoKC9eKD86KGh0dHBzPyk6XC9cLyk/KD86KD86d3d3fG0pXC4pP3lvdXR1XC5iZVwvKFthLXpBLVowLTlfLV0rKS8pO3JldHVybiBlPyhlWzFdfHwiaHR0cHMiKSsiOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkLyIrZVsyXSsiP3Nob3dpbmZvPTAiOihlPXQubWF0Y2goL14oPzooaHR0cHM/KTpcL1wvKT8oPzp3d3dcLik/dmltZW9cLmNvbVwvKFxkKykvKSk/KGVbMV18fCJodHRwcyIpKyI6Ly9wbGF5ZXIudmltZW8uY29tL3ZpZGVvLyIrZVsyXSsiLyI6dH1mdW5jdGlvbiBzKHQsZSl7dmFyIG49YXJndW1lbnRzLmxlbmd0aD4yJiZ2b2lkIDAhPT1hcmd1bWVudHNbMl0mJmFyZ3VtZW50c1syXTtlLmZvckVhY2goZnVuY3Rpb24oZSl7dmFyIHI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7ZT09PW4/ci5zZXRBdHRyaWJ1dGUoInNlbGVjdGVkIiwic2VsZWN0ZWQiKTpyLnNldEF0dHJpYnV0ZSgidmFsdWUiLGUpLHQuYXBwZW5kQ2hpbGQocil9KX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksZS5kZWZhdWx0PWUuQmFzZVRvb2x0aXA9dm9pZCAwO3ZhciB1PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lW25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsci5rZXkscil9fXJldHVybiBmdW5jdGlvbihlLG4scil7cmV0dXJuIG4mJnQoZS5wcm90b3R5cGUsbiksciYmdChlLHIpLGV9fSgpLGM9ZnVuY3Rpb24gdChlLG4scil7bnVsbD09PWUmJihlPUZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIG89T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLG4pO2lmKHZvaWQgMD09PW8pe3ZhciBpPU9iamVjdC5nZXRQcm90b3R5cGVPZihlKTtyZXR1cm4gbnVsbD09PWk/dm9pZCAwOnQoaSxuLHIpfWlmKCJ2YWx1ZSJpbiBvKXJldHVybiBvLnZhbHVlO3ZhciBsPW8uZ2V0O2lmKHZvaWQgMCE9PWwpcmV0dXJuIGwuY2FsbChyKX0sZj1uKDIpLGg9cihmKSxwPW4oNCksZD1yKHApLHk9big5KSx2PXIoeSksYj1uKDI1KSxnPXIoYiksbT1uKDMyKSxfPXIobSksTz1uKDQxKSx3PXIoTykseD1uKDQyKSxrPXIoeCksRT1uKDE2KSxOPXIoRSksaj1uKDQzKSxBPXIoaikscT1bITEsImNlbnRlciIsInJpZ2h0IiwianVzdGlmeSJdLFQ9WyIjMDAwMDAwIiwiI2U2MDAwMCIsIiNmZjk5MDAiLCIjZmZmZjAwIiwiIzAwOGEwMCIsIiMwMDY2Y2MiLCIjOTkzM2ZmIiwiI2ZmZmZmZiIsIiNmYWNjY2MiLCIjZmZlYmNjIiwiI2ZmZmZjYyIsIiNjY2U4Y2MiLCIjY2NlMGY1IiwiI2ViZDZmZiIsIiNiYmJiYmIiLCIjZjA2NjY2IiwiI2ZmYzI2NiIsIiNmZmZmNjYiLCIjNjZiOTY2IiwiIzY2YTNlMCIsIiNjMjg1ZmYiLCIjODg4ODg4IiwiI2ExMDAwMCIsIiNiMjZiMDAiLCIjYjJiMjAwIiwiIzAwNjEwMCIsIiMwMDQ3YjIiLCIjNmIyNGIyIiwiIzQ0NDQ0NCIsIiM1YzAwMDAiLCIjNjYzZDAwIiwiIzY2NjYwMCIsIiMwMDM3MDAiLCIjMDAyOTY2IiwiIzNkMTQ2NiJdLFA9WyExLCJzZXJpZiIsIm1vbm9zcGFjZSJdLFM9WyIxIiwiMiIsIjMiLCExXSxDPVsic21hbGwiLCExLCJsYXJnZSIsImh1Z2UiXSxMPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUodCxuKXtvKHRoaXMsZSk7dmFyIHI9aSh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5jYWxsKHRoaXMsdCxuKSksbD1mdW5jdGlvbiBlKG4pe2lmKCFkb2N1bWVudC5ib2R5LmNvbnRhaW5zKHQucm9vdCkpcmV0dXJuIGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLGUpO251bGw9PXIudG9vbHRpcHx8ci50b29sdGlwLnJvb3QuY29udGFpbnMobi50YXJnZXQpfHxkb2N1bWVudC5hY3RpdmVFbGVtZW50PT09ci50b29sdGlwLnRleHRib3h8fHIucXVpbGwuaGFzRm9jdXMoKXx8ci50b29sdGlwLmhpZGUoKSxudWxsIT1yLnBpY2tlcnMmJnIucGlja2Vycy5mb3JFYWNoKGZ1bmN0aW9uKHQpe3QuY29udGFpbmVyLmNvbnRhaW5zKG4udGFyZ2V0KXx8dC5jbG9zZSgpfSl9O3JldHVybiB0LmVtaXR0ZXIubGlzdGVuRE9NKCJjbGljayIsZG9jdW1lbnQuYm9keSxsKSxyfXJldHVybiBsKGUsdCksdShlLFt7a2V5OiJhZGRNb2R1bGUiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBuPWMoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJhZGRNb2R1bGUiLHRoaXMpLmNhbGwodGhpcyx0KTtyZXR1cm4idG9vbGJhciI9PT10JiZ0aGlzLmV4dGVuZFRvb2xiYXIobiksbn19LHtrZXk6ImJ1aWxkQnV0dG9ucyIsdmFsdWU6ZnVuY3Rpb24odCxlKXt0LmZvckVhY2goZnVuY3Rpb24odCl7KHQuZ2V0QXR0cmlidXRlKCJjbGFzcyIpfHwiIikuc3BsaXQoL1xzKy8pLmZvckVhY2goZnVuY3Rpb24obil7aWYobi5zdGFydHNXaXRoKCJxbC0iKSYmKG49bi5zbGljZSgicWwtIi5sZW5ndGgpLG51bGwhPWVbbl0pKWlmKCJkaXJlY3Rpb24iPT09bil0LmlubmVySFRNTD1lW25dWyIiXStlW25dLnJ0bDtlbHNlIGlmKCJzdHJpbmciPT10eXBlb2YgZVtuXSl0LmlubmVySFRNTD1lW25dO2Vsc2V7dmFyIHI9dC52YWx1ZXx8IiI7bnVsbCE9ciYmZVtuXVtyXSYmKHQuaW5uZXJIVE1MPWVbbl1bcl0pfX0pfSl9fSx7a2V5OiJidWlsZFBpY2tlcnMiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpczt0aGlzLnBpY2tlcnM9dC5tYXAoZnVuY3Rpb24odCl7aWYodC5jbGFzc0xpc3QuY29udGFpbnMoInFsLWFsaWduIikpcmV0dXJuIG51bGw9PXQucXVlcnlTZWxlY3Rvcigib3B0aW9uIikmJnModCxxKSxuZXcgay5kZWZhdWx0KHQsZS5hbGlnbik7aWYodC5jbGFzc0xpc3QuY29udGFpbnMoInFsLWJhY2tncm91bmQiKXx8dC5jbGFzc0xpc3QuY29udGFpbnMoInFsLWNvbG9yIikpe3ZhciBuPXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJxbC1iYWNrZ3JvdW5kIik/ImJhY2tncm91bmQiOiJjb2xvciI7cmV0dXJuIG51bGw9PXQucXVlcnlTZWxlY3Rvcigib3B0aW9uIikmJnModCxULCJiYWNrZ3JvdW5kIj09PW4/IiNmZmZmZmYiOiIjMDAwMDAwIiksbmV3IHcuZGVmYXVsdCh0LGVbbl0pfXJldHVybiBudWxsPT10LnF1ZXJ5U2VsZWN0b3IoIm9wdGlvbiIpJiYodC5jbGFzc0xpc3QuY29udGFpbnMoInFsLWZvbnQiKT9zKHQsUCk6dC5jbGFzc0xpc3QuY29udGFpbnMoInFsLWhlYWRlciIpP3ModCxTKTp0LmNsYXNzTGlzdC5jb250YWlucygicWwtc2l6ZSIpJiZzKHQsQykpLG5ldyBOLmRlZmF1bHQodCl9KTt2YXIgcj1mdW5jdGlvbigpe24ucGlja2Vycy5mb3JFYWNoKGZ1bmN0aW9uKHQpe3QudXBkYXRlKCl9KX07dGhpcy5xdWlsbC5vbih2LmRlZmF1bHQuZXZlbnRzLkVESVRPUl9DSEFOR0Uscil9fV0pLGV9KF8uZGVmYXVsdCk7TC5ERUZBVUxUUz0oMCxoLmRlZmF1bHQpKCEwLHt9LF8uZGVmYXVsdC5ERUZBVUxUUyx7bW9kdWxlczp7dG9vbGJhcjp7aGFuZGxlcnM6e2Zvcm11bGE6ZnVuY3Rpb24oKXt0aGlzLnF1aWxsLnRoZW1lLnRvb2x0aXAuZWRpdCgiZm9ybXVsYSIpfSxpbWFnZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMsZT10aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCJpbnB1dC5xbC1pbWFnZVt0eXBlPWZpbGVdIik7bnVsbD09ZSYmKGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKSxlLnNldEF0dHJpYnV0ZSgidHlwZSIsImZpbGUiKSxlLnNldEF0dHJpYnV0ZSgiYWNjZXB0IiwiaW1hZ2UvcG5nLCBpbWFnZS9naWYsIGltYWdlL2pwZWcsIGltYWdlL2JtcCwgaW1hZ2UveC1pY29uIiksZS5jbGFzc0xpc3QuYWRkKCJxbC1pbWFnZSIpLGUuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIixmdW5jdGlvbigpe2lmKG51bGwhPWUuZmlsZXMmJm51bGwhPWUuZmlsZXNbMF0pe3ZhciBuPW5ldyBGaWxlUmVhZGVyO24ub25sb2FkPWZ1bmN0aW9uKG4pe3ZhciByPXQucXVpbGwuZ2V0U2VsZWN0aW9uKCEwKTt0LnF1aWxsLnVwZGF0ZUNvbnRlbnRzKChuZXcgZC5kZWZhdWx0KS5yZXRhaW4oci5pbmRleCkuZGVsZXRlKHIubGVuZ3RoKS5pbnNlcnQoe2ltYWdlOm4udGFyZ2V0LnJlc3VsdH0pLHYuZGVmYXVsdC5zb3VyY2VzLlVTRVIpLHQucXVpbGwuc2V0U2VsZWN0aW9uKHIuaW5kZXgrMSx2LmRlZmF1bHQuc291cmNlcy5TSUxFTlQpLGUudmFsdWU9IiJ9LG4ucmVhZEFzRGF0YVVSTChlLmZpbGVzWzBdKX19KSx0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZChlKSksZS5jbGljaygpfSx2aWRlbzpmdW5jdGlvbigpe3RoaXMucXVpbGwudGhlbWUudG9vbHRpcC5lZGl0KCJ2aWRlbyIpfX19fX0pO3ZhciBNPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUodCxuKXtvKHRoaXMsZSk7dmFyIHI9aSh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5jYWxsKHRoaXMsdCxuKSk7cmV0dXJuIHIudGV4dGJveD1yLnJvb3QucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT0idGV4dCJdJyksci5saXN0ZW4oKSxyfXJldHVybiBsKGUsdCksdShlLFt7a2V5OiJsaXN0ZW4iLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpczt0aGlzLnRleHRib3guYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsZnVuY3Rpb24oZSl7Zy5kZWZhdWx0Lm1hdGNoKGUsImVudGVyIik/KHQuc2F2ZSgpLGUucHJldmVudERlZmF1bHQoKSk6Zy5kZWZhdWx0Lm1hdGNoKGUsImVzY2FwZSIpJiYodC5jYW5jZWwoKSxlLnByZXZlbnREZWZhdWx0KCkpfSl9fSx7a2V5OiJjYW5jZWwiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5oaWRlKCl9fSx7a2V5OiJlZGl0Iix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXToibGluayIsZT1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06bnVsbDt0aGlzLnJvb3QuY2xhc3NMaXN0LnJlbW92ZSgicWwtaGlkZGVuIiksdGhpcy5yb290LmNsYXNzTGlzdC5hZGQoInFsLWVkaXRpbmciKSxudWxsIT1lP3RoaXMudGV4dGJveC52YWx1ZT1lOnQhPT10aGlzLnJvb3QuZ2V0QXR0cmlidXRlKCJkYXRhLW1vZGUiKSYmKHRoaXMudGV4dGJveC52YWx1ZT0iIiksdGhpcy5wb3NpdGlvbih0aGlzLnF1aWxsLmdldEJvdW5kcyh0aGlzLnF1aWxsLnNlbGVjdGlvbi5zYXZlZFJhbmdlKSksdGhpcy50ZXh0Ym94LnNlbGVjdCgpLHRoaXMudGV4dGJveC5zZXRBdHRyaWJ1dGUoInBsYWNlaG9sZGVyIix0aGlzLnRleHRib3guZ2V0QXR0cmlidXRlKCJkYXRhLSIrdCl8fCIiKSx0aGlzLnJvb3Quc2V0QXR0cmlidXRlKCJkYXRhLW1vZGUiLHQpfX0se2tleToicmVzdG9yZUZvY3VzIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMucXVpbGwuc2Nyb2xsaW5nQ29udGFpbmVyLnNjcm9sbFRvcDt0aGlzLnF1aWxsLmZvY3VzKCksdGhpcy5xdWlsbC5zY3JvbGxpbmdDb250YWluZXIuc2Nyb2xsVG9wPXR9fSx7a2V5OiJzYXZlIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMudGV4dGJveC52YWx1ZTtzd2l0Y2godGhpcy5yb290LmdldEF0dHJpYnV0ZSgiZGF0YS1tb2RlIikpe2Nhc2UibGluayI6dmFyIGU9dGhpcy5xdWlsbC5yb290LnNjcm9sbFRvcDt0aGlzLmxpbmtSYW5nZT8odGhpcy5xdWlsbC5mb3JtYXRUZXh0KHRoaXMubGlua1JhbmdlLCJsaW5rIix0LHYuZGVmYXVsdC5zb3VyY2VzLlVTRVIpLGRlbGV0ZSB0aGlzLmxpbmtSYW5nZSk6KHRoaXMucmVzdG9yZUZvY3VzKCksdGhpcy5xdWlsbC5mb3JtYXQoImxpbmsiLHQsdi5kZWZhdWx0LnNvdXJjZXMuVVNFUikpLHRoaXMucXVpbGwucm9vdC5zY3JvbGxUb3A9ZTticmVhaztjYXNlInZpZGVvIjp0PWEodCk7Y2FzZSJmb3JtdWxhIjppZighdClicmVhazt2YXIgbj10aGlzLnF1aWxsLmdldFNlbGVjdGlvbighMCk7aWYobnVsbCE9bil7dmFyIHI9bi5pbmRleCtuLmxlbmd0aDt0aGlzLnF1aWxsLmluc2VydEVtYmVkKHIsdGhpcy5yb290LmdldEF0dHJpYnV0ZSgiZGF0YS1tb2RlIiksdCx2LmRlZmF1bHQuc291cmNlcy5VU0VSKSwiZm9ybXVsYSI9PT10aGlzLnJvb3QuZ2V0QXR0cmlidXRlKCJkYXRhLW1vZGUiKSYmdGhpcy5xdWlsbC5pbnNlcnRUZXh0KHIrMSwiICIsdi5kZWZhdWx0LnNvdXJjZXMuVVNFUiksdGhpcy5xdWlsbC5zZXRTZWxlY3Rpb24ocisyLHYuZGVmYXVsdC5zb3VyY2VzLlVTRVIpfX10aGlzLnRleHRib3gudmFsdWU9IiIsdGhpcy5oaWRlKCl9fV0pLGV9KEEuZGVmYXVsdCk7ZS5CYXNlVG9vbHRpcD1NLGUuZGVmYXVsdD1MfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgbz1uKDQ2KSxpPXIobyksbD1uKDM0KSxhPW4oMzYpLHM9big2MiksdT1uKDYzKSxjPXIodSksZj1uKDY0KSxoPXIoZikscD1uKDY1KSxkPXIocCkseT1uKDM1KSx2PW4oMjQpLGI9bigzNyksZz1uKDM4KSxtPW4oMzkpLF89cihtKSxPPW4oNjYpLHc9cihPKSx4PW4oMTUpLGs9cih4KSxFPW4oNjcpLE49cihFKSxqPW4oNjgpLEE9cihqKSxxPW4oNjkpLFQ9cihxKSxQPW4oNzApLFM9cihQKSxDPW4oNzEpLEw9cihDKSxNPW4oMTMpLFI9cihNKSxJPW4oNzIpLEI9cihJKSxEPW4oNzMpLFU9cihEKSxGPW4oNzQpLEg9cihGKSxLPW4oMjYpLHo9cihLKSxaPW4oMTYpLFY9cihaKSxXPW4oNDEpLEc9cihXKSxZPW4oNDIpLFg9cihZKSwkPW4oNDMpLFE9cigkKSxKPW4oMTA3KSx0dD1yKEopLGV0PW4oMTA4KSxudD1yKGV0KTtpLmRlZmF1bHQucmVnaXN0ZXIoeyJhdHRyaWJ1dG9ycy9hdHRyaWJ1dGUvZGlyZWN0aW9uIjphLkRpcmVjdGlvbkF0dHJpYnV0ZSwiYXR0cmlidXRvcnMvY2xhc3MvYWxpZ24iOmwuQWxpZ25DbGFzcywiYXR0cmlidXRvcnMvY2xhc3MvYmFja2dyb3VuZCI6eS5CYWNrZ3JvdW5kQ2xhc3MsImF0dHJpYnV0b3JzL2NsYXNzL2NvbG9yIjp2LkNvbG9yQ2xhc3MsImF0dHJpYnV0b3JzL2NsYXNzL2RpcmVjdGlvbiI6YS5EaXJlY3Rpb25DbGFzcywiYXR0cmlidXRvcnMvY2xhc3MvZm9udCI6Yi5Gb250Q2xhc3MsImF0dHJpYnV0b3JzL2NsYXNzL3NpemUiOmcuU2l6ZUNsYXNzLCJhdHRyaWJ1dG9ycy9zdHlsZS9hbGlnbiI6bC5BbGlnblN0eWxlLCJhdHRyaWJ1dG9ycy9zdHlsZS9iYWNrZ3JvdW5kIjp5LkJhY2tncm91bmRTdHlsZSwiYXR0cmlidXRvcnMvc3R5bGUvY29sb3IiOnYuQ29sb3JTdHlsZSwiYXR0cmlidXRvcnMvc3R5bGUvZGlyZWN0aW9uIjphLkRpcmVjdGlvblN0eWxlLCJhdHRyaWJ1dG9ycy9zdHlsZS9mb250IjpiLkZvbnRTdHlsZSwiYXR0cmlidXRvcnMvc3R5bGUvc2l6ZSI6Zy5TaXplU3R5bGV9LCEwKSxpLmRlZmF1bHQucmVnaXN0ZXIoeyJmb3JtYXRzL2FsaWduIjpsLkFsaWduQ2xhc3MsImZvcm1hdHMvZGlyZWN0aW9uIjphLkRpcmVjdGlvbkNsYXNzLCJmb3JtYXRzL2luZGVudCI6cy5JbmRlbnRDbGFzcywiZm9ybWF0cy9iYWNrZ3JvdW5kIjp5LkJhY2tncm91bmRTdHlsZSwiZm9ybWF0cy9jb2xvciI6di5Db2xvclN0eWxlLCJmb3JtYXRzL2ZvbnQiOmIuRm9udENsYXNzLCJmb3JtYXRzL3NpemUiOmcuU2l6ZUNsYXNzLCJmb3JtYXRzL2Jsb2NrcXVvdGUiOmMuZGVmYXVsdCwiZm9ybWF0cy9jb2RlLWJsb2NrIjpSLmRlZmF1bHQsImZvcm1hdHMvaGVhZGVyIjpoLmRlZmF1bHQsImZvcm1hdHMvbGlzdCI6ZC5kZWZhdWx0LCJmb3JtYXRzL2JvbGQiOl8uZGVmYXVsdCwiZm9ybWF0cy9jb2RlIjpNLkNvZGUsImZvcm1hdHMvaXRhbGljIjp3LmRlZmF1bHQsImZvcm1hdHMvbGluayI6ay5kZWZhdWx0LCJmb3JtYXRzL3NjcmlwdCI6Ti5kZWZhdWx0LCJmb3JtYXRzL3N0cmlrZSI6QS5kZWZhdWx0LCJmb3JtYXRzL3VuZGVybGluZSI6VC5kZWZhdWx0LCJmb3JtYXRzL2ltYWdlIjpTLmRlZmF1bHQsImZvcm1hdHMvdmlkZW8iOkwuZGVmYXVsdCwiZm9ybWF0cy9saXN0L2l0ZW0iOnAuTGlzdEl0ZW0sIm1vZHVsZXMvZm9ybXVsYSI6Qi5kZWZhdWx0LCJtb2R1bGVzL3N5bnRheCI6VS5kZWZhdWx0LCJtb2R1bGVzL3Rvb2xiYXIiOkguZGVmYXVsdCwidGhlbWVzL2J1YmJsZSI6dHQuZGVmYXVsdCwidGhlbWVzL3Nub3ciOm50LmRlZmF1bHQsInVpL2ljb25zIjp6LmRlZmF1bHQsInVpL3BpY2tlciI6Vi5kZWZhdWx0LCJ1aS9pY29uLXBpY2tlciI6WC5kZWZhdWx0LCJ1aS9jb2xvci1waWNrZXIiOkcuZGVmYXVsdCwidWkvdG9vbHRpcCI6US5kZWZhdWx0fSwhMCksZS5kZWZhdWx0PWkuZGVmYXVsdH0sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiByKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIG89bigwKSxpPXIobyksbD1uKDYpLGE9cihsKSxzPW4oMyksdT1yKHMpLGM9bigxNCksZj1yKGMpLGg9bigyMykscD1yKGgpLGQ9bigzMSkseT1yKGQpLHY9bigzMyksYj1yKHYpLGc9big1KSxtPXIoZyksXz1uKDU5KSxPPXIoXyksdz1uKDgpLHg9cih3KSxrPW4oNjApLEU9cihrKSxOPW4oNjEpLGo9cihOKSxBPW4oMjUpLHE9cihBKTthLmRlZmF1bHQucmVnaXN0ZXIoeyJibG90cy9ibG9jayI6dS5kZWZhdWx0LCJibG90cy9ibG9jay9lbWJlZCI6cy5CbG9ja0VtYmVkLCJibG90cy9icmVhayI6Zi5kZWZhdWx0LCJibG90cy9jb250YWluZXIiOnAuZGVmYXVsdCwiYmxvdHMvY3Vyc29yIjp5LmRlZmF1bHQsImJsb3RzL2VtYmVkIjpiLmRlZmF1bHQsImJsb3RzL2lubGluZSI6bS5kZWZhdWx0LCJibG90cy9zY3JvbGwiOk8uZGVmYXVsdCwiYmxvdHMvdGV4dCI6eC5kZWZhdWx0LCJtb2R1bGVzL2NsaXBib2FyZCI6RS5kZWZhdWx0LCJtb2R1bGVzL2hpc3RvcnkiOmouZGVmYXVsdCwibW9kdWxlcy9rZXlib2FyZCI6cS5kZWZhdWx0fSksaS5kZWZhdWx0LnJlZ2lzdGVyKHUuZGVmYXVsdCxmLmRlZmF1bHQseS5kZWZhdWx0LG0uZGVmYXVsdCxPLmRlZmF1bHQseC5kZWZhdWx0KSxlLmRlZmF1bHQ9YS5kZWZhdWx0fSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgcj1mdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXt0aGlzLmhlYWQ9dGhpcy50YWlsPW51bGwsdGhpcy5sZW5ndGg9MH1yZXR1cm4gdC5wcm90b3R5cGUuYXBwZW5kPWZ1bmN0aW9uKCl7Zm9yKHZhciB0PVtdLGU9MDtlPGFyZ3VtZW50cy5sZW5ndGg7ZSsrKXRbZV09YXJndW1lbnRzW2VdO3RoaXMuaW5zZXJ0QmVmb3JlKHRbMF0sbnVsbCksdC5sZW5ndGg+MSYmdGhpcy5hcHBlbmQuYXBwbHkodGhpcyx0LnNsaWNlKDEpKX0sdC5wcm90b3R5cGUuY29udGFpbnM9ZnVuY3Rpb24odCl7Zm9yKHZhciBlLG49dGhpcy5pdGVyYXRvcigpO2U9bigpOylpZihlPT09dClyZXR1cm4hMDtyZXR1cm4hMX0sdC5wcm90b3R5cGUuaW5zZXJ0QmVmb3JlPWZ1bmN0aW9uKHQsZSl7dCYmKHQubmV4dD1lLG51bGwhPWU/KHQucHJldj1lLnByZXYsbnVsbCE9ZS5wcmV2JiYoZS5wcmV2Lm5leHQ9dCksZS5wcmV2PXQsZT09PXRoaXMuaGVhZCYmKHRoaXMuaGVhZD10KSk6bnVsbCE9dGhpcy50YWlsPyh0aGlzLnRhaWwubmV4dD10LHQucHJldj10aGlzLnRhaWwsdGhpcy50YWlsPXQpOih0LnByZXY9bnVsbCx0aGlzLmhlYWQ9dGhpcy50YWlsPXQpLHRoaXMubGVuZ3RoKz0xKX0sdC5wcm90b3R5cGUub2Zmc2V0PWZ1bmN0aW9uKHQpe2Zvcih2YXIgZT0wLG49dGhpcy5oZWFkO251bGwhPW47KXtpZihuPT09dClyZXR1cm4gZTtlKz1uLmxlbmd0aCgpLG49bi5uZXh0fXJldHVybi0xfSx0LnByb3RvdHlwZS5yZW1vdmU9ZnVuY3Rpb24odCl7dGhpcy5jb250YWlucyh0KSYmKG51bGwhPXQucHJldiYmKHQucHJldi5uZXh0PXQubmV4dCksbnVsbCE9dC5uZXh0JiYodC5uZXh0LnByZXY9dC5wcmV2KSx0PT09dGhpcy5oZWFkJiYodGhpcy5oZWFkPXQubmV4dCksdD09PXRoaXMudGFpbCYmKHRoaXMudGFpbD10LnByZXYpLHRoaXMubGVuZ3RoLT0xKX0sdC5wcm90b3R5cGUuaXRlcmF0b3I9ZnVuY3Rpb24odCl7cmV0dXJuIHZvaWQgMD09PXQmJih0PXRoaXMuaGVhZCksZnVuY3Rpb24oKXt2YXIgZT10O3JldHVybiBudWxsIT10JiYodD10Lm5leHQpLGV9fSx0LnByb3RvdHlwZS5maW5kPWZ1bmN0aW9uKHQsZSl7dm9pZCAwPT09ZSYmKGU9ITEpO2Zvcih2YXIgbixyPXRoaXMuaXRlcmF0b3IoKTtuPXIoKTspe3ZhciBvPW4ubGVuZ3RoKCk7aWYodDxvfHxlJiZ0PT09byYmKG51bGw9PW4ubmV4dHx8MCE9PW4ubmV4dC5sZW5ndGgoKSkpcmV0dXJuW24sdF07dC09b31yZXR1cm5bbnVsbCwwXX0sdC5wcm90b3R5cGUuZm9yRWFjaD1mdW5jdGlvbih0KXtmb3IodmFyIGUsbj10aGlzLml0ZXJhdG9yKCk7ZT1uKCk7KXQoZSl9LHQucHJvdG90eXBlLmZvckVhY2hBdD1mdW5jdGlvbih0LGUsbil7aWYoIShlPD0wKSlmb3IodmFyIHIsbz10aGlzLmZpbmQodCksaT1vWzBdLGw9b1sxXSxhPXQtbCxzPXRoaXMuaXRlcmF0b3IoaSk7KHI9cygpKSYmYTx0K2U7KXt2YXIgdT1yLmxlbmd0aCgpO3Q+YT9uKHIsdC1hLE1hdGgubWluKGUsYSt1LXQpKTpuKHIsMCxNYXRoLm1pbih1LHQrZS1hKSksYSs9dX19LHQucHJvdG90eXBlLm1hcD1mdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5yZWR1Y2UoZnVuY3Rpb24oZSxuKXtyZXR1cm4gZS5wdXNoKHQobikpLGV9LFtdKX0sdC5wcm90b3R5cGUucmVkdWNlPWZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBuLHI9dGhpcy5pdGVyYXRvcigpO249cigpOyllPXQoZSxuKTtyZXR1cm4gZX0sdH0oKTtlLmRlZmF1bHQ9cn0sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0Ijt2YXIgcj10aGlzJiZ0aGlzLl9fZXh0ZW5kc3x8ZnVuY3Rpb24oKXt2YXIgdD1PYmplY3Quc2V0UHJvdG90eXBlT2Z8fHtfX3Byb3RvX186W119aW5zdGFuY2VvZiBBcnJheSYmZnVuY3Rpb24odCxlKXt0Ll9fcHJvdG9fXz1lfXx8ZnVuY3Rpb24odCxlKXtmb3IodmFyIG4gaW4gZSllLmhhc093blByb3BlcnR5KG4pJiYodFtuXT1lW25dKX07cmV0dXJuIGZ1bmN0aW9uKGUsbil7ZnVuY3Rpb24gcigpe3RoaXMuY29uc3RydWN0b3I9ZX10KGUsbiksZS5wcm90b3R5cGU9bnVsbD09PW4/T2JqZWN0LmNyZWF0ZShuKTooci5wcm90b3R5cGU9bi5wcm90b3R5cGUsbmV3IHIpfX0oKTtPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIG89bigxNyksaT1uKDEpLGw9e2F0dHJpYnV0ZXM6ITAsY2hhcmFjdGVyRGF0YTohMCxjaGFyYWN0ZXJEYXRhT2xkVmFsdWU6ITAsY2hpbGRMaXN0OiEwLHN1YnRyZWU6ITB9LGE9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZShlKXt2YXIgbj10LmNhbGwodGhpcyxlKXx8dGhpcztyZXR1cm4gbi5zY3JvbGw9bixuLm9ic2VydmVyPW5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKHQpe24udXBkYXRlKHQpfSksbi5vYnNlcnZlci5vYnNlcnZlKG4uZG9tTm9kZSxsKSxuLmF0dGFjaCgpLG59cmV0dXJuIHIoZSx0KSxlLnByb3RvdHlwZS5kZXRhY2g9ZnVuY3Rpb24oKXt0LnByb3RvdHlwZS5kZXRhY2guY2FsbCh0aGlzKSx0aGlzLm9ic2VydmVyLmRpc2Nvbm5lY3QoKX0sZS5wcm90b3R5cGUuZGVsZXRlQXQ9ZnVuY3Rpb24oZSxuKXt0aGlzLnVwZGF0ZSgpLDA9PT1lJiZuPT09dGhpcy5sZW5ndGgoKT90aGlzLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24odCl7dC5yZW1vdmUoKX0pOnQucHJvdG90eXBlLmRlbGV0ZUF0LmNhbGwodGhpcyxlLG4pfSxlLnByb3RvdHlwZS5mb3JtYXRBdD1mdW5jdGlvbihlLG4scixvKXt0aGlzLnVwZGF0ZSgpLHQucHJvdG90eXBlLmZvcm1hdEF0LmNhbGwodGhpcyxlLG4scixvKX0sZS5wcm90b3R5cGUuaW5zZXJ0QXQ9ZnVuY3Rpb24oZSxuLHIpe3RoaXMudXBkYXRlKCksdC5wcm90b3R5cGUuaW5zZXJ0QXQuY2FsbCh0aGlzLGUsbixyKX0sZS5wcm90b3R5cGUub3B0aW1pemU9ZnVuY3Rpb24oZSxuKXt2YXIgcj10aGlzO3ZvaWQgMD09PWUmJihlPVtdKSx2b2lkIDA9PT1uJiYobj17fSksdC5wcm90b3R5cGUub3B0aW1pemUuY2FsbCh0aGlzLG4pO2Zvcih2YXIgbD1bXS5zbGljZS5jYWxsKHRoaXMub2JzZXJ2ZXIudGFrZVJlY29yZHMoKSk7bC5sZW5ndGg+MDspZS5wdXNoKGwucG9wKCkpO2Zvcih2YXIgYT1mdW5jdGlvbih0LGUpe3ZvaWQgMD09PWUmJihlPSEwKSxudWxsIT10JiZ0IT09ciYmbnVsbCE9dC5kb21Ob2RlLnBhcmVudE5vZGUmJihudWxsPT10LmRvbU5vZGVbaS5EQVRBX0tFWV0ubXV0YXRpb25zJiYodC5kb21Ob2RlW2kuREFUQV9LRVldLm11dGF0aW9ucz1bXSksZSYmYSh0LnBhcmVudCkpfSxzPWZ1bmN0aW9uKHQpe251bGwhPXQuZG9tTm9kZVtpLkRBVEFfS0VZXSYmbnVsbCE9dC5kb21Ob2RlW2kuREFUQV9LRVldLm11dGF0aW9ucyYmKHQgaW5zdGFuY2VvZiBvLmRlZmF1bHQmJnQuY2hpbGRyZW4uZm9yRWFjaChzKSx0Lm9wdGltaXplKG4pKX0sdT1lLGM9MDt1Lmxlbmd0aD4wO2MrPTEpe2lmKGM+PTEwMCl0aHJvdyBuZXcgRXJyb3IoIltQYXJjaG1lbnRdIE1heGltdW0gb3B0aW1pemUgaXRlcmF0aW9ucyByZWFjaGVkIik7Zm9yKHUuZm9yRWFjaChmdW5jdGlvbih0KXt2YXIgZT1pLmZpbmQodC50YXJnZXQsITApO251bGwhPWUmJihlLmRvbU5vZGU9PT10LnRhcmdldCYmKCJjaGlsZExpc3QiPT09dC50eXBlPyhhKGkuZmluZCh0LnByZXZpb3VzU2libGluZywhMSkpLFtdLmZvckVhY2guY2FsbCh0LmFkZGVkTm9kZXMsZnVuY3Rpb24odCl7dmFyIGU9aS5maW5kKHQsITEpO2EoZSwhMSksZSBpbnN0YW5jZW9mIG8uZGVmYXVsdCYmZS5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKHQpe2EodCwhMSl9KX0pKToiYXR0cmlidXRlcyI9PT10LnR5cGUmJmEoZS5wcmV2KSksYShlKSl9KSx0aGlzLmNoaWxkcmVuLmZvckVhY2gocyksdT1bXS5zbGljZS5jYWxsKHRoaXMub2JzZXJ2ZXIudGFrZVJlY29yZHMoKSksbD11LnNsaWNlKCk7bC5sZW5ndGg+MDspZS5wdXNoKGwucG9wKCkpfX0sZS5wcm90b3R5cGUudXBkYXRlPWZ1bmN0aW9uKGUsbil7dmFyIHI9dGhpczt2b2lkIDA9PT1uJiYobj17fSksZT1lfHx0aGlzLm9ic2VydmVyLnRha2VSZWNvcmRzKCksZS5tYXAoZnVuY3Rpb24odCl7dmFyIGU9aS5maW5kKHQudGFyZ2V0LCEwKTtyZXR1cm4gbnVsbD09ZT9udWxsOm51bGw9PWUuZG9tTm9kZVtpLkRBVEFfS0VZXS5tdXRhdGlvbnM/KGUuZG9tTm9kZVtpLkRBVEFfS0VZXS5tdXRhdGlvbnM9W3RdLGUpOihlLmRvbU5vZGVbaS5EQVRBX0tFWV0ubXV0YXRpb25zLnB1c2godCksbnVsbCl9KS5mb3JFYWNoKGZ1bmN0aW9uKHQpe251bGwhPXQmJnQhPT1yJiZudWxsIT10LmRvbU5vZGVbaS5EQVRBX0tFWV0mJnQudXBkYXRlKHQuZG9tTm9kZVtpLkRBVEFfS0VZXS5tdXRhdGlvbnN8fFtdLG4pfSksbnVsbCE9dGhpcy5kb21Ob2RlW2kuREFUQV9LRVldLm11dGF0aW9ucyYmdC5wcm90b3R5cGUudXBkYXRlLmNhbGwodGhpcyx0aGlzLmRvbU5vZGVbaS5EQVRBX0tFWV0ubXV0YXRpb25zLG4pLHRoaXMub3B0aW1pemUoZSxuKX0sZS5ibG90TmFtZT0ic2Nyb2xsIixlLmRlZmF1bHRDaGlsZD0iYmxvY2siLGUuc2NvcGU9aS5TY29wZS5CTE9DS19CTE9ULGUudGFnTmFtZT0iRElWIixlfShvLmRlZmF1bHQpO2UuZGVmYXVsdD1hfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCxlKXtpZihPYmplY3Qua2V5cyh0KS5sZW5ndGghPT1PYmplY3Qua2V5cyhlKS5sZW5ndGgpcmV0dXJuITE7Zm9yKHZhciBuIGluIHQpaWYodFtuXSE9PWVbbl0pcmV0dXJuITE7cmV0dXJuITB9dmFyIG89dGhpcyYmdGhpcy5fX2V4dGVuZHN8fGZ1bmN0aW9uKCl7dmFyIHQ9T2JqZWN0LnNldFByb3RvdHlwZU9mfHx7X19wcm90b19fOltdfWluc3RhbmNlb2YgQXJyYXkmJmZ1bmN0aW9uKHQsZSl7dC5fX3Byb3RvX189ZX18fGZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBuIGluIGUpZS5oYXNPd25Qcm9wZXJ0eShuKSYmKHRbbl09ZVtuXSl9O3JldHVybiBmdW5jdGlvbihlLG4pe2Z1bmN0aW9uIHIoKXt0aGlzLmNvbnN0cnVjdG9yPWV9dChlLG4pLGUucHJvdG90eXBlPW51bGw9PT1uP09iamVjdC5jcmVhdGUobik6KHIucHJvdG90eXBlPW4ucHJvdG90eXBlLG5ldyByKX19KCk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBpPW4oMTgpLGw9bigxKSxhPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXtyZXR1cm4gbnVsbCE9PXQmJnQuYXBwbHkodGhpcyxhcmd1bWVudHMpfHx0aGlzfXJldHVybiBvKGUsdCksZS5mb3JtYXRzPWZ1bmN0aW9uKG4pe2lmKG4udGFnTmFtZSE9PWUudGFnTmFtZSlyZXR1cm4gdC5mb3JtYXRzLmNhbGwodGhpcyxuKX0sZS5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKG4scil7dmFyIG89dGhpcztuIT09dGhpcy5zdGF0aWNzLmJsb3ROYW1lfHxyP3QucHJvdG90eXBlLmZvcm1hdC5jYWxsKHRoaXMsbixyKToodGhpcy5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKHQpe3QgaW5zdGFuY2VvZiBpLmRlZmF1bHR8fCh0PXQud3JhcChlLmJsb3ROYW1lLCEwKSksby5hdHRyaWJ1dGVzLmNvcHkodCl9KSx0aGlzLnVud3JhcCgpKX0sZS5wcm90b3R5cGUuZm9ybWF0QXQ9ZnVuY3Rpb24oZSxuLHIsbyl7aWYobnVsbCE9dGhpcy5mb3JtYXRzKClbcl18fGwucXVlcnkocixsLlNjb3BlLkFUVFJJQlVURSkpe3RoaXMuaXNvbGF0ZShlLG4pLmZvcm1hdChyLG8pfWVsc2UgdC5wcm90b3R5cGUuZm9ybWF0QXQuY2FsbCh0aGlzLGUsbixyLG8pfSxlLnByb3RvdHlwZS5vcHRpbWl6ZT1mdW5jdGlvbihuKXt0LnByb3RvdHlwZS5vcHRpbWl6ZS5jYWxsKHRoaXMsbik7dmFyIG89dGhpcy5mb3JtYXRzKCk7aWYoMD09PU9iamVjdC5rZXlzKG8pLmxlbmd0aClyZXR1cm4gdGhpcy51bndyYXAoKTt2YXIgaT10aGlzLm5leHQ7aSBpbnN0YW5jZW9mIGUmJmkucHJldj09PXRoaXMmJnIobyxpLmZvcm1hdHMoKSkmJihpLm1vdmVDaGlsZHJlbih0aGlzKSxpLnJlbW92ZSgpKX0sZS5ibG90TmFtZT0iaW5saW5lIixlLnNjb3BlPWwuU2NvcGUuSU5MSU5FX0JMT1QsZS50YWdOYW1lPSJTUEFOIixlfShpLmRlZmF1bHQpO2UuZGVmYXVsdD1hfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO3ZhciByPXRoaXMmJnRoaXMuX19leHRlbmRzfHxmdW5jdGlvbigpe3ZhciB0PU9iamVjdC5zZXRQcm90b3R5cGVPZnx8e19fcHJvdG9fXzpbXX1pbnN0YW5jZW9mIEFycmF5JiZmdW5jdGlvbih0LGUpe3QuX19wcm90b19fPWV9fHxmdW5jdGlvbih0LGUpe2Zvcih2YXIgbiBpbiBlKWUuaGFzT3duUHJvcGVydHkobikmJih0W25dPWVbbl0pfTtyZXR1cm4gZnVuY3Rpb24oZSxuKXtmdW5jdGlvbiByKCl7dGhpcy5jb25zdHJ1Y3Rvcj1lfXQoZSxuKSxlLnByb3RvdHlwZT1udWxsPT09bj9PYmplY3QuY3JlYXRlKG4pOihyLnByb3RvdHlwZT1uLnByb3RvdHlwZSxuZXcgcil9fSgpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgbz1uKDE4KSxpPW4oMSksbD1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKCl7cmV0dXJuIG51bGwhPT10JiZ0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8dGhpc31yZXR1cm4gcihlLHQpLGUuZm9ybWF0cz1mdW5jdGlvbihuKXt2YXIgcj1pLnF1ZXJ5KGUuYmxvdE5hbWUpLnRhZ05hbWU7aWYobi50YWdOYW1lIT09cilyZXR1cm4gdC5mb3JtYXRzLmNhbGwodGhpcyxuKX0sZS5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKG4scil7bnVsbCE9aS5xdWVyeShuLGkuU2NvcGUuQkxPQ0spJiYobiE9PXRoaXMuc3RhdGljcy5ibG90TmFtZXx8cj90LnByb3RvdHlwZS5mb3JtYXQuY2FsbCh0aGlzLG4scik6dGhpcy5yZXBsYWNlV2l0aChlLmJsb3ROYW1lKSl9LGUucHJvdG90eXBlLmZvcm1hdEF0PWZ1bmN0aW9uKGUsbixyLG8pe251bGwhPWkucXVlcnkocixpLlNjb3BlLkJMT0NLKT90aGlzLmZvcm1hdChyLG8pOnQucHJvdG90eXBlLmZvcm1hdEF0LmNhbGwodGhpcyxlLG4scixvKX0sZS5wcm90b3R5cGUuaW5zZXJ0QXQ9ZnVuY3Rpb24oZSxuLHIpe2lmKG51bGw9PXJ8fG51bGwhPWkucXVlcnkobixpLlNjb3BlLklOTElORSkpdC5wcm90b3R5cGUuaW5zZXJ0QXQuY2FsbCh0aGlzLGUsbixyKTtlbHNle3ZhciBvPXRoaXMuc3BsaXQoZSksbD1pLmNyZWF0ZShuLHIpO28ucGFyZW50Lmluc2VydEJlZm9yZShsLG8pfX0sZS5wcm90b3R5cGUudXBkYXRlPWZ1bmN0aW9uKGUsbil7bmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvVHJpZGVudC8pP3RoaXMuYnVpbGQoKTp0LnByb3RvdHlwZS51cGRhdGUuY2FsbCh0aGlzLGUsbil9LGUuYmxvdE5hbWU9ImJsb2NrIixlLnNjb3BlPWkuU2NvcGUuQkxPQ0tfQkxPVCxlLnRhZ05hbWU9IlAiLGV9KG8uZGVmYXVsdCk7ZS5kZWZhdWx0PWx9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7dmFyIHI9dGhpcyYmdGhpcy5fX2V4dGVuZHN8fGZ1bmN0aW9uKCl7dmFyIHQ9T2JqZWN0LnNldFByb3RvdHlwZU9mfHx7X19wcm90b19fOltdfWluc3RhbmNlb2YgQXJyYXkmJmZ1bmN0aW9uKHQsZSl7dC5fX3Byb3RvX189ZX18fGZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBuIGluIGUpZS5oYXNPd25Qcm9wZXJ0eShuKSYmKHRbbl09ZVtuXSl9O3JldHVybiBmdW5jdGlvbihlLG4pe2Z1bmN0aW9uIHIoKXt0aGlzLmNvbnN0cnVjdG9yPWV9dChlLG4pLGUucHJvdG90eXBlPW51bGw9PT1uP09iamVjdC5jcmVhdGUobik6KHIucHJvdG90eXBlPW4ucHJvdG90eXBlLG5ldyByKX19KCk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBvPW4oMTkpLGk9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSgpe3JldHVybiBudWxsIT09dCYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXN9cmV0dXJuIHIoZSx0KSxlLmZvcm1hdHM9ZnVuY3Rpb24odCl7fSxlLnByb3RvdHlwZS5mb3JtYXQ9ZnVuY3Rpb24oZSxuKXt0LnByb3RvdHlwZS5mb3JtYXRBdC5jYWxsKHRoaXMsMCx0aGlzLmxlbmd0aCgpLGUsbil9LGUucHJvdG90eXBlLmZvcm1hdEF0PWZ1bmN0aW9uKGUsbixyLG8pezA9PT1lJiZuPT09dGhpcy5sZW5ndGgoKT90aGlzLmZvcm1hdChyLG8pOnQucHJvdG90eXBlLmZvcm1hdEF0LmNhbGwodGhpcyxlLG4scixvKX0sZS5wcm90b3R5cGUuZm9ybWF0cz1mdW5jdGlvbigpe3JldHVybiB0aGlzLnN0YXRpY3MuZm9ybWF0cyh0aGlzLmRvbU5vZGUpfSxlfShvLmRlZmF1bHQpO2UuZGVmYXVsdD1pfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO3ZhciByPXRoaXMmJnRoaXMuX19leHRlbmRzfHxmdW5jdGlvbigpe3ZhciB0PU9iamVjdC5zZXRQcm90b3R5cGVPZnx8e19fcHJvdG9fXzpbXX1pbnN0YW5jZW9mIEFycmF5JiZmdW5jdGlvbih0LGUpe3QuX19wcm90b19fPWV9fHxmdW5jdGlvbih0LGUpe2Zvcih2YXIgbiBpbiBlKWUuaGFzT3duUHJvcGVydHkobikmJih0W25dPWVbbl0pfTtyZXR1cm4gZnVuY3Rpb24oZSxuKXtmdW5jdGlvbiByKCl7dGhpcy5jb25zdHJ1Y3Rvcj1lfXQoZSxuKSxlLnByb3RvdHlwZT1udWxsPT09bj9PYmplY3QuY3JlYXRlKG4pOihyLnByb3RvdHlwZT1uLnByb3RvdHlwZSxuZXcgcil9fSgpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgbz1uKDE5KSxpPW4oMSksbD1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKGUpe3ZhciBuPXQuY2FsbCh0aGlzLGUpfHx0aGlzO3JldHVybiBuLnRleHQ9bi5zdGF0aWNzLnZhbHVlKG4uZG9tTm9kZSksbn1yZXR1cm4gcihlLHQpLGUuY3JlYXRlPWZ1bmN0aW9uKHQpe3JldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0KX0sZS52YWx1ZT1mdW5jdGlvbih0KXt2YXIgZT10LmRhdGE7cmV0dXJuIGUubm9ybWFsaXplJiYoZT1lLm5vcm1hbGl6ZSgpKSxlfSxlLnByb3RvdHlwZS5kZWxldGVBdD1mdW5jdGlvbih0LGUpe3RoaXMuZG9tTm9kZS5kYXRhPXRoaXMudGV4dD10aGlzLnRleHQuc2xpY2UoMCx0KSt0aGlzLnRleHQuc2xpY2UodCtlKX0sZS5wcm90b3R5cGUuaW5kZXg9ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5kb21Ob2RlPT09dD9lOi0xfSxlLnByb3RvdHlwZS5pbnNlcnRBdD1mdW5jdGlvbihlLG4scil7bnVsbD09cj8odGhpcy50ZXh0PXRoaXMudGV4dC5zbGljZSgwLGUpK24rdGhpcy50ZXh0LnNsaWNlKGUpLHRoaXMuZG9tTm9kZS5kYXRhPXRoaXMudGV4dCk6dC5wcm90b3R5cGUuaW5zZXJ0QXQuY2FsbCh0aGlzLGUsbixyKX0sZS5wcm90b3R5cGUubGVuZ3RoPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudGV4dC5sZW5ndGh9LGUucHJvdG90eXBlLm9wdGltaXplPWZ1bmN0aW9uKG4pe3QucHJvdG90eXBlLm9wdGltaXplLmNhbGwodGhpcyxuKSx0aGlzLnRleHQ9dGhpcy5zdGF0aWNzLnZhbHVlKHRoaXMuZG9tTm9kZSksMD09PXRoaXMudGV4dC5sZW5ndGg/dGhpcy5yZW1vdmUoKTp0aGlzLm5leHQgaW5zdGFuY2VvZiBlJiZ0aGlzLm5leHQucHJldj09PXRoaXMmJih0aGlzLmluc2VydEF0KHRoaXMubGVuZ3RoKCksdGhpcy5uZXh0LnZhbHVlKCkpLHRoaXMubmV4dC5yZW1vdmUoKSl9LGUucHJvdG90eXBlLnBvc2l0aW9uPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIHZvaWQgMD09PWUmJihlPSExKSxbdGhpcy5kb21Ob2RlLHRdfSxlLnByb3RvdHlwZS5zcGxpdD1mdW5jdGlvbih0LGUpe2lmKHZvaWQgMD09PWUmJihlPSExKSwhZSl7aWYoMD09PXQpcmV0dXJuIHRoaXM7aWYodD09PXRoaXMubGVuZ3RoKCkpcmV0dXJuIHRoaXMubmV4dH12YXIgbj1pLmNyZWF0ZSh0aGlzLmRvbU5vZGUuc3BsaXRUZXh0KHQpKTtyZXR1cm4gdGhpcy5wYXJlbnQuaW5zZXJ0QmVmb3JlKG4sdGhpcy5uZXh0KSx0aGlzLnRleHQ9dGhpcy5zdGF0aWNzLnZhbHVlKHRoaXMuZG9tTm9kZSksbn0sZS5wcm90b3R5cGUudXBkYXRlPWZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpczt0LnNvbWUoZnVuY3Rpb24odCl7cmV0dXJuImNoYXJhY3RlckRhdGEiPT09dC50eXBlJiZ0LnRhcmdldD09PW4uZG9tTm9kZX0pJiYodGhpcy50ZXh0PXRoaXMuc3RhdGljcy52YWx1ZSh0aGlzLmRvbU5vZGUpKX0sZS5wcm90b3R5cGUudmFsdWU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy50ZXh0fSxlLmJsb3ROYW1lPSJ0ZXh0IixlLnNjb3BlPWkuU2NvcGUuSU5MSU5FX0JMT1QsZX0oby5kZWZhdWx0KTtlLmRlZmF1bHQ9bH0sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0Ijt2YXIgcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTtpZihyLmNsYXNzTGlzdC50b2dnbGUoInRlc3QtY2xhc3MiLCExKSxyLmNsYXNzTGlzdC5jb250YWlucygidGVzdC1jbGFzcyIpKXt2YXIgbz1ET01Ub2tlbkxpc3QucHJvdG90eXBlLnRvZ2dsZTtET01Ub2tlbkxpc3QucHJvdG90eXBlLnRvZ2dsZT1mdW5jdGlvbih0LGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPjEmJiF0aGlzLmNvbnRhaW5zKHQpPT0hZT9lOm8uY2FsbCh0aGlzLHQpfX1TdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGh8fChTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGg9ZnVuY3Rpb24odCxlKXtyZXR1cm4gZT1lfHwwLHRoaXMuc3Vic3RyKGUsdC5sZW5ndGgpPT09dH0pLFN0cmluZy5wcm90b3R5cGUuZW5kc1dpdGh8fChTdHJpbmcucHJvdG90eXBlLmVuZHNXaXRoPWZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcy50b1N0cmluZygpOygibnVtYmVyIiE9dHlwZW9mIGV8fCFpc0Zpbml0ZShlKXx8TWF0aC5mbG9vcihlKSE9PWV8fGU+bi5sZW5ndGgpJiYoZT1uLmxlbmd0aCksZS09dC5sZW5ndGg7dmFyIHI9bi5pbmRleE9mKHQsZSk7cmV0dXJuLTEhPT1yJiZyPT09ZX0pLEFycmF5LnByb3RvdHlwZS5maW5kfHxPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXkucHJvdG90eXBlLCJmaW5kIix7dmFsdWU6ZnVuY3Rpb24odCl7aWYobnVsbD09PXRoaXMpdGhyb3cgbmV3IFR5cGVFcnJvcigiQXJyYXkucHJvdG90eXBlLmZpbmQgY2FsbGVkIG9uIG51bGwgb3IgdW5kZWZpbmVkIik7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIHQpdGhyb3cgbmV3IFR5cGVFcnJvcigicHJlZGljYXRlIG11c3QgYmUgYSBmdW5jdGlvbiIpO2Zvcih2YXIgZSxuPU9iamVjdCh0aGlzKSxyPW4ubGVuZ3RoPj4+MCxvPWFyZ3VtZW50c1sxXSxpPTA7aTxyO2krKylpZihlPW5baV0sdC5jYWxsKG8sZSxpLG4pKXJldHVybiBlfX0pLGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLGZ1bmN0aW9uKCl7ZG9jdW1lbnQuZXhlY0NvbW1hbmQoImVuYWJsZU9iamVjdFJlc2l6aW5nIiwhMSwhMSksZG9jdW1lbnQuZXhlY0NvbW1hbmQoImF1dG9VcmxEZXRlY3QiLCExLCExKX0pfSxmdW5jdGlvbih0LGUpe2Z1bmN0aW9uIG4odCxlLG4pe2lmKHQ9PWUpcmV0dXJuIHQ/W1t2LHRdXTpbXTsobjwwfHx0Lmxlbmd0aDxuKSYmKG49bnVsbCk7dmFyIG89bCh0LGUpLGk9dC5zdWJzdHJpbmcoMCxvKTt0PXQuc3Vic3RyaW5nKG8pLGU9ZS5zdWJzdHJpbmcobyksbz1hKHQsZSk7dmFyIHM9dC5zdWJzdHJpbmcodC5sZW5ndGgtbyk7dD10LnN1YnN0cmluZygwLHQubGVuZ3RoLW8pLGU9ZS5zdWJzdHJpbmcoMCxlLmxlbmd0aC1vKTt2YXIgYz1yKHQsZSk7cmV0dXJuIGkmJmMudW5zaGlmdChbdixpXSkscyYmYy5wdXNoKFt2LHNdKSx1KGMpLG51bGwhPW4mJihjPWYoYyxuKSksYz1oKGMpfWZ1bmN0aW9uIHIodCxlKXt2YXIgcjtpZighdClyZXR1cm5bW3ksZV1dO2lmKCFlKXJldHVybltbZCx0XV07dmFyIGk9dC5sZW5ndGg+ZS5sZW5ndGg/dDplLGw9dC5sZW5ndGg+ZS5sZW5ndGg/ZTp0LGE9aS5pbmRleE9mKGwpO2lmKC0xIT1hKXJldHVybiByPVtbeSxpLnN1YnN0cmluZygwLGEpXSxbdixsXSxbeSxpLnN1YnN0cmluZyhhK2wubGVuZ3RoKV1dLHQubGVuZ3RoPmUubGVuZ3RoJiYoclswXVswXT1yWzJdWzBdPWQpLHI7aWYoMT09bC5sZW5ndGgpcmV0dXJuW1tkLHRdLFt5LGVdXTt2YXIgdT1zKHQsZSk7aWYodSl7dmFyIGM9dVswXSxmPXVbMV0saD11WzJdLHA9dVszXSxiPXVbNF0sZz1uKGMsaCksbT1uKGYscCk7cmV0dXJuIGcuY29uY2F0KFtbdixiXV0sbSl9cmV0dXJuIG8odCxlKX1mdW5jdGlvbiBvKHQsZSl7Zm9yKHZhciBuPXQubGVuZ3RoLHI9ZS5sZW5ndGgsbz1NYXRoLmNlaWwoKG4rcikvMiksbD1vLGE9MipvLHM9bmV3IEFycmF5KGEpLHU9bmV3IEFycmF5KGEpLGM9MDtjPGE7YysrKXNbY109LTEsdVtjXT0tMTtzW2wrMV09MCx1W2wrMV09MDtmb3IodmFyIGY9bi1yLGg9ZiUyIT0wLHA9MCx2PTAsYj0wLGc9MCxtPTA7bTxvO20rKyl7Zm9yKHZhciBfPS1tK3A7Xzw9bS12O18rPTIpe3ZhciBPLHc9bCtfO089Xz09LW18fF8hPW0mJnNbdy0xXTxzW3crMV0/c1t3KzFdOnNbdy0xXSsxO2Zvcih2YXIgeD1PLV87TzxuJiZ4PHImJnQuY2hhckF0KE8pPT1lLmNoYXJBdCh4KTspTysrLHgrKztpZihzW3ddPU8sTz5uKXYrPTI7ZWxzZSBpZih4PnIpcCs9MjtlbHNlIGlmKGgpe3ZhciBrPWwrZi1fO2lmKGs+PTAmJms8YSYmLTEhPXVba10pe3ZhciBFPW4tdVtrXTtpZihPPj1FKXJldHVybiBpKHQsZSxPLHgpfX19Zm9yKHZhciBOPS1tK2I7Tjw9bS1nO04rPTIpe3ZhciBFLGs9bCtOO0U9Tj09LW18fE4hPW0mJnVbay0xXTx1W2srMV0/dVtrKzFdOnVbay0xXSsxO2Zvcih2YXIgaj1FLU47RTxuJiZqPHImJnQuY2hhckF0KG4tRS0xKT09ZS5jaGFyQXQoci1qLTEpOylFKyssaisrO2lmKHVba109RSxFPm4pZys9MjtlbHNlIGlmKGo+ciliKz0yO2Vsc2UgaWYoIWgpe3ZhciB3PWwrZi1OO2lmKHc+PTAmJnc8YSYmLTEhPXNbd10pe3ZhciBPPXNbd10seD1sK08tdztpZihFPW4tRSxPPj1FKXJldHVybiBpKHQsZSxPLHgpfX19fXJldHVybltbZCx0XSxbeSxlXV19ZnVuY3Rpb24gaSh0LGUscixvKXt2YXIgaT10LnN1YnN0cmluZygwLHIpLGw9ZS5zdWJzdHJpbmcoMCxvKSxhPXQuc3Vic3RyaW5nKHIpLHM9ZS5zdWJzdHJpbmcobyksdT1uKGksbCksYz1uKGEscyk7cmV0dXJuIHUuY29uY2F0KGMpfWZ1bmN0aW9uIGwodCxlKXtpZighdHx8IWV8fHQuY2hhckF0KDApIT1lLmNoYXJBdCgwKSlyZXR1cm4gMDtmb3IodmFyIG49MCxyPU1hdGgubWluKHQubGVuZ3RoLGUubGVuZ3RoKSxvPXIsaT0wO248bzspdC5zdWJzdHJpbmcoaSxvKT09ZS5zdWJzdHJpbmcoaSxvKT8obj1vLGk9bik6cj1vLG89TWF0aC5mbG9vcigoci1uKS8yK24pO3JldHVybiBvfWZ1bmN0aW9uIGEodCxlKXtpZighdHx8IWV8fHQuY2hhckF0KHQubGVuZ3RoLTEpIT1lLmNoYXJBdChlLmxlbmd0aC0xKSlyZXR1cm4gMDtmb3IodmFyIG49MCxyPU1hdGgubWluKHQubGVuZ3RoLGUubGVuZ3RoKSxvPXIsaT0wO248bzspdC5zdWJzdHJpbmcodC5sZW5ndGgtbyx0Lmxlbmd0aC1pKT09ZS5zdWJzdHJpbmcoZS5sZW5ndGgtbyxlLmxlbmd0aC1pKT8obj1vLGk9bik6cj1vLG89TWF0aC5mbG9vcigoci1uKS8yK24pO3JldHVybiBvfWZ1bmN0aW9uIHModCxlKXtmdW5jdGlvbiBuKHQsZSxuKXtmb3IodmFyIHIsbyxpLHMsdT10LnN1YnN0cmluZyhuLG4rTWF0aC5mbG9vcih0Lmxlbmd0aC80KSksYz0tMSxmPSIiOy0xIT0oYz1lLmluZGV4T2YodSxjKzEpKTspe3ZhciBoPWwodC5zdWJzdHJpbmcobiksZS5zdWJzdHJpbmcoYykpLHA9YSh0LnN1YnN0cmluZygwLG4pLGUuc3Vic3RyaW5nKDAsYykpO2YubGVuZ3RoPHAraCYmKGY9ZS5zdWJzdHJpbmcoYy1wLGMpK2Uuc3Vic3RyaW5nKGMsYytoKSxyPXQuc3Vic3RyaW5nKDAsbi1wKSxvPXQuc3Vic3RyaW5nKG4raCksaT1lLnN1YnN0cmluZygwLGMtcCkscz1lLnN1YnN0cmluZyhjK2gpKX1yZXR1cm4gMipmLmxlbmd0aD49dC5sZW5ndGg/W3IsbyxpLHMsZl06bnVsbH12YXIgcj10Lmxlbmd0aD5lLmxlbmd0aD90OmUsbz10Lmxlbmd0aD5lLmxlbmd0aD9lOnQ7aWYoci5sZW5ndGg8NHx8MipvLmxlbmd0aDxyLmxlbmd0aClyZXR1cm4gbnVsbDt2YXIgaSxzPW4ocixvLE1hdGguY2VpbChyLmxlbmd0aC80KSksdT1uKHIsbyxNYXRoLmNlaWwoci5sZW5ndGgvMikpO2lmKCFzJiYhdSlyZXR1cm4gbnVsbDtpPXU/cyYmc1s0XS5sZW5ndGg+dVs0XS5sZW5ndGg/czp1OnM7dmFyIGMsZixoLHA7cmV0dXJuIHQubGVuZ3RoPmUubGVuZ3RoPyhjPWlbMF0sZj1pWzFdLGg9aVsyXSxwPWlbM10pOihoPWlbMF0scD1pWzFdLGM9aVsyXSxmPWlbM10pLFtjLGYsaCxwLGlbNF1dfWZ1bmN0aW9uIHUodCl7dC5wdXNoKFt2LCIiXSk7Zm9yKHZhciBlLG49MCxyPTAsbz0wLGk9IiIscz0iIjtuPHQubGVuZ3RoOylzd2l0Y2godFtuXVswXSl7Y2FzZSB5Om8rKyxzKz10W25dWzFdLG4rKzticmVhaztjYXNlIGQ6cisrLGkrPXRbbl1bMV0sbisrO2JyZWFrO2Nhc2UgdjpyK28+MT8oMCE9PXImJjAhPT1vJiYoZT1sKHMsaSksMCE9PWUmJihuLXItbz4wJiZ0W24tci1vLTFdWzBdPT12P3Rbbi1yLW8tMV1bMV0rPXMuc3Vic3RyaW5nKDAsZSk6KHQuc3BsaWNlKDAsMCxbdixzLnN1YnN0cmluZygwLGUpXSksbisrKSxzPXMuc3Vic3RyaW5nKGUpLGk9aS5zdWJzdHJpbmcoZSkpLDAhPT0oZT1hKHMsaSkpJiYodFtuXVsxXT1zLnN1YnN0cmluZyhzLmxlbmd0aC1lKSt0W25dWzFdLHM9cy5zdWJzdHJpbmcoMCxzLmxlbmd0aC1lKSxpPWkuc3Vic3RyaW5nKDAsaS5sZW5ndGgtZSkpKSwwPT09cj90LnNwbGljZShuLW8scitvLFt5LHNdKTowPT09bz90LnNwbGljZShuLXIscitvLFtkLGldKTp0LnNwbGljZShuLXItbyxyK28sW2QsaV0sW3ksc10pLG49bi1yLW8rKHI/MTowKSsobz8xOjApKzEpOjAhPT1uJiZ0W24tMV1bMF09PXY/KHRbbi0xXVsxXSs9dFtuXVsxXSx0LnNwbGljZShuLDEpKTpuKyssbz0wLHI9MCxpPSIiLHM9IiJ9IiI9PT10W3QubGVuZ3RoLTFdWzFdJiZ0LnBvcCgpO3ZhciBjPSExO2ZvcihuPTE7bjx0Lmxlbmd0aC0xOyl0W24tMV1bMF09PXYmJnRbbisxXVswXT09diYmKHRbbl1bMV0uc3Vic3RyaW5nKHRbbl1bMV0ubGVuZ3RoLXRbbi0xXVsxXS5sZW5ndGgpPT10W24tMV1bMV0/KHRbbl1bMV09dFtuLTFdWzFdK3Rbbl1bMV0uc3Vic3RyaW5nKDAsdFtuXVsxXS5sZW5ndGgtdFtuLTFdWzFdLmxlbmd0aCksdFtuKzFdWzFdPXRbbi0xXVsxXSt0W24rMV1bMV0sdC5zcGxpY2Uobi0xLDEpLGM9ITApOnRbbl1bMV0uc3Vic3RyaW5nKDAsdFtuKzFdWzFdLmxlbmd0aCk9PXRbbisxXVsxXSYmKHRbbi0xXVsxXSs9dFtuKzFdWzFdLHRbbl1bMV09dFtuXVsxXS5zdWJzdHJpbmcodFtuKzFdWzFdLmxlbmd0aCkrdFtuKzFdWzFdLHQuc3BsaWNlKG4rMSwxKSxjPSEwKSksbisrO2MmJnUodCl9ZnVuY3Rpb24gYyh0LGUpe2lmKDA9PT1lKXJldHVyblt2LHRdO2Zvcih2YXIgbj0wLHI9MDtyPHQubGVuZ3RoO3IrKyl7dmFyIG89dFtyXTtpZihvWzBdPT09ZHx8b1swXT09PXYpe3ZhciBpPW4rb1sxXS5sZW5ndGg7aWYoZT09PWkpcmV0dXJuW3IrMSx0XTtpZihlPGkpe3Q9dC5zbGljZSgpO3ZhciBsPWUtbixhPVtvWzBdLG9bMV0uc2xpY2UoMCxsKV0scz1bb1swXSxvWzFdLnNsaWNlKGwpXTtyZXR1cm4gdC5zcGxpY2UociwxLGEscyksW3IrMSx0XX1uPWl9fXRocm93IG5ldyBFcnJvcigiY3Vyc29yX3BvcyBpcyBvdXQgb2YgYm91bmRzISIpfWZ1bmN0aW9uIGYodCxlKXt2YXIgbj1jKHQsZSkscj1uWzFdLG89blswXSxpPXJbb10sbD1yW28rMV07aWYobnVsbD09aSlyZXR1cm4gdDtpZihpWzBdIT09dilyZXR1cm4gdDtpZihudWxsIT1sJiZpWzFdK2xbMV09PT1sWzFdK2lbMV0pcmV0dXJuIHIuc3BsaWNlKG8sMixsLGkpLHAocixvLDIpO2lmKG51bGwhPWwmJjA9PT1sWzFdLmluZGV4T2YoaVsxXSkpe3Iuc3BsaWNlKG8sMixbbFswXSxpWzFdXSxbMCxpWzFdXSk7dmFyIGE9bFsxXS5zbGljZShpWzFdLmxlbmd0aCk7cmV0dXJuIGEubGVuZ3RoPjAmJnIuc3BsaWNlKG8rMiwwLFtsWzBdLGFdKSxwKHIsbywzKX1yZXR1cm4gdH1mdW5jdGlvbiBoKHQpe2Zvcih2YXIgZT0hMSxuPWZ1bmN0aW9uKHQpe3JldHVybiB0LmNoYXJDb2RlQXQoMCk+PTU2MzIwJiZ0LmNoYXJDb2RlQXQoMCk8PTU3MzQzfSxyPTI7cjx0Lmxlbmd0aDtyKz0xKXRbci0yXVswXT09PXYmJmZ1bmN0aW9uKHQpe3JldHVybiB0LmNoYXJDb2RlQXQodC5sZW5ndGgtMSk+PTU1Mjk2JiZ0LmNoYXJDb2RlQXQodC5sZW5ndGgtMSk8PTU2MzE5fSh0W3ItMl1bMV0pJiZ0W3ItMV1bMF09PT1kJiZuKHRbci0xXVsxXSkmJnRbcl1bMF09PT15JiZuKHRbcl1bMV0pJiYoZT0hMCx0W3ItMV1bMV09dFtyLTJdWzFdLnNsaWNlKC0xKSt0W3ItMV1bMV0sdFtyXVsxXT10W3ItMl1bMV0uc2xpY2UoLTEpK3Rbcl1bMV0sdFtyLTJdWzFdPXRbci0yXVsxXS5zbGljZSgwLC0xKSk7aWYoIWUpcmV0dXJuIHQ7Zm9yKHZhciBvPVtdLHI9MDtyPHQubGVuZ3RoO3IrPTEpdFtyXVsxXS5sZW5ndGg+MCYmby5wdXNoKHRbcl0pO3JldHVybiBvfWZ1bmN0aW9uIHAodCxlLG4pe2Zvcih2YXIgcj1lK24tMTtyPj0wJiZyPj1lLTE7ci0tKWlmKHIrMTx0Lmxlbmd0aCl7dmFyIG89dFtyXSxpPXRbcisxXTtvWzBdPT09aVsxXSYmdC5zcGxpY2UociwyLFtvWzBdLG9bMV0raVsxXV0pfXJldHVybiB0fXZhciBkPS0xLHk9MSx2PTAsYj1uO2IuSU5TRVJUPXksYi5ERUxFVEU9ZCxiLkVRVUFMPXYsdC5leHBvcnRzPWJ9LGZ1bmN0aW9uKHQsZSl7ZnVuY3Rpb24gbih0KXt2YXIgZT1bXTtmb3IodmFyIG4gaW4gdCllLnB1c2gobik7cmV0dXJuIGV9ZT10LmV4cG9ydHM9ImZ1bmN0aW9uIj09dHlwZW9mIE9iamVjdC5rZXlzP09iamVjdC5rZXlzOm4sZS5zaGltPW59LGZ1bmN0aW9uKHQsZSl7ZnVuY3Rpb24gbih0KXtyZXR1cm4iW29iamVjdCBBcmd1bWVudHNdIj09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpfWZ1bmN0aW9uIHIodCl7cmV0dXJuIHQmJiJvYmplY3QiPT10eXBlb2YgdCYmIm51bWJlciI9PXR5cGVvZiB0Lmxlbmd0aCYmT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsImNhbGxlZSIpJiYhT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHQsImNhbGxlZSIpfHwhMX12YXIgbz0iW29iamVjdCBBcmd1bWVudHNdIj09ZnVuY3Rpb24oKXtyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGFyZ3VtZW50cyl9KCk7ZT10LmV4cG9ydHM9bz9uOnIsZS5zdXBwb3J0ZWQ9bixlLnVuc3VwcG9ydGVkPXJ9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19ZnVuY3Rpb24gbyh0LGUsbil7cmV0dXJuIGUgaW4gdD9PYmplY3QuZGVmaW5lUHJvcGVydHkodCxlLHt2YWx1ZTpuLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwfSk6dFtlXT1uLHR9ZnVuY3Rpb24gaSh0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIGwodCxlKXtyZXR1cm4gT2JqZWN0LmtleXMoZSkucmVkdWNlKGZ1bmN0aW9uKG4scil7cmV0dXJuIG51bGw9PXRbcl0/bjooZVtyXT09PXRbcl0/bltyXT1lW3JdOkFycmF5LmlzQXJyYXkoZVtyXSk/ZVtyXS5pbmRleE9mKHRbcl0pPDAmJihuW3JdPWVbcl0uY29uY2F0KFt0W3JdXSkpOm5bcl09W2Vbcl0sdFtyXV0sbil9LHt9KX1mdW5jdGlvbiBhKHQpe3JldHVybiB0LnJlZHVjZShmdW5jdGlvbih0LGUpe2lmKDE9PT1lLmluc2VydCl7dmFyIG49KDAsTi5kZWZhdWx0KShlLmF0dHJpYnV0ZXMpO3JldHVybiBkZWxldGUgbi5pbWFnZSx0Lmluc2VydCh7aW1hZ2U6ZS5hdHRyaWJ1dGVzLmltYWdlfSxuKX1pZihudWxsPT1lLmF0dHJpYnV0ZXN8fCEwIT09ZS5hdHRyaWJ1dGVzLmxpc3QmJiEwIT09ZS5hdHRyaWJ1dGVzLmJ1bGxldHx8KGU9KDAsTi5kZWZhdWx0KShlKSxlLmF0dHJpYnV0ZXMubGlzdD9lLmF0dHJpYnV0ZXMubGlzdD0ib3JkZXJlZCI6KGUuYXR0cmlidXRlcy5saXN0PSJidWxsZXQiLGRlbGV0ZSBlLmF0dHJpYnV0ZXMuYnVsbGV0KSksInN0cmluZyI9PXR5cGVvZiBlLmluc2VydCl7dmFyIHI9ZS5pbnNlcnQucmVwbGFjZSgvXHJcbi9nLCJcbiIpLnJlcGxhY2UoL1xyL2csIlxuIik7cmV0dXJuIHQuaW5zZXJ0KHIsZS5hdHRyaWJ1dGVzKX1yZXR1cm4gdC5wdXNoKGUpfSxuZXcgaC5kZWZhdWx0KX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIHM9ImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmInN5bWJvbCI9PXR5cGVvZiBTeW1ib2wuaXRlcmF0b3I/ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0fTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmdC5jb25zdHJ1Y3Rvcj09PVN5bWJvbCYmdCE9PVN5bWJvbC5wcm90b3R5cGU/InN5bWJvbCI6dHlwZW9mIHR9LHU9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQsZSl7dmFyIG49W10scj0hMCxvPSExLGk9dm9pZCAwO3RyeXtmb3IodmFyIGwsYT10W1N5bWJvbC5pdGVyYXRvcl0oKTshKHI9KGw9YS5uZXh0KCkpLmRvbmUpJiYobi5wdXNoKGwudmFsdWUpLCFlfHxuLmxlbmd0aCE9PWUpO3I9ITApO31jYXRjaCh0KXtvPSEwLGk9dH1maW5hbGx5e3RyeXshciYmYS5yZXR1cm4mJmEucmV0dXJuKCl9ZmluYWxseXtpZihvKXRocm93IGl9fXJldHVybiBufXJldHVybiBmdW5jdGlvbihlLG4pe2lmKEFycmF5LmlzQXJyYXkoZSkpcmV0dXJuIGU7aWYoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChlKSlyZXR1cm4gdChlLG4pO3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKX19KCksYz1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZVtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX1yZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfX0oKSxmPW4oNCksaD1yKGYpLHA9bigyMCksZD1yKHApLHk9bigwKSx2PXIoeSksYj1uKDEzKSxnPXIoYiksbT1uKDMxKSxfPXIobSksTz1uKDMpLHc9cihPKSx4PW4oMTQpLGs9cih4KSxFPW4oMjEpLE49cihFKSxqPW4oMTIpLEE9cihqKSxxPW4oMiksVD1yKHEpLFA9L15bIC1+XSokLyxTPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdChlKXtpKHRoaXMsdCksdGhpcy5zY3JvbGw9ZSx0aGlzLmRlbHRhPXRoaXMuZ2V0RGVsdGEoKX1yZXR1cm4gYyh0LFt7a2V5OiJhcHBseURlbHRhIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLG49ITE7dGhpcy5zY3JvbGwudXBkYXRlKCk7dmFyIHI9dGhpcy5zY3JvbGwubGVuZ3RoKCk7cmV0dXJuIHRoaXMuc2Nyb2xsLmJhdGNoU3RhcnQoKSx0PWEodCksdC5yZWR1Y2UoZnVuY3Rpb24odCxvKXt2YXIgaT1vLnJldGFpbnx8by5kZWxldGV8fG8uaW5zZXJ0Lmxlbmd0aHx8MSxsPW8uYXR0cmlidXRlc3x8e307aWYobnVsbCE9by5pbnNlcnQpe2lmKCJzdHJpbmciPT10eXBlb2Ygby5pbnNlcnQpe3ZhciBhPW8uaW5zZXJ0O2EuZW5kc1dpdGgoIlxuIikmJm4mJihuPSExLGE9YS5zbGljZSgwLC0xKSksdD49ciYmIWEuZW5kc1dpdGgoIlxuIikmJihuPSEwKSxlLnNjcm9sbC5pbnNlcnRBdCh0LGEpO3ZhciBjPWUuc2Nyb2xsLmxpbmUodCksZj11KGMsMiksaD1mWzBdLHA9ZlsxXSx5PSgwLFQuZGVmYXVsdCkoe30sKDAsTy5idWJibGVGb3JtYXRzKShoKSk7aWYoaCBpbnN0YW5jZW9mIHcuZGVmYXVsdCl7dmFyIGI9aC5kZXNjZW5kYW50KHYuZGVmYXVsdC5MZWFmLHApLGc9dShiLDEpLG09Z1swXTt5PSgwLFQuZGVmYXVsdCkoeSwoMCxPLmJ1YmJsZUZvcm1hdHMpKG0pKX1sPWQuZGVmYXVsdC5hdHRyaWJ1dGVzLmRpZmYoeSxsKXx8e319ZWxzZSBpZigib2JqZWN0Ij09PXMoby5pbnNlcnQpKXt2YXIgXz1PYmplY3Qua2V5cyhvLmluc2VydClbMF07aWYobnVsbD09XylyZXR1cm4gdDtlLnNjcm9sbC5pbnNlcnRBdCh0LF8sby5pbnNlcnRbX10pfXIrPWl9cmV0dXJuIE9iamVjdC5rZXlzKGwpLmZvckVhY2goZnVuY3Rpb24obil7ZS5zY3JvbGwuZm9ybWF0QXQodCxpLG4sbFtuXSl9KSx0K2l9LDApLHQucmVkdWNlKGZ1bmN0aW9uKHQsbil7cmV0dXJuIm51bWJlciI9PXR5cGVvZiBuLmRlbGV0ZT8oZS5zY3JvbGwuZGVsZXRlQXQodCxuLmRlbGV0ZSksdCk6dCsobi5yZXRhaW58fG4uaW5zZXJ0Lmxlbmd0aHx8MSl9LDApLHRoaXMuc2Nyb2xsLmJhdGNoRW5kKCksdGhpcy51cGRhdGUodCl9fSx7a2V5OiJkZWxldGVUZXh0Iix2YWx1ZTpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLnNjcm9sbC5kZWxldGVBdCh0LGUpLHRoaXMudXBkYXRlKChuZXcgaC5kZWZhdWx0KS5yZXRhaW4odCkuZGVsZXRlKGUpKX19LHtrZXk6ImZvcm1hdExpbmUiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcyxyPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTp7fTtyZXR1cm4gdGhpcy5zY3JvbGwudXBkYXRlKCksT2JqZWN0LmtleXMocikuZm9yRWFjaChmdW5jdGlvbihvKXtpZihudWxsPT1uLnNjcm9sbC53aGl0ZWxpc3R8fG4uc2Nyb2xsLndoaXRlbGlzdFtvXSl7dmFyIGk9bi5zY3JvbGwubGluZXModCxNYXRoLm1heChlLDEpKSxsPWU7aS5mb3JFYWNoKGZ1bmN0aW9uKGUpe3ZhciBpPWUubGVuZ3RoKCk7aWYoZSBpbnN0YW5jZW9mIGcuZGVmYXVsdCl7dmFyIGE9dC1lLm9mZnNldChuLnNjcm9sbCkscz1lLm5ld2xpbmVJbmRleChhK2wpLWErMTtlLmZvcm1hdEF0KGEscyxvLHJbb10pfWVsc2UgZS5mb3JtYXQobyxyW29dKTtsLT1pfSl9fSksdGhpcy5zY3JvbGwub3B0aW1pemUoKSx0aGlzLnVwZGF0ZSgobmV3IGguZGVmYXVsdCkucmV0YWluKHQpLnJldGFpbihlLCgwLE4uZGVmYXVsdCkocikpKX19LHtrZXk6ImZvcm1hdFRleHQiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcyxyPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTp7fTtyZXR1cm4gT2JqZWN0LmtleXMocikuZm9yRWFjaChmdW5jdGlvbihvKXtuLnNjcm9sbC5mb3JtYXRBdCh0LGUsbyxyW29dKX0pLHRoaXMudXBkYXRlKChuZXcgaC5kZWZhdWx0KS5yZXRhaW4odCkucmV0YWluKGUsKDAsTi5kZWZhdWx0KShyKSkpfX0se2tleToiZ2V0Q29udGVudHMiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuZGVsdGEuc2xpY2UodCx0K2UpfX0se2tleToiZ2V0RGVsdGEiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2Nyb2xsLmxpbmVzKCkucmVkdWNlKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQuY29uY2F0KGUuZGVsdGEoKSl9LG5ldyBoLmRlZmF1bHQpfX0se2tleToiZ2V0Rm9ybWF0Iix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgZT1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06MCxuPVtdLHI9W107MD09PWU/dGhpcy5zY3JvbGwucGF0aCh0KS5mb3JFYWNoKGZ1bmN0aW9uKHQpe3ZhciBlPXUodCwxKSxvPWVbMF07byBpbnN0YW5jZW9mIHcuZGVmYXVsdD9uLnB1c2gobyk6byBpbnN0YW5jZW9mIHYuZGVmYXVsdC5MZWFmJiZyLnB1c2gobyl9KToobj10aGlzLnNjcm9sbC5saW5lcyh0LGUpLHI9dGhpcy5zY3JvbGwuZGVzY2VuZGFudHModi5kZWZhdWx0LkxlYWYsdCxlKSk7dmFyIG89W24scl0ubWFwKGZ1bmN0aW9uKHQpe2lmKDA9PT10Lmxlbmd0aClyZXR1cm57fTtmb3IodmFyIGU9KDAsTy5idWJibGVGb3JtYXRzKSh0LnNoaWZ0KCkpO09iamVjdC5rZXlzKGUpLmxlbmd0aD4wOyl7dmFyIG49dC5zaGlmdCgpO2lmKG51bGw9PW4pcmV0dXJuIGU7ZT1sKCgwLE8uYnViYmxlRm9ybWF0cykobiksZSl9cmV0dXJuIGV9KTtyZXR1cm4gVC5kZWZhdWx0LmFwcGx5KFQuZGVmYXVsdCxvKX19LHtrZXk6ImdldFRleHQiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuZ2V0Q29udGVudHModCxlKS5maWx0ZXIoZnVuY3Rpb24odCl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0Lmluc2VydH0pLm1hcChmdW5jdGlvbih0KXtyZXR1cm4gdC5pbnNlcnR9KS5qb2luKCIiKX19LHtrZXk6Imluc2VydEVtYmVkIix2YWx1ZTpmdW5jdGlvbih0LGUsbil7cmV0dXJuIHRoaXMuc2Nyb2xsLmluc2VydEF0KHQsZSxuKSx0aGlzLnVwZGF0ZSgobmV3IGguZGVmYXVsdCkucmV0YWluKHQpLmluc2VydChvKHt9LGUsbikpKX19LHtrZXk6Imluc2VydFRleHQiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcyxyPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTp7fTtyZXR1cm4gZT1lLnJlcGxhY2UoL1xyXG4vZywiXG4iKS5yZXBsYWNlKC9cci9nLCJcbiIpLHRoaXMuc2Nyb2xsLmluc2VydEF0KHQsZSksT2JqZWN0LmtleXMocikuZm9yRWFjaChmdW5jdGlvbihvKXtuLnNjcm9sbC5mb3JtYXRBdCh0LGUubGVuZ3RoLG8scltvXSl9KSx0aGlzLnVwZGF0ZSgobmV3IGguZGVmYXVsdCkucmV0YWluKHQpLmluc2VydChlLCgwLE4uZGVmYXVsdCkocikpKX19LHtrZXk6ImlzQmxhbmsiLHZhbHVlOmZ1bmN0aW9uKCl7aWYoMD09dGhpcy5zY3JvbGwuY2hpbGRyZW4ubGVuZ3RoKXJldHVybiEwO2lmKHRoaXMuc2Nyb2xsLmNoaWxkcmVuLmxlbmd0aD4xKXJldHVybiExO3ZhciB0PXRoaXMuc2Nyb2xsLmNoaWxkcmVuLmhlYWQ7cmV0dXJuIHQuc3RhdGljcy5ibG90TmFtZT09PXcuZGVmYXVsdC5ibG90TmFtZSYmKCEodC5jaGlsZHJlbi5sZW5ndGg+MSkmJnQuY2hpbGRyZW4uaGVhZCBpbnN0YW5jZW9mIGsuZGVmYXVsdCl9fSx7a2V5OiJyZW1vdmVGb3JtYXQiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcy5nZXRUZXh0KHQsZSkscj10aGlzLnNjcm9sbC5saW5lKHQrZSksbz11KHIsMiksaT1vWzBdLGw9b1sxXSxhPTAscz1uZXcgaC5kZWZhdWx0O251bGwhPWkmJihhPWkgaW5zdGFuY2VvZiBnLmRlZmF1bHQ/aS5uZXdsaW5lSW5kZXgobCktbCsxOmkubGVuZ3RoKCktbCxzPWkuZGVsdGEoKS5zbGljZShsLGwrYS0xKS5pbnNlcnQoIlxuIikpO3ZhciBjPXRoaXMuZ2V0Q29udGVudHModCxlK2EpLGY9Yy5kaWZmKChuZXcgaC5kZWZhdWx0KS5pbnNlcnQobikuY29uY2F0KHMpKSxwPShuZXcgaC5kZWZhdWx0KS5yZXRhaW4odCkuY29uY2F0KGYpO3JldHVybiB0aGlzLmFwcGx5RGVsdGEocCl9fSx7a2V5OiJ1cGRhdGUiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTpbXSxuPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTp2b2lkIDAscj10aGlzLmRlbHRhO2lmKDE9PT1lLmxlbmd0aCYmImNoYXJhY3RlckRhdGEiPT09ZVswXS50eXBlJiZlWzBdLnRhcmdldC5kYXRhLm1hdGNoKFApJiZ2LmRlZmF1bHQuZmluZChlWzBdLnRhcmdldCkpe3ZhciBvPXYuZGVmYXVsdC5maW5kKGVbMF0udGFyZ2V0KSxpPSgwLE8uYnViYmxlRm9ybWF0cykobyksbD1vLm9mZnNldCh0aGlzLnNjcm9sbCksYT1lWzBdLm9sZFZhbHVlLnJlcGxhY2UoXy5kZWZhdWx0LkNPTlRFTlRTLCIiKSxzPShuZXcgaC5kZWZhdWx0KS5pbnNlcnQoYSksdT0obmV3IGguZGVmYXVsdCkuaW5zZXJ0KG8udmFsdWUoKSk7dD0obmV3IGguZGVmYXVsdCkucmV0YWluKGwpLmNvbmNhdChzLmRpZmYodSxuKSkucmVkdWNlKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIGUuaW5zZXJ0P3QuaW5zZXJ0KGUuaW5zZXJ0LGkpOnQucHVzaChlKX0sbmV3IGguZGVmYXVsdCksdGhpcy5kZWx0YT1yLmNvbXBvc2UodCl9ZWxzZSB0aGlzLmRlbHRhPXRoaXMuZ2V0RGVsdGEoKSx0JiYoMCxBLmRlZmF1bHQpKHIuY29tcG9zZSh0KSx0aGlzLmRlbHRhKXx8KHQ9ci5kaWZmKHRoaXMuZGVsdGEsbikpO3JldHVybiB0fX1dKSx0fSgpO2UuZGVmYXVsdD1TfSxmdW5jdGlvbih0LGUpeyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBuKCl7fWZ1bmN0aW9uIHIodCxlLG4pe3RoaXMuZm49dCx0aGlzLmNvbnRleHQ9ZSx0aGlzLm9uY2U9bnx8ITF9ZnVuY3Rpb24gbygpe3RoaXMuX2V2ZW50cz1uZXcgbix0aGlzLl9ldmVudHNDb3VudD0wfXZhciBpPU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksbD0ifiI7T2JqZWN0LmNyZWF0ZSYmKG4ucHJvdG90eXBlPU9iamVjdC5jcmVhdGUobnVsbCksKG5ldyBuKS5fX3Byb3RvX198fChsPSExKSksby5wcm90b3R5cGUuZXZlbnROYW1lcz1mdW5jdGlvbigpe3ZhciB0LGUsbj1bXTtpZigwPT09dGhpcy5fZXZlbnRzQ291bnQpcmV0dXJuIG47Zm9yKGUgaW4gdD10aGlzLl9ldmVudHMpaS5jYWxsKHQsZSkmJm4ucHVzaChsP2Uuc2xpY2UoMSk6ZSk7cmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM/bi5jb25jYXQoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyh0KSk6bn0sby5wcm90b3R5cGUubGlzdGVuZXJzPWZ1bmN0aW9uKHQsZSl7dmFyIG49bD9sK3Q6dCxyPXRoaXMuX2V2ZW50c1tuXTtpZihlKXJldHVybiEhcjtpZighcilyZXR1cm5bXTtpZihyLmZuKXJldHVybltyLmZuXTtmb3IodmFyIG89MCxpPXIubGVuZ3RoLGE9bmV3IEFycmF5KGkpO288aTtvKyspYVtvXT1yW29dLmZuO3JldHVybiBhfSxvLnByb3RvdHlwZS5lbWl0PWZ1bmN0aW9uKHQsZSxuLHIsbyxpKXt2YXIgYT1sP2wrdDp0O2lmKCF0aGlzLl9ldmVudHNbYV0pcmV0dXJuITE7dmFyIHMsdSxjPXRoaXMuX2V2ZW50c1thXSxmPWFyZ3VtZW50cy5sZW5ndGg7aWYoYy5mbil7c3dpdGNoKGMub25jZSYmdGhpcy5yZW1vdmVMaXN0ZW5lcih0LGMuZm4sdm9pZCAwLCEwKSxmKXtjYXNlIDE6cmV0dXJuIGMuZm4uY2FsbChjLmNvbnRleHQpLCEwO2Nhc2UgMjpyZXR1cm4gYy5mbi5jYWxsKGMuY29udGV4dCxlKSwhMDtjYXNlIDM6cmV0dXJuIGMuZm4uY2FsbChjLmNvbnRleHQsZSxuKSwhMDtjYXNlIDQ6cmV0dXJuIGMuZm4uY2FsbChjLmNvbnRleHQsZSxuLHIpLCEwO2Nhc2UgNTpyZXR1cm4gYy5mbi5jYWxsKGMuY29udGV4dCxlLG4scixvKSwhMDtjYXNlIDY6cmV0dXJuIGMuZm4uY2FsbChjLmNvbnRleHQsZSxuLHIsbyxpKSwhMH1mb3IodT0xLHM9bmV3IEFycmF5KGYtMSk7dTxmO3UrKylzW3UtMV09YXJndW1lbnRzW3VdO2MuZm4uYXBwbHkoYy5jb250ZXh0LHMpfWVsc2V7dmFyIGgscD1jLmxlbmd0aDtmb3IodT0wO3U8cDt1Kyspc3dpdGNoKGNbdV0ub25jZSYmdGhpcy5yZW1vdmVMaXN0ZW5lcih0LGNbdV0uZm4sdm9pZCAwLCEwKSxmKXtjYXNlIDE6Y1t1XS5mbi5jYWxsKGNbdV0uY29udGV4dCk7YnJlYWs7Y2FzZSAyOmNbdV0uZm4uY2FsbChjW3VdLmNvbnRleHQsZSk7YnJlYWs7Y2FzZSAzOmNbdV0uZm4uY2FsbChjW3VdLmNvbnRleHQsZSxuKTticmVhaztjYXNlIDQ6Y1t1XS5mbi5jYWxsKGNbdV0uY29udGV4dCxlLG4scik7YnJlYWs7ZGVmYXVsdDppZighcylmb3IoaD0xLHM9bmV3IEFycmF5KGYtMSk7aDxmO2grKylzW2gtMV09YXJndW1lbnRzW2hdO2NbdV0uZm4uYXBwbHkoY1t1XS5jb250ZXh0LHMpfX1yZXR1cm4hMH0sby5wcm90b3R5cGUub249ZnVuY3Rpb24odCxlLG4pe3ZhciBvPW5ldyByKGUsbnx8dGhpcyksaT1sP2wrdDp0O3JldHVybiB0aGlzLl9ldmVudHNbaV0/dGhpcy5fZXZlbnRzW2ldLmZuP3RoaXMuX2V2ZW50c1tpXT1bdGhpcy5fZXZlbnRzW2ldLG9dOnRoaXMuX2V2ZW50c1tpXS5wdXNoKG8pOih0aGlzLl9ldmVudHNbaV09byx0aGlzLl9ldmVudHNDb3VudCsrKSx0aGlzfSxvLnByb3RvdHlwZS5vbmNlPWZ1bmN0aW9uKHQsZSxuKXt2YXIgbz1uZXcgcihlLG58fHRoaXMsITApLGk9bD9sK3Q6dDtyZXR1cm4gdGhpcy5fZXZlbnRzW2ldP3RoaXMuX2V2ZW50c1tpXS5mbj90aGlzLl9ldmVudHNbaV09W3RoaXMuX2V2ZW50c1tpXSxvXTp0aGlzLl9ldmVudHNbaV0ucHVzaChvKToodGhpcy5fZXZlbnRzW2ldPW8sdGhpcy5fZXZlbnRzQ291bnQrKyksdGhpc30sby5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXI9ZnVuY3Rpb24odCxlLHIsbyl7dmFyIGk9bD9sK3Q6dDtpZighdGhpcy5fZXZlbnRzW2ldKXJldHVybiB0aGlzO2lmKCFlKXJldHVybiAwPT0tLXRoaXMuX2V2ZW50c0NvdW50P3RoaXMuX2V2ZW50cz1uZXcgbjpkZWxldGUgdGhpcy5fZXZlbnRzW2ldLHRoaXM7dmFyIGE9dGhpcy5fZXZlbnRzW2ldO2lmKGEuZm4pYS5mbiE9PWV8fG8mJiFhLm9uY2V8fHImJmEuY29udGV4dCE9PXJ8fCgwPT0tLXRoaXMuX2V2ZW50c0NvdW50P3RoaXMuX2V2ZW50cz1uZXcgbjpkZWxldGUgdGhpcy5fZXZlbnRzW2ldKTtlbHNle2Zvcih2YXIgcz0wLHU9W10sYz1hLmxlbmd0aDtzPGM7cysrKShhW3NdLmZuIT09ZXx8byYmIWFbc10ub25jZXx8ciYmYVtzXS5jb250ZXh0IT09cikmJnUucHVzaChhW3NdKTt1Lmxlbmd0aD90aGlzLl9ldmVudHNbaV09MT09PXUubGVuZ3RoP3VbMF06dTowPT0tLXRoaXMuX2V2ZW50c0NvdW50P3RoaXMuX2V2ZW50cz1uZXcgbjpkZWxldGUgdGhpcy5fZXZlbnRzW2ldfXJldHVybiB0aGlzfSxvLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnM9ZnVuY3Rpb24odCl7dmFyIGU7cmV0dXJuIHQ/KGU9bD9sK3Q6dCx0aGlzLl9ldmVudHNbZV0mJigwPT0tLXRoaXMuX2V2ZW50c0NvdW50P3RoaXMuX2V2ZW50cz1uZXcgbjpkZWxldGUgdGhpcy5fZXZlbnRzW2VdKSk6KHRoaXMuX2V2ZW50cz1uZXcgbix0aGlzLl9ldmVudHNDb3VudD0wKSx0aGlzfSxvLnByb3RvdHlwZS5vZmY9by5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIsby5wcm90b3R5cGUuYWRkTGlzdGVuZXI9by5wcm90b3R5cGUub24sby5wcm90b3R5cGUuc2V0TWF4TGlzdGVuZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9LG8ucHJlZml4ZWQ9bCxvLkV2ZW50RW1pdHRlcj1vLHZvaWQgMCE9PXQmJih0LmV4cG9ydHM9byl9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19ZnVuY3Rpb24gbyh0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIGkodCxlKXtpZighdCl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiFlfHwib2JqZWN0IiE9dHlwZW9mIGUmJiJmdW5jdGlvbiIhPXR5cGVvZiBlP3Q6ZX1mdW5jdGlvbiBsKHQsZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUmJm51bGwhPT1lKXRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIit0eXBlb2YgZSk7dC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlJiZlLnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOnQsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksZSYmKE9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YodCxlKTp0Ll9fcHJvdG9fXz1lKX1mdW5jdGlvbiBhKHQpe3JldHVybiB0IGluc3RhbmNlb2Ygdi5kZWZhdWx0fHx0IGluc3RhbmNlb2YgeS5CbG9ja0VtYmVkfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgcz1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXt2YXIgbj1bXSxyPSEwLG89ITEsaT12b2lkIDA7dHJ5e2Zvcih2YXIgbCxhPXRbU3ltYm9sLml0ZXJhdG9yXSgpOyEocj0obD1hLm5leHQoKSkuZG9uZSkmJihuLnB1c2gobC52YWx1ZSksIWV8fG4ubGVuZ3RoIT09ZSk7cj0hMCk7fWNhdGNoKHQpe289ITAsaT10fWZpbmFsbHl7dHJ5eyFyJiZhLnJldHVybiYmYS5yZXR1cm4oKX1maW5hbGx5e2lmKG8pdGhyb3cgaX19cmV0dXJuIG59cmV0dXJuIGZ1bmN0aW9uKGUsbil7aWYoQXJyYXkuaXNBcnJheShlKSlyZXR1cm4gZTtpZihTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGUpKXJldHVybiB0KGUsbik7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpfX0oKSx1PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lW25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsci5rZXkscil9fXJldHVybiBmdW5jdGlvbihlLG4scil7cmV0dXJuIG4mJnQoZS5wcm90b3R5cGUsbiksciYmdChlLHIpLGV9fSgpLGM9ZnVuY3Rpb24gdChlLG4scil7bnVsbD09PWUmJihlPUZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIG89T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLG4pO2lmKHZvaWQgMD09PW8pe3ZhciBpPU9iamVjdC5nZXRQcm90b3R5cGVPZihlKTtyZXR1cm4gbnVsbD09PWk/dm9pZCAwOnQoaSxuLHIpfWlmKCJ2YWx1ZSJpbiBvKXJldHVybiBvLnZhbHVlO3ZhciBsPW8uZ2V0O2lmKHZvaWQgMCE9PWwpcmV0dXJuIGwuY2FsbChyKX0sZj1uKDApLGg9cihmKSxwPW4oOSksZD1yKHApLHk9bigzKSx2PXIoeSksYj1uKDE0KSxnPXIoYiksbT1uKDEzKSxfPXIobSksTz1uKDIzKSx3PXIoTykseD1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKHQsbil7byh0aGlzLGUpO3ZhciByPWkodGhpcywoZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSkuY2FsbCh0aGlzLHQpKTtyZXR1cm4gci5lbWl0dGVyPW4uZW1pdHRlcixBcnJheS5pc0FycmF5KG4ud2hpdGVsaXN0KSYmKHIud2hpdGVsaXN0PW4ud2hpdGVsaXN0LnJlZHVjZShmdW5jdGlvbih0LGUpe3JldHVybiB0W2VdPSEwLHR9LHt9KSksci5kb21Ob2RlLmFkZEV2ZW50TGlzdGVuZXIoIkRPTU5vZGVJbnNlcnRlZCIsZnVuY3Rpb24oKXt9KSxyLm9wdGltaXplKCksci5lbmFibGUoKSxyfXJldHVybiBsKGUsdCksdShlLFt7a2V5OiJiYXRjaFN0YXJ0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuYmF0Y2g9ITB9fSx7a2V5OiJiYXRjaEVuZCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLmJhdGNoPSExLHRoaXMub3B0aW1pemUoKX19LHtrZXk6ImRlbGV0ZUF0Iix2YWx1ZTpmdW5jdGlvbih0LG4pe3ZhciByPXRoaXMubGluZSh0KSxvPXMociwyKSxpPW9bMF0sbD1vWzFdLGE9dGhpcy5saW5lKHQrbiksdT1zKGEsMSksZj11WzBdO2lmKGMoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJkZWxldGVBdCIsdGhpcykuY2FsbCh0aGlzLHQsbiksbnVsbCE9ZiYmaSE9PWYmJmw+MCl7aWYoaSBpbnN0YW5jZW9mIHkuQmxvY2tFbWJlZHx8ZiBpbnN0YW5jZW9mIHkuQmxvY2tFbWJlZClyZXR1cm4gdm9pZCB0aGlzLm9wdGltaXplKCk7aWYoaSBpbnN0YW5jZW9mIF8uZGVmYXVsdCl7dmFyIGg9aS5uZXdsaW5lSW5kZXgoaS5sZW5ndGgoKSwhMCk7aWYoaD4tMSYmKGk9aS5zcGxpdChoKzEpKT09PWYpcmV0dXJuIHZvaWQgdGhpcy5vcHRpbWl6ZSgpfWVsc2UgaWYoZiBpbnN0YW5jZW9mIF8uZGVmYXVsdCl7dmFyIHA9Zi5uZXdsaW5lSW5kZXgoMCk7cD4tMSYmZi5zcGxpdChwKzEpfXZhciBkPWYuY2hpbGRyZW4uaGVhZCBpbnN0YW5jZW9mIGcuZGVmYXVsdD9udWxsOmYuY2hpbGRyZW4uaGVhZDtpLm1vdmVDaGlsZHJlbihmLGQpLGkucmVtb3ZlKCl9dGhpcy5vcHRpbWl6ZSgpfX0se2tleToiZW5hYmxlIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PSEoYXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0pfHxhcmd1bWVudHNbMF07dGhpcy5kb21Ob2RlLnNldEF0dHJpYnV0ZSgiY29udGVudGVkaXRhYmxlIix0KX19LHtrZXk6ImZvcm1hdEF0Iix2YWx1ZTpmdW5jdGlvbih0LG4scixvKXsobnVsbD09dGhpcy53aGl0ZWxpc3R8fHRoaXMud2hpdGVsaXN0W3JdKSYmKGMoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJmb3JtYXRBdCIsdGhpcykuY2FsbCh0aGlzLHQsbixyLG8pLHRoaXMub3B0aW1pemUoKSl9fSx7a2V5OiJpbnNlcnRBdCIsdmFsdWU6ZnVuY3Rpb24odCxuLHIpe2lmKG51bGw9PXJ8fG51bGw9PXRoaXMud2hpdGVsaXN0fHx0aGlzLndoaXRlbGlzdFtuXSl7aWYodD49dGhpcy5sZW5ndGgoKSlpZihudWxsPT1yfHxudWxsPT1oLmRlZmF1bHQucXVlcnkobixoLmRlZmF1bHQuU2NvcGUuQkxPQ0spKXt2YXIgbz1oLmRlZmF1bHQuY3JlYXRlKHRoaXMuc3RhdGljcy5kZWZhdWx0Q2hpbGQpO3RoaXMuYXBwZW5kQ2hpbGQobyksbnVsbD09ciYmbi5lbmRzV2l0aCgiXG4iKSYmKG49bi5zbGljZSgwLC0xKSksby5pbnNlcnRBdCgwLG4scil9ZWxzZXt2YXIgaT1oLmRlZmF1bHQuY3JlYXRlKG4scik7dGhpcy5hcHBlbmRDaGlsZChpKX1lbHNlIGMoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJpbnNlcnRBdCIsdGhpcykuY2FsbCh0aGlzLHQsbixyKTt0aGlzLm9wdGltaXplKCl9fX0se2tleToiaW5zZXJ0QmVmb3JlIix2YWx1ZTpmdW5jdGlvbih0LG4pe2lmKHQuc3RhdGljcy5zY29wZT09PWguZGVmYXVsdC5TY29wZS5JTkxJTkVfQkxPVCl7dmFyIHI9aC5kZWZhdWx0LmNyZWF0ZSh0aGlzLnN0YXRpY3MuZGVmYXVsdENoaWxkKTtyLmFwcGVuZENoaWxkKHQpLHQ9cn1jKGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwiaW5zZXJ0QmVmb3JlIix0aGlzKS5jYWxsKHRoaXMsdCxuKX19LHtrZXk6ImxlYWYiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLnBhdGgodCkucG9wKCl8fFtudWxsLC0xXX19LHtrZXk6ImxpbmUiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiB0PT09dGhpcy5sZW5ndGgoKT90aGlzLmxpbmUodC0xKTp0aGlzLmRlc2NlbmRhbnQoYSx0KX19LHtrZXk6ImxpbmVzIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTowLGU9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOk51bWJlci5NQVhfVkFMVUU7cmV0dXJuIGZ1bmN0aW9uIHQoZSxuLHIpe3ZhciBvPVtdLGk9cjtyZXR1cm4gZS5jaGlsZHJlbi5mb3JFYWNoQXQobixyLGZ1bmN0aW9uKGUsbixyKXthKGUpP28ucHVzaChlKTplIGluc3RhbmNlb2YgaC5kZWZhdWx0LkNvbnRhaW5lciYmKG89by5jb25jYXQodChlLG4saSkpKSxpLT1yfSksb30odGhpcyx0LGUpfX0se2tleToib3B0aW1pemUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOltdLG49YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOnt9OyEwIT09dGhpcy5iYXRjaCYmKGMoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJvcHRpbWl6ZSIsdGhpcykuY2FsbCh0aGlzLHQsbiksdC5sZW5ndGg+MCYmdGhpcy5lbWl0dGVyLmVtaXQoZC5kZWZhdWx0LmV2ZW50cy5TQ1JPTExfT1BUSU1JWkUsdCxuKSl9fSx7a2V5OiJwYXRoIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gYyhlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksInBhdGgiLHRoaXMpLmNhbGwodGhpcyx0KS5zbGljZSgxKX19LHtrZXk6InVwZGF0ZSIsdmFsdWU6ZnVuY3Rpb24odCl7aWYoITAhPT10aGlzLmJhdGNoKXt2YXIgbj1kLmRlZmF1bHQuc291cmNlcy5VU0VSOyJzdHJpbmciPT10eXBlb2YgdCYmKG49dCksQXJyYXkuaXNBcnJheSh0KXx8KHQ9dGhpcy5vYnNlcnZlci50YWtlUmVjb3JkcygpKSx0Lmxlbmd0aD4wJiZ0aGlzLmVtaXR0ZXIuZW1pdChkLmRlZmF1bHQuZXZlbnRzLlNDUk9MTF9CRUZPUkVfVVBEQVRFLG4sdCksYyhlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksInVwZGF0ZSIsdGhpcykuY2FsbCh0aGlzLHQuY29uY2F0KFtdKSksdC5sZW5ndGg+MCYmdGhpcy5lbWl0dGVyLmVtaXQoZC5kZWZhdWx0LmV2ZW50cy5TQ1JPTExfVVBEQVRFLG4sdCl9fX1dKSxlfShoLmRlZmF1bHQuU2Nyb2xsKTt4LmJsb3ROYW1lPSJzY3JvbGwiLHguY2xhc3NOYW1lPSJxbC1lZGl0b3IiLHgudGFnTmFtZT0iRElWIix4LmRlZmF1bHRDaGlsZD0iYmxvY2siLHguYWxsb3dlZENoaWxkcmVuPVt2LmRlZmF1bHQseS5CbG9ja0VtYmVkLHcuZGVmYXVsdF0sZS5kZWZhdWx0PXh9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19ZnVuY3Rpb24gbyh0LGUsbil7cmV0dXJuIGUgaW4gdD9PYmplY3QuZGVmaW5lUHJvcGVydHkodCxlLHt2YWx1ZTpuLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwfSk6dFtlXT1uLHR9ZnVuY3Rpb24gaSh0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIGwodCxlKXtpZighdCl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiFlfHwib2JqZWN0IiE9dHlwZW9mIGUmJiJmdW5jdGlvbiIhPXR5cGVvZiBlP3Q6ZX1mdW5jdGlvbiBhKHQsZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUmJm51bGwhPT1lKXRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIit0eXBlb2YgZSk7dC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlJiZlLnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOnQsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksZSYmKE9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YodCxlKTp0Ll9fcHJvdG9fXz1lKX1mdW5jdGlvbiBzKHQsZSxuKXtyZXR1cm4ib2JqZWN0Ij09PSh2b2lkIDA9PT1lPyJ1bmRlZmluZWQiOngoZSkpP09iamVjdC5rZXlzKGUpLnJlZHVjZShmdW5jdGlvbih0LG4pe3JldHVybiBzKHQsbixlW25dKX0sdCk6dC5yZWR1Y2UoZnVuY3Rpb24odCxyKXtyZXR1cm4gci5hdHRyaWJ1dGVzJiZyLmF0dHJpYnV0ZXNbZV0/dC5wdXNoKHIpOnQuaW5zZXJ0KHIuaW5zZXJ0LCgwLGouZGVmYXVsdCkoe30sbyh7fSxlLG4pLHIuYXR0cmlidXRlcykpfSxuZXcgcS5kZWZhdWx0KX1mdW5jdGlvbiB1KHQpe2lmKHQubm9kZVR5cGUhPT1Ob2RlLkVMRU1FTlRfTk9ERSlyZXR1cm57fTtyZXR1cm4gdFsiX19xbC1jb21wdXRlZC1zdHlsZSJdfHwodFsiX19xbC1jb21wdXRlZC1zdHlsZSJdPXdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHQpKX1mdW5jdGlvbiBjKHQsZSl7Zm9yKHZhciBuPSIiLHI9dC5vcHMubGVuZ3RoLTE7cj49MCYmbi5sZW5ndGg8ZS5sZW5ndGg7LS1yKXt2YXIgbz10Lm9wc1tyXTtpZigic3RyaW5nIiE9dHlwZW9mIG8uaW5zZXJ0KWJyZWFrO249by5pbnNlcnQrbn1yZXR1cm4gbi5zbGljZSgtMSplLmxlbmd0aCk9PT1lfWZ1bmN0aW9uIGYodCl7cmV0dXJuIDAhPT10LmNoaWxkTm9kZXMubGVuZ3RoJiZbImJsb2NrIiwibGlzdC1pdGVtIl0uaW5kZXhPZih1KHQpLmRpc3BsYXkpPi0xfWZ1bmN0aW9uIGgodCxlLG4pe3JldHVybiB0Lm5vZGVUeXBlPT09dC5URVhUX05PREU/bi5yZWR1Y2UoZnVuY3Rpb24oZSxuKXtyZXR1cm4gbih0LGUpfSxuZXcgcS5kZWZhdWx0KTp0Lm5vZGVUeXBlPT09dC5FTEVNRU5UX05PREU/W10ucmVkdWNlLmNhbGwodC5jaGlsZE5vZGVzfHxbXSxmdW5jdGlvbihyLG8pe3ZhciBpPWgobyxlLG4pO3JldHVybiBvLm5vZGVUeXBlPT09dC5FTEVNRU5UX05PREUmJihpPWUucmVkdWNlKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIGUobyx0KX0saSksaT0ob1tXXXx8W10pLnJlZHVjZShmdW5jdGlvbih0LGUpe3JldHVybiBlKG8sdCl9LGkpKSxyLmNvbmNhdChpKX0sbmV3IHEuZGVmYXVsdCk6bmV3IHEuZGVmYXVsdH1mdW5jdGlvbiBwKHQsZSxuKXtyZXR1cm4gcyhuLHQsITApfWZ1bmN0aW9uIGQodCxlKXt2YXIgbj1QLmRlZmF1bHQuQXR0cmlidXRvci5BdHRyaWJ1dGUua2V5cyh0KSxyPVAuZGVmYXVsdC5BdHRyaWJ1dG9yLkNsYXNzLmtleXModCksbz1QLmRlZmF1bHQuQXR0cmlidXRvci5TdHlsZS5rZXlzKHQpLGk9e307cmV0dXJuIG4uY29uY2F0KHIpLmNvbmNhdChvKS5mb3JFYWNoKGZ1bmN0aW9uKGUpe3ZhciBuPVAuZGVmYXVsdC5xdWVyeShlLFAuZGVmYXVsdC5TY29wZS5BVFRSSUJVVEUpO251bGwhPW4mJihpW24uYXR0ck5hbWVdPW4udmFsdWUodCksaVtuLmF0dHJOYW1lXSl8fChuPVlbZV0sbnVsbD09bnx8bi5hdHRyTmFtZSE9PWUmJm4ua2V5TmFtZSE9PWV8fChpW24uYXR0ck5hbWVdPW4udmFsdWUodCl8fHZvaWQgMCksbnVsbD09KG49WFtlXSl8fG4uYXR0ck5hbWUhPT1lJiZuLmtleU5hbWUhPT1lfHwobj1YW2VdLGlbbi5hdHRyTmFtZV09bi52YWx1ZSh0KXx8dm9pZCAwKSl9KSxPYmplY3Qua2V5cyhpKS5sZW5ndGg+MCYmKGU9cyhlLGkpKSxlfWZ1bmN0aW9uIHkodCxlKXt2YXIgbj1QLmRlZmF1bHQucXVlcnkodCk7aWYobnVsbD09bilyZXR1cm4gZTtpZihuLnByb3RvdHlwZSBpbnN0YW5jZW9mIFAuZGVmYXVsdC5FbWJlZCl7dmFyIHI9e30sbz1uLnZhbHVlKHQpO251bGwhPW8mJihyW24uYmxvdE5hbWVdPW8sZT0obmV3IHEuZGVmYXVsdCkuaW5zZXJ0KHIsbi5mb3JtYXRzKHQpKSl9ZWxzZSJmdW5jdGlvbiI9PXR5cGVvZiBuLmZvcm1hdHMmJihlPXMoZSxuLmJsb3ROYW1lLG4uZm9ybWF0cyh0KSkpO3JldHVybiBlfWZ1bmN0aW9uIHYodCxlKXtyZXR1cm4gYyhlLCJcbiIpfHxlLmluc2VydCgiXG4iKSxlfWZ1bmN0aW9uIGIoKXtyZXR1cm4gbmV3IHEuZGVmYXVsdH1mdW5jdGlvbiBnKHQsZSl7dmFyIG49UC5kZWZhdWx0LnF1ZXJ5KHQpO2lmKG51bGw9PW58fCJsaXN0LWl0ZW0iIT09bi5ibG90TmFtZXx8IWMoZSwiXG4iKSlyZXR1cm4gZTtmb3IodmFyIHI9LTEsbz10LnBhcmVudE5vZGU7IW8uY2xhc3NMaXN0LmNvbnRhaW5zKCJxbC1jbGlwYm9hcmQiKTspImxpc3QiPT09KFAuZGVmYXVsdC5xdWVyeShvKXx8e30pLmJsb3ROYW1lJiYocis9MSksbz1vLnBhcmVudE5vZGU7cmV0dXJuIHI8PTA/ZTplLmNvbXBvc2UoKG5ldyBxLmRlZmF1bHQpLnJldGFpbihlLmxlbmd0aCgpLTEpLnJldGFpbigxLHtpbmRlbnQ6cn0pKX1mdW5jdGlvbiBtKHQsZSl7cmV0dXJuIGMoZSwiXG4iKXx8KGYodCl8fGUubGVuZ3RoKCk+MCYmdC5uZXh0U2libGluZyYmZih0Lm5leHRTaWJsaW5nKSkmJmUuaW5zZXJ0KCJcbiIpLGV9ZnVuY3Rpb24gXyh0LGUpe2lmKGYodCkmJm51bGwhPXQubmV4dEVsZW1lbnRTaWJsaW5nJiYhYyhlLCJcblxuIikpe3ZhciBuPXQub2Zmc2V0SGVpZ2h0K3BhcnNlRmxvYXQodSh0KS5tYXJnaW5Ub3ApK3BhcnNlRmxvYXQodSh0KS5tYXJnaW5Cb3R0b20pO3QubmV4dEVsZW1lbnRTaWJsaW5nLm9mZnNldFRvcD50Lm9mZnNldFRvcCsxLjUqbiYmZS5pbnNlcnQoIlxuIil9cmV0dXJuIGV9ZnVuY3Rpb24gTyh0LGUpe3ZhciBuPXt9LHI9dC5zdHlsZXx8e307cmV0dXJuIHIuZm9udFN0eWxlJiYiaXRhbGljIj09PXUodCkuZm9udFN0eWxlJiYobi5pdGFsaWM9ITApLHIuZm9udFdlaWdodCYmKHUodCkuZm9udFdlaWdodC5zdGFydHNXaXRoKCJib2xkIil8fHBhcnNlSW50KHUodCkuZm9udFdlaWdodCk+PTcwMCkmJihuLmJvbGQ9ITApLE9iamVjdC5rZXlzKG4pLmxlbmd0aD4wJiYoZT1zKGUsbikpLHBhcnNlRmxvYXQoci50ZXh0SW5kZW50fHwwKT4wJiYoZT0obmV3IHEuZGVmYXVsdCkuaW5zZXJ0KCJcdCIpLmNvbmNhdChlKSksZX1mdW5jdGlvbiB3KHQsZSl7dmFyIG49dC5kYXRhO2lmKCJPOlAiPT09dC5wYXJlbnROb2RlLnRhZ05hbWUpcmV0dXJuIGUuaW5zZXJ0KG4udHJpbSgpKTtpZigwPT09bi50cmltKCkubGVuZ3RoJiZ0LnBhcmVudE5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCJxbC1jbGlwYm9hcmQiKSlyZXR1cm4gZTtpZighdSh0LnBhcmVudE5vZGUpLndoaXRlU3BhY2Uuc3RhcnRzV2l0aCgicHJlIikpe3ZhciByPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIGU9ZS5yZXBsYWNlKC9bXlx1MDBhMF0vZywiIiksZS5sZW5ndGg8MSYmdD8iICI6ZX07bj1uLnJlcGxhY2UoL1xyXG4vZywiICIpLnJlcGxhY2UoL1xuL2csIiAiKSxuPW4ucmVwbGFjZSgvXHNccysvZyxyLmJpbmQociwhMCkpLChudWxsPT10LnByZXZpb3VzU2libGluZyYmZih0LnBhcmVudE5vZGUpfHxudWxsIT10LnByZXZpb3VzU2libGluZyYmZih0LnByZXZpb3VzU2libGluZykpJiYobj1uLnJlcGxhY2UoL15ccysvLHIuYmluZChyLCExKSkpLChudWxsPT10Lm5leHRTaWJsaW5nJiZmKHQucGFyZW50Tm9kZSl8fG51bGwhPXQubmV4dFNpYmxpbmcmJmYodC5uZXh0U2libGluZykpJiYobj1uLnJlcGxhY2UoL1xzKyQvLHIuYmluZChyLCExKSkpfXJldHVybiBlLmluc2VydChuKX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksZS5tYXRjaFRleHQ9ZS5tYXRjaFNwYWNpbmc9ZS5tYXRjaE5ld2xpbmU9ZS5tYXRjaEJsb3Q9ZS5tYXRjaEF0dHJpYnV0b3I9ZS5kZWZhdWx0PXZvaWQgMDt2YXIgeD0iZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sJiYic3ltYm9sIj09dHlwZW9mIFN5bWJvbC5pdGVyYXRvcj9mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHR9OmZ1bmN0aW9uKHQpe3JldHVybiB0JiYiZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sJiZ0LmNvbnN0cnVjdG9yPT09U3ltYm9sJiZ0IT09U3ltYm9sLnByb3RvdHlwZT8ic3ltYm9sIjp0eXBlb2YgdH0saz1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXt2YXIgbj1bXSxyPSEwLG89ITEsaT12b2lkIDA7dHJ5e2Zvcih2YXIgbCxhPXRbU3ltYm9sLml0ZXJhdG9yXSgpOyEocj0obD1hLm5leHQoKSkuZG9uZSkmJihuLnB1c2gobC52YWx1ZSksIWV8fG4ubGVuZ3RoIT09ZSk7cj0hMCk7fWNhdGNoKHQpe289ITAsaT10fWZpbmFsbHl7dHJ5eyFyJiZhLnJldHVybiYmYS5yZXR1cm4oKX1maW5hbGx5e2lmKG8pdGhyb3cgaX19cmV0dXJuIG59cmV0dXJuIGZ1bmN0aW9uKGUsbil7aWYoQXJyYXkuaXNBcnJheShlKSlyZXR1cm4gZTtpZihTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGUpKXJldHVybiB0KGUsbik7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpfX0oKSxFPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lW25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsci5rZXkscil9fXJldHVybiBmdW5jdGlvbihlLG4scil7cmV0dXJuIG4mJnQoZS5wcm90b3R5cGUsbiksciYmdChlLHIpLGV9fSgpLE49bigyKSxqPXIoTiksQT1uKDQpLHE9cihBKSxUPW4oMCksUD1yKFQpLFM9big2KSxDPXIoUyksTD1uKDEwKSxNPXIoTCksUj1uKDcpLEk9cihSKSxCPW4oMzQpLEQ9bigzNSksVT1uKDEzKSxGPXIoVSksSD1uKDI0KSxLPW4oMzYpLHo9bigzNyksWj1uKDM4KSxWPSgwLE0uZGVmYXVsdCkoInF1aWxsOmNsaXBib2FyZCIpLFc9Il9fcWwtbWF0Y2hlciIsRz1bW05vZGUuVEVYVF9OT0RFLHddLFtOb2RlLlRFWFRfTk9ERSxtXSxbImJyIix2XSxbTm9kZS5FTEVNRU5UX05PREUsbV0sW05vZGUuRUxFTUVOVF9OT0RFLHldLFtOb2RlLkVMRU1FTlRfTk9ERSxfXSxbTm9kZS5FTEVNRU5UX05PREUsZF0sW05vZGUuRUxFTUVOVF9OT0RFLE9dLFsibGkiLGddLFsiYiIscC5iaW5kKHAsImJvbGQiKV0sWyJpIixwLmJpbmQocCwiaXRhbGljIildLFsic3R5bGUiLGJdXSxZPVtCLkFsaWduQXR0cmlidXRlLEsuRGlyZWN0aW9uQXR0cmlidXRlXS5yZWR1Y2UoZnVuY3Rpb24odCxlKXtyZXR1cm4gdFtlLmtleU5hbWVdPWUsdH0se30pLFg9W0IuQWxpZ25TdHlsZSxELkJhY2tncm91bmRTdHlsZSxILkNvbG9yU3R5bGUsSy5EaXJlY3Rpb25TdHlsZSx6LkZvbnRTdHlsZSxaLlNpemVTdHlsZV0ucmVkdWNlKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRbZS5rZXlOYW1lXT1lLHR9LHt9KSwkPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUodCxuKXtpKHRoaXMsZSk7dmFyIHI9bCh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5jYWxsKHRoaXMsdCxuKSk7cmV0dXJuIHIucXVpbGwucm9vdC5hZGRFdmVudExpc3RlbmVyKCJwYXN0ZSIsci5vblBhc3RlLmJpbmQocikpLHIuY29udGFpbmVyPXIucXVpbGwuYWRkQ29udGFpbmVyKCJxbC1jbGlwYm9hcmQiKSxyLmNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoImNvbnRlbnRlZGl0YWJsZSIsITApLHIuY29udGFpbmVyLnNldEF0dHJpYnV0ZSgidGFiaW5kZXgiLC0xKSxyLm1hdGNoZXJzPVtdLEcuY29uY2F0KHIub3B0aW9ucy5tYXRjaGVycykuZm9yRWFjaChmdW5jdGlvbih0KXt2YXIgZT1rKHQsMiksbz1lWzBdLGk9ZVsxXTsobi5tYXRjaFZpc3VhbHx8aSE9PV8pJiZyLmFkZE1hdGNoZXIobyxpKX0pLHJ9cmV0dXJuIGEoZSx0KSxFKGUsW3trZXk6ImFkZE1hdGNoZXIiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7dGhpcy5tYXRjaGVycy5wdXNoKFt0LGVdKX19LHtrZXk6ImNvbnZlcnQiLHZhbHVlOmZ1bmN0aW9uKHQpe2lmKCJzdHJpbmciPT10eXBlb2YgdClyZXR1cm4gdGhpcy5jb250YWluZXIuaW5uZXJIVE1MPXQucmVwbGFjZSgvXD5ccj9cbiArXDwvZywiPjwiKSx0aGlzLmNvbnZlcnQoKTt2YXIgZT10aGlzLnF1aWxsLmdldEZvcm1hdCh0aGlzLnF1aWxsLnNlbGVjdGlvbi5zYXZlZFJhbmdlLmluZGV4KTtpZihlW0YuZGVmYXVsdC5ibG90TmFtZV0pe3ZhciBuPXRoaXMuY29udGFpbmVyLmlubmVyVGV4dDtyZXR1cm4gdGhpcy5jb250YWluZXIuaW5uZXJIVE1MPSIiLChuZXcgcS5kZWZhdWx0KS5pbnNlcnQobixvKHt9LEYuZGVmYXVsdC5ibG90TmFtZSxlW0YuZGVmYXVsdC5ibG90TmFtZV0pKX12YXIgcj10aGlzLnByZXBhcmVNYXRjaGluZygpLGk9ayhyLDIpLGw9aVswXSxhPWlbMV0scz1oKHRoaXMuY29udGFpbmVyLGwsYSk7cmV0dXJuIGMocywiXG4iKSYmbnVsbD09cy5vcHNbcy5vcHMubGVuZ3RoLTFdLmF0dHJpYnV0ZXMmJihzPXMuY29tcG9zZSgobmV3IHEuZGVmYXVsdCkucmV0YWluKHMubGVuZ3RoKCktMSkuZGVsZXRlKDEpKSksVi5sb2coImNvbnZlcnQiLHRoaXMuY29udGFpbmVyLmlubmVySFRNTCxzKSx0aGlzLmNvbnRhaW5lci5pbm5lckhUTUw9IiIsc319LHtrZXk6ImRhbmdlcm91c2x5UGFzdGVIVE1MIix2YWx1ZTpmdW5jdGlvbih0LGUpe3ZhciBuPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTpDLmRlZmF1bHQuc291cmNlcy5BUEk7aWYoInN0cmluZyI9PXR5cGVvZiB0KXRoaXMucXVpbGwuc2V0Q29udGVudHModGhpcy5jb252ZXJ0KHQpLGUpLHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKDAsQy5kZWZhdWx0LnNvdXJjZXMuU0lMRU5UKTtlbHNle3ZhciByPXRoaXMuY29udmVydChlKTt0aGlzLnF1aWxsLnVwZGF0ZUNvbnRlbnRzKChuZXcgcS5kZWZhdWx0KS5yZXRhaW4odCkuY29uY2F0KHIpLG4pLHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKHQrci5sZW5ndGgoKSxDLmRlZmF1bHQuc291cmNlcy5TSUxFTlQpfX19LHtrZXk6Im9uUGFzdGUiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXM7aWYoIXQuZGVmYXVsdFByZXZlbnRlZCYmdGhpcy5xdWlsbC5pc0VuYWJsZWQoKSl7dmFyIG49dGhpcy5xdWlsbC5nZXRTZWxlY3Rpb24oKSxyPShuZXcgcS5kZWZhdWx0KS5yZXRhaW4obi5pbmRleCksbz10aGlzLnF1aWxsLnNjcm9sbGluZ0NvbnRhaW5lci5zY3JvbGxUb3A7dGhpcy5jb250YWluZXIuZm9jdXMoKSx0aGlzLnF1aWxsLnNlbGVjdGlvbi51cGRhdGUoQy5kZWZhdWx0LnNvdXJjZXMuU0lMRU5UKSxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7cj1yLmNvbmNhdChlLmNvbnZlcnQoKSkuZGVsZXRlKG4ubGVuZ3RoKSxlLnF1aWxsLnVwZGF0ZUNvbnRlbnRzKHIsQy5kZWZhdWx0LnNvdXJjZXMuVVNFUiksZS5xdWlsbC5zZXRTZWxlY3Rpb24oci5sZW5ndGgoKS1uLmxlbmd0aCxDLmRlZmF1bHQuc291cmNlcy5TSUxFTlQpLGUucXVpbGwuc2Nyb2xsaW5nQ29udGFpbmVyLnNjcm9sbFRvcD1vLGUucXVpbGwuZm9jdXMoKX0sMSl9fX0se2tleToicHJlcGFyZU1hdGNoaW5nIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMsZT1bXSxuPVtdO3JldHVybiB0aGlzLm1hdGNoZXJzLmZvckVhY2goZnVuY3Rpb24ocil7dmFyIG89ayhyLDIpLGk9b1swXSxsPW9bMV07c3dpdGNoKGkpe2Nhc2UgTm9kZS5URVhUX05PREU6bi5wdXNoKGwpO2JyZWFrO2Nhc2UgTm9kZS5FTEVNRU5UX05PREU6ZS5wdXNoKGwpO2JyZWFrO2RlZmF1bHQ6W10uZm9yRWFjaC5jYWxsKHQuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoaSksZnVuY3Rpb24odCl7dFtXXT10W1ddfHxbXSx0W1ddLnB1c2gobCl9KX19KSxbZSxuXX19XSksZX0oSS5kZWZhdWx0KTskLkRFRkFVTFRTPXttYXRjaGVyczpbXSxtYXRjaFZpc3VhbDohMH0sZS5kZWZhdWx0PSQsZS5tYXRjaEF0dHJpYnV0b3I9ZCxlLm1hdGNoQmxvdD15LGUubWF0Y2hOZXdsaW5lPW0sZS5tYXRjaFNwYWNpbmc9XyxlLm1hdGNoVGV4dD13fSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fWZ1bmN0aW9uIG8odCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBpKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gbCh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9ZnVuY3Rpb24gYSh0KXt2YXIgZT10Lm9wc1t0Lm9wcy5sZW5ndGgtMV07cmV0dXJuIG51bGwhPWUmJihudWxsIT1lLmluc2VydD8ic3RyaW5nIj09dHlwZW9mIGUuaW5zZXJ0JiZlLmluc2VydC5lbmRzV2l0aCgiXG4iKTpudWxsIT1lLmF0dHJpYnV0ZXMmJk9iamVjdC5rZXlzKGUuYXR0cmlidXRlcykuc29tZShmdW5jdGlvbih0KXtyZXR1cm4gbnVsbCE9Zi5kZWZhdWx0LnF1ZXJ5KHQsZi5kZWZhdWx0LlNjb3BlLkJMT0NLKX0pKX1mdW5jdGlvbiBzKHQpe3ZhciBlPXQucmVkdWNlKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQrPWUuZGVsZXRlfHwwfSwwKSxuPXQubGVuZ3RoKCktZTtyZXR1cm4gYSh0KSYmKG4tPTEpLG59T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pLGUuZ2V0TGFzdENoYW5nZUluZGV4PWUuZGVmYXVsdD12b2lkIDA7dmFyIHU9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQsZSl7Zm9yKHZhciBuPTA7bjxlLmxlbmd0aDtuKyspe3ZhciByPWVbbl07ci5lbnVtZXJhYmxlPXIuZW51bWVyYWJsZXx8ITEsci5jb25maWd1cmFibGU9ITAsInZhbHVlImluIHImJihyLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCxyLmtleSxyKX19cmV0dXJuIGZ1bmN0aW9uKGUsbixyKXtyZXR1cm4gbiYmdChlLnByb3RvdHlwZSxuKSxyJiZ0KGUsciksZX19KCksYz1uKDApLGY9cihjKSxoPW4oNikscD1yKGgpLGQ9big3KSx5PXIoZCksdj1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKHQsbil7byh0aGlzLGUpO3ZhciByPWkodGhpcywoZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSkuY2FsbCh0aGlzLHQsbikpO3JldHVybiByLmxhc3RSZWNvcmRlZD0wLHIuaWdub3JlQ2hhbmdlPSExLHIuY2xlYXIoKSxyLnF1aWxsLm9uKHAuZGVmYXVsdC5ldmVudHMuRURJVE9SX0NIQU5HRSxmdW5jdGlvbih0LGUsbixvKXt0IT09cC5kZWZhdWx0LmV2ZW50cy5URVhUX0NIQU5HRXx8ci5pZ25vcmVDaGFuZ2V8fChyLm9wdGlvbnMudXNlck9ubHkmJm8hPT1wLmRlZmF1bHQuc291cmNlcy5VU0VSP3IudHJhbnNmb3JtKGUpOnIucmVjb3JkKGUsbikpfSksci5xdWlsbC5rZXlib2FyZC5hZGRCaW5kaW5nKHtrZXk6IloiLHNob3J0S2V5OiEwfSxyLnVuZG8uYmluZChyKSksci5xdWlsbC5rZXlib2FyZC5hZGRCaW5kaW5nKHtrZXk6IloiLHNob3J0S2V5OiEwLHNoaWZ0S2V5OiEwfSxyLnJlZG8uYmluZChyKSksL1dpbi9pLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKSYmci5xdWlsbC5rZXlib2FyZC5hZGRCaW5kaW5nKHtrZXk6IlkiLHNob3J0S2V5OiEwfSxyLnJlZG8uYmluZChyKSkscn1yZXR1cm4gbChlLHQpLHUoZSxbe2tleToiY2hhbmdlIix2YWx1ZTpmdW5jdGlvbih0LGUpe2lmKDAhPT10aGlzLnN0YWNrW3RdLmxlbmd0aCl7dmFyIG49dGhpcy5zdGFja1t0XS5wb3AoKTt0aGlzLnN0YWNrW2VdLnB1c2gobiksdGhpcy5sYXN0UmVjb3JkZWQ9MCx0aGlzLmlnbm9yZUNoYW5nZT0hMCx0aGlzLnF1aWxsLnVwZGF0ZUNvbnRlbnRzKG5bdF0scC5kZWZhdWx0LnNvdXJjZXMuVVNFUiksdGhpcy5pZ25vcmVDaGFuZ2U9ITE7dmFyIHI9cyhuW3RdKTt0aGlzLnF1aWxsLnNldFNlbGVjdGlvbihyKX19fSx7a2V5OiJjbGVhciIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnN0YWNrPXt1bmRvOltdLHJlZG86W119fX0se2tleToiY3V0b2ZmIix2YWx1ZTpmdW5jdGlvbigpe3RoaXMubGFzdFJlY29yZGVkPTB9fSx7a2V5OiJyZWNvcmQiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7aWYoMCE9PXQub3BzLmxlbmd0aCl7dGhpcy5zdGFjay5yZWRvPVtdO3ZhciBuPXRoaXMucXVpbGwuZ2V0Q29udGVudHMoKS5kaWZmKGUpLHI9RGF0ZS5ub3coKTtpZih0aGlzLmxhc3RSZWNvcmRlZCt0aGlzLm9wdGlvbnMuZGVsYXk+ciYmdGhpcy5zdGFjay51bmRvLmxlbmd0aD4wKXt2YXIgbz10aGlzLnN0YWNrLnVuZG8ucG9wKCk7bj1uLmNvbXBvc2Uoby51bmRvKSx0PW8ucmVkby5jb21wb3NlKHQpfWVsc2UgdGhpcy5sYXN0UmVjb3JkZWQ9cjt0aGlzLnN0YWNrLnVuZG8ucHVzaCh7cmVkbzp0LHVuZG86bn0pLHRoaXMuc3RhY2sudW5kby5sZW5ndGg+dGhpcy5vcHRpb25zLm1heFN0YWNrJiZ0aGlzLnN0YWNrLnVuZG8uc2hpZnQoKX19fSx7a2V5OiJyZWRvIix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuY2hhbmdlKCJyZWRvIiwidW5kbyIpfX0se2tleToidHJhbnNmb3JtIix2YWx1ZTpmdW5jdGlvbih0KXt0aGlzLnN0YWNrLnVuZG8uZm9yRWFjaChmdW5jdGlvbihlKXtlLnVuZG89dC50cmFuc2Zvcm0oZS51bmRvLCEwKSxlLnJlZG89dC50cmFuc2Zvcm0oZS5yZWRvLCEwKX0pLHRoaXMuc3RhY2sucmVkby5mb3JFYWNoKGZ1bmN0aW9uKGUpe2UudW5kbz10LnRyYW5zZm9ybShlLnVuZG8sITApLGUucmVkbz10LnRyYW5zZm9ybShlLnJlZG8sITApfSl9fSx7a2V5OiJ1bmRvIix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuY2hhbmdlKCJ1bmRvIiwicmVkbyIpfX1dKSxlfSh5LmRlZmF1bHQpO3YuREVGQVVMVFM9e2RlbGF5OjFlMyxtYXhTdGFjazoxMDAsdXNlck9ubHk6ITF9LGUuZGVmYXVsdD12LGUuZ2V0TGFzdENoYW5nZUluZGV4PXN9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIG8odCxlKXtpZighdCl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiFlfHwib2JqZWN0IiE9dHlwZW9mIGUmJiJmdW5jdGlvbiIhPXR5cGVvZiBlP3Q6ZX1mdW5jdGlvbiBpKHQsZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUmJm51bGwhPT1lKXRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIit0eXBlb2YgZSk7dC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlJiZlLnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOnQsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksZSYmKE9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YodCxlKTp0Ll9fcHJvdG9fXz1lKX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksZS5JbmRlbnRDbGFzcz12b2lkIDA7dmFyIGw9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQsZSl7Zm9yKHZhciBuPTA7bjxlLmxlbmd0aDtuKyspe3ZhciByPWVbbl07ci5lbnVtZXJhYmxlPXIuZW51bWVyYWJsZXx8ITEsci5jb25maWd1cmFibGU9ITAsInZhbHVlImluIHImJihyLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCxyLmtleSxyKX19cmV0dXJuIGZ1bmN0aW9uKGUsbixyKXtyZXR1cm4gbiYmdChlLnByb3RvdHlwZSxuKSxyJiZ0KGUsciksZX19KCksYT1mdW5jdGlvbiB0KGUsbixyKXtudWxsPT09ZSYmKGU9RnVuY3Rpb24ucHJvdG90eXBlKTt2YXIgbz1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsbik7aWYodm9pZCAwPT09byl7dmFyIGk9T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpO3JldHVybiBudWxsPT09aT92b2lkIDA6dChpLG4scil9aWYoInZhbHVlImluIG8pcmV0dXJuIG8udmFsdWU7dmFyIGw9by5nZXQ7aWYodm9pZCAwIT09bClyZXR1cm4gbC5jYWxsKHIpfSxzPW4oMCksdT1mdW5jdGlvbih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19KHMpLGM9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSgpe3JldHVybiByKHRoaXMsZSksbyh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5hcHBseSh0aGlzLGFyZ3VtZW50cykpfXJldHVybiBpKGUsdCksbChlLFt7a2V5OiJhZGQiLHZhbHVlOmZ1bmN0aW9uKHQsbil7aWYoIisxIj09PW58fCItMSI9PT1uKXt2YXIgcj10aGlzLnZhbHVlKHQpfHwwO249IisxIj09PW4/cisxOnItMX1yZXR1cm4gMD09PW4/KHRoaXMucmVtb3ZlKHQpLCEwKTphKGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwiYWRkIix0aGlzKS5jYWxsKHRoaXMsdCxuKX19LHtrZXk6ImNhbkFkZCIsdmFsdWU6ZnVuY3Rpb24odCxuKXtyZXR1cm4gYShlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksImNhbkFkZCIsdGhpcykuY2FsbCh0aGlzLHQsbil8fGEoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJjYW5BZGQiLHRoaXMpLmNhbGwodGhpcyx0LHBhcnNlSW50KG4pKX19LHtrZXk6InZhbHVlIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gcGFyc2VJbnQoYShlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksInZhbHVlIix0aGlzKS5jYWxsKHRoaXMsdCkpfHx2b2lkIDB9fV0pLGV9KHUuZGVmYXVsdC5BdHRyaWJ1dG9yLkNsYXNzKSxmPW5ldyBjKCJpbmRlbnQiLCJxbC1pbmRlbnQiLHtzY29wZTp1LmRlZmF1bHQuU2NvcGUuQkxPQ0ssd2hpdGVsaXN0OlsxLDIsMyw0LDUsNiw3LDhdfSk7ZS5JbmRlbnRDbGFzcz1mfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBvKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gaSh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBsPW4oMyksYT1mdW5jdGlvbih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19KGwpLHM9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSgpe3JldHVybiByKHRoaXMsZSksbyh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5hcHBseSh0aGlzLGFyZ3VtZW50cykpfXJldHVybiBpKGUsdCksZX0oYS5kZWZhdWx0KTtzLmJsb3ROYW1lPSJibG9ja3F1b3RlIixzLnRhZ05hbWU9ImJsb2NrcXVvdGUiLGUuZGVmYXVsdD1zfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBvKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gaSh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBsPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lW25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsci5rZXkscil9fXJldHVybiBmdW5jdGlvbihlLG4scil7cmV0dXJuIG4mJnQoZS5wcm90b3R5cGUsbiksciYmdChlLHIpLGV9fSgpLGE9bigzKSxzPWZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX0oYSksdT1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKCl7cmV0dXJuIHIodGhpcyxlKSxvKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9cmV0dXJuIGkoZSx0KSxsKGUsbnVsbCxbe2tleToiZm9ybWF0cyIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMudGFnTmFtZS5pbmRleE9mKHQudGFnTmFtZSkrMX19XSksZX0ocy5kZWZhdWx0KTt1LmJsb3ROYW1lPSJoZWFkZXIiLHUudGFnTmFtZT1bIkgxIiwiSDIiLCJIMyIsIkg0IiwiSDUiLCJINiJdLGUuZGVmYXVsdD11fSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fWZ1bmN0aW9uIG8odCxlLG4pe3JldHVybiBlIGluIHQ/T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsZSx7dmFsdWU6bixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pOnRbZV09bix0fWZ1bmN0aW9uIGkodCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBsKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gYSh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pLGUuZGVmYXVsdD1lLkxpc3RJdGVtPXZvaWQgMDt2YXIgcz1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZVtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX1yZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfX0oKSx1PWZ1bmN0aW9uIHQoZSxuLHIpe251bGw9PT1lJiYoZT1GdW5jdGlvbi5wcm90b3R5cGUpO3ZhciBvPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSxuKTtpZih2b2lkIDA9PT1vKXt2YXIgaT1PYmplY3QuZ2V0UHJvdG90eXBlT2YoZSk7cmV0dXJuIG51bGw9PT1pP3ZvaWQgMDp0KGksbixyKX1pZigidmFsdWUiaW4gbylyZXR1cm4gby52YWx1ZTt2YXIgbD1vLmdldDtpZih2b2lkIDAhPT1sKXJldHVybiBsLmNhbGwocil9LGM9bigwKSxmPXIoYyksaD1uKDMpLHA9cihoKSxkPW4oMjMpLHk9cihkKSx2PWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXtyZXR1cm4gaSh0aGlzLGUpLGwodGhpcywoZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSkuYXBwbHkodGhpcyxhcmd1bWVudHMpKX1yZXR1cm4gYShlLHQpLHMoZSxbe2tleToiZm9ybWF0Iix2YWx1ZTpmdW5jdGlvbih0LG4pe3QhPT1iLmJsb3ROYW1lfHxuP3UoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJmb3JtYXQiLHRoaXMpLmNhbGwodGhpcyx0LG4pOnRoaXMucmVwbGFjZVdpdGgoZi5kZWZhdWx0LmNyZWF0ZSh0aGlzLnN0YXRpY3Muc2NvcGUpKX19LHtrZXk6InJlbW92ZSIsdmFsdWU6ZnVuY3Rpb24oKXtudWxsPT10aGlzLnByZXYmJm51bGw9PXRoaXMubmV4dD90aGlzLnBhcmVudC5yZW1vdmUoKTp1KGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwicmVtb3ZlIix0aGlzKS5jYWxsKHRoaXMpfX0se2tleToicmVwbGFjZVdpdGgiLHZhbHVlOmZ1bmN0aW9uKHQsbil7cmV0dXJuIHRoaXMucGFyZW50Lmlzb2xhdGUodGhpcy5vZmZzZXQodGhpcy5wYXJlbnQpLHRoaXMubGVuZ3RoKCkpLHQ9PT10aGlzLnBhcmVudC5zdGF0aWNzLmJsb3ROYW1lPyh0aGlzLnBhcmVudC5yZXBsYWNlV2l0aCh0LG4pLHRoaXMpOih0aGlzLnBhcmVudC51bndyYXAoKSx1KGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwicmVwbGFjZVdpdGgiLHRoaXMpLmNhbGwodGhpcyx0LG4pKX19XSxbe2tleToiZm9ybWF0cyIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHQudGFnTmFtZT09PXRoaXMudGFnTmFtZT92b2lkIDA6dShlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpLCJmb3JtYXRzIix0aGlzKS5jYWxsKHRoaXMsdCl9fV0pLGV9KHAuZGVmYXVsdCk7di5ibG90TmFtZT0ibGlzdC1pdGVtIix2LnRhZ05hbWU9IkxJIjt2YXIgYj1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKHQpe2kodGhpcyxlKTt2YXIgbj1sKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmNhbGwodGhpcyx0KSkscj1mdW5jdGlvbihlKXtpZihlLnRhcmdldC5wYXJlbnROb2RlPT09dCl7dmFyIHI9bi5zdGF0aWNzLmZvcm1hdHModCksbz1mLmRlZmF1bHQuZmluZChlLnRhcmdldCk7ImNoZWNrZWQiPT09cj9vLmZvcm1hdCgibGlzdCIsInVuY2hlY2tlZCIpOiJ1bmNoZWNrZWQiPT09ciYmby5mb3JtYXQoImxpc3QiLCJjaGVja2VkIil9fTtyZXR1cm4gdC5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaHN0YXJ0IixyKSx0LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsciksbn1yZXR1cm4gYShlLHQpLHMoZSxudWxsLFt7a2V5OiJjcmVhdGUiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBuPSJvcmRlcmVkIj09PXQ/Ik9MIjoiVUwiLHI9dShlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpLCJjcmVhdGUiLHRoaXMpLmNhbGwodGhpcyxuKTtyZXR1cm4iY2hlY2tlZCIhPT10JiYidW5jaGVja2VkIiE9PXR8fHIuc2V0QXR0cmlidXRlKCJkYXRhLWNoZWNrZWQiLCJjaGVja2VkIj09PXQpLHJ9fSx7a2V5OiJmb3JtYXRzIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4iT0wiPT09dC50YWdOYW1lPyJvcmRlcmVkIjoiVUwiPT09dC50YWdOYW1lP3QuaGFzQXR0cmlidXRlKCJkYXRhLWNoZWNrZWQiKT8idHJ1ZSI9PT10LmdldEF0dHJpYnV0ZSgiZGF0YS1jaGVja2VkIik/ImNoZWNrZWQiOiJ1bmNoZWNrZWQiOiJidWxsZXQiOnZvaWQgMH19XSkscyhlLFt7a2V5OiJmb3JtYXQiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7dGhpcy5jaGlsZHJlbi5sZW5ndGg+MCYmdGhpcy5jaGlsZHJlbi50YWlsLmZvcm1hdCh0LGUpfX0se2tleToiZm9ybWF0cyIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gbyh7fSx0aGlzLnN0YXRpY3MuYmxvdE5hbWUsdGhpcy5zdGF0aWNzLmZvcm1hdHModGhpcy5kb21Ob2RlKSl9fSx7a2V5OiJpbnNlcnRCZWZvcmUiLHZhbHVlOmZ1bmN0aW9uKHQsbil7aWYodCBpbnN0YW5jZW9mIHYpdShlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksImluc2VydEJlZm9yZSIsdGhpcykuY2FsbCh0aGlzLHQsbik7ZWxzZXt2YXIgcj1udWxsPT1uP3RoaXMubGVuZ3RoKCk6bi5vZmZzZXQodGhpcyksbz10aGlzLnNwbGl0KHIpO28ucGFyZW50Lmluc2VydEJlZm9yZSh0LG8pfX19LHtrZXk6Im9wdGltaXplIix2YWx1ZTpmdW5jdGlvbih0KXt1KGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwib3B0aW1pemUiLHRoaXMpLmNhbGwodGhpcyx0KTt2YXIgbj10aGlzLm5leHQ7bnVsbCE9biYmbi5wcmV2PT09dGhpcyYmbi5zdGF0aWNzLmJsb3ROYW1lPT09dGhpcy5zdGF0aWNzLmJsb3ROYW1lJiZuLmRvbU5vZGUudGFnTmFtZT09PXRoaXMuZG9tTm9kZS50YWdOYW1lJiZuLmRvbU5vZGUuZ2V0QXR0cmlidXRlKCJkYXRhLWNoZWNrZWQiKT09PXRoaXMuZG9tTm9kZS5nZXRBdHRyaWJ1dGUoImRhdGEtY2hlY2tlZCIpJiYobi5tb3ZlQ2hpbGRyZW4odGhpcyksbi5yZW1vdmUoKSl9fSx7a2V5OiJyZXBsYWNlIix2YWx1ZTpmdW5jdGlvbih0KXtpZih0LnN0YXRpY3MuYmxvdE5hbWUhPT10aGlzLnN0YXRpY3MuYmxvdE5hbWUpe3ZhciBuPWYuZGVmYXVsdC5jcmVhdGUodGhpcy5zdGF0aWNzLmRlZmF1bHRDaGlsZCk7dC5tb3ZlQ2hpbGRyZW4obiksdGhpcy5hcHBlbmRDaGlsZChuKX11KGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwicmVwbGFjZSIsdGhpcykuY2FsbCh0aGlzLHQpfX1dKSxlfSh5LmRlZmF1bHQpO2IuYmxvdE5hbWU9Imxpc3QiLGIuc2NvcGU9Zi5kZWZhdWx0LlNjb3BlLkJMT0NLX0JMT1QsYi50YWdOYW1lPVsiT0wiLCJVTCJdLGIuZGVmYXVsdENoaWxkPSJsaXN0LWl0ZW0iLGIuYWxsb3dlZENoaWxkcmVuPVt2XSxlLkxpc3RJdGVtPXYsZS5kZWZhdWx0PWJ9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIG8odCxlKXtpZighdCl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiFlfHwib2JqZWN0IiE9dHlwZW9mIGUmJiJmdW5jdGlvbiIhPXR5cGVvZiBlP3Q6ZX1mdW5jdGlvbiBpKHQsZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUmJm51bGwhPT1lKXRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIit0eXBlb2YgZSk7dC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlJiZlLnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOnQsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksZSYmKE9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YodCxlKTp0Ll9fcHJvdG9fXz1lKX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIGw9bigzOSksYT1mdW5jdGlvbih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19KGwpLHM9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSgpe3JldHVybiByKHRoaXMsZSksbyh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5hcHBseSh0aGlzLGFyZ3VtZW50cykpfXJldHVybiBpKGUsdCksZX0oYS5kZWZhdWx0KTtzLmJsb3ROYW1lPSJpdGFsaWMiLHMudGFnTmFtZT1bIkVNIiwiSSJdLGUuZGVmYXVsdD1zfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBvKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gaSh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBsPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lW25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsci5rZXkscil9fXJldHVybiBmdW5jdGlvbihlLG4scil7cmV0dXJuIG4mJnQoZS5wcm90b3R5cGUsbiksciYmdChlLHIpLGV9fSgpLGE9ZnVuY3Rpb24gdChlLG4scil7bnVsbD09PWUmJihlPUZ1bmN0aW9uLnByb3RvdHlwZSk7dmFyIG89T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLG4pO2lmKHZvaWQgMD09PW8pe3ZhciBpPU9iamVjdC5nZXRQcm90b3R5cGVPZihlKTtyZXR1cm4gbnVsbD09PWk/dm9pZCAwOnQoaSxuLHIpfWlmKCJ2YWx1ZSJpbiBvKXJldHVybiBvLnZhbHVlO3ZhciBsPW8uZ2V0O2lmKHZvaWQgMCE9PWwpcmV0dXJuIGwuY2FsbChyKX0scz1uKDUpLHU9ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fShzKSxjPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXtyZXR1cm4gcih0aGlzLGUpLG8odGhpcywoZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSkuYXBwbHkodGhpcyxhcmd1bWVudHMpKX1yZXR1cm4gaShlLHQpLGwoZSxudWxsLFt7a2V5OiJjcmVhdGUiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiJzdXBlciI9PT10P2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN1cCIpOiJzdWIiPT09dD9kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdWIiKTphKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSksImNyZWF0ZSIsdGhpcykuY2FsbCh0aGlzLHQpfX0se2tleToiZm9ybWF0cyIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIlNVQiI9PT10LnRhZ05hbWU/InN1YiI6IlNVUCI9PT10LnRhZ05hbWU/InN1cGVyIjp2b2lkIDB9fV0pLGV9KHUuZGVmYXVsdCk7Yy5ibG90TmFtZT0ic2NyaXB0IixjLnRhZ05hbWU9WyJTVUIiLCJTVVAiXSxlLmRlZmF1bHQ9Y30sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiByKHQsZSl7aWYoISh0IGluc3RhbmNlb2YgZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIil9ZnVuY3Rpb24gbyh0LGUpe2lmKCF0KXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7cmV0dXJuIWV8fCJvYmplY3QiIT10eXBlb2YgZSYmImZ1bmN0aW9uIiE9dHlwZW9mIGU/dDplfWZ1bmN0aW9uIGkodCxlKXtpZigiZnVuY3Rpb24iIT10eXBlb2YgZSYmbnVsbCE9PWUpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiK3R5cGVvZiBlKTt0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGUmJmUucHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6dCxlbnVtZXJhYmxlOiExLHdyaXRhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH19KSxlJiYoT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0LGUpOnQuX19wcm90b19fPWUpfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgbD1uKDUpLGE9ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fShsKSxzPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXtyZXR1cm4gcih0aGlzLGUpLG8odGhpcywoZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSkuYXBwbHkodGhpcyxhcmd1bWVudHMpKX1yZXR1cm4gaShlLHQpLGV9KGEuZGVmYXVsdCk7cy5ibG90TmFtZT0ic3RyaWtlIixzLnRhZ05hbWU9IlMiLGUuZGVmYXVsdD1zfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBvKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gaSh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBsPW4oNSksYT1mdW5jdGlvbih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19KGwpLHM9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSgpe3JldHVybiByKHRoaXMsZSksbyh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5hcHBseSh0aGlzLGFyZ3VtZW50cykpfXJldHVybiBpKGUsdCksZX0oYS5kZWZhdWx0KTtzLmJsb3ROYW1lPSJ1bmRlcmxpbmUiLHMudGFnTmFtZT0iVSIsZS5kZWZhdWx0PXN9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIG8odCxlKXtpZighdCl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiFlfHwib2JqZWN0IiE9dHlwZW9mIGUmJiJmdW5jdGlvbiIhPXR5cGVvZiBlP3Q6ZX1mdW5jdGlvbiBpKHQsZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUmJm51bGwhPT1lKXRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIit0eXBlb2YgZSk7dC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlJiZlLnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOnQsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksZSYmKE9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YodCxlKTp0Ll9fcHJvdG9fXz1lKX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIGw9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQsZSl7Zm9yKHZhciBuPTA7bjxlLmxlbmd0aDtuKyspe3ZhciByPWVbbl07ci5lbnVtZXJhYmxlPXIuZW51bWVyYWJsZXx8ITEsci5jb25maWd1cmFibGU9ITAsInZhbHVlImluIHImJihyLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCxyLmtleSxyKX19cmV0dXJuIGZ1bmN0aW9uKGUsbixyKXtyZXR1cm4gbiYmdChlLnByb3RvdHlwZSxuKSxyJiZ0KGUsciksZX19KCksYT1mdW5jdGlvbiB0KGUsbixyKXtudWxsPT09ZSYmKGU9RnVuY3Rpb24ucHJvdG90eXBlKTt2YXIgbz1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsbik7aWYodm9pZCAwPT09byl7dmFyIGk9T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpO3JldHVybiBudWxsPT09aT92b2lkIDA6dChpLG4scil9aWYoInZhbHVlImluIG8pcmV0dXJuIG8udmFsdWU7dmFyIGw9by5nZXQ7aWYodm9pZCAwIT09bClyZXR1cm4gbC5jYWxsKHIpfSxzPW4oMCksdT1mdW5jdGlvbih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19KHMpLGM9bigxNSksZj1bImFsdCIsImhlaWdodCIsIndpZHRoIl0saD1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKCl7cmV0dXJuIHIodGhpcyxlKSxvKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9cmV0dXJuIGkoZSx0KSxsKGUsW3trZXk6ImZvcm1hdCIsdmFsdWU6ZnVuY3Rpb24odCxuKXtmLmluZGV4T2YodCk+LTE/bj90aGlzLmRvbU5vZGUuc2V0QXR0cmlidXRlKHQsbik6dGhpcy5kb21Ob2RlLnJlbW92ZUF0dHJpYnV0ZSh0KTphKGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwiZm9ybWF0Iix0aGlzKS5jYWxsKHRoaXMsdCxuKX19XSxbe2tleToiY3JlYXRlIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgbj1hKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSksImNyZWF0ZSIsdGhpcykuY2FsbCh0aGlzLHQpO3JldHVybiJzdHJpbmciPT10eXBlb2YgdCYmbi5zZXRBdHRyaWJ1dGUoInNyYyIsdGhpcy5zYW5pdGl6ZSh0KSksbn19LHtrZXk6ImZvcm1hdHMiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBmLnJlZHVjZShmdW5jdGlvbihlLG4pe3JldHVybiB0Lmhhc0F0dHJpYnV0ZShuKSYmKGVbbl09dC5nZXRBdHRyaWJ1dGUobikpLGV9LHt9KX19LHtrZXk6Im1hdGNoIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4vXC4oanBlP2d8Z2lmfHBuZykkLy50ZXN0KHQpfHwvXmRhdGE6aW1hZ2VcLy4rO2Jhc2U2NC8udGVzdCh0KX19LHtrZXk6InNhbml0aXplIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4oMCxjLnNhbml0aXplKSh0LFsiaHR0cCIsImh0dHBzIiwiZGF0YSJdKT90OiIvLzowIn19LHtrZXk6InZhbHVlIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gdC5nZXRBdHRyaWJ1dGUoInNyYyIpfX1dKSxlfSh1LmRlZmF1bHQuRW1iZWQpO2guYmxvdE5hbWU9ImltYWdlIixoLnRhZ05hbWU9IklNRyIsZS5kZWZhdWx0PWh9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIG8odCxlKXtpZighdCl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiFlfHwib2JqZWN0IiE9dHlwZW9mIGUmJiJmdW5jdGlvbiIhPXR5cGVvZiBlP3Q6ZX1mdW5jdGlvbiBpKHQsZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUmJm51bGwhPT1lKXRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIit0eXBlb2YgZSk7dC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlJiZlLnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOnQsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksZSYmKE9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YodCxlKTp0Ll9fcHJvdG9fXz1lKX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIGw9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQsZSl7Zm9yKHZhciBuPTA7bjxlLmxlbmd0aDtuKyspe3ZhciByPWVbbl07ci5lbnVtZXJhYmxlPXIuZW51bWVyYWJsZXx8ITEsci5jb25maWd1cmFibGU9ITAsInZhbHVlImluIHImJihyLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCxyLmtleSxyKX19cmV0dXJuIGZ1bmN0aW9uKGUsbixyKXtyZXR1cm4gbiYmdChlLnByb3RvdHlwZSxuKSxyJiZ0KGUsciksZX19KCksYT1mdW5jdGlvbiB0KGUsbixyKXtudWxsPT09ZSYmKGU9RnVuY3Rpb24ucHJvdG90eXBlKTt2YXIgbz1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsbik7aWYodm9pZCAwPT09byl7dmFyIGk9T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpO3JldHVybiBudWxsPT09aT92b2lkIDA6dChpLG4scil9aWYoInZhbHVlImluIG8pcmV0dXJuIG8udmFsdWU7dmFyIGw9by5nZXQ7aWYodm9pZCAwIT09bClyZXR1cm4gbC5jYWxsKHIpfSxzPW4oMyksdT1uKDE1KSxjPWZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX0odSksZj1bImhlaWdodCIsIndpZHRoIl0saD1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKCl7cmV0dXJuIHIodGhpcyxlKSxvKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9cmV0dXJuIGkoZSx0KSxsKGUsW3trZXk6ImZvcm1hdCIsdmFsdWU6ZnVuY3Rpb24odCxuKXtmLmluZGV4T2YodCk+LTE/bj90aGlzLmRvbU5vZGUuc2V0QXR0cmlidXRlKHQsbik6dGhpcy5kb21Ob2RlLnJlbW92ZUF0dHJpYnV0ZSh0KTphKGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwiZm9ybWF0Iix0aGlzKS5jYWxsKHRoaXMsdCxuKX19XSxbe2tleToiY3JlYXRlIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgbj1hKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSksImNyZWF0ZSIsdGhpcykuY2FsbCh0aGlzLHQpO3JldHVybiBuLnNldEF0dHJpYnV0ZSgiZnJhbWVib3JkZXIiLCIwIiksbi5zZXRBdHRyaWJ1dGUoImFsbG93ZnVsbHNjcmVlbiIsITApLG4uc2V0QXR0cmlidXRlKCJzcmMiLHRoaXMuc2FuaXRpemUodCkpLG59fSx7a2V5OiJmb3JtYXRzIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZi5yZWR1Y2UoZnVuY3Rpb24oZSxuKXtyZXR1cm4gdC5oYXNBdHRyaWJ1dGUobikmJihlW25dPXQuZ2V0QXR0cmlidXRlKG4pKSxlfSx7fSl9fSx7a2V5OiJzYW5pdGl6ZSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGMuZGVmYXVsdC5zYW5pdGl6ZSh0KX19LHtrZXk6InZhbHVlIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gdC5nZXRBdHRyaWJ1dGUoInNyYyIpfX1dKSxlfShzLkJsb2NrRW1iZWQpO2guYmxvdE5hbWU9InZpZGVvIixoLmNsYXNzTmFtZT0icWwtdmlkZW8iLGgudGFnTmFtZT0iSUZSQU1FIixlLmRlZmF1bHQ9aH0sZnVuY3Rpb24odCxlLG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiByKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGU/dDp7ZGVmYXVsdDp0fX1mdW5jdGlvbiBvKHQsZSl7aWYoISh0IGluc3RhbmNlb2YgZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIil9ZnVuY3Rpb24gaSh0LGUpe2lmKCF0KXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7cmV0dXJuIWV8fCJvYmplY3QiIT10eXBlb2YgZSYmImZ1bmN0aW9uIiE9dHlwZW9mIGU/dDplfWZ1bmN0aW9uIGwodCxlKXtpZigiZnVuY3Rpb24iIT10eXBlb2YgZSYmbnVsbCE9PWUpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiK3R5cGVvZiBlKTt0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGUmJmUucHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6dCxlbnVtZXJhYmxlOiExLHdyaXRhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH19KSxlJiYoT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0LGUpOnQuX19wcm90b19fPWUpfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxlLmRlZmF1bHQ9ZS5Gb3JtdWxhQmxvdD12b2lkIDA7dmFyIGE9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQsZSl7Zm9yKHZhciBuPTA7bjxlLmxlbmd0aDtuKyspe3ZhciByPWVbbl07ci5lbnVtZXJhYmxlPXIuZW51bWVyYWJsZXx8ITEsci5jb25maWd1cmFibGU9ITAsInZhbHVlImluIHImJihyLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCxyLmtleSxyKX19cmV0dXJuIGZ1bmN0aW9uKGUsbixyKXtyZXR1cm4gbiYmdChlLnByb3RvdHlwZSxuKSxyJiZ0KGUsciksZX19KCkscz1mdW5jdGlvbiB0KGUsbixyKXtudWxsPT09ZSYmKGU9RnVuY3Rpb24ucHJvdG90eXBlKTt2YXIgbz1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsbik7aWYodm9pZCAwPT09byl7dmFyIGk9T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpO3JldHVybiBudWxsPT09aT92b2lkIDA6dChpLG4scil9aWYoInZhbHVlImluIG8pcmV0dXJuIG8udmFsdWU7dmFyIGw9by5nZXQ7aWYodm9pZCAwIT09bClyZXR1cm4gbC5jYWxsKHIpfSx1PW4oMzMpLGM9cih1KSxmPW4oNiksaD1yKGYpLHA9big3KSxkPXIocCkseT1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKCl7cmV0dXJuIG8odGhpcyxlKSxpKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9cmV0dXJuIGwoZSx0KSxhKGUsbnVsbCxbe2tleToiY3JlYXRlIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgbj1zKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSksImNyZWF0ZSIsdGhpcykuY2FsbCh0aGlzLHQpO3JldHVybiJzdHJpbmciPT10eXBlb2YgdCYmKHdpbmRvdy5rYXRleC5yZW5kZXIodCxuLHt0aHJvd09uRXJyb3I6ITEsZXJyb3JDb2xvcjoiI2YwMCJ9KSxuLnNldEF0dHJpYnV0ZSgiZGF0YS12YWx1ZSIsdCkpLG59fSx7a2V5OiJ2YWx1ZSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHQuZ2V0QXR0cmlidXRlKCJkYXRhLXZhbHVlIil9fV0pLGV9KGMuZGVmYXVsdCk7eS5ibG90TmFtZT0iZm9ybXVsYSIseS5jbGFzc05hbWU9InFsLWZvcm11bGEiLHkudGFnTmFtZT0iU1BBTiI7dmFyIHY9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSgpe28odGhpcyxlKTt2YXIgdD1pKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmNhbGwodGhpcykpO2lmKG51bGw9PXdpbmRvdy5rYXRleCl0aHJvdyBuZXcgRXJyb3IoIkZvcm11bGEgbW9kdWxlIHJlcXVpcmVzIEthVGVYLiIpO3JldHVybiB0fXJldHVybiBsKGUsdCksYShlLG51bGwsW3trZXk6InJlZ2lzdGVyIix2YWx1ZTpmdW5jdGlvbigpe2guZGVmYXVsdC5yZWdpc3Rlcih5LCEwKX19XSksZX0oZC5kZWZhdWx0KTtlLkZvcm11bGFCbG90PXksZS5kZWZhdWx0PXZ9LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19ZnVuY3Rpb24gbyh0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIGkodCxlKXtpZighdCl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiFlfHwib2JqZWN0IiE9dHlwZW9mIGUmJiJmdW5jdGlvbiIhPXR5cGVvZiBlP3Q6ZX1mdW5jdGlvbiBsKHQsZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUmJm51bGwhPT1lKXRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIit0eXBlb2YgZSk7dC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlJiZlLnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOnQsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksZSYmKE9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YodCxlKTp0Ll9fcHJvdG9fXz1lKX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksZS5kZWZhdWx0PWUuQ29kZVRva2VuPWUuQ29kZUJsb2NrPXZvaWQgMDt2YXIgYT1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZVtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX1yZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfX0oKSxzPWZ1bmN0aW9uIHQoZSxuLHIpe251bGw9PT1lJiYoZT1GdW5jdGlvbi5wcm90b3R5cGUpO3ZhciBvPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSxuKTtpZih2b2lkIDA9PT1vKXt2YXIgaT1PYmplY3QuZ2V0UHJvdG90eXBlT2YoZSk7cmV0dXJuIG51bGw9PT1pP3ZvaWQgMDp0KGksbixyKX1pZigidmFsdWUiaW4gbylyZXR1cm4gby52YWx1ZTt2YXIgbD1vLmdldDtpZih2b2lkIDAhPT1sKXJldHVybiBsLmNhbGwocil9LHU9bigwKSxjPXIodSksZj1uKDYpLGg9cihmKSxwPW4oNyksZD1yKHApLHk9bigxMyksdj1yKHkpLGI9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSgpe3JldHVybiBvKHRoaXMsZSksaSh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5hcHBseSh0aGlzLGFyZ3VtZW50cykpfXJldHVybiBsKGUsdCksYShlLFt7a2V5OiJyZXBsYWNlV2l0aCIsdmFsdWU6ZnVuY3Rpb24odCl7dGhpcy5kb21Ob2RlLnRleHRDb250ZW50PXRoaXMuZG9tTm9kZS50ZXh0Q29udGVudCx0aGlzLmF0dGFjaCgpLHMoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJyZXBsYWNlV2l0aCIsdGhpcykuY2FsbCh0aGlzLHQpfX0se2tleToiaGlnaGxpZ2h0Iix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLmRvbU5vZGUudGV4dENvbnRlbnQ7dGhpcy5jYWNoZWRUZXh0IT09ZSYmKChlLnRyaW0oKS5sZW5ndGg+MHx8bnVsbD09dGhpcy5jYWNoZWRUZXh0KSYmKHRoaXMuZG9tTm9kZS5pbm5lckhUTUw9dChlKSx0aGlzLmRvbU5vZGUubm9ybWFsaXplKCksdGhpcy5hdHRhY2goKSksdGhpcy5jYWNoZWRUZXh0PWUpfX1dKSxlfSh2LmRlZmF1bHQpO2IuY2xhc3NOYW1lPSJxbC1zeW50YXgiO3ZhciBnPW5ldyBjLmRlZmF1bHQuQXR0cmlidXRvci5DbGFzcygidG9rZW4iLCJobGpzIix7c2NvcGU6Yy5kZWZhdWx0LlNjb3BlLklOTElORX0pLG09ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSh0LG4pe28odGhpcyxlKTt2YXIgcj1pKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmNhbGwodGhpcyx0LG4pKTtpZigiZnVuY3Rpb24iIT10eXBlb2Ygci5vcHRpb25zLmhpZ2hsaWdodCl0aHJvdyBuZXcgRXJyb3IoIlN5bnRheCBtb2R1bGUgcmVxdWlyZXMgaGlnaGxpZ2h0LmpzLiBQbGVhc2UgaW5jbHVkZSB0aGUgbGlicmFyeSBvbiB0aGUgcGFnZSBiZWZvcmUgUXVpbGwuIik7dmFyIGw9bnVsbDtyZXR1cm4gci5xdWlsbC5vbihoLmRlZmF1bHQuZXZlbnRzLlNDUk9MTF9PUFRJTUlaRSxmdW5jdGlvbigpe2NsZWFyVGltZW91dChsKSxsPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtyLmhpZ2hsaWdodCgpLGw9bnVsbH0sci5vcHRpb25zLmludGVydmFsKX0pLHIuaGlnaGxpZ2h0KCkscn1yZXR1cm4gbChlLHQpLGEoZSxudWxsLFt7a2V5OiJyZWdpc3RlciIsdmFsdWU6ZnVuY3Rpb24oKXtoLmRlZmF1bHQucmVnaXN0ZXIoZywhMCksaC5kZWZhdWx0LnJlZ2lzdGVyKGIsITApfX1dKSxhKGUsW3trZXk6ImhpZ2hsaWdodCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzO2lmKCF0aGlzLnF1aWxsLnNlbGVjdGlvbi5jb21wb3Npbmcpe3RoaXMucXVpbGwudXBkYXRlKGguZGVmYXVsdC5zb3VyY2VzLlVTRVIpO3ZhciBlPXRoaXMucXVpbGwuZ2V0U2VsZWN0aW9uKCk7dGhpcy5xdWlsbC5zY3JvbGwuZGVzY2VuZGFudHMoYikuZm9yRWFjaChmdW5jdGlvbihlKXtlLmhpZ2hsaWdodCh0Lm9wdGlvbnMuaGlnaGxpZ2h0KX0pLHRoaXMucXVpbGwudXBkYXRlKGguZGVmYXVsdC5zb3VyY2VzLlNJTEVOVCksbnVsbCE9ZSYmdGhpcy5xdWlsbC5zZXRTZWxlY3Rpb24oZSxoLmRlZmF1bHQuc291cmNlcy5TSUxFTlQpfX19XSksZX0oZC5kZWZhdWx0KTttLkRFRkFVTFRTPXtoaWdobGlnaHQ6ZnVuY3Rpb24oKXtyZXR1cm4gbnVsbD09d2luZG93LmhsanM/bnVsbDpmdW5jdGlvbih0KXtyZXR1cm4gd2luZG93LmhsanMuaGlnaGxpZ2h0QXV0byh0KS52YWx1ZX19KCksaW50ZXJ2YWw6MWUzfSxlLkNvZGVCbG9jaz1iLGUuQ29kZVRva2VuPWcsZS5kZWZhdWx0PW19LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19ZnVuY3Rpb24gbyh0LGUsbil7cmV0dXJuIGUgaW4gdD9PYmplY3QuZGVmaW5lUHJvcGVydHkodCxlLHt2YWx1ZTpuLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwfSk6dFtlXT1uLHR9ZnVuY3Rpb24gaSh0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIGwodCxlKXtpZighdCl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiFlfHwib2JqZWN0IiE9dHlwZW9mIGUmJiJmdW5jdGlvbiIhPXR5cGVvZiBlP3Q6ZX1mdW5jdGlvbiBhKHQsZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUmJm51bGwhPT1lKXRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIit0eXBlb2YgZSk7dC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlJiZlLnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOnQsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksZSYmKE9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YodCxlKTp0Ll9fcHJvdG9fXz1lKX1mdW5jdGlvbiBzKHQsZSxuKXt2YXIgcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTtyLnNldEF0dHJpYnV0ZSgidHlwZSIsImJ1dHRvbiIpLHIuY2xhc3NMaXN0LmFkZCgicWwtIitlKSxudWxsIT1uJiYoci52YWx1ZT1uKSx0LmFwcGVuZENoaWxkKHIpfWZ1bmN0aW9uIHUodCxlKXtBcnJheS5pc0FycmF5KGVbMF0pfHwoZT1bZV0pLGUuZm9yRWFjaChmdW5jdGlvbihlKXt2YXIgbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7bi5jbGFzc0xpc3QuYWRkKCJxbC1mb3JtYXRzIiksZS5mb3JFYWNoKGZ1bmN0aW9uKHQpe2lmKCJzdHJpbmciPT10eXBlb2YgdClzKG4sdCk7ZWxzZXt2YXIgZT1PYmplY3Qua2V5cyh0KVswXSxyPXRbZV07QXJyYXkuaXNBcnJheShyKT9jKG4sZSxyKTpzKG4sZSxyKX19KSx0LmFwcGVuZENoaWxkKG4pfSl9ZnVuY3Rpb24gYyh0LGUsbil7dmFyIHI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2VsZWN0Iik7ci5jbGFzc0xpc3QuYWRkKCJxbC0iK2UpLG4uZm9yRWFjaChmdW5jdGlvbih0KXt2YXIgZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTshMSE9PXQ/ZS5zZXRBdHRyaWJ1dGUoInZhbHVlIix0KTplLnNldEF0dHJpYnV0ZSgic2VsZWN0ZWQiLCJzZWxlY3RlZCIpLHIuYXBwZW5kQ2hpbGQoZSl9KSx0LmFwcGVuZENoaWxkKHIpfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxlLmFkZENvbnRyb2xzPWUuZGVmYXVsdD12b2lkIDA7dmFyIGY9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQsZSl7dmFyIG49W10scj0hMCxvPSExLGk9dm9pZCAwO3RyeXtmb3IodmFyIGwsYT10W1N5bWJvbC5pdGVyYXRvcl0oKTshKHI9KGw9YS5uZXh0KCkpLmRvbmUpJiYobi5wdXNoKGwudmFsdWUpLCFlfHxuLmxlbmd0aCE9PWUpO3I9ITApO31jYXRjaCh0KXtvPSEwLGk9dH1maW5hbGx5e3RyeXshciYmYS5yZXR1cm4mJmEucmV0dXJuKCl9ZmluYWxseXtpZihvKXRocm93IGl9fXJldHVybiBufXJldHVybiBmdW5jdGlvbihlLG4pe2lmKEFycmF5LmlzQXJyYXkoZSkpcmV0dXJuIGU7aWYoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChlKSlyZXR1cm4gdChlLG4pO3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKX19KCksaD1mdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZVtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX1yZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfX0oKSxwPW4oNCksZD1yKHApLHk9bigwKSx2PXIoeSksYj1uKDYpLGc9cihiKSxtPW4oMTApLF89cihtKSxPPW4oNyksdz1yKE8pLHg9KDAsXy5kZWZhdWx0KSgicXVpbGw6dG9vbGJhciIpLGs9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSh0LG4pe2kodGhpcyxlKTt2YXIgcj1sKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmNhbGwodGhpcyx0LG4pKTtpZihBcnJheS5pc0FycmF5KHIub3B0aW9ucy5jb250YWluZXIpKXt2YXIgbz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt1KG8sci5vcHRpb25zLmNvbnRhaW5lciksdC5jb250YWluZXIucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobyx0LmNvbnRhaW5lciksci5jb250YWluZXI9b31lbHNlInN0cmluZyI9PXR5cGVvZiByLm9wdGlvbnMuY29udGFpbmVyP3IuY29udGFpbmVyPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioci5vcHRpb25zLmNvbnRhaW5lcik6ci5jb250YWluZXI9ci5vcHRpb25zLmNvbnRhaW5lcjtpZighKHIuY29udGFpbmVyIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpKXt2YXIgYTtyZXR1cm4gYT14LmVycm9yKCJDb250YWluZXIgcmVxdWlyZWQgZm9yIHRvb2xiYXIiLHIub3B0aW9ucyksbChyLGEpfXJldHVybiByLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJxbC10b29sYmFyIiksci5jb250cm9scz1bXSxyLmhhbmRsZXJzPXt9LE9iamVjdC5rZXlzKHIub3B0aW9ucy5oYW5kbGVycykuZm9yRWFjaChmdW5jdGlvbih0KXtyLmFkZEhhbmRsZXIodCxyLm9wdGlvbnMuaGFuZGxlcnNbdF0pfSksW10uZm9yRWFjaC5jYWxsKHIuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoImJ1dHRvbiwgc2VsZWN0IiksZnVuY3Rpb24odCl7ci5hdHRhY2godCl9KSxyLnF1aWxsLm9uKGcuZGVmYXVsdC5ldmVudHMuRURJVE9SX0NIQU5HRSxmdW5jdGlvbih0LGUpe3Q9PT1nLmRlZmF1bHQuZXZlbnRzLlNFTEVDVElPTl9DSEFOR0UmJnIudXBkYXRlKGUpfSksci5xdWlsbC5vbihnLmRlZmF1bHQuZXZlbnRzLlNDUk9MTF9PUFRJTUlaRSxmdW5jdGlvbigpe3ZhciB0PXIucXVpbGwuc2VsZWN0aW9uLmdldFJhbmdlKCksZT1mKHQsMSksbj1lWzBdO3IudXBkYXRlKG4pfSkscn1yZXR1cm4gYShlLHQpLGgoZSxbe2tleToiYWRkSGFuZGxlciIsdmFsdWU6ZnVuY3Rpb24odCxlKXt0aGlzLmhhbmRsZXJzW3RdPWV9fSx7a2V5OiJhdHRhY2giLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMsbj1bXS5maW5kLmNhbGwodC5jbGFzc0xpc3QsZnVuY3Rpb24odCl7cmV0dXJuIDA9PT10LmluZGV4T2YoInFsLSIpfSk7aWYobil7aWYobj1uLnNsaWNlKCJxbC0iLmxlbmd0aCksIkJVVFRPTiI9PT10LnRhZ05hbWUmJnQuc2V0QXR0cmlidXRlKCJ0eXBlIiwiYnV0dG9uIiksbnVsbD09dGhpcy5oYW5kbGVyc1tuXSl7aWYobnVsbCE9dGhpcy5xdWlsbC5zY3JvbGwud2hpdGVsaXN0JiZudWxsPT10aGlzLnF1aWxsLnNjcm9sbC53aGl0ZWxpc3Rbbl0pcmV0dXJuIHZvaWQgeC53YXJuKCJpZ25vcmluZyBhdHRhY2hpbmcgdG8gZGlzYWJsZWQgZm9ybWF0IixuLHQpO2lmKG51bGw9PXYuZGVmYXVsdC5xdWVyeShuKSlyZXR1cm4gdm9pZCB4Lndhcm4oImlnbm9yaW5nIGF0dGFjaGluZyB0byBub25leGlzdGVudCBmb3JtYXQiLG4sdCl9dmFyIHI9IlNFTEVDVCI9PT10LnRhZ05hbWU/ImNoYW5nZSI6ImNsaWNrIjt0LmFkZEV2ZW50TGlzdGVuZXIocixmdW5jdGlvbihyKXt2YXIgaT12b2lkIDA7aWYoIlNFTEVDVCI9PT10LnRhZ05hbWUpe2lmKHQuc2VsZWN0ZWRJbmRleDwwKXJldHVybjt2YXIgbD10Lm9wdGlvbnNbdC5zZWxlY3RlZEluZGV4XTtpPSFsLmhhc0F0dHJpYnV0ZSgic2VsZWN0ZWQiKSYmKGwudmFsdWV8fCExKX1lbHNlIGk9IXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJxbC1hY3RpdmUiKSYmKHQudmFsdWV8fCF0Lmhhc0F0dHJpYnV0ZSgidmFsdWUiKSksci5wcmV2ZW50RGVmYXVsdCgpO2UucXVpbGwuZm9jdXMoKTt2YXIgYT1lLnF1aWxsLnNlbGVjdGlvbi5nZXRSYW5nZSgpLHM9ZihhLDEpLHU9c1swXTtpZihudWxsIT1lLmhhbmRsZXJzW25dKWUuaGFuZGxlcnNbbl0uY2FsbChlLGkpO2Vsc2UgaWYodi5kZWZhdWx0LnF1ZXJ5KG4pLnByb3RvdHlwZSBpbnN0YW5jZW9mIHYuZGVmYXVsdC5FbWJlZCl7aWYoIShpPXByb21wdCgiRW50ZXIgIituKSkpcmV0dXJuO2UucXVpbGwudXBkYXRlQ29udGVudHMoKG5ldyBkLmRlZmF1bHQpLnJldGFpbih1LmluZGV4KS5kZWxldGUodS5sZW5ndGgpLmluc2VydChvKHt9LG4saSkpLGcuZGVmYXVsdC5zb3VyY2VzLlVTRVIpfWVsc2UgZS5xdWlsbC5mb3JtYXQobixpLGcuZGVmYXVsdC5zb3VyY2VzLlVTRVIpO2UudXBkYXRlKHUpfSksdGhpcy5jb250cm9scy5wdXNoKFtuLHRdKX19fSx7a2V5OiJ1cGRhdGUiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPW51bGw9PXQ/e306dGhpcy5xdWlsbC5nZXRGb3JtYXQodCk7dGhpcy5jb250cm9scy5mb3JFYWNoKGZ1bmN0aW9uKG4pe3ZhciByPWYobiwyKSxvPXJbMF0saT1yWzFdO2lmKCJTRUxFQ1QiPT09aS50YWdOYW1lKXt2YXIgbD12b2lkIDA7aWYobnVsbD09dClsPW51bGw7ZWxzZSBpZihudWxsPT1lW29dKWw9aS5xdWVyeVNlbGVjdG9yKCJvcHRpb25bc2VsZWN0ZWRdIik7ZWxzZSBpZighQXJyYXkuaXNBcnJheShlW29dKSl7dmFyIGE9ZVtvXTsic3RyaW5nIj09dHlwZW9mIGEmJihhPWEucmVwbGFjZSgvXCIvZywnXFwiJykpLGw9aS5xdWVyeVNlbGVjdG9yKCdvcHRpb25bdmFsdWU9IicrYSsnIl0nKX1udWxsPT1sPyhpLnZhbHVlPSIiLGkuc2VsZWN0ZWRJbmRleD0tMSk6bC5zZWxlY3RlZD0hMH1lbHNlIGlmKG51bGw9PXQpaS5jbGFzc0xpc3QucmVtb3ZlKCJxbC1hY3RpdmUiKTtlbHNlIGlmKGkuaGFzQXR0cmlidXRlKCJ2YWx1ZSIpKXt2YXIgcz1lW29dPT09aS5nZXRBdHRyaWJ1dGUoInZhbHVlIil8fG51bGwhPWVbb10mJmVbb10udG9TdHJpbmcoKT09PWkuZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpfHxudWxsPT1lW29dJiYhaS5nZXRBdHRyaWJ1dGUoInZhbHVlIik7aS5jbGFzc0xpc3QudG9nZ2xlKCJxbC1hY3RpdmUiLHMpfWVsc2UgaS5jbGFzc0xpc3QudG9nZ2xlKCJxbC1hY3RpdmUiLG51bGwhPWVbb10pfSl9fV0pLGV9KHcuZGVmYXVsdCk7ay5ERUZBVUxUUz17fSxrLkRFRkFVTFRTPXtjb250YWluZXI6bnVsbCxoYW5kbGVyczp7Y2xlYW46ZnVuY3Rpb24oKXt2YXIgdD10aGlzLGU9dGhpcy5xdWlsbC5nZXRTZWxlY3Rpb24oKTtpZihudWxsIT1lKWlmKDA9PWUubGVuZ3RoKXt2YXIgbj10aGlzLnF1aWxsLmdldEZvcm1hdCgpO09iamVjdC5rZXlzKG4pLmZvckVhY2goZnVuY3Rpb24oZSl7bnVsbCE9di5kZWZhdWx0LnF1ZXJ5KGUsdi5kZWZhdWx0LlNjb3BlLklOTElORSkmJnQucXVpbGwuZm9ybWF0KGUsITEpfSl9ZWxzZSB0aGlzLnF1aWxsLnJlbW92ZUZvcm1hdChlLGcuZGVmYXVsdC5zb3VyY2VzLlVTRVIpfSxkaXJlY3Rpb246ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5xdWlsbC5nZXRGb3JtYXQoKS5hbGlnbjsicnRsIj09PXQmJm51bGw9PWU/dGhpcy5xdWlsbC5mb3JtYXQoImFsaWduIiwicmlnaHQiLGcuZGVmYXVsdC5zb3VyY2VzLlVTRVIpOnR8fCJyaWdodCIhPT1lfHx0aGlzLnF1aWxsLmZvcm1hdCgiYWxpZ24iLCExLGcuZGVmYXVsdC5zb3VyY2VzLlVTRVIpLHRoaXMucXVpbGwuZm9ybWF0KCJkaXJlY3Rpb24iLHQsZy5kZWZhdWx0LnNvdXJjZXMuVVNFUil9LGluZGVudDpmdW5jdGlvbih0KXt2YXIgZT10aGlzLnF1aWxsLmdldFNlbGVjdGlvbigpLG49dGhpcy5xdWlsbC5nZXRGb3JtYXQoZSkscj1wYXJzZUludChuLmluZGVudHx8MCk7aWYoIisxIj09PXR8fCItMSI9PT10KXt2YXIgbz0iKzEiPT09dD8xOi0xOyJydGwiPT09bi5kaXJlY3Rpb24mJihvKj0tMSksdGhpcy5xdWlsbC5mb3JtYXQoImluZGVudCIscitvLGcuZGVmYXVsdC5zb3VyY2VzLlVTRVIpfX0sbGluazpmdW5jdGlvbih0KXshMD09PXQmJih0PXByb21wdCgiRW50ZXIgbGluayBVUkw6IikpLHRoaXMucXVpbGwuZm9ybWF0KCJsaW5rIix0LGcuZGVmYXVsdC5zb3VyY2VzLlVTRVIpfSxsaXN0OmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMucXVpbGwuZ2V0U2VsZWN0aW9uKCksbj10aGlzLnF1aWxsLmdldEZvcm1hdChlKTsiY2hlY2siPT09dD8iY2hlY2tlZCI9PT1uLmxpc3R8fCJ1bmNoZWNrZWQiPT09bi5saXN0P3RoaXMucXVpbGwuZm9ybWF0KCJsaXN0IiwhMSxnLmRlZmF1bHQuc291cmNlcy5VU0VSKTp0aGlzLnF1aWxsLmZvcm1hdCgibGlzdCIsInVuY2hlY2tlZCIsZy5kZWZhdWx0LnNvdXJjZXMuVVNFUik6dGhpcy5xdWlsbC5mb3JtYXQoImxpc3QiLHQsZy5kZWZhdWx0LnNvdXJjZXMuVVNFUil9fX0sZS5kZWZhdWx0PWssZS5hZGRDb250cm9scz11fSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz0nPHN2ZyB2aWV3Ym94PSIwIDAgMTggMTgiPiA8bGluZSBjbGFzcz1xbC1zdHJva2UgeDE9MyB4Mj0xNSB5MT05IHkyPTk+PC9saW5lPiA8bGluZSBjbGFzcz1xbC1zdHJva2UgeDE9MyB4Mj0xMyB5MT0xNCB5Mj0xND48L2xpbmU+IDxsaW5lIGNsYXNzPXFsLXN0cm9rZSB4MT0zIHgyPTkgeTE9NCB5Mj00PjwvbGluZT4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTE1IHgyPTMgeTE9OSB5Mj05PjwvbGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTE0IHgyPTQgeTE9MTQgeTI9MTQ+PC9saW5lPiA8bGluZSBjbGFzcz1xbC1zdHJva2UgeDE9MTIgeDI9NiB5MT00IHkyPTQ+PC9saW5lPiA8L3N2Zz4nfSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz0nPHN2ZyB2aWV3Ym94PSIwIDAgMTggMTgiPiA8bGluZSBjbGFzcz1xbC1zdHJva2UgeDE9MTUgeDI9MyB5MT05IHkyPTk+PC9saW5lPiA8bGluZSBjbGFzcz1xbC1zdHJva2UgeDE9MTUgeDI9NSB5MT0xNCB5Mj0xND48L2xpbmU+IDxsaW5lIGNsYXNzPXFsLXN0cm9rZSB4MT0xNSB4Mj05IHkxPTQgeTI9ND48L2xpbmU+IDwvc3ZnPid9LGZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPSc8c3ZnIHZpZXdib3g9IjAgMCAxOCAxOCI+IDxsaW5lIGNsYXNzPXFsLXN0cm9rZSB4MT0xNSB4Mj0zIHkxPTkgeTI9OT48L2xpbmU+IDxsaW5lIGNsYXNzPXFsLXN0cm9rZSB4MT0xNSB4Mj0zIHkxPTE0IHkyPTE0PjwvbGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTE1IHgyPTMgeTE9NCB5Mj00PjwvbGluZT4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPGcgY2xhc3M9InFsLWZpbGwgcWwtY29sb3ItbGFiZWwiPiA8cG9seWdvbiBwb2ludHM9IjYgNi44NjggNiA2IDUgNiA1IDcgNS45NDIgNyA2IDYuODY4Ij48L3BvbHlnb24+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD00IHk9ND48L3JlY3Q+IDxwb2x5Z29uIHBvaW50cz0iNi44MTcgNSA2IDUgNiA2IDYuMzggNiA2LjgxNyA1Ij48L3BvbHlnb24+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD0yIHk9Nj48L3JlY3Q+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD0zIHk9NT48L3JlY3Q+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD00IHk9Nz48L3JlY3Q+IDxwb2x5Z29uIHBvaW50cz0iNCAxMS40MzkgNCAxMSAzIDExIDMgMTIgMy43NTUgMTIgNCAxMS40MzkiPjwvcG9seWdvbj4gPHJlY3QgaGVpZ2h0PTEgd2lkdGg9MSB4PTIgeT0xMj48L3JlY3Q+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD0yIHk9OT48L3JlY3Q+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD0yIHk9MTU+PC9yZWN0PiA8cG9seWdvbiBwb2ludHM9IjQuNjMgMTAgNCAxMCA0IDExIDQuMTkyIDExIDQuNjMgMTAiPjwvcG9seWdvbj4gPHJlY3QgaGVpZ2h0PTEgd2lkdGg9MSB4PTMgeT04PjwvcmVjdD4gPHBhdGggZD1NMTAuODMyLDQuMkwxMSw0LjU4MlY0SDEwLjcwOEExLjk0OCwxLjk0OCwwLDAsMSwxMC44MzIsNC4yWj48L3BhdGg+IDxwYXRoIGQ9TTcsNC41ODJMNy4xNjgsNC4yQTEuOTI5LDEuOTI5LDAsMCwxLDcuMjkyLDRIN1Y0LjU4Mlo+PC9wYXRoPiA8cGF0aCBkPU04LDEzSDcuNjgzbC0wLjM1MS44YTEuOTMzLDEuOTMzLDAsMCwxLS4xMjQuMkg4VjEzWj48L3BhdGg+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD0xMiB5PTI+PC9yZWN0PiA8cmVjdCBoZWlnaHQ9MSB3aWR0aD0xIHg9MTEgeT0zPjwvcmVjdD4gPHBhdGggZD1NOSwzSDhWMy4yODJBMS45ODUsMS45ODUsMCwwLDEsOSwzWj48L3BhdGg+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD0yIHk9Mz48L3JlY3Q+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD02IHk9Mj48L3JlY3Q+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD0zIHk9Mj48L3JlY3Q+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD01IHk9Mz48L3JlY3Q+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD05IHk9Mj48L3JlY3Q+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD0xNSB5PTE0PjwvcmVjdD4gPHBvbHlnb24gcG9pbnRzPSIxMy40NDcgMTAuMTc0IDEzLjQ2OSAxMC4yMjUgMTMuNDcyIDEwLjIzMiAxMy44MDggMTEgMTQgMTEgMTQgMTAgMTMuMzcgMTAgMTMuNDQ3IDEwLjE3NCI+PC9wb2x5Z29uPiA8cmVjdCBoZWlnaHQ9MSB3aWR0aD0xIHg9MTMgeT03PjwvcmVjdD4gPHJlY3QgaGVpZ2h0PTEgd2lkdGg9MSB4PTE1IHk9NT48L3JlY3Q+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD0xNCB5PTY+PC9yZWN0PiA8cmVjdCBoZWlnaHQ9MSB3aWR0aD0xIHg9MTUgeT04PjwvcmVjdD4gPHJlY3QgaGVpZ2h0PTEgd2lkdGg9MSB4PTE0IHk9OT48L3JlY3Q+IDxwYXRoIGQ9TTMuNzc1LDE0SDN2MUg0VjE0LjMxNEExLjk3LDEuOTcsMCwwLDEsMy43NzUsMTRaPjwvcGF0aD4gPHJlY3QgaGVpZ2h0PTEgd2lkdGg9MSB4PTE0IHk9Mz48L3JlY3Q+IDxwb2x5Z29uIHBvaW50cz0iMTIgNi44NjggMTIgNiAxMS42MiA2IDEyIDYuODY4Ij48L3BvbHlnb24+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD0xNSB5PTI+PC9yZWN0PiA8cmVjdCBoZWlnaHQ9MSB3aWR0aD0xIHg9MTIgeT01PjwvcmVjdD4gPHJlY3QgaGVpZ2h0PTEgd2lkdGg9MSB4PTEzIHk9ND48L3JlY3Q+IDxwb2x5Z29uIHBvaW50cz0iMTIuOTMzIDkgMTMgOSAxMyA4IDEyLjQ5NSA4IDEyLjkzMyA5Ij48L3BvbHlnb24+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD05IHk9MTQ+PC9yZWN0PiA8cmVjdCBoZWlnaHQ9MSB3aWR0aD0xIHg9OCB5PTE1PjwvcmVjdD4gPHBhdGggZD1NNiwxNC45MjZWMTVIN1YxNC4zMTZBMS45OTMsMS45OTMsMCwwLDEsNiwxNC45MjZaPjwvcGF0aD4gPHJlY3QgaGVpZ2h0PTEgd2lkdGg9MSB4PTUgeT0xNT48L3JlY3Q+IDxwYXRoIGQ9TTEwLjY2OCwxMy44TDEwLjMxNywxM0gxMHYxaDAuNzkyQTEuOTQ3LDEuOTQ3LDAsMCwxLDEwLjY2OCwxMy44Wj48L3BhdGg+IDxyZWN0IGhlaWdodD0xIHdpZHRoPTEgeD0xMSB5PTE1PjwvcmVjdD4gPHBhdGggZD1NMTQuMzMyLDEyLjJhMS45OSwxLjk5LDAsMCwxLC4xNjYuOEgxNVYxMkgxNC4yNDVaPjwvcGF0aD4gPHJlY3QgaGVpZ2h0PTEgd2lkdGg9MSB4PTE0IHk9MTU+PC9yZWN0PiA8cmVjdCBoZWlnaHQ9MSB3aWR0aD0xIHg9MTUgeT0xMT48L3JlY3Q+IDwvZz4gPHBvbHlsaW5lIGNsYXNzPXFsLXN0cm9rZSBwb2ludHM9IjUuNSAxMyA5IDUgMTIuNSAxMyI+PC9wb2x5bGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTExLjYzIHgyPTYuMzggeTE9MTEgeTI9MTE+PC9saW5lPiA8L3N2Zz4nfSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz0nPHN2ZyB2aWV3Ym94PSIwIDAgMTggMTgiPiA8cmVjdCBjbGFzcz0icWwtZmlsbCBxbC1zdHJva2UiIGhlaWdodD0zIHdpZHRoPTMgeD00IHk9NT48L3JlY3Q+IDxyZWN0IGNsYXNzPSJxbC1maWxsIHFsLXN0cm9rZSIgaGVpZ2h0PTMgd2lkdGg9MyB4PTExIHk9NT48L3JlY3Q+IDxwYXRoIGNsYXNzPSJxbC1ldmVuIHFsLWZpbGwgcWwtc3Ryb2tlIiBkPU03LDhjMCw0LjAzMS0zLDUtMyw1PjwvcGF0aD4gPHBhdGggY2xhc3M9InFsLWV2ZW4gcWwtZmlsbCBxbC1zdHJva2UiIGQ9TTE0LDhjMCw0LjAzMS0zLDUtMyw1PjwvcGF0aD4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPHBhdGggY2xhc3M9cWwtc3Ryb2tlIGQ9TTUsNEg5LjVBMi41LDIuNSwwLDAsMSwxMiw2LjV2MEEyLjUsMi41LDAsMCwxLDkuNSw5SDVBMCwwLDAsMCwxLDUsOVY0QTAsMCwwLDAsMSw1LDRaPjwvcGF0aD4gPHBhdGggY2xhc3M9cWwtc3Ryb2tlIGQ9TTUsOWg1LjVBMi41LDIuNSwwLDAsMSwxMywxMS41djBBMi41LDIuNSwwLDAsMSwxMC41LDE0SDVhMCwwLDAsMCwxLDAsMFY5QTAsMCwwLDAsMSw1LDlaPjwvcGF0aD4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9JzxzdmcgY2xhc3M9IiIgdmlld2JveD0iMCAwIDE4IDE4Ij4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTUgeDI9MTMgeTE9MyB5Mj0zPjwvbGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTYgeDI9OS4zNSB5MT0xMiB5Mj0zPjwvbGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTExIHgyPTE1IHkxPTExIHkyPTE1PjwvbGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTE1IHgyPTExIHkxPTExIHkyPTE1PjwvbGluZT4gPHJlY3QgY2xhc3M9cWwtZmlsbCBoZWlnaHQ9MSByeD0wLjUgcnk9MC41IHdpZHRoPTcgeD0yIHk9MTQ+PC9yZWN0PiA8L3N2Zz4nfSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz0nPHN2ZyB2aWV3Ym94PSIwIDAgMTggMTgiPiA8bGluZSBjbGFzcz0icWwtY29sb3ItbGFiZWwgcWwtc3Ryb2tlIHFsLXRyYW5zcGFyZW50IiB4MT0zIHgyPTE1IHkxPTE1IHkyPTE1PjwvbGluZT4gPHBvbHlsaW5lIGNsYXNzPXFsLXN0cm9rZSBwb2ludHM9IjUuNSAxMSA5IDMgMTIuNSAxMSI+PC9wb2x5bGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTExLjYzIHgyPTYuMzggeTE9OSB5Mj05PjwvbGluZT4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPHBvbHlnb24gY2xhc3M9InFsLXN0cm9rZSBxbC1maWxsIiBwb2ludHM9IjMgMTEgNSA5IDMgNyAzIDExIj48L3BvbHlnb24+IDxsaW5lIGNsYXNzPSJxbC1zdHJva2UgcWwtZmlsbCIgeDE9MTUgeDI9MTEgeTE9NCB5Mj00PjwvbGluZT4gPHBhdGggY2xhc3M9cWwtZmlsbCBkPU0xMSwzYTMsMywwLDAsMCwwLDZoMVYzSDExWj48L3BhdGg+IDxyZWN0IGNsYXNzPXFsLWZpbGwgaGVpZ2h0PTExIHdpZHRoPTEgeD0xMSB5PTQ+PC9yZWN0PiA8cmVjdCBjbGFzcz1xbC1maWxsIGhlaWdodD0xMSB3aWR0aD0xIHg9MTMgeT00PjwvcmVjdD4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPHBvbHlnb24gY2xhc3M9InFsLXN0cm9rZSBxbC1maWxsIiBwb2ludHM9IjE1IDEyIDEzIDEwIDE1IDggMTUgMTIiPjwvcG9seWdvbj4gPGxpbmUgY2xhc3M9InFsLXN0cm9rZSBxbC1maWxsIiB4MT05IHgyPTUgeTE9NCB5Mj00PjwvbGluZT4gPHBhdGggY2xhc3M9cWwtZmlsbCBkPU01LDNBMywzLDAsMCwwLDUsOUg2VjNINVo+PC9wYXRoPiA8cmVjdCBjbGFzcz1xbC1maWxsIGhlaWdodD0xMSB3aWR0aD0xIHg9NSB5PTQ+PC9yZWN0PiA8cmVjdCBjbGFzcz1xbC1maWxsIGhlaWdodD0xMSB3aWR0aD0xIHg9NyB5PTQ+PC9yZWN0PiA8L3N2Zz4nfSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz0nPHN2ZyB2aWV3Ym94PSIwIDAgMTggMTgiPiA8cGF0aCBjbGFzcz1xbC1maWxsIGQ9TTE0LDE2SDRhMSwxLDAsMCwxLDAtMkgxNEExLDEsMCwwLDEsMTQsMTZaIC8+IDxwYXRoIGNsYXNzPXFsLWZpbGwgZD1NMTQsNEg0QTEsMSwwLDAsMSw0LDJIMTRBMSwxLDAsMCwxLDE0LDRaIC8+IDxyZWN0IGNsYXNzPXFsLWZpbGwgeD0zIHk9NiB3aWR0aD0xMiBoZWlnaHQ9NiByeD0xIHJ5PTEgLz4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPHBhdGggY2xhc3M9cWwtZmlsbCBkPU0xMywxNkg1YTEsMSwwLDAsMSwwLTJoOEExLDEsMCwwLDEsMTMsMTZaIC8+IDxwYXRoIGNsYXNzPXFsLWZpbGwgZD1NMTMsNEg1QTEsMSwwLDAsMSw1LDJoOEExLDEsMCwwLDEsMTMsNFogLz4gPHJlY3QgY2xhc3M9cWwtZmlsbCB4PTIgeT02IHdpZHRoPTE0IGhlaWdodD02IHJ4PTEgcnk9MSAvPiA8L3N2Zz4nfSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz0nPHN2ZyB2aWV3Ym94PSIwIDAgMTggMTgiPiA8cGF0aCBjbGFzcz1xbC1maWxsIGQ9TTE1LDhIMTNhMSwxLDAsMCwxLDAtMmgyQTEsMSwwLDAsMSwxNSw4WiAvPiA8cGF0aCBjbGFzcz1xbC1maWxsIGQ9TTE1LDEySDEzYTEsMSwwLDAsMSwwLTJoMkExLDEsMCwwLDEsMTUsMTJaIC8+IDxwYXRoIGNsYXNzPXFsLWZpbGwgZD1NMTUsMTZINWExLDEsMCwwLDEsMC0ySDE1QTEsMSwwLDAsMSwxNSwxNlogLz4gPHBhdGggY2xhc3M9cWwtZmlsbCBkPU0xNSw0SDVBMSwxLDAsMCwxLDUsMkgxNUExLDEsMCwwLDEsMTUsNFogLz4gPHJlY3QgY2xhc3M9cWwtZmlsbCB4PTIgeT02IHdpZHRoPTggaGVpZ2h0PTYgcng9MSByeT0xIC8+IDwvc3ZnPid9LGZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPSc8c3ZnIHZpZXdib3g9IjAgMCAxOCAxOCI+IDxwYXRoIGNsYXNzPXFsLWZpbGwgZD1NNSw4SDNBMSwxLDAsMCwxLDMsNkg1QTEsMSwwLDAsMSw1LDhaIC8+IDxwYXRoIGNsYXNzPXFsLWZpbGwgZD1NNSwxMkgzYTEsMSwwLDAsMSwwLTJINUExLDEsMCwwLDEsNSwxMlogLz4gPHBhdGggY2xhc3M9cWwtZmlsbCBkPU0xMywxNkgzYTEsMSwwLDAsMSwwLTJIMTNBMSwxLDAsMCwxLDEzLDE2WiAvPiA8cGF0aCBjbGFzcz1xbC1maWxsIGQ9TTEzLDRIM0ExLDEsMCwwLDEsMywySDEzQTEsMSwwLDAsMSwxMyw0WiAvPiA8cmVjdCBjbGFzcz1xbC1maWxsIHg9OCB5PTYgd2lkdGg9OCBoZWlnaHQ9NiByeD0xIHJ5PTEgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjQgMTgpIHJvdGF0ZSgtMTgwKSIvPiA8L3N2Zz4nfSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz0nPHN2ZyB2aWV3Ym94PSIwIDAgMTggMTgiPiA8cGF0aCBjbGFzcz1xbC1maWxsIGQ9TTExLjc1OSwyLjQ4MmEyLjU2MSwyLjU2MSwwLDAsMC0zLjUzLjYwN0E3LjY1Niw3LjY1NiwwLDAsMCw2LjgsNi4yQzYuMTA5LDkuMTg4LDUuMjc1LDE0LjY3Nyw0LjE1LDE0LjkyN2ExLjU0NSwxLjU0NSwwLDAsMC0xLjMtLjkzM0EwLjkyMiwwLjkyMiwwLDAsMCwyLDE1LjAzNlMxLjk1NCwxNiw0LjExOSwxNnMzLjA5MS0yLjY5MSwzLjctNS41NTNjMC4xNzctLjgyNi4zNi0xLjcyNiwwLjU1NC0yLjZMOC43NzUsNi4yYzAuMzgxLTEuNDIxLjgwNy0yLjUyMSwxLjMwNi0yLjY3NmExLjAxNCwxLjAxNCwwLDAsMCwxLjAyLjU2QTAuOTY2LDAuOTY2LDAsMCwwLDExLjc1OSwyLjQ4Mlo+PC9wYXRoPiA8cmVjdCBjbGFzcz1xbC1maWxsIGhlaWdodD0xLjYgcng9MC44IHJ5PTAuOCB3aWR0aD01IHg9NS4xNSB5PTYuMj48L3JlY3Q+IDxwYXRoIGNsYXNzPXFsLWZpbGwgZD1NMTMuNjYzLDEyLjAyN2ExLjY2MiwxLjY2MiwwLDAsMSwuMjY2LTAuMjc2cTAuMTkzLDAuMDY5LjQ1NiwwLjEzOGEyLjEsMi4xLDAsMCwwLC41MzUuMDY5LDEuMDc1LDEuMDc1LDAsMCwwLC43NjctMC4zLDEuMDQ0LDEuMDQ0LDAsMCwwLC4zMTQtMC44LDAuODQsMC44NCwwLDAsMC0uMjM4LTAuNjE5LDAuOCwwLjgsMCwwLDAtLjU5NC0wLjIzOSwxLjE1NCwxLjE1NCwwLDAsMC0uNzgxLjMsNC42MDcsNC42MDcsMCwwLDAtLjc4MSwxcS0wLjA5MS4xNS0uMjE4LDAuMzQ2bC0wLjI0Ni4zOGMtMC4wNjgtLjI4OC0wLjEzNy0wLjU4Mi0wLjIxMi0wLjg4NS0wLjQ1OS0xLjg0Ny0yLjQ5NC0uOTg0LTIuOTQxLTAuOC0wLjQ4Mi4yLS4zNTMsMC42NDctMC4wOTQsMC41MjlhMC44NjksMC44NjksMCwwLDEsMS4yODEuNTg1YzAuMjE3LDAuNzUxLjM3NywxLjQzNiwwLjUyNywyLjAzOGE1LjY4OCw1LjY4OCwwLDAsMS0uMzYyLjQ2NywyLjY5LDIuNjksMCwwLDEtLjI2NC4yNzFxLTAuMjIxLS4wOC0wLjQ3MS0wLjE0N2EyLjAyOSwyLjAyOSwwLDAsMC0uNTIyLTAuMDY2LDEuMDc5LDEuMDc5LDAsMCwwLS43NjguM0ExLjA1OCwxLjA1OCwwLDAsMCw5LDE1LjEzMWEwLjgyLDAuODIsMCwwLDAsLjgzMi44NTIsMS4xMzQsMS4xMzQsMCwwLDAsLjc4Ny0wLjMsNS4xMSw1LjExLDAsMCwwLC43NzYtMC45OTNxMC4xNDEtLjIxOS4yMTUtMC4zNGMwLjA0Ni0uMDc2LjEyMi0wLjE5NCwwLjIyMy0wLjM0NmEyLjc4NiwyLjc4NiwwLDAsMCwuOTE4LDEuNzI2LDIuNTgyLDIuNTgyLDAsMCwwLDIuMzc2LS4xODVjMC4zMTctLjE4MS4yMTItMC41NjUsMC0wLjQ5NEEwLjgwNywwLjgwNywwLDAsMSwxNC4xNzYsMTVhNS4xNTksNS4xNTksMCwwLDEtLjkxMy0yLjQ0NmwwLDBRMTMuNDg3LDEyLjI0LDEzLjY2MywxMi4wMjdaPjwvcGF0aD4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld0JveD0iMCAwIDE4IDE4Ij4gPHBhdGggY2xhc3M9cWwtZmlsbCBkPU0xMCw0VjE0YTEsMSwwLDAsMS0yLDBWMTBIM3Y0YTEsMSwwLDAsMS0yLDBWNEExLDEsMCwwLDEsMyw0VjhIOFY0YTEsMSwwLDAsMSwyLDBabTYuMDY3ODcsOS4yMDlIMTQuOTg5NzVWNy41OTg2M2EuNTQwODUuNTQwODUsMCwwLDAtLjYwNS0uNjA1NDdoLS42Mjc0NGExLjAxMTE5LDEuMDExMTksMCwwLDAtLjc0OC4yOTY4OEwxMS42NDUsOC41NjY0MWEuNTQzNS41NDM1LDAsMCwwLS4wMjIuODU4NGwuMjg2MTMuMzA3NjJhLjUzODYxLjUzODYxLDAsMCwwLC44NDcxNy4wMzMybC4wOTkxMi0uMDg3ODlhMS4yMTM3LDEuMjEzNywwLDAsMCwuMjQxNy0uMzUyNTRoLjAyMjQ2cy0uMDExMjMuMzA4NTktLjAxMTIzLjYwNTQ3VjEzLjIwOUgxMi4wNDFhLjU0MDg1LjU0MDg1LDAsMCwwLS42MDUuNjA1NDd2LjQzOTQ1YS41NDA4NS41NDA4NSwwLDAsMCwuNjA1LjYwNTQ3aDQuMDI2ODZhLjU0MDg1LjU0MDg1LDAsMCwwLC42MDUtLjYwNTQ3di0uNDM5NDVBLjU0MDg1LjU0MDg1LDAsMCwwLDE2LjA2Nzg3LDEzLjIwOVogLz4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld0JveD0iMCAwIDE4IDE4Ij4gPHBhdGggY2xhc3M9cWwtZmlsbCBkPU0xNi43Mzk3NSwxMy44MTQ0NXYuNDM5NDVhLjU0MDg1LjU0MDg1LDAsMCwxLS42MDUuNjA1NDdIMTEuODU1YS41ODM5Mi41ODM5MiwwLDAsMS0uNjQ4OTMtLjYwNTQ3VjE0LjAxMjdjMC0yLjkwNTI3LDMuMzk5NDEtMy40MjE4NywzLjM5OTQxLTQuNTU0NjlhLjc3Njc1Ljc3Njc1LDAsMCwwLS44NDcxNy0uNzgxMjUsMS4xNzY4NCwxLjE3Njg0LDAsMCwwLS44MzU5NC4zODQ3N2MtLjI3NDkuMjYzNjctLjU2MS4zNzQtLjg1NzkxLjEzMTg0bC0uNDI5Mi0uMzQwODJjLS4zMDgxMS0uMjQyMTktLjM4NTI1LS41MTc1OC0uMTU0My0uODE0NDVhMi45NzE1NSwyLjk3MTU1LDAsMCwxLDIuNDUzNjEtMS4xNzY3NiwyLjQ1MzkzLDIuNDUzOTMsMCwwLDEsMi42ODQwOCwyLjQwOTE4YzAsMi40NTMxMi0zLjE3OTIsMi45MjY3Ni0zLjI3ODMyLDMuOTM4NDhoMi43OTQ0M0EuNTQwODUuNTQwODUsMCwwLDEsMTYuNzM5NzUsMTMuODE0NDVaTTksM0EuOTk5NzQuOTk5NzQsMCwwLDAsOCw0VjhIM1Y0QTEsMSwwLDAsMCwxLDRWMTRhMSwxLDAsMCwwLDIsMFYxMEg4djRhMSwxLDAsMCwwLDIsMFY0QS45OTk3NC45OTk3NCwwLDAsMCw5LDNaIC8+IDwvc3ZnPid9LGZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPSc8c3ZnIHZpZXdib3g9IjAgMCAxOCAxOCI+IDxsaW5lIGNsYXNzPXFsLXN0cm9rZSB4MT03IHgyPTEzIHkxPTQgeTI9ND48L2xpbmU+IDxsaW5lIGNsYXNzPXFsLXN0cm9rZSB4MT01IHgyPTExIHkxPTE0IHkyPTE0PjwvbGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTggeDI9MTAgeTE9MTQgeTI9ND48L2xpbmU+IDwvc3ZnPid9LGZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPSc8c3ZnIHZpZXdib3g9IjAgMCAxOCAxOCI+IDxyZWN0IGNsYXNzPXFsLXN0cm9rZSBoZWlnaHQ9MTAgd2lkdGg9MTIgeD0zIHk9ND48L3JlY3Q+IDxjaXJjbGUgY2xhc3M9cWwtZmlsbCBjeD02IGN5PTcgcj0xPjwvY2lyY2xlPiA8cG9seWxpbmUgY2xhc3M9InFsLWV2ZW4gcWwtZmlsbCIgcG9pbnRzPSI1IDEyIDUgMTEgNyA5IDggMTAgMTEgNyAxMyA5IDEzIDEyIDUgMTIiPjwvcG9seWxpbmU+IDwvc3ZnPid9LGZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPSc8c3ZnIHZpZXdib3g9IjAgMCAxOCAxOCI+IDxsaW5lIGNsYXNzPXFsLXN0cm9rZSB4MT0zIHgyPTE1IHkxPTE0IHkyPTE0PjwvbGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTMgeDI9MTUgeTE9NCB5Mj00PjwvbGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTkgeDI9MTUgeTE9OSB5Mj05PjwvbGluZT4gPHBvbHlsaW5lIGNsYXNzPSJxbC1maWxsIHFsLXN0cm9rZSIgcG9pbnRzPSIzIDcgMyAxMSA1IDkgMyA3Ij48L3BvbHlsaW5lPiA8L3N2Zz4nfSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz0nPHN2ZyB2aWV3Ym94PSIwIDAgMTggMTgiPiA8bGluZSBjbGFzcz1xbC1zdHJva2UgeDE9MyB4Mj0xNSB5MT0xNCB5Mj0xND48L2xpbmU+IDxsaW5lIGNsYXNzPXFsLXN0cm9rZSB4MT0zIHgyPTE1IHkxPTQgeTI9ND48L2xpbmU+IDxsaW5lIGNsYXNzPXFsLXN0cm9rZSB4MT05IHgyPTE1IHkxPTkgeTI9OT48L2xpbmU+IDxwb2x5bGluZSBjbGFzcz1xbC1zdHJva2UgcG9pbnRzPSI1IDcgNSAxMSAzIDkgNSA3Ij48L3BvbHlsaW5lPiA8L3N2Zz4nfSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz0nPHN2ZyB2aWV3Ym94PSIwIDAgMTggMTgiPiA8bGluZSBjbGFzcz1xbC1zdHJva2UgeDE9NyB4Mj0xMSB5MT03IHkyPTExPjwvbGluZT4gPHBhdGggY2xhc3M9InFsLWV2ZW4gcWwtc3Ryb2tlIiBkPU04LjksNC41NzdhMy40NzYsMy40NzYsMCwwLDEsLjM2LDQuNjc5QTMuNDc2LDMuNDc2LDAsMCwxLDQuNTc3LDguOUMzLjE4NSw3LjUsMi4wMzUsNi40LDQuMjE3LDQuMjE3UzcuNSwzLjE4NSw4LjksNC41NzdaPjwvcGF0aD4gPHBhdGggY2xhc3M9InFsLWV2ZW4gcWwtc3Ryb2tlIiBkPU0xMy40MjMsOS4xYTMuNDc2LDMuNDc2LDAsMCwwLTQuNjc5LS4zNiwzLjQ3NiwzLjQ3NiwwLDAsMCwuMzYsNC42NzljMS4zOTIsMS4zOTIsMi41LDIuNTQyLDQuNjc5LjM2UzE0LjgxNSwxMC41LDEzLjQyMyw5LjFaPjwvcGF0aD4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTcgeDI9MTUgeTE9NCB5Mj00PjwvbGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTcgeDI9MTUgeTE9OSB5Mj05PjwvbGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTcgeDI9MTUgeTE9MTQgeTI9MTQ+PC9saW5lPiA8bGluZSBjbGFzcz0icWwtc3Ryb2tlIHFsLXRoaW4iIHgxPTIuNSB4Mj00LjUgeTE9NS41IHkyPTUuNT48L2xpbmU+IDxwYXRoIGNsYXNzPXFsLWZpbGwgZD1NMy41LDZBMC41LDAuNSwwLDAsMSwzLDUuNVYzLjA4NWwtMC4yNzYuMTM4QTAuNSwwLjUsMCwwLDEsMi4wNTMsM2MtMC4xMjQtLjI0Ny0wLjAyMy0wLjMyNC4yMjQtMC40NDdsMS0uNUEwLjUsMC41LDAsMCwxLDQsMi41djNBMC41LDAuNSwwLDAsMSwzLjUsNlo+PC9wYXRoPiA8cGF0aCBjbGFzcz0icWwtc3Ryb2tlIHFsLXRoaW4iIGQ9TTQuNSwxMC41aC0yYzAtLjIzNCwxLjg1LTEuMDc2LDEuODUtMi4yMzRBMC45NTksMC45NTksMCwwLDAsMi41LDguMTU2PjwvcGF0aD4gPHBhdGggY2xhc3M9InFsLXN0cm9rZSBxbC10aGluIiBkPU0yLjUsMTQuODQ2YTAuOTU5LDAuOTU5LDAsMCwwLDEuODUtLjEwOUEwLjcsMC43LDAsMCwwLDMuNzUsMTRhMC42ODgsMC42ODgsMCwwLDAsLjYtMC43MzYsMC45NTksMC45NTksMCwwLDAtMS44NS0uMTA5PjwvcGF0aD4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTYgeDI9MTUgeTE9NCB5Mj00PjwvbGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTYgeDI9MTUgeTE9OSB5Mj05PjwvbGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTYgeDI9MTUgeTE9MTQgeTI9MTQ+PC9saW5lPiA8bGluZSBjbGFzcz1xbC1zdHJva2UgeDE9MyB4Mj0zIHkxPTQgeTI9ND48L2xpbmU+IDxsaW5lIGNsYXNzPXFsLXN0cm9rZSB4MT0zIHgyPTMgeTE9OSB5Mj05PjwvbGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTMgeDI9MyB5MT0xNCB5Mj0xND48L2xpbmU+IDwvc3ZnPid9LGZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPSc8c3ZnIGNsYXNzPSIiIHZpZXdib3g9IjAgMCAxOCAxOCI+IDxsaW5lIGNsYXNzPXFsLXN0cm9rZSB4MT05IHgyPTE1IHkxPTQgeTI9ND48L2xpbmU+IDxwb2x5bGluZSBjbGFzcz1xbC1zdHJva2UgcG9pbnRzPSIzIDQgNCA1IDYgMyI+PC9wb2x5bGluZT4gPGxpbmUgY2xhc3M9cWwtc3Ryb2tlIHgxPTkgeDI9MTUgeTE9MTQgeTI9MTQ+PC9saW5lPiA8cG9seWxpbmUgY2xhc3M9cWwtc3Ryb2tlIHBvaW50cz0iMyAxNCA0IDE1IDYgMTMiPjwvcG9seWxpbmU+IDxsaW5lIGNsYXNzPXFsLXN0cm9rZSB4MT05IHgyPTE1IHkxPTkgeTI9OT48L2xpbmU+IDxwb2x5bGluZSBjbGFzcz1xbC1zdHJva2UgcG9pbnRzPSIzIDkgNCAxMCA2IDgiPjwvcG9seWxpbmU+IDwvc3ZnPid9LGZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPSc8c3ZnIHZpZXdib3g9IjAgMCAxOCAxOCI+IDxwYXRoIGNsYXNzPXFsLWZpbGwgZD1NMTUuNSwxNUgxMy44NjFhMy44NTgsMy44NTgsMCwwLDAsMS45MTQtMi45NzUsMS44LDEuOCwwLDAsMC0xLjYtMS43NTFBMS45MjEsMS45MjEsMCwwLDAsMTIuMDIxLDExLjdhMC41MDAxMywwLjUwMDEzLDAsMSwwLC45NTcuMjkxaDBhMC45MTQsMC45MTQsMCwwLDEsMS4wNTMtLjcyNSwwLjgxLDAuODEsMCwwLDEsLjc0NC43NjJjMCwxLjA3Ni0xLjE2OTcxLDEuODY5ODItMS45Mzk3MSwyLjQzMDgyQTEuNDU2MzksMS40NTYzOSwwLDAsMCwxMiwxNS41YTAuNSwwLjUsMCwwLDAsLjUuNWgzQTAuNSwwLjUsMCwwLDAsMTUuNSwxNVogLz4gPHBhdGggY2xhc3M9cWwtZmlsbCBkPU05LjY1LDUuMjQxYTEsMSwwLDAsMC0xLjQwOS4xMDhMNiw3Ljk2NCwzLjc1OSw1LjM0OUExLDEsMCwwLDAsMi4xOTIsNi41OTE3OFEyLjIxNTQxLDYuNjIxMywyLjI0MSw2LjY0OUw0LjY4NCw5LjUsMi4yNDEsMTIuMzVBMSwxLDAsMCwwLDMuNzEsMTMuNzA3MjJxMC4wMjU1Ny0uMDI3NjguMDQ5LTAuMDU3MjJMNiwxMS4wMzYsOC4yNDEsMTMuNjVhMSwxLDAsMSwwLDEuNTY3LTEuMjQyNzdROS43ODQ1OSwxMi4zNzc3LDkuNzU5LDEyLjM1TDcuMzE2LDkuNSw5Ljc1OSw2LjY1MUExLDEsMCwwLDAsOS42NSw1LjI0MVogLz4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPHBhdGggY2xhc3M9cWwtZmlsbCBkPU0xNS41LDdIMTMuODYxYTQuMDE1LDQuMDE1LDAsMCwwLDEuOTE0LTIuOTc1LDEuOCwxLjgsMCwwLDAtMS42LTEuNzUxQTEuOTIyLDEuOTIyLDAsMCwwLDEyLjAyMSwzLjdhMC41LDAuNSwwLDEsMCwuOTU3LjI5MSwwLjkxNywwLjkxNywwLDAsMSwxLjA1My0uNzI1LDAuODEsMC44MSwwLDAsMSwuNzQ0Ljc2MmMwLDEuMDc3LTEuMTY0LDEuOTI1LTEuOTM0LDIuNDg2QTEuNDIzLDEuNDIzLDAsMCwwLDEyLDcuNWEwLjUsMC41LDAsMCwwLC41LjVoM0EwLjUsMC41LDAsMCwwLDE1LjUsN1ogLz4gPHBhdGggY2xhc3M9cWwtZmlsbCBkPU05LjY1MSw1LjI0MWExLDEsMCwwLDAtMS40MS4xMDhMNiw3Ljk2NCwzLjc1OSw1LjM0OWExLDEsMCwxLDAtMS41MTksMS4zTDQuNjgzLDkuNSwyLjI0MSwxMi4zNWExLDEsMCwxLDAsMS41MTksMS4zTDYsMTEuMDM2LDguMjQxLDEzLjY1YTEsMSwwLDAsMCwxLjUxOS0xLjNMNy4zMTcsOS41LDkuNzU5LDYuNjUxQTEsMSwwLDAsMCw5LjY1MSw1LjI0MVogLz4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPGxpbmUgY2xhc3M9InFsLXN0cm9rZSBxbC10aGluIiB4MT0xNS41IHgyPTIuNSB5MT04LjUgeTI9OS41PjwvbGluZT4gPHBhdGggY2xhc3M9cWwtZmlsbCBkPU05LjAwNyw4QzYuNTQyLDcuNzkxLDYsNy41MTksNiw2LjUsNiw1Ljc5Miw3LjI4Myw1LDksNWMxLjU3MSwwLDIuNzY1LjY3OSwyLjk2OSwxLjMwOWExLDEsMCwwLDAsMS45LS42MTdDMTMuMzU2LDQuMTA2LDExLjM1NCwzLDksMyw2LjIsMyw0LDQuNTM4LDQsNi41YTMuMiwzLjIsMCwwLDAsLjUsMS44NDNaPjwvcGF0aD4gPHBhdGggY2xhc3M9cWwtZmlsbCBkPU04Ljk4NCwxMEMxMS40NTcsMTAuMjA4LDEyLDEwLjQ3OSwxMiwxMS41YzAsMC43MDgtMS4yODMsMS41LTMsMS41LTEuNTcxLDAtMi43NjUtLjY3OS0yLjk2OS0xLjMwOWExLDEsMCwxLDAtMS45LjYxN0M0LjY0NCwxMy44OTQsNi42NDYsMTUsOSwxNWMyLjgsMCw1LTEuNTM4LDUtMy41YTMuMiwzLjIsMCwwLDAtLjUtMS44NDNaPjwvcGF0aD4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPHBhdGggY2xhc3M9cWwtc3Ryb2tlIGQ9TTUsM1Y5YTQuMDEyLDQuMDEyLDAsMCwwLDQsNEg5YTQuMDEyLDQuMDEyLDAsMCwwLDQtNFYzPjwvcGF0aD4gPHJlY3QgY2xhc3M9cWwtZmlsbCBoZWlnaHQ9MSByeD0wLjUgcnk9MC41IHdpZHRoPTEyIHg9MyB5PTE1PjwvcmVjdD4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPHJlY3QgY2xhc3M9cWwtc3Ryb2tlIGhlaWdodD0xMiB3aWR0aD0xMiB4PTMgeT0zPjwvcmVjdD4gPHJlY3QgY2xhc3M9cWwtZmlsbCBoZWlnaHQ9MTIgd2lkdGg9MSB4PTUgeT0zPjwvcmVjdD4gPHJlY3QgY2xhc3M9cWwtZmlsbCBoZWlnaHQ9MTIgd2lkdGg9MSB4PTEyIHk9Mz48L3JlY3Q+IDxyZWN0IGNsYXNzPXFsLWZpbGwgaGVpZ2h0PTIgd2lkdGg9OCB4PTUgeT04PjwvcmVjdD4gPHJlY3QgY2xhc3M9cWwtZmlsbCBoZWlnaHQ9MSB3aWR0aD0zIHg9MyB5PTU+PC9yZWN0PiA8cmVjdCBjbGFzcz1xbC1maWxsIGhlaWdodD0xIHdpZHRoPTMgeD0zIHk9Nz48L3JlY3Q+IDxyZWN0IGNsYXNzPXFsLWZpbGwgaGVpZ2h0PTEgd2lkdGg9MyB4PTMgeT0xMD48L3JlY3Q+IDxyZWN0IGNsYXNzPXFsLWZpbGwgaGVpZ2h0PTEgd2lkdGg9MyB4PTMgeT0xMj48L3JlY3Q+IDxyZWN0IGNsYXNzPXFsLWZpbGwgaGVpZ2h0PTEgd2lkdGg9MyB4PTEyIHk9NT48L3JlY3Q+IDxyZWN0IGNsYXNzPXFsLWZpbGwgaGVpZ2h0PTEgd2lkdGg9MyB4PTEyIHk9Nz48L3JlY3Q+IDxyZWN0IGNsYXNzPXFsLWZpbGwgaGVpZ2h0PTEgd2lkdGg9MyB4PTEyIHk9MTA+PC9yZWN0PiA8cmVjdCBjbGFzcz1xbC1maWxsIGhlaWdodD0xIHdpZHRoPTMgeD0xMiB5PTEyPjwvcmVjdD4gPC9zdmc+J30sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9Jzxzdmcgdmlld2JveD0iMCAwIDE4IDE4Ij4gPHBvbHlnb24gY2xhc3M9cWwtc3Ryb2tlIHBvaW50cz0iNyAxMSA5IDEzIDExIDExIDcgMTEiPjwvcG9seWdvbj4gPHBvbHlnb24gY2xhc3M9cWwtc3Ryb2tlIHBvaW50cz0iNyA3IDkgNSAxMSA3IDcgNyI+PC9wb2x5Z29uPiA8L3N2Zz4nfSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZT90OntkZWZhdWx0OnR9fWZ1bmN0aW9uIG8odCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBpKHQsZSl7aWYoIXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4hZXx8Im9iamVjdCIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZT90OmV9ZnVuY3Rpb24gbCh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pLGUuZGVmYXVsdD1lLkJ1YmJsZVRvb2x0aXA9dm9pZCAwO3ZhciBhPWZ1bmN0aW9uIHQoZSxuLHIpe251bGw9PT1lJiYoZT1GdW5jdGlvbi5wcm90b3R5cGUpO3ZhciBvPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSxuKTtpZih2b2lkIDA9PT1vKXt2YXIgaT1PYmplY3QuZ2V0UHJvdG90eXBlT2YoZSk7cmV0dXJuIG51bGw9PT1pP3ZvaWQgMDp0KGksbixyKX1pZigidmFsdWUiaW4gbylyZXR1cm4gby52YWx1ZTt2YXIgbD1vLmdldDtpZih2b2lkIDAhPT1sKXJldHVybiBsLmNhbGwocil9LHM9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQsZSl7Zm9yKHZhciBuPTA7bjxlLmxlbmd0aDtuKyspe3ZhciByPWVbbl07ci5lbnVtZXJhYmxlPXIuZW51bWVyYWJsZXx8ITEsci5jb25maWd1cmFibGU9ITAsInZhbHVlImluIHImJihyLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCxyLmtleSxyKX19cmV0dXJuIGZ1bmN0aW9uKGUsbixyKXtyZXR1cm4gbiYmdChlLnByb3RvdHlwZSxuKSxyJiZ0KGUsciksZX19KCksdT1uKDIpLGM9cih1KSxmPW4oOSksaD1yKGYpLHA9big0NCksZD1yKHApLHk9bigyMiksdj1uKDI2KSxiPXIodiksZz1bWyJib2xkIiwiaXRhbGljIiwibGluayJdLFt7aGVhZGVyOjF9LHtoZWFkZXI6Mn0sImJsb2NrcXVvdGUiXV0sbT1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKHQsbil7byh0aGlzLGUpLG51bGwhPW4ubW9kdWxlcy50b29sYmFyJiZudWxsPT1uLm1vZHVsZXMudG9vbGJhci5jb250YWluZXImJihuLm1vZHVsZXMudG9vbGJhci5jb250YWluZXI9Zyk7dmFyIHI9aSh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5jYWxsKHRoaXMsdCxuKSk7cmV0dXJuIHIucXVpbGwuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoInFsLWJ1YmJsZSIpLHJ9cmV0dXJuIGwoZSx0KSxzKGUsW3trZXk6ImV4dGVuZFRvb2xiYXIiLHZhbHVlOmZ1bmN0aW9uKHQpe3RoaXMudG9vbHRpcD1uZXcgXyh0aGlzLnF1aWxsLHRoaXMub3B0aW9ucy5ib3VuZHMpLHRoaXMudG9vbHRpcC5yb290LmFwcGVuZENoaWxkKHQuY29udGFpbmVyKSx0aGlzLmJ1aWxkQnV0dG9ucyhbXS5zbGljZS5jYWxsKHQuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoImJ1dHRvbiIpKSxiLmRlZmF1bHQpLHRoaXMuYnVpbGRQaWNrZXJzKFtdLnNsaWNlLmNhbGwodC5jb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgic2VsZWN0IikpLGIuZGVmYXVsdCl9fV0pLGV9KGQuZGVmYXVsdCk7bS5ERUZBVUxUUz0oMCxjLmRlZmF1bHQpKCEwLHt9LGQuZGVmYXVsdC5ERUZBVUxUUyx7bW9kdWxlczp7dG9vbGJhcjp7aGFuZGxlcnM6e2xpbms6ZnVuY3Rpb24odCl7dD90aGlzLnF1aWxsLnRoZW1lLnRvb2x0aXAuZWRpdCgpOnRoaXMucXVpbGwuZm9ybWF0KCJsaW5rIiwhMSl9fX19fSk7dmFyIF89ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSh0LG4pe28odGhpcyxlKTt2YXIgcj1pKHRoaXMsKGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkpLmNhbGwodGhpcyx0LG4pKTtyZXR1cm4gci5xdWlsbC5vbihoLmRlZmF1bHQuZXZlbnRzLkVESVRPUl9DSEFOR0UsZnVuY3Rpb24odCxlLG4sbyl7aWYodD09PWguZGVmYXVsdC5ldmVudHMuU0VMRUNUSU9OX0NIQU5HRSlpZihudWxsIT1lJiZlLmxlbmd0aD4wJiZvPT09aC5kZWZhdWx0LnNvdXJjZXMuVVNFUil7ci5zaG93KCksci5yb290LnN0eWxlLmxlZnQ9IjBweCIsci5yb290LnN0eWxlLndpZHRoPSIiLHIucm9vdC5zdHlsZS53aWR0aD1yLnJvb3Qub2Zmc2V0V2lkdGgrInB4Ijt2YXIgaT1yLnF1aWxsLmdldExpbmVzKGUuaW5kZXgsZS5sZW5ndGgpO2lmKDE9PT1pLmxlbmd0aClyLnBvc2l0aW9uKHIucXVpbGwuZ2V0Qm91bmRzKGUpKTtlbHNle3ZhciBsPWlbaS5sZW5ndGgtMV0sYT1yLnF1aWxsLmdldEluZGV4KGwpLHM9TWF0aC5taW4obC5sZW5ndGgoKS0xLGUuaW5kZXgrZS5sZW5ndGgtYSksdT1yLnF1aWxsLmdldEJvdW5kcyhuZXcgeS5SYW5nZShhLHMpKTtyLnBvc2l0aW9uKHUpfX1lbHNlIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQhPT1yLnRleHRib3gmJnIucXVpbGwuaGFzRm9jdXMoKSYmci5oaWRlKCl9KSxyfXJldHVybiBsKGUsdCkscyhlLFt7a2V5OiJsaXN0ZW4iLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpczthKGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwibGlzdGVuIix0aGlzKS5jYWxsKHRoaXMpLHRoaXMucm9vdC5xdWVyeVNlbGVjdG9yKCIucWwtY2xvc2UiKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsZnVuY3Rpb24oKXt0LnJvb3QuY2xhc3NMaXN0LnJlbW92ZSgicWwtZWRpdGluZyIpfSksdGhpcy5xdWlsbC5vbihoLmRlZmF1bHQuZXZlbnRzLlNDUk9MTF9PUFRJTUlaRSxmdW5jdGlvbigpe3NldFRpbWVvdXQoZnVuY3Rpb24oKXtpZighdC5yb290LmNsYXNzTGlzdC5jb250YWlucygicWwtaGlkZGVuIikpe3ZhciBlPXQucXVpbGwuZ2V0U2VsZWN0aW9uKCk7bnVsbCE9ZSYmdC5wb3NpdGlvbih0LnF1aWxsLmdldEJvdW5kcyhlKSl9fSwxKX0pfX0se2tleToiY2FuY2VsIix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuc2hvdygpfX0se2tleToicG9zaXRpb24iLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBuPWEoZS5wcm90b3R5cGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZS5wcm90b3R5cGUpLCJwb3NpdGlvbiIsdGhpcykuY2FsbCh0aGlzLHQpLHI9dGhpcy5yb290LnF1ZXJ5U2VsZWN0b3IoIi5xbC10b29sdGlwLWFycm93Iik7aWYoci5zdHlsZS5tYXJnaW5MZWZ0PSIiLDA9PT1uKXJldHVybiBuO3Iuc3R5bGUubWFyZ2luTGVmdD0tMSpuLXIub2Zmc2V0V2lkdGgvMisicHgifX1dKSxlfShwLkJhc2VUb29sdGlwKTtfLlRFTVBMQVRFPVsnPHNwYW4gY2xhc3M9InFsLXRvb2x0aXAtYXJyb3ciPjwvc3Bhbj4nLCc8ZGl2IGNsYXNzPSJxbC10b29sdGlwLWVkaXRvciI+JywnPGlucHV0IHR5cGU9InRleHQiIGRhdGEtZm9ybXVsYT0iZT1tY14yIiBkYXRhLWxpbms9Imh0dHBzOi8vcXVpbGxqcy5jb20iIGRhdGEtdmlkZW89IkVtYmVkIFVSTCI+JywnPGEgY2xhc3M9InFsLWNsb3NlIj48L2E+JywiPC9kaXY+Il0uam9pbigiIiksZS5CdWJibGVUb29sdGlwPV8sZS5kZWZhdWx0PW19LGZ1bmN0aW9uKHQsZSxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlP3Q6e2RlZmF1bHQ6dH19ZnVuY3Rpb24gbyh0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIGkodCxlKXtpZighdCl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiFlfHwib2JqZWN0IiE9dHlwZW9mIGUmJiJmdW5jdGlvbiIhPXR5cGVvZiBlP3Q6ZX1mdW5jdGlvbiBsKHQsZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUmJm51bGwhPT1lKXRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIit0eXBlb2YgZSk7dC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlJiZlLnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOnQsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksZSYmKE9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YodCxlKTp0Ll9fcHJvdG9fXz1lKX1PYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIGE9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQsZSl7dmFyIG49W10scj0hMCxvPSExLGk9dm9pZCAwO3RyeXtmb3IodmFyIGwsYT10W1N5bWJvbC5pdGVyYXRvcl0oKTshKHI9KGw9YS5uZXh0KCkpLmRvbmUpJiYobi5wdXNoKGwudmFsdWUpLCFlfHxuLmxlbmd0aCE9PWUpO3I9ITApO31jYXRjaCh0KXtvPSEwLGk9dH1maW5hbGx5e3RyeXshciYmYS5yZXR1cm4mJmEucmV0dXJuKCl9ZmluYWxseXtpZihvKXRocm93IGl9fXJldHVybiBufXJldHVybiBmdW5jdGlvbihlLG4pe2lmKEFycmF5LmlzQXJyYXkoZSkpcmV0dXJuIGU7aWYoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChlKSlyZXR1cm4gdChlLG4pO3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKX19KCkscz1mdW5jdGlvbiB0KGUsbixyKXtudWxsPT09ZSYmKGU9RnVuY3Rpb24ucHJvdG90eXBlKTt2YXIgbz1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsbik7aWYodm9pZCAwPT09byl7dmFyIGk9T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpO3JldHVybiBudWxsPT09aT92b2lkIDA6dChpLG4scil9aWYoInZhbHVlImluIG8pcmV0dXJuIG8udmFsdWU7dmFyIGw9by5nZXQ7aWYodm9pZCAwIT09bClyZXR1cm4gbC5jYWxsKHIpfSx1PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lW25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsci5rZXkscil9fXJldHVybiBmdW5jdGlvbihlLG4scil7cmV0dXJuIG4mJnQoZS5wcm90b3R5cGUsbiksciYmdChlLHIpLGV9fSgpLGM9bigyKSxmPXIoYyksaD1uKDkpLHA9cihoKSxkPW4oNDQpLHk9cihkKSx2PW4oMTUpLGI9cih2KSxnPW4oMjIpLG09bigyNiksXz1yKG0pLE89W1t7aGVhZGVyOlsiMSIsIjIiLCIzIiwhMV19XSxbImJvbGQiLCJpdGFsaWMiLCJ1bmRlcmxpbmUiLCJsaW5rIl0sW3tsaXN0OiJvcmRlcmVkIn0se2xpc3Q6ImJ1bGxldCJ9XSxbImNsZWFuIl1dLHc9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSh0LG4pe28odGhpcyxlKSxudWxsIT1uLm1vZHVsZXMudG9vbGJhciYmbnVsbD09bi5tb2R1bGVzLnRvb2xiYXIuY29udGFpbmVyJiYobi5tb2R1bGVzLnRvb2xiYXIuY29udGFpbmVyPU8pO3ZhciByPWkodGhpcywoZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSkuY2FsbCh0aGlzLHQsbikpO3JldHVybiByLnF1aWxsLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJxbC1zbm93Iikscn1yZXR1cm4gbChlLHQpLHUoZSxbe2tleToiZXh0ZW5kVG9vbGJhciIsdmFsdWU6ZnVuY3Rpb24odCl7dC5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgicWwtc25vdyIpLHRoaXMuYnVpbGRCdXR0b25zKFtdLnNsaWNlLmNhbGwodC5jb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgiYnV0dG9uIikpLF8uZGVmYXVsdCksdGhpcy5idWlsZFBpY2tlcnMoW10uc2xpY2UuY2FsbCh0LmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCJzZWxlY3QiKSksXy5kZWZhdWx0KSx0aGlzLnRvb2x0aXA9bmV3IHgodGhpcy5xdWlsbCx0aGlzLm9wdGlvbnMuYm91bmRzKSx0LmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCIucWwtbGluayIpJiZ0aGlzLnF1aWxsLmtleWJvYXJkLmFkZEJpbmRpbmcoe2tleToiSyIsc2hvcnRLZXk6ITB9LGZ1bmN0aW9uKGUsbil7dC5oYW5kbGVycy5saW5rLmNhbGwodCwhbi5mb3JtYXQubGluayl9KX19XSksZX0oeS5kZWZhdWx0KTt3LkRFRkFVTFRTPSgwLGYuZGVmYXVsdCkoITAse30seS5kZWZhdWx0LkRFRkFVTFRTLHttb2R1bGVzOnt0b29sYmFyOntoYW5kbGVyczp7bGluazpmdW5jdGlvbih0KXtpZih0KXt2YXIgZT10aGlzLnF1aWxsLmdldFNlbGVjdGlvbigpO2lmKG51bGw9PWV8fDA9PWUubGVuZ3RoKXJldHVybjt2YXIgbj10aGlzLnF1aWxsLmdldFRleHQoZSk7L15cUytAXFMrXC5cUyskLy50ZXN0KG4pJiYwIT09bi5pbmRleE9mKCJtYWlsdG86IikmJihuPSJtYWlsdG86IituKTt0aGlzLnF1aWxsLnRoZW1lLnRvb2x0aXAuZWRpdCgibGluayIsbil9ZWxzZSB0aGlzLnF1aWxsLmZvcm1hdCgibGluayIsITEpfX19fX0pO3ZhciB4PWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUodCxuKXtvKHRoaXMsZSk7dmFyIHI9aSh0aGlzLChlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKS5jYWxsKHRoaXMsdCxuKSk7cmV0dXJuIHIucHJldmlldz1yLnJvb3QucXVlcnlTZWxlY3RvcigiYS5xbC1wcmV2aWV3Iikscn1yZXR1cm4gbChlLHQpLHUoZSxbe2tleToibGlzdGVuIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXM7cyhlLnByb3RvdHlwZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlLnByb3RvdHlwZSksImxpc3RlbiIsdGhpcykuY2FsbCh0aGlzKSx0aGlzLnJvb3QucXVlcnlTZWxlY3RvcigiYS5xbC1hY3Rpb24iKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsZnVuY3Rpb24oZSl7dC5yb290LmNsYXNzTGlzdC5jb250YWlucygicWwtZWRpdGluZyIpP3Quc2F2ZSgpOnQuZWRpdCgibGluayIsdC5wcmV2aWV3LnRleHRDb250ZW50KSxlLnByZXZlbnREZWZhdWx0KCl9KSx0aGlzLnJvb3QucXVlcnlTZWxlY3RvcigiYS5xbC1yZW1vdmUiKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsZnVuY3Rpb24oZSl7aWYobnVsbCE9dC5saW5rUmFuZ2Upe3ZhciBuPXQubGlua1JhbmdlO3QucmVzdG9yZUZvY3VzKCksdC5xdWlsbC5mb3JtYXRUZXh0KG4sImxpbmsiLCExLHAuZGVmYXVsdC5zb3VyY2VzLlVTRVIpLGRlbGV0ZSB0LmxpbmtSYW5nZX1lLnByZXZlbnREZWZhdWx0KCksdC5oaWRlKCl9KSx0aGlzLnF1aWxsLm9uKHAuZGVmYXVsdC5ldmVudHMuU0VMRUNUSU9OX0NIQU5HRSxmdW5jdGlvbihlLG4scil7aWYobnVsbCE9ZSl7aWYoMD09PWUubGVuZ3RoJiZyPT09cC5kZWZhdWx0LnNvdXJjZXMuVVNFUil7dmFyIG89dC5xdWlsbC5zY3JvbGwuZGVzY2VuZGFudChiLmRlZmF1bHQsZS5pbmRleCksaT1hKG8sMiksbD1pWzBdLHM9aVsxXTtpZihudWxsIT1sKXt0LmxpbmtSYW5nZT1uZXcgZy5SYW5nZShlLmluZGV4LXMsbC5sZW5ndGgoKSk7dmFyIHU9Yi5kZWZhdWx0LmZvcm1hdHMobC5kb21Ob2RlKTtyZXR1cm4gdC5wcmV2aWV3LnRleHRDb250ZW50PXUsdC5wcmV2aWV3LnNldEF0dHJpYnV0ZSgiaHJlZiIsdSksdC5zaG93KCksdm9pZCB0LnBvc2l0aW9uKHQucXVpbGwuZ2V0Qm91bmRzKHQubGlua1JhbmdlKSl9fWVsc2UgZGVsZXRlIHQubGlua1JhbmdlO3QuaGlkZSgpfX0pfX0se2tleToic2hvdyIsdmFsdWU6ZnVuY3Rpb24oKXtzKGUucHJvdG90eXBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUucHJvdG90eXBlKSwic2hvdyIsdGhpcykuY2FsbCh0aGlzKSx0aGlzLnJvb3QucmVtb3ZlQXR0cmlidXRlKCJkYXRhLW1vZGUiKX19XSksZX0oZC5CYXNlVG9vbHRpcCk7eC5URU1QTEFURT1bJzxhIGNsYXNzPSJxbC1wcmV2aWV3IiB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iYWJvdXQ6YmxhbmsiPjwvYT4nLCc8aW5wdXQgdHlwZT0idGV4dCIgZGF0YS1mb3JtdWxhPSJlPW1jXjIiIGRhdGEtbGluaz0iaHR0cHM6Ly9xdWlsbGpzLmNvbSIgZGF0YS12aWRlbz0iRW1iZWQgVVJMIj4nLCc8YSBjbGFzcz0icWwtYWN0aW9uIj48L2E+JywnPGEgY2xhc3M9InFsLXJlbW92ZSI+PC9hPiddLmpvaW4oIiIpLGUuZGVmYXVsdD13fV0pLmRlZmF1bHR9KTs=';
        RichTextEditor.quillCSS = '.ql-container {  box-sizing: border-box;  font-family: Helvetica, Arial, sans-serif;  font-size: 13px;  height: 100%;  margin: 0px;  position: relative;}.ql-container.ql-disabled .ql-tooltip {  visibility: hidden;}.ql-container.ql-disabled .ql-editor ul[data-checked] > li::before {  pointer-events: none;}.ql-clipboard {  left: -100000px;  height: 1px;  overflow-y: hidden;  position: absolute;  top: 50%;}.ql-clipboard p {  margin: 0;  padding: 0;}.ql-editor {  box-sizing: border-box;  line-height: 1.42;  height: 100%;  outline: none;  overflow-y: auto;  padding: 12px 15px;  tab-size: 4;  -moz-tab-size: 4;  text-align: left;  white-space: pre-wrap;  word-wrap: break-word;}.ql-editor > * {  cursor: text;}.ql-editor p,.ql-editor ol,.ql-editor ul,.ql-editor pre,.ql-editor blockquote,.ql-editor h1,.ql-editor h2,.ql-editor h3,.ql-editor h4,.ql-editor h5,.ql-editor h6 {  margin: 0;  padding: 0;  counter-reset: list-1 list-2 list-3 list-4 list-5 list-6 list-7 list-8 list-9;}.ql-editor ol,.ql-editor ul {  padding-left: 1.5em;}.ql-editor ol > li,.ql-editor ul > li {  list-style-type: none;}.ql-editor ul > li::before {  content: "\2022";}.ql-editor ul[data-checked=true],.ql-editor ul[data-checked=false] {  pointer-events: none;}.ql-editor ul[data-checked=true] > li *,.ql-editor ul[data-checked=false] > li * {  pointer-events: all;}.ql-editor ul[data-checked=true] > li::before,.ql-editor ul[data-checked=false] > li::before {  color: #777;  cursor: pointer;  pointer-events: all;}.ql-editor ul[data-checked=true] > li::before {  content: "\2611";}.ql-editor ul[data-checked=false] > li::before {  content: "\2610";}.ql-editor li::before {  display: inline-block;  white-space: nowrap;  width: 1.2em;}.ql-editor li:not(.ql-direction-rtl)::before {  margin-left: -1.5em;  margin-right: 0.3em;  text-align: right;}.ql-editor li.ql-direction-rtl::before {  margin-left: 0.3em;  margin-right: -1.5em;}.ql-editor ol li:not(.ql-direction-rtl),.ql-editor ul li:not(.ql-direction-rtl) {  padding-left: 1.5em;}.ql-editor ol li.ql-direction-rtl,.ql-editor ul li.ql-direction-rtl {  padding-right: 1.5em;}.ql-editor ol li {  counter-reset: list-1 list-2 list-3 list-4 list-5 list-6 list-7 list-8 list-9;  counter-increment: list-0;}.ql-editor ol li:before {  content: counter(list-0, decimal) ". ";}.ql-editor ol li.ql-indent-1 {  counter-increment: list-1;}.ql-editor ol li.ql-indent-1:before {  content: counter(list-1, lower-alpha) ". ";}.ql-editor ol li.ql-indent-1 {  counter-reset: list-2 list-3 list-4 list-5 list-6 list-7 list-8 list-9;}.ql-editor ol li.ql-indent-2 {  counter-increment: list-2;}.ql-editor ol li.ql-indent-2:before {  content: counter(list-2, lower-roman) ". ";}.ql-editor ol li.ql-indent-2 {  counter-reset: list-3 list-4 list-5 list-6 list-7 list-8 list-9;}.ql-editor ol li.ql-indent-3 {  counter-increment: list-3;}.ql-editor ol li.ql-indent-3:before {  content: counter(list-3, decimal) ". ";}.ql-editor ol li.ql-indent-3 {  counter-reset: list-4 list-5 list-6 list-7 list-8 list-9;}.ql-editor ol li.ql-indent-4 {  counter-increment: list-4;}.ql-editor ol li.ql-indent-4:before {  content: counter(list-4, lower-alpha) ". ";}.ql-editor ol li.ql-indent-4 {  counter-reset: list-5 list-6 list-7 list-8 list-9;}.ql-editor ol li.ql-indent-5 {  counter-increment: list-5;}.ql-editor ol li.ql-indent-5:before {  content: counter(list-5, lower-roman) ". ";}.ql-editor ol li.ql-indent-5 {  counter-reset: list-6 list-7 list-8 list-9;}.ql-editor ol li.ql-indent-6 {  counter-increment: list-6;}.ql-editor ol li.ql-indent-6:before {  content: counter(list-6, decimal) ". ";}.ql-editor ol li.ql-indent-6 {  counter-reset: list-7 list-8 list-9;}.ql-editor ol li.ql-indent-7 {  counter-increment: list-7;}.ql-editor ol li.ql-indent-7:before {  content: counter(list-7, lower-alpha) ". ";}.ql-editor ol li.ql-indent-7 {  counter-reset: list-8 list-9;}.ql-editor ol li.ql-indent-8 {  counter-increment: list-8;}.ql-editor ol li.ql-indent-8:before {  content: counter(list-8, lower-roman) ". ";}.ql-editor ol li.ql-indent-8 {  counter-reset: list-9;}.ql-editor ol li.ql-indent-9 {  counter-increment: list-9;}.ql-editor ol li.ql-indent-9:before {  content: counter(list-9, decimal) ". ";}.ql-editor .ql-indent-1:not(.ql-direction-rtl) {  padding-left: 3em;}.ql-editor li.ql-indent-1:not(.ql-direction-rtl) {  padding-left: 4.5em;}.ql-editor .ql-indent-1.ql-direction-rtl.ql-align-right {  padding-right: 3em;}.ql-editor li.ql-indent-1.ql-direction-rtl.ql-align-right {  padding-right: 4.5em;}.ql-editor .ql-indent-2:not(.ql-direction-rtl) {  padding-left: 6em;}.ql-editor li.ql-indent-2:not(.ql-direction-rtl) {  padding-left: 7.5em;}.ql-editor .ql-indent-2.ql-direction-rtl.ql-align-right {  padding-right: 6em;}.ql-editor li.ql-indent-2.ql-direction-rtl.ql-align-right {  padding-right: 7.5em;}.ql-editor .ql-indent-3:not(.ql-direction-rtl) {  padding-left: 9em;}.ql-editor li.ql-indent-3:not(.ql-direction-rtl) {  padding-left: 10.5em;}.ql-editor .ql-indent-3.ql-direction-rtl.ql-align-right {  padding-right: 9em;}.ql-editor li.ql-indent-3.ql-direction-rtl.ql-align-right {  padding-right: 10.5em;}.ql-editor .ql-indent-4:not(.ql-direction-rtl) {  padding-left: 12em;}.ql-editor li.ql-indent-4:not(.ql-direction-rtl) {  padding-left: 13.5em;}.ql-editor .ql-indent-4.ql-direction-rtl.ql-align-right {  padding-right: 12em;}.ql-editor li.ql-indent-4.ql-direction-rtl.ql-align-right {  padding-right: 13.5em;}.ql-editor .ql-indent-5:not(.ql-direction-rtl) {  padding-left: 15em;}.ql-editor li.ql-indent-5:not(.ql-direction-rtl) {  padding-left: 16.5em;}.ql-editor .ql-indent-5.ql-direction-rtl.ql-align-right {  padding-right: 15em;}.ql-editor li.ql-indent-5.ql-direction-rtl.ql-align-right {  padding-right: 16.5em;}.ql-editor .ql-indent-6:not(.ql-direction-rtl) {  padding-left: 18em;}.ql-editor li.ql-indent-6:not(.ql-direction-rtl) {  padding-left: 19.5em;}.ql-editor .ql-indent-6.ql-direction-rtl.ql-align-right {  padding-right: 18em;}.ql-editor li.ql-indent-6.ql-direction-rtl.ql-align-right {  padding-right: 19.5em;}.ql-editor .ql-indent-7:not(.ql-direction-rtl) {  padding-left: 21em;}.ql-editor li.ql-indent-7:not(.ql-direction-rtl) {  padding-left: 22.5em;}.ql-editor .ql-indent-7.ql-direction-rtl.ql-align-right {  padding-right: 21em;}.ql-editor li.ql-indent-7.ql-direction-rtl.ql-align-right {  padding-right: 22.5em;}.ql-editor .ql-indent-8:not(.ql-direction-rtl) {  padding-left: 24em;}.ql-editor li.ql-indent-8:not(.ql-direction-rtl) {  padding-left: 25.5em;}.ql-editor .ql-indent-8.ql-direction-rtl.ql-align-right {  padding-right: 24em;}.ql-editor li.ql-indent-8.ql-direction-rtl.ql-align-right {  padding-right: 25.5em;}.ql-editor .ql-indent-9:not(.ql-direction-rtl) {  padding-left: 27em;}.ql-editor li.ql-indent-9:not(.ql-direction-rtl) {  padding-left: 28.5em;}.ql-editor .ql-indent-9.ql-direction-rtl.ql-align-right {  padding-right: 27em;}.ql-editor li.ql-indent-9.ql-direction-rtl.ql-align-right {  padding-right: 28.5em;}.ql-editor .ql-video {  display: block;  max-width: 100%;}.ql-editor .ql-video.ql-align-center {  margin: 0 auto;}.ql-editor .ql-video.ql-align-right {  margin: 0 0 0 auto;}.ql-editor .ql-bg-black {  background-color: #000;}.ql-editor .ql-bg-red {  background-color: #e60000;}.ql-editor .ql-bg-orange {  background-color: #f90;}.ql-editor .ql-bg-yellow {  background-color: #ff0;}.ql-editor .ql-bg-green {  background-color: #008a00;}.ql-editor .ql-bg-blue {  background-color: #06c;}.ql-editor .ql-bg-purple {  background-color: #93f;}.ql-editor .ql-color-white {  color: #fff;}.ql-editor .ql-color-red {  color: #e60000;}.ql-editor .ql-color-orange {  color: #f90;}.ql-editor .ql-color-yellow {  color: #ff0;}.ql-editor .ql-color-green {  color: #008a00;}.ql-editor .ql-color-blue {  color: #06c;}.ql-editor .ql-color-purple {  color: #93f;}.ql-editor .ql-font-serif {  font-family: Georgia, Times New Roman, serif;}.ql-editor .ql-font-monospace {  font-family: Monaco, Courier New, monospace;}.ql-editor .ql-size-small {  font-size: 0.75em;}.ql-editor .ql-size-large {  font-size: 1.5em;}.ql-editor .ql-size-huge {  font-size: 2.5em;}.ql-editor .ql-direction-rtl {  direction: rtl;  text-align: inherit;}.ql-editor .ql-align-center {  text-align: center;}.ql-editor .ql-align-justify {  text-align: justify;}.ql-editor .ql-align-right {  text-align: right;}.ql-editor.ql-blank::before {  color: rgba(0,0,0,0.6);  content: attr(data-placeholder);  font-style: italic;  left: 15px;  pointer-events: none;  position: absolute;  right: 15px;}.ql-snow.ql-toolbar:after,.ql-snow .ql-toolbar:after {  clear: both;  content: "";  display: table;}.ql-snow.ql-toolbar button,.ql-snow .ql-toolbar button {  background: none;  border: none;  cursor: pointer;  display: inline-block;  float: left;  height: 24px;  padding: 3px 5px;  width: 28px;}.ql-snow.ql-toolbar button svg,.ql-snow .ql-toolbar button svg {  float: left;  height: 100%;}.ql-snow.ql-toolbar button:active:hover,.ql-snow .ql-toolbar button:active:hover {  outline: none;}.ql-snow.ql-toolbar input.ql-image[type=file],.ql-snow .ql-toolbar input.ql-image[type=file] {  display: none;}.ql-snow.ql-toolbar button:hover,.ql-snow .ql-toolbar button:hover,.ql-snow.ql-toolbar button:focus,.ql-snow .ql-toolbar button:focus,.ql-snow.ql-toolbar button.ql-active,.ql-snow .ql-toolbar button.ql-active,.ql-snow.ql-toolbar .ql-picker-label:hover,.ql-snow .ql-toolbar .ql-picker-label:hover,.ql-snow.ql-toolbar .ql-picker-label.ql-active,.ql-snow .ql-toolbar .ql-picker-label.ql-active,.ql-snow.ql-toolbar .ql-picker-item:hover,.ql-snow .ql-toolbar .ql-picker-item:hover,.ql-snow.ql-toolbar .ql-picker-item.ql-selected,.ql-snow .ql-toolbar .ql-picker-item.ql-selected {  color: #06c;}.ql-snow.ql-toolbar button:hover .ql-fill,.ql-snow .ql-toolbar button:hover .ql-fill,.ql-snow.ql-toolbar button:focus .ql-fill,.ql-snow .ql-toolbar button:focus .ql-fill,.ql-snow.ql-toolbar button.ql-active .ql-fill,.ql-snow .ql-toolbar button.ql-active .ql-fill,.ql-snow.ql-toolbar .ql-picker-label:hover .ql-fill,.ql-snow .ql-toolbar .ql-picker-label:hover .ql-fill,.ql-snow.ql-toolbar .ql-picker-label.ql-active .ql-fill,.ql-snow .ql-toolbar .ql-picker-label.ql-active .ql-fill,.ql-snow.ql-toolbar .ql-picker-item:hover .ql-fill,.ql-snow .ql-toolbar .ql-picker-item:hover .ql-fill,.ql-snow.ql-toolbar .ql-picker-item.ql-selected .ql-fill,.ql-snow .ql-toolbar .ql-picker-item.ql-selected .ql-fill,.ql-snow.ql-toolbar button:hover .ql-stroke.ql-fill,.ql-snow .ql-toolbar button:hover .ql-stroke.ql-fill,.ql-snow.ql-toolbar button:focus .ql-stroke.ql-fill,.ql-snow .ql-toolbar button:focus .ql-stroke.ql-fill,.ql-snow.ql-toolbar button.ql-active .ql-stroke.ql-fill,.ql-snow .ql-toolbar button.ql-active .ql-stroke.ql-fill,.ql-snow.ql-toolbar .ql-picker-label:hover .ql-stroke.ql-fill,.ql-snow .ql-toolbar .ql-picker-label:hover .ql-stroke.ql-fill,.ql-snow.ql-toolbar .ql-picker-label.ql-active .ql-stroke.ql-fill,.ql-snow .ql-toolbar .ql-picker-label.ql-active .ql-stroke.ql-fill,.ql-snow.ql-toolbar .ql-picker-item:hover .ql-stroke.ql-fill,.ql-snow .ql-toolbar .ql-picker-item:hover .ql-stroke.ql-fill,.ql-snow.ql-toolbar .ql-picker-item.ql-selected .ql-stroke.ql-fill,.ql-snow .ql-toolbar .ql-picker-item.ql-selected .ql-stroke.ql-fill {  fill: #06c;}.ql-snow.ql-toolbar button:hover .ql-stroke,.ql-snow .ql-toolbar button:hover .ql-stroke,.ql-snow.ql-toolbar button:focus .ql-stroke,.ql-snow .ql-toolbar button:focus .ql-stroke,.ql-snow.ql-toolbar button.ql-active .ql-stroke,.ql-snow .ql-toolbar button.ql-active .ql-stroke,.ql-snow.ql-toolbar .ql-picker-label:hover .ql-stroke,.ql-snow .ql-toolbar .ql-picker-label:hover .ql-stroke,.ql-snow.ql-toolbar .ql-picker-label.ql-active .ql-stroke,.ql-snow .ql-toolbar .ql-picker-label.ql-active .ql-stroke,.ql-snow.ql-toolbar .ql-picker-item:hover .ql-stroke,.ql-snow .ql-toolbar .ql-picker-item:hover .ql-stroke,.ql-snow.ql-toolbar .ql-picker-item.ql-selected .ql-stroke,.ql-snow .ql-toolbar .ql-picker-item.ql-selected .ql-stroke,.ql-snow.ql-toolbar button:hover .ql-stroke-miter,.ql-snow .ql-toolbar button:hover .ql-stroke-miter,.ql-snow.ql-toolbar button:focus .ql-stroke-miter,.ql-snow .ql-toolbar button:focus .ql-stroke-miter,.ql-snow.ql-toolbar button.ql-active .ql-stroke-miter,.ql-snow .ql-toolbar button.ql-active .ql-stroke-miter,.ql-snow.ql-toolbar .ql-picker-label:hover .ql-stroke-miter,.ql-snow .ql-toolbar .ql-picker-label:hover .ql-stroke-miter,.ql-snow.ql-toolbar .ql-picker-label.ql-active .ql-stroke-miter,.ql-snow .ql-toolbar .ql-picker-label.ql-active .ql-stroke-miter,.ql-snow.ql-toolbar .ql-picker-item:hover .ql-stroke-miter,.ql-snow .ql-toolbar .ql-picker-item:hover .ql-stroke-miter,.ql-snow.ql-toolbar .ql-picker-item.ql-selected .ql-stroke-miter,.ql-snow .ql-toolbar .ql-picker-item.ql-selected .ql-stroke-miter {  stroke: #06c;}@media (pointer: coarse) {  .ql-snow.ql-toolbar button:hover:not(.ql-active),  .ql-snow .ql-toolbar button:hover:not(.ql-active) {    color: #444;  }  .ql-snow.ql-toolbar button:hover:not(.ql-active) .ql-fill,  .ql-snow .ql-toolbar button:hover:not(.ql-active) .ql-fill,  .ql-snow.ql-toolbar button:hover:not(.ql-active) .ql-stroke.ql-fill,  .ql-snow .ql-toolbar button:hover:not(.ql-active) .ql-stroke.ql-fill {    fill: #444;  }  .ql-snow.ql-toolbar button:hover:not(.ql-active) .ql-stroke,  .ql-snow .ql-toolbar button:hover:not(.ql-active) .ql-stroke,  .ql-snow.ql-toolbar button:hover:not(.ql-active) .ql-stroke-miter,  .ql-snow .ql-toolbar button:hover:not(.ql-active) .ql-stroke-miter {    stroke: #444;  }}.ql-snow {  box-sizing: border-box;}.ql-snow * {  box-sizing: border-box;}.ql-snow .ql-hidden {  display: none;}.ql-snow .ql-out-bottom,.ql-snow .ql-out-top {  visibility: hidden;}.ql-snow .ql-tooltip {  position: absolute;  transform: translateY(10px);}.ql-snow .ql-tooltip a {  cursor: pointer;  text-decoration: none;}.ql-snow .ql-tooltip.ql-flip {  transform: translateY(-10px);}.ql-snow .ql-formats {  display: inline-block;  vertical-align: middle;}.ql-snow .ql-formats:after {  clear: both;  content: "";  display: table;}.ql-snow .ql-stroke {  fill: none;  stroke: #444;  stroke-linecap: round;  stroke-linejoin: round;  stroke-width: 2;}.ql-snow .ql-stroke-miter {  fill: none;  stroke: #444;  stroke-miterlimit: 10;  stroke-width: 2;}.ql-snow .ql-fill,.ql-snow .ql-stroke.ql-fill {  fill: #444;}.ql-snow .ql-empty {  fill: none;}.ql-snow .ql-even {  fill-rule: evenodd;}.ql-snow .ql-thin,.ql-snow .ql-stroke.ql-thin {  stroke-width: 1;}.ql-snow .ql-transparent {  opacity: 0.4;}.ql-snow .ql-direction svg:last-child {  display: none;}.ql-snow .ql-direction.ql-active svg:last-child {  display: inline;}.ql-snow .ql-direction.ql-active svg:first-child {  display: none;}.ql-snow .ql-editor h1 {  font-size: 2em;}.ql-snow .ql-editor h2 {  font-size: 1.5em;}.ql-snow .ql-editor h3 {  font-size: 1.17em;}.ql-snow .ql-editor h4 {  font-size: 1em;}.ql-snow .ql-editor h5 {  font-size: 0.83em;}.ql-snow .ql-editor h6 {  font-size: 0.67em;}.ql-snow .ql-editor a {  text-decoration: underline;}.ql-snow .ql-editor blockquote {  border-left: 4px solid #ccc;  margin-bottom: 5px;  margin-top: 5px;  padding-left: 16px;}.ql-snow .ql-editor code,.ql-snow .ql-editor pre {  background-color: #f0f0f0;  border-radius: 3px;}.ql-snow .ql-editor pre {  white-space: pre-wrap;  margin-bottom: 5px;  margin-top: 5px;  padding: 5px 10px;}.ql-snow .ql-editor code {  font-size: 85%;  padding: 2px 4px;}.ql-snow .ql-editor pre.ql-syntax {  background-color: #23241f;  color: #f8f8f2;  overflow: visible;}.ql-snow .ql-editor img {  max-width: 100%;}.ql-snow .ql-picker {  color: #444;  display: inline-block;  float: left;  font-size: 14px;  font-weight: 500;  height: 24px;  position: relative;  vertical-align: middle;}.ql-snow .ql-picker-label {  cursor: pointer;  display: inline-block;  height: 100%;  padding-left: 8px;  padding-right: 2px;  position: relative;  width: 100%;}.ql-snow .ql-picker-label::before {  display: inline-block;  line-height: 22px;}.ql-snow .ql-picker-options {  background-color: #fff;  display: none;  min-width: 100%;  padding: 4px 8px;  position: absolute;  white-space: nowrap;}.ql-snow .ql-picker-options .ql-picker-item {  cursor: pointer;  display: block;  padding-bottom: 5px;  padding-top: 5px;}.ql-snow .ql-picker.ql-expanded .ql-picker-label {  color: #ccc;  z-index: 2;}.ql-snow .ql-picker.ql-expanded .ql-picker-label .ql-fill {  fill: #ccc;}.ql-snow .ql-picker.ql-expanded .ql-picker-label .ql-stroke {  stroke: #ccc;}.ql-snow .ql-picker.ql-expanded .ql-picker-options {  display: block;  margin-top: -1px;  top: 100%;  z-index: 1;}.ql-snow .ql-color-picker,.ql-snow .ql-icon-picker {  width: 28px;}.ql-snow .ql-color-picker .ql-picker-label,.ql-snow .ql-icon-picker .ql-picker-label {  padding: 2px 4px;}.ql-snow .ql-color-picker .ql-picker-label svg,.ql-snow .ql-icon-picker .ql-picker-label svg {  right: 4px;}.ql-snow .ql-icon-picker .ql-picker-options {  padding: 4px 0px;}.ql-snow .ql-icon-picker .ql-picker-item {  height: 24px;  width: 24px;  padding: 2px 4px;}.ql-snow .ql-color-picker .ql-picker-options {  padding: 3px 5px;  width: 152px;}.ql-snow .ql-color-picker .ql-picker-item {  border: 1px solid transparent;  float: left;  height: 16px;  margin: 2px;  padding: 0px;  width: 16px;}.ql-snow .ql-picker:not(.ql-color-picker):not(.ql-icon-picker) svg {  position: absolute;  margin-top: -9px;  right: 0;  top: 50%;  width: 18px;}.ql-snow .ql-picker.ql-header .ql-picker-label[data-label]:not([data-label=""])::before,.ql-snow .ql-picker.ql-font .ql-picker-label[data-label]:not([data-label=""])::before,.ql-snow .ql-picker.ql-size .ql-picker-label[data-label]:not([data-label=""])::before,.ql-snow .ql-picker.ql-header .ql-picker-item[data-label]:not([data-label=""])::before,.ql-snow .ql-picker.ql-font .ql-picker-item[data-label]:not([data-label=""])::before,.ql-snow .ql-picker.ql-size .ql-picker-item[data-label]:not([data-label=""])::before {  content: attr(data-label);}.ql-snow .ql-picker.ql-header {  width: 98px;}.ql-snow .ql-picker.ql-header .ql-picker-label::before,.ql-snow .ql-picker.ql-header .ql-picker-item::before {  content: "Normal";}.ql-snow .ql-picker.ql-header .ql-picker-label[data-value="1"]::before,.ql-snow .ql-picker.ql-header .ql-picker-item[data-value="1"]::before {  content: "Heading 1";}.ql-snow .ql-picker.ql-header .ql-picker-label[data-value="2"]::before,.ql-snow .ql-picker.ql-header .ql-picker-item[data-value="2"]::before {  content: "Heading 2";}.ql-snow .ql-picker.ql-header .ql-picker-label[data-value="3"]::before,.ql-snow .ql-picker.ql-header .ql-picker-item[data-value="3"]::before {  content: "Heading 3";}.ql-snow .ql-picker.ql-header .ql-picker-label[data-value="4"]::before,.ql-snow .ql-picker.ql-header .ql-picker-item[data-value="4"]::before {  content: "Heading 4";}.ql-snow .ql-picker.ql-header .ql-picker-label[data-value="5"]::before,.ql-snow .ql-picker.ql-header .ql-picker-item[data-value="5"]::before {  content: "Heading 5";}.ql-snow .ql-picker.ql-header .ql-picker-label[data-value="6"]::before,.ql-snow .ql-picker.ql-header .ql-picker-item[data-value="6"]::before {  content: "Heading 6";}.ql-snow .ql-picker.ql-header .ql-picker-item[data-value="1"]::before {  font-size: 2em;}.ql-snow .ql-picker.ql-header .ql-picker-item[data-value="2"]::before {  font-size: 1.5em;}.ql-snow .ql-picker.ql-header .ql-picker-item[data-value="3"]::before {  font-size: 1.17em;}.ql-snow .ql-picker.ql-header .ql-picker-item[data-value="4"]::before {  font-size: 1em;}.ql-snow .ql-picker.ql-header .ql-picker-item[data-value="5"]::before {  font-size: 0.83em;}.ql-snow .ql-picker.ql-header .ql-picker-item[data-value="6"]::before {  font-size: 0.67em;}.ql-snow .ql-picker.ql-font {  width: 108px;}.ql-snow .ql-picker.ql-font .ql-picker-label::before,.ql-snow .ql-picker.ql-font .ql-picker-item::before {  content: "Sans Serif";}.ql-snow .ql-picker.ql-font .ql-picker-label[data-value=serif]::before,.ql-snow .ql-picker.ql-font .ql-picker-item[data-value=serif]::before {  content: "Serif";}.ql-snow .ql-picker.ql-font .ql-picker-label[data-value=monospace]::before,.ql-snow .ql-picker.ql-font .ql-picker-item[data-value=monospace]::before {  content: "Monospace";}.ql-snow .ql-picker.ql-font .ql-picker-item[data-value=serif]::before {  font-family: Georgia, Times New Roman, serif;}.ql-snow .ql-picker.ql-font .ql-picker-item[data-value=monospace]::before {  font-family: Monaco, Courier New, monospace;}.ql-snow .ql-picker.ql-size {  width: 98px;}.ql-snow .ql-picker.ql-size .ql-picker-label::before,.ql-snow .ql-picker.ql-size .ql-picker-item::before {  content: "Normal";}.ql-snow .ql-picker.ql-size .ql-picker-label[data-value=small]::before,.ql-snow .ql-picker.ql-size .ql-picker-item[data-value=small]::before {  content: "Small";}.ql-snow .ql-picker.ql-size .ql-picker-label[data-value=large]::before,.ql-snow .ql-picker.ql-size .ql-picker-item[data-value=large]::before {  content: "Large";}.ql-snow .ql-picker.ql-size .ql-picker-label[data-value=huge]::before,.ql-snow .ql-picker.ql-size .ql-picker-item[data-value=huge]::before {  content: "Huge";}.ql-snow .ql-picker.ql-size .ql-picker-item[data-value=small]::before {  font-size: 10px;}.ql-snow .ql-picker.ql-size .ql-picker-item[data-value=large]::before {  font-size: 18px;}.ql-snow .ql-picker.ql-size .ql-picker-item[data-value=huge]::before {  font-size: 32px;}.ql-snow .ql-color-picker.ql-background .ql-picker-item {  background-color: #fff;}.ql-snow .ql-color-picker.ql-color .ql-picker-item {  background-color: #000;}.ql-toolbar.ql-snow {  border: 1px solid #ccc;  box-sizing: border-box;  font-family: "Helvetica Neue", "Helvetica", "Arial", sans-serif;  padding: 8px;}.ql-toolbar.ql-snow .ql-formats {  margin-right: 15px;}.ql-toolbar.ql-snow .ql-picker-label {  border: 1px solid transparent;}.ql-toolbar.ql-snow .ql-picker-options {  border: 1px solid transparent;  box-shadow: rgba(0,0,0,0.2) 0 2px 8px;}.ql-toolbar.ql-snow .ql-picker.ql-expanded .ql-picker-label {  border-color: #ccc;}.ql-toolbar.ql-snow .ql-picker.ql-expanded .ql-picker-options {  border-color: #ccc;}.ql-toolbar.ql-snow .ql-color-picker .ql-picker-item.ql-selected,.ql-toolbar.ql-snow .ql-color-picker .ql-picker-item:hover {  border-color: #000;}.ql-toolbar.ql-snow + .ql-container.ql-snow {  border-top: 0px;}.ql-snow .ql-tooltip {  background-color: #fff;  border: 1px solid #ccc;  box-shadow: 0px 0px 5px #ddd;  color: #444;  padding: 5px 12px;  white-space: nowrap;}.ql-snow .ql-tooltip::before {  content: "Visit URL:";  line-height: 26px;  margin-right: 8px;}.ql-snow .ql-tooltip input[type=text] {  display: none;  border: 1px solid #ccc;  font-size: 13px;  height: 26px;  margin: 0px;  padding: 3px 5px;  width: 170px;}.ql-snow .ql-tooltip a.ql-preview {  display: inline-block;  max-width: 200px;  overflow-x: hidden;  text-overflow: ellipsis;  vertical-align: top;}.ql-snow .ql-tooltip a.ql-action::after {  border-right: 1px solid #ccc;  content: "Edit";  margin-left: 16px;  padding-right: 8px;}.ql-snow .ql-tooltip a.ql-remove::before {  content: "Remove";  margin-left: 8px;}.ql-snow .ql-tooltip a {  line-height: 26px;}.ql-snow .ql-tooltip.ql-editing a.ql-preview,.ql-snow .ql-tooltip.ql-editing a.ql-remove {  display: none;}.ql-snow .ql-tooltip.ql-editing input[type=text] {  display: inline-block;}.ql-snow .ql-tooltip.ql-editing a.ql-action::after {  border-right: 0px;  content: "Save";  padding-right: 0px;}.ql-snow .ql-tooltip[data-mode=link]::before {  content: "Enter link:";}.ql-snow .ql-tooltip[data-mode=formula]::before {  content: "Enter formula:";}.ql-snow .ql-tooltip[data-mode=video]::before {  content: "Enter video:";}.ql-snow a {  color: #06c;}.ql-container.ql-snow {  border: 1px solid #ccc;}';
        RichTextEditor.style = `
            .next-admin-rich-text-editor .next-admin-editor-container {
                width:100%;
                height:100%;
                display:flex;
                flex-direction:column;
                background:#fff
            }
            .next-admin-table .next-admin-editor-container {
                background:rgba(255,255,255,0)
                }
            .next-admin-table{
                .next-admin-rich-text-editor-modern{
                    .ql-editor{
                        background:#fff;
                        border-radius:4px;
                        box-shadow: 0px 0px 2px rgba(0,0,0,0.25);
                        padding:4px;
                    }
                    .ql-container{
                        border:0px;
                    }
                }
            }
            .next-admin-rich-text-editor-no-background{
                .ql-editor{
                    background:rgba(255,255,255,0);
                    border:0px;
                    box-shadow: unset;
                    padding:0px;
                }
                .ql-container{
                    border:0px;
                    background:rgba(255,255,255,0);
                }
                .ql-editor:hover{
                    box-shadow: 0px 0px 2px rgba(0,0,0,0.40);
                }
            }
            .next-admin-rich-text-editor-inline-grid{
                .ql-editor{
                    padding-top:13px;
                    min-height:46px;
                }
            }


        `;
        RichTextEditor.onCreated = new NextAdmin.EventHandler();
        UI.RichTextEditor = RichTextEditor;
        let RichTextEditorStyle;
        (function (RichTextEditorStyle) {
            RichTextEditorStyle[RichTextEditorStyle["default"] = 0] = "default";
            RichTextEditorStyle[RichTextEditorStyle["modern"] = 1] = "modern";
            RichTextEditorStyle[RichTextEditorStyle["noBackground"] = 2] = "noBackground";
        })(RichTextEditorStyle = UI.RichTextEditorStyle || (UI.RichTextEditorStyle = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class ScrollableHorizontalBar extends UI.FlexLayout {
            ;
            constructor(options) {
                super({
                    direction: UI.FlexLayoutDirection.horizontal,
                    scrollOffset: 50,
                    displayArrowsAbsolute: false,
                    autoUpdateButtonsArrowsState: false,
                    ...options
                });
                this.element.style.width = 'unset';
                NextAdmin.Style.append('NextAdmin.UI.ScrollableHorizontalBar', ScrollableHorizontalBar.style);
                if (this.options.displayArrowsAbsolute) {
                    this.element.style.position = 'relative';
                }
                if (this.options.autoUpdateButtonsArrowsState) {
                    this.element.style.position = 'relative';
                    this.element.appendControl(new UI.ResisingContainer(), (rsContaoner) => {
                        rsContaoner.element.style.position = 'absolute';
                        rsContaoner.element.style.left = '0px';
                        rsContaoner.element.style.width = '100%';
                        rsContaoner.element.style.height = '0%';
                        rsContaoner.element.style.visibility = 'hidden';
                        rsContaoner.onSizeChanged.subscribe(() => {
                            this.updateButtonsState();
                        });
                    });
                }
                this.buttonLeftArrow = super.appendControl(new NextAdmin.UI.Button({
                    text: NextAdmin.Resources.iconCaretLeft,
                    style: UI.ButtonStyle.noBgDarkBlue,
                    action: () => {
                        this.scrollableArea.scrollBy(-this.options.scrollOffset, 0);
                        this.updateButtonsState();
                    }
                }), (buttonLeftArrow) => {
                    buttonLeftArrow.element.style.height = '100%';
                    buttonLeftArrow.element.style.visibility = 'hidden';
                    if (this.options.displayArrowsAbsolute) {
                        buttonLeftArrow.element.style.position = 'absolute';
                        buttonLeftArrow.element.style.left = '0px';
                        buttonLeftArrow.element.style.backgroundColor = '#fff';
                    }
                });
                this.scrollableArea = super.appendHTMLStretch('div', (scrollableArea) => {
                    scrollableArea.classList.add('scrollable-horizontal-bar-scrollable-area');
                    let startTouch;
                    let startTouchScrollLeft;
                    let startTouchScrollTop;
                    scrollableArea.addEventListener('touchstart', (ev) => {
                        scrollableArea.scrollBy({ left: 0, top: 0 });
                        let touch = [...ev.touches].firstOrDefault();
                        if (touch) {
                            startTouch = touch;
                            startTouchScrollLeft = this.scrollableArea.scrollLeft;
                            startTouchScrollTop = this.scrollableArea.scrollTop;
                        }
                    });
                    scrollableArea.addEventListener('touchmove', (ev) => {
                        let touch = [...ev.touches].firstOrDefault();
                        if (touch && startTouch) {
                            this.scrollableArea.scrollTo(startTouchScrollLeft + startTouch.clientX - touch.clientX, startTouchScrollTop + startTouch.clientY - touch.clientY);
                            this.updateButtonsState();
                        }
                    });
                    scrollableArea.addEventListener('touchend', (args) => {
                        startTouch = null;
                    });
                });
                this.buttonRightArrow = super.appendControl(new NextAdmin.UI.Button({
                    text: NextAdmin.Resources.iconCaretRight,
                    style: UI.ButtonStyle.noBgDarkBlue,
                    action: () => {
                        this.scrollableArea.scrollBy(this.options.scrollOffset, 0);
                        this.updateButtonsState();
                    }
                }), (buttonRightArrow) => {
                    buttonRightArrow.element.style.height = '100%';
                    buttonRightArrow.element.style.visibility = 'hidden';
                    if (this.options.displayArrowsAbsolute) {
                        buttonRightArrow.element.style.position = 'absolute';
                        buttonRightArrow.element.style.right = '0px';
                        buttonRightArrow.element.style.backgroundColor = '#fff';
                    }
                });
                if (this.options.maxWidth) {
                    this.setMaxWidth(this.options.maxWidth);
                }
                else {
                    this.element.style.maxWidth = '100%';
                }
            }
            appendControl(elementOrControl, setControlPropertiesAction) {
                return this.scrollableArea.addChild(elementOrControl, setControlPropertiesAction);
            }
            prependControl(elementOrControl, setControlPropertiesAction) {
                return this.scrollableArea.addChildFirst(elementOrControl, setControlPropertiesAction);
            }
            appendHTML(html, setControlPropertiesAction) {
                return this.scrollableArea.appendHTML(html, setControlPropertiesAction);
            }
            prependHTML(html, setControlPropertiesAction) {
                return this.scrollableArea.prependHTML(html, setControlPropertiesAction);
            }
            setMaxWidth(maxWidth) {
                this.element.style.maxWidth = maxWidth + 'px';
                this._maxWidth = maxWidth;
                this.updateButtonsState();
            }
            updateButtonsState() {
                let maxWidth = this._maxWidth ?? this.element.clientWidth;
                if (this.element.clientWidth < maxWidth && maxWidth > 0) {
                    this.buttonLeftArrow.element.style.display = 'none';
                    this.buttonRightArrow.element.style.display = 'none';
                }
                else {
                    this.buttonLeftArrow.element.style.display = '';
                    this.buttonRightArrow.element.style.display = '';
                    if (this.scrollableArea.scrollLeft == 0) {
                        this.buttonLeftArrow.element.style.visibility = 'hidden';
                    }
                    else {
                        this.buttonLeftArrow.element.style.visibility = '';
                    }
                    if (this.scrollableArea.scrollLeft + this.scrollableArea.clientWidth >= this.scrollableArea.scrollWidth) {
                        this.buttonRightArrow.element.style.visibility = 'hidden';
                    }
                    else {
                        this.buttonRightArrow.element.style.visibility = '';
                    }
                }
            }
        }
        ScrollableHorizontalBar.style = `
            .scrollable-horizontal-bar-scrollable-area{
                overflow: auto;
            }
            .scrollable-horizontal-bar-scrollable-area::-webkit-scrollbar{
                display: none;
            }
        `;
        UI.ScrollableHorizontalBar = ScrollableHorizontalBar;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="LabelFormControl.ts"/>
/// <reference path="DefaultStyle.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Select extends UI.LabelFormControl {
            constructor(options) {
                super({
                    autoFill: true,
                    style: Select.defaultStyle,
                    size: UI.InputSize.medium,
                    ...options
                });
                this._currentValue = null;
                NextAdmin.Style.append("SelectBox", Select.style);
                this.select = document.createElement('select');
                this.select.style.width = '100%';
                this.select.classList.add('next-admin-select');
                if (this.options.inlineGrid) {
                    this.options.style = NextAdmin.UI.SelectStyle.noBackground;
                    this.element.classList.add('next-admin-select-inline-grid');
                }
                this.select.addEventListener("input", () => {
                    let previousValue = this._currentValue;
                    this._currentValue = this.getValue();
                    this.onValueChanged.dispatch(this, { value: this._currentValue, previousValue: previousValue });
                });
                this.controlContainer.appendChild(this.select);
                if (this.options.items) {
                    this.addSelectItems(this.options.items);
                }
                this.setStyle(this.options.style);
                this.setSize(this.options.size);
            }
            setStyle(style) {
                switch (style) {
                    default:
                    case SelectStyle.default:
                        this.element.classList.add('next-admin-select-default');
                        break;
                    case SelectStyle.modern:
                        this.element.classList.add('next-admin-select-modern');
                        break;
                    case SelectStyle.noBackground:
                        this.element.classList.add('next-admin-select-no-background');
                        break;
                }
            }
            setSize(size) {
                switch (size) {
                    default:
                    case SelectSize.medium:
                        break;
                    case SelectSize.large:
                        this.select.classList.add('next-admin-select-large');
                        break;
                    case SelectSize.ultraLarge:
                        this.select.classList.add('next-admin-select-ultra-large');
                        break;
                }
            }
            setPropertyInfo(propertyInfo) {
                super.setPropertyInfo(propertyInfo);
                if (this.options.autoFill && propertyInfo.values != null && this.getItems().length == 0) {
                    if ((!propertyInfo.isRequired && this.options.required === undefined) || this.options.allowNullValue) {
                        this.addItem("");
                    }
                    for (let memberValue of propertyInfo.values) {
                        this.addItem(memberValue.value, memberValue.label);
                    }
                }
            }
            addSelectItem(selectItem) {
                return this.addItem(selectItem.value, selectItem.label, selectItem.selected);
            }
            addSelectItems(selectItems) {
                let optionElements = [];
                for (let valueItem of selectItems) {
                    optionElements.add(this.addSelectItem(valueItem));
                }
                return optionElements;
            }
            setSelectItems(selectItems) {
                let value = this.getValue();
                this.clearItems();
                let items = this.addSelectItems(selectItems);
                if (value) {
                    this.setValue(value);
                }
                return items;
            }
            addItem(value, label = value, selected) {
                if (value === undefined) {
                    value = null;
                }
                let option = document.createElement('option');
                option.innerHTML = label.toString();
                option.value = value === null ? '' : value.toString();
                option['_rowValue'] = value;
                option.selected = selected;
                this.select.appendChild(option);
                this._currentValue = this.getValue();
                return option;
            }
            addItems(dataset, valueFunc, captionFunc = null) {
                let items = new Array();
                for (let data of dataset) {
                    let item = this.addItem(valueFunc(data), captionFunc == null ? undefined : captionFunc(data));
                    items.push(item);
                }
                return items;
            }
            setItems(dataset, valueFunc, captionFunc = null) {
                this.clearItems();
                return this.addItems(dataset, valueFunc, captionFunc);
            }
            getItems() {
                let items = new Array();
                for (let i = 0; i < this.select.children.length; i++) {
                    items.add(this.select.children.item(i));
                }
                return items;
            }
            removeItem(item) {
                item.remove();
            }
            removeItemByValue(value) {
                let item = this.getItem(value);
                if (item) {
                    item.remove();
                }
            }
            clearItems() {
                for (let item of this.getItems()) {
                    item.remove();
                }
            }
            clearAll() {
                this.clearItems();
                this.setValue(null);
            }
            setPlaceholder(text) {
                this.select.setAttribute('placeholder', text);
                return this;
            }
            getItem(value) {
                return this.getItems().firstOrDefault(a => a.value == value || a['_rowValue'] == value);
            }
            setValue(value, fireChange) {
                if (value === undefined) {
                    value = null;
                }
                if (value !== null && this.getItem(value) == null) {
                    this.addItem(value);
                }
                this.select.value = value === null ? '' : value.toString();
                value = this.getValue();
                if (fireChange) {
                    this.onValueChanged.dispatch(this, { value: value, previousValue: this._currentValue, origin: UI.ChangeOrigin.code });
                }
                this._currentValue = value;
            }
            getValue() {
                let item = this.getSelectedItem();
                let value = item ? item['_rowValue'] : this.select.value;
                if (this.options.outputNullIfEmpty && NextAdmin.String.isNullOrEmptyString(value)) {
                    value = null;
                }
                return value;
            }
            getSelectedItem() {
                return this.getItem(this.select.value);
            }
            getValueText() {
                return this.getSelectedItem()?.text;
            }
            displayAsRequired() {
                super.displayAsRequired();
                this.select.classList.add('next-admin-required');
            }
            displayAsNotRequired() {
                super.displayAsNotRequired();
                this.select.classList.remove('next-admin-required');
            }
        }
        Select.style = `

        .next-admin-select { 
            border-radius: 4px;
            height:32px;
            margin:0px;
            padding:0px;
            box-sizing:border-box;
            outline:0px;
            border:1px solid #ccc; 
            background:rgba(250,250,250,1);
            font-size:14px;
            color:#444;
        }
        .next-admin-select-large{
            height:38px;
            font-size:18px;
        }
        .next-admin-input-select-large{
            height:46px;
            font-size:22px;
        }
        .next-admin-table .next-admin-select { 
            border:0px;background:rgba(255,255,255,0)
        }

        .next-admin-table .next-admin-select:hover {
            border:1px solid #ccc;
        }

        .next-admin-select-modern{
            .next-admin-select{
                background:#fff;
                border:1px solid #fff;
                box-shadow: 0px 0px 2px rgba(0,0,0,0.25);
                transition: 0.5s;
            }
            .next-admin-select:hover{
                box-shadow: 0px 0px 2px rgba(0,0,0,0.40);
            }
            .next-admin-select:focus {
                border: 1px solid #12101d;
                text-shadow:0px 0px 2px rgba(0,0,0,0.2);
            }
        }


        .next-admin-select-no-background{
            .next-admin-select{
                background:rgba(0,0,0,0);
                border:0px;
                box-shadow: unset;
                transition: 0.5s;
            }
            .next-admin-select:hover{
                border:0px;
                box-shadow: 0px 0px 2px rgba(0,0,0,0.40);
            }
        }

        .next-admin-select-inline-grid{
            .next-admin-select{
                height:46px;
                border-radius:0px;
                transition: unset;
            }
        }

        .next-admin-select.next-admin-required{
            background:` + UI.DefaultStyle.RequiredFieldBackground + `;
        }
        `;
        UI.Select = Select;
        let SelectStyle;
        (function (SelectStyle) {
            SelectStyle[SelectStyle["default"] = 0] = "default";
            SelectStyle[SelectStyle["modern"] = 1] = "modern";
            SelectStyle[SelectStyle["noBackground"] = 2] = "noBackground";
        })(SelectStyle = UI.SelectStyle || (UI.SelectStyle = {}));
        let SelectSize;
        (function (SelectSize) {
            SelectSize[SelectSize["medium"] = 0] = "medium";
            SelectSize[SelectSize["large"] = 1] = "large";
            SelectSize[SelectSize["ultraLarge"] = 2] = "ultraLarge";
        })(SelectSize = UI.SelectSize || (UI.SelectSize = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class SelectDropDownButton extends UI.FormControl {
            constructor(options) {
                super('div', {
                    autoFill: true,
                    style: UI.ButtonStyle.default,
                    ...options
                });
                this.dropDownButton = this.element.appendControl(new UI.DropDownButton({ text: this.options.label, style: this.options.style }), (dropDownButton) => {
                    dropDownButton.dropDown.onOpen.subscribe((dropDown) => {
                        let value = this.getValue();
                        for (let button of dropDown.getItems()) {
                            if (button['_value'] == value) {
                                button.element.style.color = UI.DefaultStyle.BlueOne;
                            }
                            else {
                                button.element.style.color = 'unset';
                            }
                        }
                    });
                });
                if (this.options.items) {
                    this.setItems(this.options.items);
                }
                if (this.options.label) {
                    this.setLabel(this.options.label);
                }
            }
            getLabel() {
                return this._label;
            }
            setLabel(label) {
                this._label = label;
                let valueLabel = this.getValueLabel(this.getValue());
                if (valueLabel) {
                    this.dropDownButton.setText(this._label + ' : ' + valueLabel);
                }
                else {
                    this.dropDownButton.setText(this._label);
                }
            }
            getValueLabel(value) {
                return this.getItemButton(value)?.getText();
            }
            getValue() {
                return this._value;
            }
            setValue(value, fireChange) {
                let previousValue = this._value;
                this._value = value;
                this.setLabel(this.getLabel());
                if (fireChange) {
                    this.onValueChanged.dispatch(this, {
                        previousValue: previousValue,
                        value: this.getValue()
                    });
                }
            }
            setItems(selectItems) {
                this.clearItems();
                return this.addItems(selectItems);
            }
            addItems(selectItems) {
                let buttons = [];
                for (let item of selectItems) {
                    buttons.add(this.addItem(item));
                }
                return buttons;
            }
            addItem(selectItem) {
                let button = this.dropDownButton.addItem({
                    text: selectItem.label,
                    action: () => {
                        this.setValue(selectItem.value, true);
                    }
                });
                if (this.options.onAddButton) {
                    this.options.onAddButton(this, {
                        button: button,
                        item: selectItem
                    });
                }
                button['_value'] = selectItem.value;
                return button;
            }
            removeItem(value) {
                let button = this.getItemButton(value);
                if (button?.element?.parentElement) {
                    button?.element?.parentElement.remove();
                }
            }
            getItemButton(value) {
                return this.dropDownButton.dropDown.getItems().firstOrDefault(a => a['_value'] == value);
            }
            clearItems() {
                this.dropDownButton.clearItems();
            }
            clearAll() {
                this.clearItems();
                this.setValue(null);
            }
            setPropertyInfo(propertyInfo) {
                super.setPropertyInfo(propertyInfo);
                if (!NextAdmin.String.isNullOrEmpty(propertyInfo?.displayName) && NextAdmin.String.isNullOrEmpty(this.getLabel())) {
                    this.setLabel(propertyInfo.displayName);
                }
                if (this.options.autoFill && propertyInfo?.values?.length) {
                    this.setItems(propertyInfo.values);
                }
            }
        }
        UI.SelectDropDownButton = SelectDropDownButton;
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Sidebar extends UI.Control {
            constructor(options) {
                super('div', options);
                this.pagesButtonsDictionary = new NextAdmin.Dictionary();
                this.setStyle(this.options.style);
                if (this.options.navigationController != null) {
                    this._pageChangedAction = this.options.navigationController.onNavigate.subscribe((sender, args) => {
                        this.updateActivePage(args.nextPage?.options?.name, args.previousPage?.options?.name);
                    });
                }
                NextAdmin.Style.append("SideBar", Sidebar.style);
                if (!Sidebar.sideBarJSLoaded) {
                    let script = document.createElement('script');
                    script.textContent = Sidebar.sideBarJS;
                    document.head.appendChild(script);
                    Sidebar.sideBarJSLoaded = true;
                }
                this.element.classList.add('sidebar-wrapper');
                this.header = this.element.appendHTML('div', (header) => {
                    header.classList.add('sidebar-header');
                });
                this.element.appendHTML('div', (sideBarMenu) => {
                    sideBarMenu.classList.add('sidebar-menu');
                    this.body = sideBarMenu.appendHTML('div', (body) => {
                        body.classList.add('menu');
                    });
                });
                this.element.appendPerfectScrollbar();
            }
            updateActivePage(activePageName, previousPageName) {
                if (previousPageName) {
                    let previousPageButton = this.pagesButtonsDictionary.get(previousPageName);
                    if (previousPageButton != null) {
                        previousPageButton.desactivate();
                    }
                }
                if (activePageName) {
                    let newPageButton = this.pagesButtonsDictionary.get(activePageName);
                    if (newPageButton != null) {
                        newPageButton.activate();
                    }
                }
            }
            setStyle(style) {
                switch (style) {
                    case SideBarStyle.darkBlueOne:
                        this.element.classList.add('side-bar-dark-blue-one');
                        break;
                    case SideBarStyle.darkBlueTwo:
                        this.element.classList.add('side-bar-dark-blue-two');
                        break;
                    default:
                    case SideBarStyle.default:
                        break;
                }
            }
            addPageButton(options) {
                return this.body.appendControl(new SidebarPageButton(this, options));
            }
            dispose() {
                super.dispose();
                if (this._pageChangedAction) {
                    this.options.navigationController.onNavigate.unsubscribe(this._pageChangedAction);
                }
            }
        }
        Sidebar.sideBarJS = 'function slideToggle(t,e,o){0===t.clientHeight?j(t,e,o,!0):j(t,e,o)}function slideUp(t,e,o){j(t,e,o)}function slideDown(t,e,o){j(t,e,o,!0)}function j(t,e,o,i){void 0===e&&(e=400),void 0===i&&(i=!1),t.style.overflow="hidden",i&&(t.style.display="block");var p,l=window.getComputedStyle(t),n=parseFloat(l.getPropertyValue("height")),a=parseFloat(l.getPropertyValue("padding-top")),s=parseFloat(l.getPropertyValue("padding-bottom")),r=parseFloat(l.getPropertyValue("margin-top")),d=parseFloat(l.getPropertyValue("margin-bottom")),g=n/e,y=a/e,m=s/e,u=r/e,h=d/e;window.requestAnimationFrame(function l(x){void 0===p&&(p=x);var f=x-p;i?(t.style.height=g*f+"px",t.style.paddingTop=y*f+"px",t.style.paddingBottom=m*f+"px",t.style.marginTop=u*f+"px",t.style.marginBottom=h*f+"px"):(t.style.height=n-g*f+"px",t.style.paddingTop=a-y*f+"px",t.style.paddingBottom=s-m*f+"px",t.style.marginTop=r-u*f+"px",t.style.marginBottom=d-h*f+"px"),f>=e?(t.style.height="",t.style.paddingTop="",t.style.paddingBottom="",t.style.marginTop="",t.style.marginBottom="",t.style.overflow="",i||(t.style.display="none"),"function"==typeof o&&o()):window.requestAnimationFrame(l)})}';
        Sidebar.sideBarJSLoaded = false;
        Sidebar.style = `
        .sidebar-wrapper {
            background-color:#fff;
            bottom:0;height:100vh;
            overflow-y:auto;position:fixed;
            top:0;transition:left .5s ease-out;
            width:250px;
            z-index:10;
            box-shadow:2px 0px 2px #ccc;
        }

        .sidebar-wrapper .sidebar-header {
            padding:1rem 1rem .8rem
        }

        .sidebar-wrapper .sidebar-toggler.x {
            display:none;
            position:absolute;
            right:0;top:.5rem;
        }

        .sidebar-wrapper .menu {
            margin-top:10px;
            padding:0 20px;
        }

        .sidebar-wrapper .menu .sidebar-title {
            color:#25396f;
            list-style:none;
            margin:1.5rem 0 .8rem;padding:0 .8rem
        }

        .sidebar-wrapper .menu .sidebar-link {
            font-size:14px;
            align-items:center;
            border-radius:.5rem;
            color:#25396f;
            font-weight:bold;
            display:block;
            padding:.5rem .5rem;
            text-decoration:none;
            transition:all .5s;
        }

        .sidebar-wrapper .menu .sidebar-link i,.sidebar-wrapper .menu .sidebar-link svg {
            color:#7c8db5;
        }

        .sidebar-wrapper .menu .sidebar-link .sidebar-link-text {
            margin-left:.8rem;
        }

        .sidebar-wrapper .menu .sidebar-link:hover {
            background-color:#f0f1f5;
        }

        .sidebar-wrapper .menu .sidebar-item {
            list-style:none;
            margin-top:.5rem;
            position:relative
        }

        .sidebar-wrapper .menu .sidebar-item.active>.sidebar-link {
            background-color:#0069b6
        }

        .sidebar-wrapper .menu .sidebar-item.active>.sidebar-link .sidebar-link-text {
            color:#fff;
        }

        .sidebar-wrapper .menu .sidebar-item.active>.sidebar-link i,.sidebar-wrapper .menu .sidebar-item.active>.sidebar-link svg {
            fill:#fff;color:#fff
        }

        .sidebar-wrapper .menu .submenu {
            display:none;
            list-style:none;
            overflow:hidden;
            transition:max-height 2s cubic-bezier(0, .55, .45, 1);
            padding-left:1.5rem;
            background:rgba(37, 42, 73, 0.4);
            border-radius:10px;
        }

        .sidebar-wrapper .menu .caret{
            float:right;
        }

        .sidebar-wrapper .menu .submenu.active {
            display:block;
            max-height:999px
        }

        .sidebar-wrapper .menu .submenu .submenu-item.active>a {
            color:#435ebe;
        }

        .sidebar-wrapper .menu .submenu .submenu-item a {
            color:#25396f;
            display:block;
            padding:.5rem .5rem;
            transition:all .3s
        }

        .sidebar-wrapper .menu .submenu .submenu-item a:hover {
            margin-left:.3rem
        }

        .sidebar-wrapper .sidebar-item.has-sub .submenu-item .sidebar-link:after {
            content:'';
        }

        .side-bar-dark-blue-one {

            background-color:#263544 !important;

            .sidebar-title{
                color:#e0e0e0 !important;
            }
            .sidebar-link{
                color:#e0e0e0 !important;
            }
            .sidebar-link:hover {
                color:#263544 !important;
            }
            .menu .sidebar-item.active>.sidebar-link{
                background-color:#1d2431 !important;
            }
            .sidebar-link
            {
                color:#007FFF;
            }
            .menu .submenu .submenu-item.active>a{
                color:#7c8db5 !important;
            }
        }

        .side-bar-dark-blue-two {

            background-color:#12101d !important;

            .sidebar-title{
                color:#e0e0e0 !important;
            }
            .sidebar-link{
                padding:12px !important;
                color:#e0e0e0 !important;
            }
            .sidebar-link:hover {
                color:#263544 !important;
            }
            .sidebar-link
            {
                color:#d6d2d7 !important;
            }
            .sidebar-link i {
                color:#d6d2d7 !important;
            }
            .menu .sidebar-item.active>.sidebar-link{
                background-color:#fdfffe !important;
            }
            .menu .submenu-item.active .sidebar-link{
                background-color:#fdfffe !important;
            }
            .menu .sidebar-link:hover {
                background-color:#fdfffe !important;
            }

            .sidebar-item.active>.sidebar-link .sidebar-link-text {
                color:#3f424a !important;
            }
            .sidebar-item.active>.sidebar-link i {
                color:#3f424a !important;
            }
            .menu .submenu-item.active .sidebar-link .sidebar-link-text{
                color:#3f424a !important;
            }
            .menu .submenu-item.active .sidebar-link i{
                color:#3f424a !important;
            }
            .submenu{
                padding-left:0px !important;
            }
            .submenu .submenu-item{
                margin-top:0.5rem;
            }

        }

        `;
        UI.Sidebar = Sidebar;
        class SidebarPageButton extends UI.Control {
            constructor(sidebar, options) {
                super('li', options);
                this.sidebar = sidebar;
                this.options = options;
                this.element.classList.add(this.options.parent ? 'submenu-item' : 'sidebar-item');
                this.link = this.element.appendHTML('a', (a) => {
                    a.classList.add('sidebar-link');
                    a.href = 'JavaScript:void(0)';
                    if (this.options.page != null) {
                        this.element.id = this.options.page.options.name + '_Button';
                        if (sidebar.options.navigationController != null) {
                            a.addEventListener('click', () => {
                                sidebar.options.navigationController.navigateTo(this.options.page.options.name);
                            });
                        }
                        sidebar.pagesButtonsDictionary.add(options.page.options.name, this);
                    }
                    else if (this.options.action) {
                        this.options.action(this);
                    }
                    else if (this.options.href) {
                        a.href = this.options.href;
                        sidebar.pagesButtonsDictionary.add(this.options.href, this);
                    }
                    else if (this.options.pageName) {
                        a.href = this.options.pageName;
                        sidebar.pagesButtonsDictionary.add(this.options.pageName, this);
                    }
                    if (this.options.parent) {
                        a.style.paddingLeft = '0px';
                        a.style.paddingRight = '0px';
                    }
                    if (options.icon) {
                        a.appendHTML('span', (icon) => {
                            icon.classList.add('sidebar-link-icon');
                            icon.innerHTML = options.icon;
                        });
                    }
                    a.appendHTML('span', (text) => {
                        text.classList.add('sidebar-link-text');
                        if (options.fontSize) {
                            text.style.fontSize = options.fontSize;
                        }
                        text.innerHTML = options.text;
                    });
                });
            }
            activate() {
                if (!this.element.classList.contains('active')) {
                    this.element.classList.add('active');
                }
                document.body.querySelectorAll('.submenu').forEach(otherSubMenu => {
                    if (this.options.parent == null || this.options.parent.subMenu != otherSubMenu) {
                        let otherPageButton = otherSubMenu['_control'];
                        if (otherPageButton != null) {
                            otherPageButton.closeSubMenu();
                        }
                    }
                    else if (this.options.parent != null && this.options.parent.subMenu.style.display == '') {
                        this.options.parent.openSubMenu();
                    }
                });
            }
            desactivate() {
                this.element.classList.remove('active');
            }
            addPageButton(options) {
                if (this.subMenu == null) {
                    this.element.classList.add('has-sub');
                    this.caret = this.link.appendHTML('span', (caret) => {
                        caret.classList.add('caret');
                        caret.innerHTML = NextAdmin.Resources.iconCaretDown;
                    });
                    this.subMenu = this.element.appendHTML('ul', (subMenu) => {
                        subMenu.classList.add('submenu');
                    });
                    this.subMenu['_control'] = this;
                    this.link.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.toggleSubMenu();
                    });
                }
                options.parent = this;
                return this.subMenu.appendControl(new SidebarPageButton(this.sidebar, options));
            }
            isSubMenuOpen() {
                return this.subMenu != null && this.subMenu.offsetParent !== null;
            }
            toggleSubMenu() {
                if (this.subMenu == null) {
                    return;
                }
                if (this.isSubMenuOpen()) {
                    this.closeSubMenu();
                }
                else {
                    this.openSubMenu();
                }
            }
            openSubMenu() {
                if (this.subMenu == null || this.isSubMenuOpen()) {
                    return;
                }
                slideDown(this.subMenu, 300);
                this.caret.innerHTML = NextAdmin.Resources.iconCaretLeft;
            }
            closeSubMenu() {
                if (this.subMenu == null || !this.isSubMenuOpen()) {
                    return;
                }
                slideUp(this.subMenu, 300);
                this.caret.innerHTML = NextAdmin.Resources.iconCaretDown;
            }
        }
        UI.SidebarPageButton = SidebarPageButton;
        let SideBarStyle;
        (function (SideBarStyle) {
            SideBarStyle[SideBarStyle["default"] = 0] = "default";
            SideBarStyle[SideBarStyle["darkBlueOne"] = 1] = "darkBlueOne";
            SideBarStyle[SideBarStyle["darkBlueTwo"] = 2] = "darkBlueTwo";
        })(SideBarStyle = UI.SideBarStyle || (UI.SideBarStyle = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="StretchLayout.ts" />
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class TabPanel extends UI.StretchLayout {
            constructor(options) {
                super({
                    style: TabPanel.defaultStyle,
                    ...options
                });
                this.tabs = new NextAdmin.Dictionary();
                this.onActivTabChange = new NextAdmin.EventHandler();
                this.onActivTabChanged = new NextAdmin.EventHandler();
                NextAdmin.Style.append('TabPanel', TabPanel.style);
                if (this.options.activTabName == null && this.options.tabs != null && this.options.tabs.length > 0) {
                    this.options.activTabName = this.options.tabs[0].name;
                }
                this.fixedContainer.classList.add('next-admin-tab-panel-header');
                this.stretchContainer.classList.add('next-admin-tab-panel-body');
                this.fixedContainer.appendControl(new UI.ScrollableHorizontalBar({ displayArrowsAbsolute: true, scrollOffset: 100, autoUpdateButtonsArrowsState: true }), (shb) => {
                    this.tabsButtonsBar = shb.appendControl(new UI.Toolbar());
                });
                if (this.options.tabs != null) {
                    for (let tab of this.options.tabs) {
                        this.addTab(tab);
                    }
                }
                if (this.options.activTabName != null) {
                    this.setActiveTab(this.options.activTabName);
                }
                this.setStyle(this.options.style);
                TabPanel.onCreated.dispatch(this, this.options);
            }
            setStyle(style) {
                switch (style) {
                    default:
                    case TabPanelStyle.default:
                        this.element.classList.add('next-admin-tab-panel-default');
                        break;
                    case TabPanelStyle.modern:
                        this.element.classList.add('next-admin-tab-panel-modern');
                        break;
                }
            }
            addTab(tabOptionOrLabel, configAction) {
                let tabOption = typeof (tabOptionOrLabel) === 'string' ? {
                    name: tabOptionOrLabel,
                } : tabOptionOrLabel;
                if (tabOption.label == null) {
                    tabOption.label = tabOption.name;
                }
                let tab = new Tab(this, tabOption);
                if (!this.tabs.tryAdd(tabOption.name, tab)) {
                    return null;
                }
                if (tabOption.index == null) {
                    this.tabsButtonsBar.appendControl(tab.button);
                    tab.options.index = this.tabsButtonsBar.row.getChildrenElements().length;
                }
                else {
                    let exustingTab = this.tabs.getValues().where(a => a.name != tabOption.name).orderBy(a => a.options.index).firstOrDefault(a => a.options.index >= tabOption.index);
                    if (exustingTab != null) {
                        let existingTabButtonIndex = this.tabsButtonsBar.row.getChildrenElements().indexOf(exustingTab.button.element.parentElement);
                        this.tabsButtonsBar.insertControl(tab.button, existingTabButtonIndex);
                    }
                    else {
                        this.tabsButtonsBar.appendControl(tab.button);
                    }
                }
                this.stretchContainer.appendChild(tab.element);
                if (this.getActiveTab() == null || tabOption.active) {
                    this.setActiveTab(tabOption.name);
                }
                if (configAction) {
                    configAction(tab);
                }
                return tab;
            }
            hideTab(tabName) {
                let tab = this.getTab(tabName);
                if (tab) {
                    tab.button.element.parentElement.style.display = 'none';
                    if (this.getActiveTab() == tab) {
                        let otherTab = this.tabs.getValues().where(a => a != tab && a.button.element.parentElement.style.display != 'none').orderBy(a => a.options.index).firstOrDefault();
                        if (otherTab) {
                            this.setActiveTab(otherTab.name);
                        }
                    }
                }
            }
            displayTab(tabName) {
                let tab = this.getTab(tabName);
                if (tab) {
                    tab.button.element.parentElement.style.display = '';
                }
            }
            removeTab(tabName) {
                let tab = this.tabs.get(tabName);
                if (tab == null)
                    return;
                if (this.getActiveTab() == tab) {
                    let nextTab = this.tabs.getValues().orderBy(e => e.options.index).firstOrDefault(e => e.name != tab.name);
                    if (nextTab != null) {
                        this.setActiveTab(nextTab.name);
                    }
                }
                this.tabsButtonsBar.removeControl(tab.button);
                tab.body.remove();
                this.tabs.remove(tabName);
            }
            clearTabs() {
                for (let tab of this.tabs.getValues()) {
                    this.removeTab(tab.name);
                }
            }
            setActiveTab(tabName) {
                let previousTab = this.getActiveTab();
                let tab = this.tabs.get(tabName);
                if (tab == null) {
                    throw new Error('Invalid tab name : ' + tabName);
                }
                if (tab.isActiv) {
                    return;
                }
                let tabChangedArgs = {
                    newTab: tab,
                    previousTab: previousTab,
                    cancel: false
                };
                this.onActivTabChange.dispatch(this, tabChangedArgs);
                if (tabChangedArgs.cancel) {
                    return;
                }
                for (let otherTab of this.tabs.getValues().where(e => e !== tab)) {
                    otherTab.body.style.display = 'none';
                    otherTab.isActiv = false;
                    otherTab.button.element.classList.remove('next-admin-activ-tab-button');
                }
                tab.body.style.display = '';
                tab.button.element.classList.add('next-admin-activ-tab-button');
                tab.isActiv = true;
                this.onActivTabChanged.dispatch(this, tabChangedArgs);
            }
            getActiveTab() {
                return this.tabs.getValues().firstOrDefault(e => e.isActiv == true);
            }
            getTab(tabName) {
                return this.tabs.get(tabName);
            }
            findElementParentTab(element) {
                while (element != this.element && element != null) {
                    element = element.parentElement;
                    for (let tab of this.tabs.getValues()) {
                        if (element == tab.body) {
                            return tab;
                        }
                    }
                }
            }
        }
        TabPanel.onCreated = new NextAdmin.EventHandler();
        TabPanel.style = `

            .next-admin-tab-panel-body{
                background:rgba(255,255,255,1)
            }
            .next-admin-tab-panel-header{
                border-bottom:1px solid #ccc;
                padding-left:10px;
            }

            .next-admin-tab-panel-body .next-admin-panel-header{
                border-radius:0px;
                border-top:0px;
                border-left:0px;
                border-right:0px;
            } 
            .next-admin-tab-panel-body .next-admin-panel-footer{
                border-radius:0px;
                border-bottom:0px;
                border-left:0px;
                border-right:0px;
            } 
            .next-admin-tab-panel-body .next-admin-panel-body{
                border-left:0px;
                border-right:0px;border-bottom:0px
            }
            .next-admin-tab-panel-header {
                .next-admin-activ-tab-button{
                    text-shadow:0px 0px 2px rgba(0,0,0,0.2);
                    color:#105ABE;
                }
            }
            .next-admin-tab-panel-header {
                .toolbar-cell{
                    padding:6px;
                }
            }
         
            `;
        UI.TabPanel = TabPanel;
        class Tab extends NextAdmin.UI.Control {
            constructor(tabPanel, options) {
                super('div', {
                    style: TabPanel.defaultStyle,
                    ...options
                });
                this.name = this.options.name;
                this.tabPanel = tabPanel;
                this.body = this.element;
                this.body.style.display = 'none';
                if (this.tabPanel.options.stretch) {
                    this.body.style.height = '100%';
                }
                this.button = new UI.Button({
                    text: this.options.label,
                    style: UI.ButtonStyle.noBg,
                    action: () => {
                        this.tabPanel.setActiveTab(this.options.name);
                    }
                });
            }
        }
        UI.Tab = Tab;
        let TabPanelStyle;
        (function (TabPanelStyle) {
            TabPanelStyle[TabPanelStyle["default"] = 0] = "default";
            TabPanelStyle[TabPanelStyle["modern"] = 1] = "modern";
        })(TabPanelStyle = UI.TabPanelStyle || (UI.TabPanelStyle = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="Control.ts" />
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Table extends UI.Control {
            constructor(options) {
                super("div", {
                    style: Table.defaultStyle,
                    stretchWidth: true,
                    ...options
                });
                this.onRowSelected = new NextAdmin.EventHandler();
                this.onRowUnselected = new NextAdmin.EventHandler();
                this.onSelectedRowsChanged = new NextAdmin.EventHandler();
                this.onRowAdded = new NextAdmin.EventHandler();
                NextAdmin.Style.append("NextAdmin.UI.Table", Table.style);
                this.element.style.width = this.options.stretchWidth ? '100%' : 'fit-content';
                this.tableContainer = this.element.appendHTML('div', (tableContainer) => {
                    tableContainer.style.width = this.options.stretchWidth ? '100%' : 'fit-content';
                    this.table = tableContainer.appendHTML('table', (table) => {
                        table.classList.add('next-admin-table');
                        if (this.options.stretchWidth) {
                            table.style.width = '100%';
                        }
                        this.tHead = table.appendHTML('thead');
                        this.tBody = table.appendHTML('tbody');
                        this.tFoot = table.appendHTML('tfoot');
                    });
                });
                if (this.options.stretchHeight) {
                    this.element.style.position = 'relative';
                    this.element.style.height = '100%';
                    this.tableContainer.style.position = 'absolute';
                    this.tableContainer.style.height = '100%';
                    this.tableContainer.style.left = '0px';
                    this.tableContainer.style.top = '0px';
                    this.tableContainer.style.overflow = 'auto';
                    if (NextAdmin.UserAgent.isDesktop()) {
                        this.tableContainer.appendPerfectScrollbar();
                    }
                }
                this.setStyle(this.options.style);
                Table.onCreated.dispatch(this, this.options);
            }
            setStyle(style) {
                switch (style) {
                    default:
                    case TableStyle.default:
                        this.element.classList.add('next-admin-table-default');
                        break;
                    case TableStyle.modern:
                        this.element.classList.add('next-admin-table-modern');
                        break;
                    case TableStyle.modernNoCellPadding:
                        this.element.classList.add('next-admin-table-modern-no-cell-padding');
                        break;
                    case TableStyle.card:
                        this.element.classList.add('next-admin-table-card');
                        break;
                }
            }
            addHeaderRow(...headerCellCaptions) {
                let tr = document.createElement('tr');
                tr['RowType'] = 'Head';
                if (headerCellCaptions != null) {
                    for (let caption of headerCellCaptions) {
                        tr.addCell(caption);
                    }
                }
                this.tHead.appendChild(tr);
                return tr;
            }
            addBodyRow(...cellContent) {
                let tr = document.createElement('tr');
                tr.classList.add('next-admin-table-row');
                if (cellContent != null) {
                    for (let content of cellContent) {
                        let cell = tr.addCell(content);
                        cell.classList.add('next-admin-table-cell');
                    }
                }
                if (this.options.rowSelectionMode != null && this.options.rowSelectionMode != RowSelectionMode.disabled) {
                    tr.style.cursor = 'pointer';
                }
                tr.addEventListener('click', (e) => {
                    if (this.options.rowSelectionMode != RowSelectionMode.disabled) {
                        this.selectRow(tr);
                    }
                });
                if (this.options.rowHoverable) {
                    tr.addEventListener('pointerenter', (e) => {
                        tr.classList.add('next-admin-table-row-hover');
                    });
                    tr.addEventListener('pointerleave', (e) => {
                        tr.classList.remove('next-admin-table-row-hover');
                    });
                }
                tr['RowType'] = 'Body';
                this.tBody.appendChild(tr);
                this.onRowAdded.dispatch(this, tr);
                return tr;
            }
            addFooterRow() {
                let tr = document.createElement('tr');
                tr['RowType'] = 'Foot';
                this.tFoot.appendChild(tr);
                return tr;
            }
            selectRow(row, fireRowSelectedEvent = true) {
                if (this.options.rowSelectionMode == RowSelectionMode.singleSelect) {
                    for (let otherRow of Array.from(this.tBody.children)) {
                        this.unselectRow(otherRow);
                    }
                }
                if (!row.hasAttribute('selected')) {
                    row.setAttribute('selected', 'true');
                    row.classList.add('next-admin-table-row-selected');
                    if (fireRowSelectedEvent) {
                        this.onRowSelected.dispatch(this, row);
                        this.onSelectedRowsChanged.dispatch(this, this.getSelectedRows());
                    }
                }
                else if (this.options.rowSelectionMode == RowSelectionMode.multiSelect) {
                    this.unselectRow(row);
                }
            }
            unselectRow(row) {
                if (row.hasAttribute('selected')) {
                    row.removeAttribute('selected');
                    row.classList.remove('next-admin-table-row-selected');
                    this.onRowUnselected.dispatch(this, row);
                    this.onSelectedRowsChanged.dispatch(this, this.getSelectedRows());
                }
            }
            unselectAll() {
                for (let row of this.getBodyRows()) {
                    this.unselectRow(row);
                }
            }
            getSelectedRows() {
                let selectedRows = new Array();
                for (let row of Array.from(this.tBody.children)) {
                    if (row.hasAttribute('selected')) {
                        selectedRows.add(row);
                    }
                }
                return selectedRows;
            }
            getBodyRows() {
                let rows = new Array();
                for (let row of Array.from(this.tBody.children)) {
                    rows.add(row);
                }
                return rows;
            }
            getHeaderRows() {
                let rows = new Array();
                for (let row of Array.from(this.tHead.children)) {
                    rows.add(row);
                }
                return rows;
            }
            getColumnCells(index) {
                let columnCells = new Array();
                let headerRows = this.getBodyRows();
                for (let row of headerRows) {
                    let cells = row.getCells();
                    let cell = cells[index];
                    columnCells.add(cell);
                }
                let bodyRows = this.getBodyRows();
                for (let row of bodyRows) {
                    let cells = row.getCells();
                    let cell = cells[index];
                    columnCells.add(cell);
                }
                return columnCells;
            }
            clear(clearTHead = false) {
                if (clearTHead) {
                    this.tHead.innerHTML = '';
                }
                this.tBody.innerHTML = '';
            }
        }
        Table.style = `
        .next-admin-table {
            border-spacing:0px;
        } 
        .next-admin-table thead td {
            position:sticky;
            top:0;
            background:rgba(255,255,255,1)
        } 
        .next-admin-table thead th {
            position:sticky;
            top:0;
            background:rgba(255,255,255,1)
        } 
        .next-admin-table thead .next-admin-table-row-border {
            border-bottom:1px solid #ccc
        } 
        .next-admin-table-row-border {
            border-bottom:1px solid #e5e5e5
        } 
        .next-admin-table-col-border{

        }
        .next-admin-table-row-hover {
            background:rgba(220,220,220,0.2);
            text-shadow:` + UI.DefaultStyle.HoveredRowBackground + `;
        }
        .next-admin-table-row-hover {
            .next-admin-table-cell{
                background:` + UI.DefaultStyle.HoveredRowBackground + `;
            }
        }
        .next-admin-table-row-selected{
            background:` + UI.DefaultStyle.SelectedRowBackground + `;
        }
        .next-admin-table-row-selected{
            .next-admin-table-cell{
                background:` + UI.DefaultStyle.SelectedRowBackground + `;
            }
        }


        .next-admin-table-modern {
            .next-admin-table {
                .next-admin-table-thead-row{
                    .next-admin-table-header-cell{
                        box-shadow:0px 1px 1px rgba(0,0,0,0.25);
                        color:#263544;
                    }
                }

                .next-admin-table-row{
                    box-shadow:0px 1px 1px rgba(0,0,0,0.15);
                    .next-admin-table-cell{
                        padding:10px;
                    }
                }
            }
        }
        .next-admin-table-modern-no-cell-padding {
            .next-admin-table {
                .next-admin-table-thead-row{
                    .next-admin-table-header-cell{
                        box-shadow:0px 1px 1px rgba(0,0,0,0.25);
                        color:#263544;
                    }
                }

                .next-admin-table-row{
                    box-shadow:0px 1px 1px rgba(0,0,0,0.15);
                    .next-admin-table-cell{
                        padding:0px;
                        min-height:
                    }
                }
            }
        }
        .next-admin-table-card {

            .next-admin-table-header{
                background-color:unset;
                border-bottom:0px;
            }

            .next-admin-table {

                .next-admin-table-thead{
                    visibility:collapse;
                }

                border-collapse:separate;
                border-spacing: 0 20px;

                .next-admin-table-row{
                    .next-admin-table-cell{
                        padding:30px;
                        border: solid 1px #ccc;
                        border-style: solid none;
                    }
                    .next-admin-table-cell:first-child {
                        border-left-style: solid;
                        border-top-left-radius: 10px;
                        border-bottom-left-radius: 10px;
                    }
                    .next-admin-table-cell:last-child {
                        border-right-style: solid;
                        border-bottom-right-radius: 10px;
                        border-top-right-radius: 10px;
                    }

                }
                .next-admin-table-row-hover{

                }
            }
        }


        `;
        Table.onCreated = new NextAdmin.EventHandler();
        UI.Table = Table;
        let TableStyle;
        (function (TableStyle) {
            TableStyle[TableStyle["default"] = 0] = "default";
            TableStyle[TableStyle["modern"] = 1] = "modern";
            TableStyle[TableStyle["modernNoCellPadding"] = 2] = "modernNoCellPadding";
            TableStyle[TableStyle["card"] = 3] = "card";
        })(TableStyle = UI.TableStyle || (UI.TableStyle = {}));
        let RowSelectionMode;
        (function (RowSelectionMode) {
            RowSelectionMode[RowSelectionMode["disabled"] = 0] = "disabled";
            RowSelectionMode[RowSelectionMode["singleSelect"] = 1] = "singleSelect";
            RowSelectionMode[RowSelectionMode["multiSelect"] = 2] = "multiSelect";
            RowSelectionMode[RowSelectionMode["multiSelect_CtrlShift"] = 3] = "multiSelect_CtrlShift";
        })(RowSelectionMode = UI.RowSelectionMode || (UI.RowSelectionMode = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
try {
    HTMLTableRowElement.prototype.getCells = function () {
        let cells = new Array();
        if (this['RowType'] == 'Head') {
            for (let cell of Array.from(this.children)) {
                cells.add(cell);
            }
        }
        else {
            for (let cell of Array.from(this.children)) {
                cells.add(cell);
            }
        }
        return cells;
    };
    HTMLTableRowElement.prototype.addCell = function (content = null) {
        let cell;
        if (this['RowType'] == 'Head') {
            cell = document.createElement('th');
            this.appendChild(cell);
        }
        else {
            cell = document.createElement('td');
            this.appendChild(cell);
        }
        if (content != null) {
            cell.innerHTML = content;
        }
        return cell;
    };
}
catch {
}
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Text extends NextAdmin.UI.Control {
            constructor(options) {
                super(options?.htmlTag ?? 'div', {
                    isResponsive: true,
                    size: TextSize.medium,
                    style: TextStyle.dark,
                    ...options
                });
                NextAdmin.Style.append('NextAdmin.UI.Text', Text.style);
                this.element.classList.add('next-admin-text');
                if (this.options.isResponsive) {
                    this.element.classList.add('responsive');
                }
                this.setStyle(this.options.style);
                this.setSize(this.options.size);
                this.setText(this.options.text);
            }
            setText(text) {
                this.element.innerHTML = text ?? '';
            }
            setSize(style) {
                switch (style) {
                    default:
                    case TextSize.medium:
                        this.element.classList.add('next-admin-text-medium');
                        break;
                    case TextSize.large:
                        this.element.classList.add('next-admin-text-large');
                        break;
                }
            }
            setStyle(style) {
                switch (style) {
                    default:
                    case TextStyle.dark:
                        this.element.classList.add('next-admin-text-dark');
                        break;
                    case TextStyle.black:
                        this.element.classList.add('next-admin-text-black');
                        break;
                    case TextStyle.lightGreyThin:
                        this.element.classList.add('next-admin-text-light-grey-thin');
                        break;
                    case TextStyle.greyThin:
                        this.element.classList.add('next-admin-text-grey-thin');
                        break;
                    case TextStyle.darkGreyThin:
                        this.element.classList.add('next-admin-text-dark-grey-thin');
                        break;
                    case TextStyle.lightGrey:
                        this.element.classList.add('next-admin-text-light-grey');
                        break;
                    case TextStyle.grey:
                        this.element.classList.add('next-admin-text-grey');
                        break;
                    case TextStyle.darkGrey:
                        this.element.classList.add('next-admin-text-dark-grey');
                        break;
                }
            }
        }
        Text.style = `

        .next-admin-text{

        }

        .next-admin-text-light-grey-thin{
            color:#999;
            font-weight:100;
        }
        .next-admin-text-grey-thin{
            color:#777;
            font-weight:100;
        }
        .next-admin-text-dark-grey-thin{
            color:#444;
            font-weight:100;
        }
        .next-admin-text-dark-thin{
            color:#222;
            font-weight:100;
        }
        .next-admin-text-light-grey{
            color:#999;
        }
        .next-admin-text-grey-thin{
            color:#777;
        }
        .next-admin-text-dark-grey{
            color:#444;
        }
        .next-admin-text-dark{
            color:#222;
        }
        .next-admin-text-black{
            color:#000;
        }

        .next-admin-text-medium {
            font-size:14px;
        }
        .next-admin-text-medium-responsive {
            @media (max-width: 768px) {
                font-size:12px;
            }
        }
        .next-admin-text-large {
            font-size:20px;
        }
        .next-admin-text-large.responsive{
            @media (max-width: 1280px) {
                font-size:18px;
            }
            @media (max-width: 1024px) {
                font-size:16px;
            }
            @media (max-width: 768px) {
                font-size:14px;
            }
        }

        `;
        UI.Text = Text;
        let TextSize;
        (function (TextSize) {
            TextSize[TextSize["medium"] = 0] = "medium";
            TextSize[TextSize["large"] = 1] = "large";
        })(TextSize = UI.TextSize || (UI.TextSize = {}));
        let TextStyle;
        (function (TextStyle) {
            TextStyle[TextStyle["lightGreyThin"] = 0] = "lightGreyThin";
            TextStyle[TextStyle["greyThin"] = 1] = "greyThin";
            TextStyle[TextStyle["darkGreyThin"] = 2] = "darkGreyThin";
            TextStyle[TextStyle["lightGrey"] = 3] = "lightGrey";
            TextStyle[TextStyle["grey"] = 4] = "grey";
            TextStyle[TextStyle["darkGrey"] = 5] = "darkGrey";
            TextStyle[TextStyle["dark"] = 6] = "dark";
            TextStyle[TextStyle["black"] = 7] = "black";
        })(TextStyle = UI.TextStyle || (UI.TextStyle = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
/// <reference path="LabelFormControl.ts"/>
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class TextArea extends UI.LabelFormControl {
            constructor(options) {
                super({
                    style: TextArea.defaultStyle,
                    ...options
                });
                NextAdmin.Style.append('NextAdmin.UI.TextArea', TextArea.style);
                this.textArea = document.createElement('textarea');
                this.textArea.classList.add('next-admin-textarea');
                this.textArea.addEventListener("input", () => {
                    this.onValueChanged.dispatch(this, { value: this.textArea.value });
                });
                this.controlContainer.appendChild(this.textArea);
                if (this.options.displayMode == TextAreaDisplayMode.stretchHeight) {
                    this.element.style.height = '100%';
                    this.textArea.style.height = '100%';
                }
                else if (this.options.displayMode == TextAreaDisplayMode.fitContent) {
                    this.textArea.addEventListener('input', () => {
                        this.textArea.style.height = "";
                        this.textArea.style.height = this.textArea.scrollHeight + "px";
                    });
                }
                else if (this.options.height) {
                    this.textArea.style.height = this.options.height;
                }
                this.setStyle(this.options.style);
                TextArea.onCreated.dispatch(this, this.options);
            }
            setStyle(style) {
                switch (style) {
                    case UI.InputStyle.default:
                        this.element.classList.add('next-admin-textarea-default');
                        break;
                    default:
                    case UI.InputStyle.modern:
                        this.element.classList.add('next-admin-textarea-modern');
                        break;
                }
            }
            setPlaceholder(text) {
                this.textArea.setAttribute('placeholder', text);
                return this;
            }
            setValue(value, fireChange) {
                let previousValue = this.textArea.value;
                this.textArea.value = value ?? '';
                if (fireChange) {
                    this.onValueChanged.dispatch(this, { value: value, previousValue: previousValue, origin: UI.ChangeOrigin.code });
                }
            }
            getValue() {
                return this.textArea.value;
            }
        }
        TextArea.onCreated = new NextAdmin.EventHandler();
        TextArea.style = `


            .next-admin-textarea {
                border-radius: 4px;
                margin:0px;
                box-sizing:border-box;
                outline:0px;border:1px solid #ccc;
                font-size:14px;
                color:#444;
                padding:6px;
                width:100%;
            }

            .next-admin-textarea-modern {
                .next-admin-textarea {
                    background:#fff;
                    border:1px solid #fff;
                    box-shadow: 0px 0px 2px rgba(0,0,0,0.25);
                    transition: 0.5s;
                }
                .next-admin-textarea:hover{
                    box-shadow: 0px 0px 2px rgba(0,0,0,0.40);
                }
                .next-admin-textarea:focus {
                    border: 1px solid #12101d;
                    text-shadow:0px 0px 2px rgba(0,0,0,0.2);
                }
            }

        `;
        UI.TextArea = TextArea;
        let TextAreaStyle;
        (function (TextAreaStyle) {
            TextAreaStyle[TextAreaStyle["default"] = 0] = "default";
            TextAreaStyle[TextAreaStyle["modern"] = 1] = "modern";
        })(TextAreaStyle = UI.TextAreaStyle || (UI.TextAreaStyle = {}));
        let TextAreaDisplayMode;
        (function (TextAreaDisplayMode) {
            TextAreaDisplayMode[TextAreaDisplayMode["default"] = 0] = "default";
            TextAreaDisplayMode[TextAreaDisplayMode["stretchHeight"] = 1] = "stretchHeight";
            TextAreaDisplayMode[TextAreaDisplayMode["fitContent"] = 2] = "fitContent";
        })(TextAreaDisplayMode = UI.TextAreaDisplayMode || (UI.TextAreaDisplayMode = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class Title extends NextAdmin.UI.Control {
            constructor(options) {
                super(options?.htmlTag ?? 'h1', {
                    isResponsive: true,
                    size: TitleSize.large,
                    style: TitleStyle.greyThin,
                    ...options
                });
                NextAdmin.Style.append('NextAdmin.UI.Title', Title.style);
                this.element.classList.add('next-admin-title');
                if (this.options.isResponsive) {
                    this.element.classList.add('next-admin-title-responsive');
                }
                this.setStyle(this.options.style);
                this.setSize(this.options.size);
                this.setText(this.options.text);
            }
            setText(text) {
                this.element.innerHTML = text ?? '';
            }
            setStyle(style) {
                switch (style) {
                    case TitleStyle.ultraLightGreyThin:
                        this.element.classList.add('next-admin-title-thin-ultra-light-grey');
                        break;
                    case TitleStyle.lightGrey:
                        this.element.classList.add('next-admin-title-light-grey');
                        break;
                    case TitleStyle.lightGreyThin:
                        this.element.classList.add('next-admin-title-thin-light-grey');
                        break;
                    default:
                    case TitleStyle.greyThin:
                        this.element.classList.add('next-admin-title-thin-grey');
                        break;
                    case TitleStyle.grey:
                        this.element.classList.add('next-admin-title-grey');
                        break;
                    case TitleStyle.darkGrey:
                        this.element.classList.add('next-admin-title-dark-grey');
                        break;
                    case TitleStyle.darkGreyThin:
                        this.element.classList.add('next-admin-title-thin-dark-grey');
                        break;
                    case TitleStyle.dark:
                        this.element.classList.add('next-admin-title-dark');
                        break;
                    case TitleStyle.darkThin:
                        this.element.classList.add('next-admin-title-thin-dark');
                        break;
                }
            }
            setSize(size) {
                switch (size) {
                    default:
                    case TitleSize.large:
                        this.element.classList.add('next-admin-title-large');
                        break;
                    case TitleSize.medium:
                        this.element.classList.add('next-admin-title-medium');
                        break;
                    case TitleSize.small:
                        this.element.classList.add('next-admin-title-small');
                        break;
                    case TitleSize.ultraSmall:
                        this.element.classList.add('next-admin-title-ultra-small');
                        break;
                }
            }
        }
        Title.style = `
        .next-admin-title {
            margin-top:5px;
            margin-bottom:5px;
        }

        .next-admin-title-thin-ultra-light-grey{
            font-weight:100;
            color:#bbb;
        }

        .next-admin-title-thin-light-grey{
            font-weight:100;
            color:#999;
        }
        .next-admin-title-light-grey {
            color:#999;
        }

        .next-admin-title-thin-grey {
            font-weight:100;
            color:#777;
        }
        .next-admin-title-grey{
            color:#777;
        }

        .next-admin-title-thin-dark-grey {
            font-weight:100;
            color:#444;
        }
        .next-admin-title-dark-grey {
            color:#444;
        }

        .next-admin-title-thin-dark {
            font-weight:100;
            color:#222;
        }
        .next-admin-title-dark {
            color:#222;
        }

        .next-admin-title-large {
            font-size:36px;
        }
        .next-admin-title-medium {
            font-size:24px;
        }
        .next-admin-title-small {
            font-size:20px;
        }
        .next-admin-title-ultra-small{
            font-size:16px;
        }
        @media (max-width: 1280px) {
            .next-admin-title-responsive.next-admin-title-large {
                font-size:32px;
            }
            .next-admin-title-responsive.next-admin-title-medium {
                font-size:20px;
            }
            .next-admin-title-responsive.next-admin-title-small {
                font-size:18px;
            }
        }
        @media (max-width: 1024px) {
            .next-admin-title-responsive.next-admin-title-large {
                font-size:28px;
            }
            .next-admin-title-responsive.next-admin-title-medium {
                font-size:18px;
            }
            .next-admin-title-responsive.next-admin-title-small {
                font-size:16px;
            }
            .next-admin-title-responsive.next-admin-title-small {
                font-size:14px;
            }
        }
        @media (max-width: 768px) {
            .next-admin-title-responsive.next-admin-title-large {
                font-size:24px;
            }
            .next-admin-title-responsive.next-admin-title-medium {
                font-size:16px;
            }
            .next-admin-title-responsive.next-admin-title-small {
                font-size:14px;
            }
        }
        `;
        UI.Title = Title;
        let TitleSize;
        (function (TitleSize) {
            TitleSize[TitleSize["large"] = 0] = "large";
            TitleSize[TitleSize["medium"] = 1] = "medium";
            TitleSize[TitleSize["small"] = 2] = "small";
            TitleSize[TitleSize["ultraSmall"] = 3] = "ultraSmall";
        })(TitleSize = UI.TitleSize || (UI.TitleSize = {}));
        let TitleStyle;
        (function (TitleStyle) {
            TitleStyle[TitleStyle["ultraLightGreyThin"] = 0] = "ultraLightGreyThin";
            TitleStyle[TitleStyle["lightGrey"] = 1] = "lightGrey";
            TitleStyle[TitleStyle["lightGreyThin"] = 2] = "lightGreyThin";
            TitleStyle[TitleStyle["grey"] = 3] = "grey";
            TitleStyle[TitleStyle["greyThin"] = 4] = "greyThin";
            TitleStyle[TitleStyle["darkGrey"] = 5] = "darkGrey";
            TitleStyle[TitleStyle["darkGreyThin"] = 6] = "darkGreyThin";
            TitleStyle[TitleStyle["dark"] = 7] = "dark";
            TitleStyle[TitleStyle["darkThin"] = 8] = "darkThin";
        })(TitleStyle = UI.TitleStyle || (UI.TitleStyle = {}));
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
var NextAdmin;
(function (NextAdmin) {
    var UI;
    (function (UI) {
        class UserInterfaceHelper {
            getDefaultPropertyDisplayValue(propertyInfo, value) {
                let displayValue = value == null ? '' : value;
                if (propertyInfo != null) {
                    if (value != null && propertyInfo.values != null && propertyInfo.values.length > 0) {
                        if (propertyInfo.type == 'string') {
                            let selectValudes = value.split(',');
                            displayValue = propertyInfo.values.where(e => selectValudes.contains(e.value.toString())).select(e => e.label).join(', ');
                        }
                        else {
                            let valueItem = propertyInfo.values.firstOrDefault(e => e.value == value);
                            if (valueItem != null) {
                                displayValue = valueItem.label;
                            }
                        }
                    }
                    else if (!NextAdmin.String.isNullOrEmpty(value) && propertyInfo.type == 'date') {
                        displayValue = new Date(value).toLocaleDateString();
                    }
                    else if (value && propertyInfo.type == 'number') {
                        let numberValue = Number(value);
                        displayValue = (Number.isInteger(numberValue) ? value + '' : numberValue.toFixed(UserInterfaceHelper.DefaultNumberDecimalCount)).replace(/\B(?=(\d{3})+(?!\d))/g, " ");
                    }
                    else if (value != null && propertyInfo.type == 'boolean') {
                        displayValue = value ? NextAdmin.Resources.yes : NextAdmin.Resources.no;
                    }
                }
                return displayValue;
            }
            getDefaultPropertyHtmlElement(propertyInfo, value, onReady) {
                let element = document.createElement('span');
                if (propertyInfo?.type == 'number') {
                    element.style.cssFloat = 'right';
                }
                element.innerHTML = this.getDefaultPropertyDisplayValue(propertyInfo, value);
                if (onReady) {
                    onReady(element);
                }
                return element;
            }
            getDefaultPropertyHtmlElementAsync(propertyInfo, value) {
                return new Promise((resolve) => {
                    this.getDefaultPropertyHtmlElement(propertyInfo, value, (element) => {
                        resolve(element);
                    });
                });
            }
            getDefaultPropertyFormControl(propertyInfo, inlineControl) {
                if (!NextAdmin.String.isNullOrEmpty(propertyInfo.foreignDataName) && !propertyInfo.isPrimaryKey) { //lookup
                    return new NextAdmin.UI.DataSelect({ inlineGrid: inlineControl });
                }
                else if (propertyInfo.values != null && propertyInfo.values.length > 0) {
                    if (propertyInfo.type == 'string') {
                        return new NextAdmin.UI.MultiInputSelect({ inlineGrid: inlineControl });
                    }
                    else {
                        return new NextAdmin.UI.Select({ inlineGrid: inlineControl });
                    }
                }
                else {
                    switch (propertyInfo.type) {
                        default:
                        case 'string':
                            return new NextAdmin.UI.Input({ inputType: NextAdmin.UI.InputType.text, inlineGrid: inlineControl });
                        case 'number':
                            return new NextAdmin.UI.Input({ inputType: NextAdmin.UI.InputType.number, inlineGrid: inlineControl });
                        case 'date':
                            return new NextAdmin.UI.Input({ inputType: NextAdmin.UI.InputType.date, inlineGrid: inlineControl });
                        case 'boolean':
                            return new NextAdmin.UI.Input({ inputType: NextAdmin.UI.InputType.checkbox, inlineGrid: inlineControl });
                    }
                }
            }
        }
        UserInterfaceHelper.noSelectStyle = `
        .no-select{
            -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none; /* Safari */
            -khtml-user-select: none; /* Konqueror HTML */
            -moz-user-select: none; /* Old versions of Firefox */
            -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currentlysupported by Chrome, Edge, Opera and Firefox */
        }
        `;
        UserInterfaceHelper.noScrollbarStyle = `
        .no-scrollbar::-webkit-scrollbar{
            display: none;
        }
        `;
        UserInterfaceHelper.DefaultNumberDecimalCount = 2;
        UI.UserInterfaceHelper = UserInterfaceHelper;
        UI.Helper = new UserInterfaceHelper();
    })(UI = NextAdmin.UI || (NextAdmin.UI = {}));
})(NextAdmin || (NextAdmin = {}));
//# sourceMappingURL=NextAdmin.Core.js.map